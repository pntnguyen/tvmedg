<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Update tvmedg</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="run_files/libs/clipboard/clipboard.min.js"></script>
<script src="run_files/libs/quarto-html/quarto.js"></script>
<script src="run_files/libs/quarto-html/popper.min.js"></script>
<script src="run_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="run_files/libs/quarto-html/anchor.min.js"></script>
<link href="run_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="run_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="run_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="run_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="run_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#import-data" id="toc-import-data" class="nav-link active" data-scroll-target="#import-data">Import data</a></li>
  <li><a href="#process-data-function" id="toc-process-data-function" class="nav-link" data-scroll-target="#process-data-function">Process data function</a>
  <ul class="collapse">
  <li><a href="#default-output" id="toc-default-output" class="nav-link" data-scroll-target="#default-output">Default output</a></li>
  <li><a href="#output-with-tvar_to_med-true" id="toc-output-with-tvar_to_med-true" class="nav-link" data-scroll-target="#output-with-tvar_to_med-true">Output with tvar_to_med = TRUE</a></li>
  <li><a href="#output-with-continous-exposure-with-standardize-splines" id="toc-output-with-continous-exposure-with-standardize-splines" class="nav-link" data-scroll-target="#output-with-continous-exposure-with-standardize-splines">Output with continous exposure with standardize, splines,</a></li>
  <li><a href="#output-with-continous-exposure-without-standardize-splines" id="toc-output-with-continous-exposure-without-standardize-splines" class="nav-link" data-scroll-target="#output-with-continous-exposure-without-standardize-splines">Output with continous exposure without standardize, splines</a></li>
  </ul></li>
  <li><a href="#fitg-function" id="toc-fitg-function" class="nav-link" data-scroll-target="#fitg-function">fitg function</a>
  <ul class="collapse">
  <li><a href="#output-with-continuous-exposure-and-splines-list" id="toc-output-with-continuous-exposure-and-splines-list" class="nav-link" data-scroll-target="#output-with-continuous-exposure-and-splines-list">Output with continuous exposure and splines list</a></li>
  <li><a href="#data-cũ" id="toc-data-cũ" class="nav-link" data-scroll-target="#data-cũ">data cũ</a></li>
  </ul></li>
  <li><a href="#baseline_mc-function" id="toc-baseline_mc-function" class="nav-link" data-scroll-target="#baseline_mc-function">Baseline_mc function</a>
  <ul class="collapse">
  <li><a href="#output-with-standardized-continous-exposure" id="toc-output-with-standardized-continous-exposure" class="nav-link" data-scroll-target="#output-with-standardized-continous-exposure">Output with standardized continous exposure</a></li>
  </ul></li>
  <li><a href="#g_form-function" id="toc-g_form-function" class="nav-link" data-scroll-target="#g_form-function">g_form function</a>
  <ul class="collapse">
  <li><a href="#output-with-continous-exposuse-and-not-standardize" id="toc-output-with-continous-exposuse-and-not-standardize" class="nav-link" data-scroll-target="#output-with-continous-exposuse-and-not-standardize">Output with continous exposuse and not standardize</a></li>
  </ul></li>
  <li><a href="#additional-function" id="toc-additional-function" class="nav-link" data-scroll-target="#additional-function">Additional function</a></li>
  <li><a href="#final-tvmedg-function" id="toc-final-tvmedg-function" class="nav-link" data-scroll-target="#final-tvmedg-function">Final tvmedg function</a></li>
  <li><a href="#run" id="toc-run" class="nav-link" data-scroll-target="#run">run</a>
  <ul class="collapse">
  <li><a href="#default" id="toc-default" class="nav-link" data-scroll-target="#default">Default</a></li>
  <li><a href="#đổi-các-agument" id="toc-đổi-các-agument" class="nav-link" data-scroll-target="#đổi-các-agument">Đổi các agument</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Update tvmedg</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="import-data" class="level1">
<h1>Import data</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/tvmed_dat100_12mo.RDS"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dat0 <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,147 × 13
      id    mm    Ap    Mp    L1    L2    L3    Yp   age   sex    ow  risk
   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1     1     1     0     0     0  100   80       0  10.9     1     1     0
 2     1     2     0     0     0  131.  88.1     0  10.9     1     1     0
 3     1     3     0     0     0  125.  97.6     0  10.9     1     1     0
 4     1     4     0     0     0  135. 112.      0  10.9     1     1     0
 5     1     5     0     0     0  124. 108.      0  10.9     1     1     0
 6     1     6     0     0     0  141. 123.      0  10.9     1     1     0
 7     1     7     0     0     0  119. 128.      0  10.9     1     1     0
 8     1     8     0     0     0  141. 114.      0  10.9     1     1     0
 9     1     9     0     0     0  155. 127.      0  10.9     1     1     0
10     1    10     0     0     0  135. 102.      0  10.9     1     1     0
# ℹ 1,137 more rows
# ℹ 1 more variable: lastid &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="process-data-function" class="level1">
<h1>Process data function</h1>
<p>Em rút gọn continuous exposure còn 2 argument thôi, cont_exp = NULL =&gt; binary, cont_exp_std = F giới hạn chỉ xài được khi đã define continous exposure</p>
<p>Về phần splines em định nghĩa là nếu mọi thứ null thì mình smooth time variables với df là 3 luôn, mình có thể có options là nếu mọi thứ NULL thì không smooth time. Do em quên không note nên khúc đó không nhớ nhóm mình có thống nhất với nhau không, em đọc lại study plan thì trước mắt là code theo ý hiểu của em như thế này.</p>
<p>Có một vấn đề mình cần cân nhắc là splines và standardize có apply cho lag luôn không? Em đang code là apply cho lag luôn</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>process_data <span class="ot">&lt;-</span> <span class="cf">function</span>(basec,expo,med,tvar,lag,outc,time,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">norev =</span> <span class="cn">NULL</span>,<span class="at">tvar_to_med =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cont_exp =</span> <span class="cn">NULL</span>,<span class="at">cont_exp_std =</span> F,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sp_list =</span> <span class="cn">NULL</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sp_type =</span> <span class="cn">NULL</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sp_df=</span> <span class="cn">NULL</span>, data){</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## detect which variables are non-reversible</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(expo <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    norev_expo <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"A"</span>,<span class="fu">which</span>(expo <span class="sc">%in%</span> norev))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    norev_expo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(med <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    norev_med <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="fu">which</span>(med <span class="sc">%in%</span> norev))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    norev_med <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(tvar <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    norev_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="fu">which</span>(tvar <span class="sc">%in%</span> norev))</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    norev_tvar <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  norev_var <span class="ot">&lt;-</span> <span class="fu">c</span>(norev_expo,norev_med,norev_tvar)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  sp_var <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## detect which variables in splines list</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="do">### time-fixed var</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(sp_list <span class="sc">%in%</span> basec)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    sp_fix <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"v"</span>,<span class="fu">which</span>(basec <span class="sc">%in%</span> sp_list))</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    sp_fix <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  sp_var[<span class="fu">which</span>(sp_list <span class="sc">%in%</span> basec)] <span class="ot">&lt;-</span> sp_fix</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="do">## exposure var</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(sp_list <span class="sc">%in%</span> expo)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    sp_expo <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"A"</span>,<span class="fu">which</span>(expo <span class="sc">%in%</span> sp_list))</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    sp_expo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  sp_var[<span class="fu">which</span>(sp_list <span class="sc">%in%</span> expo)] <span class="ot">&lt;-</span> sp_expo</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  <span class="do">## mediator var</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(sp_list <span class="sc">%in%</span> med)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    sp_med <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="fu">which</span>(med <span class="sc">%in%</span> sp_list))</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    sp_med <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  sp_var[<span class="fu">which</span>(sp_list <span class="sc">%in%</span> med)] <span class="ot">&lt;-</span> sp_med</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-varying var</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(sp_list <span class="sc">%in%</span> tvar)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    sp_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="fu">which</span>(tvar <span class="sc">%in%</span> sp_list))</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    sp_tvar <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>  sp_var[<span class="fu">which</span>(sp_list <span class="sc">%in%</span> tvar)] <span class="ot">&lt;-</span> sp_tvar</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time var</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(sp_list <span class="sc">%in%</span> time)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    sp_time <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"j"</span>)</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>    sp_time <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>  sp_var[<span class="fu">which</span>(sp_list <span class="sc">%in%</span> time)] <span class="ot">&lt;-</span> sp_time</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>  <span class="do">## continous exposure</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(cont_exp) <span class="sc">&amp;</span> cont_exp_std <span class="sc">==</span> T){</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"standardize only applicable when continuous exposure was defined, default is NULL"</span>)</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.null</span>(cont_exp) <span class="sc">&amp;</span> cont_exp_std <span class="sc">==</span> F){</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    <span class="do">## binary exposure</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    expo_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cont_exp) <span class="sc">&amp;</span> cont_exp <span class="sc">!=</span> expo){</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"defined continuous exposure was not the input exposure"</span>)</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cont_exp) <span class="sc">&amp;</span> cont_exp_std <span class="sc">==</span> F){</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>    <span class="do">## continuous exposure without standardize</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>    expo_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(data[,expo])</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cont_exp) <span class="sc">&amp;</span> cont_exp_std <span class="sc">==</span> T){</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>    <span class="do">## continuous exposure with standardize</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>    expo_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>    data[,expo] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(data[,expo]))</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of time-fixed variables</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>  name_v <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"v"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(basec))</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> data<span class="sc">$</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(data[,basec]) <span class="sc">%&gt;%</span> </span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">c</span>(<span class="st">"id"</span>,name_v))</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of exposure variables  </span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>  name_e <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"A"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(expo))</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of mediator variables  </span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>  name_me <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med))</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of time-varying variables  </span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>  name_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar))</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lag){</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>    <span class="do">## column name of lag effect on exposure variable</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>    co_ex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_e,<span class="st">"l"</span>,i)</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>    co_me <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_me,<span class="st">"l"</span>,i)</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>    co_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_tvar,<span class="st">"l"</span>,i)</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_e)){</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>      out[,name_e[k]] <span class="ot">&lt;-</span> data[,expo[k]]</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>      name_ep <span class="ot">&lt;-</span> {{co_ex}}[k]</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>          {{name_ep}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_e[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,expo[k]])</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_me)){</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>      out[,name_me[k]] <span class="ot">&lt;-</span> data[,med[k]]</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>      name_med <span class="ot">&lt;-</span> {{co_me}}[k]</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>          {{name_med}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_me[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,med[k]])</span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>    }  </span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_tvar)){</span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>      out[,name_tvar[k]] <span class="ot">&lt;-</span> data[,tvar[k]]</span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>      name_tv <span class="ot">&lt;-</span> {{co_tvar}}[k]</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>          {{name_tv}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_tvar[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,tvar[k]])</span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>  <span class="do">## outcome variable</span></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>Y <span class="ot">&lt;-</span> data[,outc]</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time variable</span></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>j <span class="ot">&lt;-</span> data[,time]</span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a>  kq <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>  kq<span class="sc">$</span>df <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() </span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>  kq<span class="sc">$</span>norev_var <span class="ot">&lt;-</span> norev_var</span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>  kq<span class="sc">$</span>am <span class="ot">&lt;-</span>  expo_mean</span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column name</span></span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"A"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>  tf <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>  tva <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"L"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>  mediator <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"M"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>  outcome <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"Y"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"j"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>  <span class="do">### exposure variable</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(eps <span class="sc">%in%</span> sp_var)){</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>    ep_sp <span class="ot">&lt;-</span> sp_type[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> eps)]</span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>    ep_df <span class="ot">&lt;-</span> sp_df[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> eps)]</span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>    eps <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,ep_sp,<span class="st">"("</span>,eps,<span class="st">",df="</span>,ep_df,<span class="st">")"</span>)</span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>  <span class="do">### time-fixed variables</span></span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(tf <span class="sc">%in%</span> sp_var)){</span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>    tf_sp <span class="ot">&lt;-</span> sp_type[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> tf)]</span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>    tf_df <span class="ot">&lt;-</span> sp_df[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> tf)]</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>    tf_v <span class="ot">&lt;-</span> <span class="fu">keep</span>(tf, <span class="sc">~</span> <span class="fu">any</span>(<span class="fu">str_starts</span>(.x, sp_var)))</span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>    tf <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,tf_sp,<span class="st">"("</span>,tf_v,<span class="st">",df="</span>,tf_df,<span class="st">")"</span>)</span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a>  <span class="do">### mediator variables</span></span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(mediator <span class="sc">%in%</span> sp_var)){</span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>    mediator_sp <span class="ot">&lt;-</span> sp_type[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> mediator)]</span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a>    mediator_df <span class="ot">&lt;-</span> sp_df[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> mediator)]</span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a>    mediator_v <span class="ot">&lt;-</span> <span class="fu">keep</span>(tva, <span class="sc">~</span> <span class="fu">any</span>(<span class="fu">str_starts</span>(.x, sp_var)))</span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>    mediator <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,mediator_sp,<span class="st">"("</span>,mediator_v,<span class="st">",df="</span>,mediator_df,<span class="st">")"</span>)</span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a>  <span class="do">### time-varying variables</span></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(tva <span class="sc">%in%</span> sp_var)){</span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a>    tva_sp <span class="ot">&lt;-</span> sp_type[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> tva)]</span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a>    tva_df <span class="ot">&lt;-</span> sp_df[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> tva)]</span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a>    tva_v <span class="ot">&lt;-</span> <span class="fu">keep</span>(tva, <span class="sc">~</span> <span class="fu">any</span>(<span class="fu">str_starts</span>(.x, sp_var)))</span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a>    tva <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,tva_sp,<span class="st">"("</span>,tva_v,<span class="st">",df="</span>,tva_df,<span class="st">")"</span>)</span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>  <span class="do">### time variables</span></span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(timee <span class="sc">%in%</span> sp_var)){</span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>    timee_sp <span class="ot">&lt;-</span> sp_type[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> timee)]</span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>    timee_df <span class="ot">&lt;-</span> sp_df[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> timee)]</span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a>    timee <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,timee_sp,<span class="st">"(jj,df="</span>,timee_df,<span class="st">")"</span>)</span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>    timee <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,<span class="st">"bs"</span>,<span class="st">"(jj,df="</span>,<span class="dv">3</span>,<span class="st">")"</span>)</span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>  <span class="do">## formula for M(t)</span></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>  l_tm1 <span class="ot">&lt;-</span> tva[<span class="sc">!</span>tva <span class="sc">%in%</span> name_tvar]</span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>  m_tm1 <span class="ot">&lt;-</span> mediator[<span class="sc">!</span>mediator <span class="sc">%in%</span> name_me]</span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tvar_to_med <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>    formula_mt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med)){</span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>      formula_mt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_me[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,l_tm1,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fm <span class="ot">&lt;-</span> formula_mt</span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for L(t)</span></span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a>    formular_lt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar)){</span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a>      formular_lt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_tvar[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,mediator,l_tm1,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fl <span class="ot">&lt;-</span> formular_lt</span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for Y(t)</span></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a>    formular_y <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome,<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,mediator,tva,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fy <span class="ot">&lt;-</span> formular_y</span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a>    formula_mt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med)){</span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>      formula_mt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_me[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,name_tvar,l_tm1,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fm <span class="ot">&lt;-</span> formula_mt</span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for L(t)</span></span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a>    formular_lt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar)){</span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a>      formular_lt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_tvar[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,l_tm1,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fl <span class="ot">&lt;-</span> formular_lt</span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for Y(t)</span></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a>    formular_y <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome,<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,tva,mediator,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fy <span class="ot">&lt;-</span> formular_y</span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(kq)</span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="default-output" class="level2">
<h2 class="anchored" data-anchor-id="default-output">Default output</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cont_exp = c("L2"),</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cont_exp_std = T,</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_list = c("mm","L1","sex"),</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_type = c("ns","bs","bs"),</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_df= c(3,3,3),</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ df       :'data.frame':  1147 obs. of  19 variables:
  ..$ id  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v1  : num [1:1147] 10.9 10.9 10.9 10.9 10.9 ...
  ..$ v2  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v3  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v4  : int [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ A1  : num [1:1147] 100 131 125 135 124 ...
  ..$ A1l1: num [1:1147] 100 100 131 125 135 ...
  ..$ M1  : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ M1l1: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1  : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1l1: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L2  : num [1:1147] 80 88.1 97.6 112.2 108.1 ...
  ..$ L2l1: num [1:1147] 80 80 88.1 97.6 112.2 ...
  ..$ A1l2: num [1:1147] 100 100 100 131 125 ...
  ..$ M1l2: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1l2: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L2l2: num [1:1147] 80 80 80 88.1 97.6 ...
  ..$ Y   : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ j   : num [1:1147] 1 2 3 4 5 6 7 8 9 10 ...
 $ norev_var: chr "M1"
 $ am       : num 0
 $ fm       :List of 1
  ..$ : chr "M1 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + L1l1 + L2l1 + L1l2 + L2l2 + v1 + v2 + v3 + v4 + splines::bs(jj,df=3)"
 $ fl       :List of 2
  ..$ : chr "L1 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + L1l1 + L2l1 + L1l2 + L2l2 + v1 + v2 + v3 + v4 + splines::bs(jj,df=3)"
  ..$ : chr "L2 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + L1l1 + L2l1 + L1l2 + L2l2 + v1 + v2 + v3 + v4 + splines::bs(jj,df=3)"
 $ fy       : chr "Y ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + L1 + L1l1 + L2 + L2l1 + L1l2 + L2l2 + v1 + v2 + v3 + v4 + splines::bs(jj,df=3)"</code></pre>
</div>
</div>
</section>
<section id="output-with-tvar_to_med-true" class="level2">
<h2 class="anchored" data-anchor-id="output-with-tvar_to_med-true">Output with tvar_to_med = TRUE</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> T,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cont_exp = c("L2"),</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cont_exp_std = T,</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_list = c("mm","L1","sex"),</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_type = c("ns","bs","bs"),</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_df= c(3,3,3),</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ df       :'data.frame':  1147 obs. of  19 variables:
  ..$ id  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v1  : num [1:1147] 10.9 10.9 10.9 10.9 10.9 ...
  ..$ v2  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v3  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v4  : int [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ A1  : num [1:1147] 100 131 125 135 124 ...
  ..$ A1l1: num [1:1147] 100 100 131 125 135 ...
  ..$ M1  : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ M1l1: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1  : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1l1: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L2  : num [1:1147] 80 88.1 97.6 112.2 108.1 ...
  ..$ L2l1: num [1:1147] 80 80 88.1 97.6 112.2 ...
  ..$ A1l2: num [1:1147] 100 100 100 131 125 ...
  ..$ M1l2: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1l2: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L2l2: num [1:1147] 80 80 80 88.1 97.6 ...
  ..$ Y   : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ j   : num [1:1147] 1 2 3 4 5 6 7 8 9 10 ...
 $ norev_var: chr "M1"
 $ am       : num 0
 $ fm       :List of 1
  ..$ : chr "M1 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + L1 + L2 + L1l1 + L2l1 + L1l2 + L2l2 + v1 + v2 + v3 + v4 + splines::bs(jj,df=3)"
 $ fl       :List of 2
  ..$ : chr "L1 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + L1l1 + L2l1 + L1l2 + L2l2 + v1 + v2 + v3 + v4 + splines::bs(jj,df=3)"
  ..$ : chr "L2 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + L1l1 + L2l1 + L1l2 + L2l2 + v1 + v2 + v3 + v4 + splines::bs(jj,df=3)"
 $ fy       : chr "Y ~ A1 + A1l1 + A1l2 + L1 + L1l1 + L2 + L2l1 + L1l2 + L2l2 + M1 + M1l1 + M1l2 + v1 + v2 + v3 + v4 + splines::bs(jj,df=3)"</code></pre>
</div>
</div>
</section>
<section id="output-with-continous-exposure-with-standardize-splines" class="level2">
<h2 class="anchored" data-anchor-id="output-with-continous-exposure-with-standardize-splines">Output with continous exposure with standardize, splines,</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> T,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"mm"</span>,<span class="st">"L1"</span>,<span class="st">"sex"</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"bs"</span>,<span class="st">"bs"</span>,<span class="st">"ns"</span>),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ df       :'data.frame':  1147 obs. of  19 variables:
  ..$ id  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v1  : num [1:1147] 10.9 10.9 10.9 10.9 10.9 ...
  ..$ v2  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v3  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v4  : int [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ A1  : num [1:1147] -1.921 0.274 -0.112 0.603 -0.176 ...
  ..$ A1l1: num [1:1147] -1.921 -1.921 0.274 -0.112 0.603 ...
  ..$ M1  : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ M1l1: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1  : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1l1: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L2  : num [1:1147] 80 88.1 97.6 112.2 108.1 ...
  ..$ L2l1: num [1:1147] 80 80 88.1 97.6 112.2 ...
  ..$ A1l2: num [1:1147] -1.921 -1.921 -1.921 0.274 -0.112 ...
  ..$ M1l2: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1l2: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L2l2: num [1:1147] 80 80 80 88.1 97.6 ...
  ..$ Y   : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ j   : num [1:1147] 1 2 3 4 5 6 7 8 9 10 ...
 $ norev_var: chr "M1"
 $ am       : num 0
 $ fm       :List of 1
  ..$ : chr "M1 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + splines::bs(L1,df=3) + splines::bs(L1l1,df=3) + splines::bs(L1l2,df=3) + "| __truncated__
 $ fl       :List of 2
  ..$ : chr "L1 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + splines::bs(L1,df=3) + splines::bs(L1l1,df=3) + splines::bs(L1l2,df="| __truncated__
  ..$ : chr "L2 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + splines::bs(L1,df=3) + splines::bs(L1l1,df=3) + splines::bs(L1l2,df="| __truncated__
 $ fy       : chr "Y ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + splines::bs(L1,df=3) + splines::bs(L1l1,df=3) + splines::bs(L1l2,df=3"| __truncated__</code></pre>
</div>
</div>
</section>
<section id="output-with-continous-exposure-without-standardize-splines" class="level2">
<h2 class="anchored" data-anchor-id="output-with-continous-exposure-without-standardize-splines">Output with continous exposure without standardize, splines</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> F,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"mm"</span>,<span class="st">"L1"</span>,<span class="st">"sex"</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"bs"</span>,<span class="st">"bs"</span>,<span class="st">"ns"</span>),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 6
 $ df       :'data.frame':  1147 obs. of  19 variables:
  ..$ id  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v1  : num [1:1147] 10.9 10.9 10.9 10.9 10.9 ...
  ..$ v2  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v3  : int [1:1147] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v4  : int [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ A1  : num [1:1147] 100 131 125 135 124 ...
  ..$ A1l1: num [1:1147] 100 100 131 125 135 ...
  ..$ M1  : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ M1l1: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1  : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1l1: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L2  : num [1:1147] 80 88.1 97.6 112.2 108.1 ...
  ..$ L2l1: num [1:1147] 80 80 88.1 97.6 112.2 ...
  ..$ A1l2: num [1:1147] 100 100 100 131 125 ...
  ..$ M1l2: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1l2: num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L2l2: num [1:1147] 80 80 80 88.1 97.6 ...
  ..$ Y   : num [1:1147] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ j   : num [1:1147] 1 2 3 4 5 6 7 8 9 10 ...
 $ norev_var: chr "M1"
 $ am       : num 127
 $ fm       :List of 1
  ..$ : chr "M1 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + splines::bs(L1,df=3) + splines::bs(L1l1,df=3) + splines::bs(L1l2,df=3) + "| __truncated__
 $ fl       :List of 2
  ..$ : chr "L1 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + splines::bs(L1,df=3) + splines::bs(L1l1,df=3) + splines::bs(L1l2,df="| __truncated__
  ..$ : chr "L2 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + splines::bs(L1,df=3) + splines::bs(L1l1,df=3) + splines::bs(L1l2,df="| __truncated__
 $ fy       : chr "Y ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + splines::bs(L1,df=3) + splines::bs(L1l1,df=3) + splines::bs(L1l2,df=3"| __truncated__</code></pre>
</div>
</div>
</section>
</section>
<section id="fitg-function" class="level1">
<h1>fitg function</h1>
<p>Chổ binomial và gaussian em không đổi được, do em assign nó thẳng vô family của glm luôn. Rồi lúc predict ở dưới em extract từ model ra nên nếu chuyển sang lm với logistic nó hơi lằng nhằng :))</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## cen_and_scale function</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>cen_and_scale <span class="ot">&lt;-</span> <span class="cf">function</span>(time){</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  j_out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  jj <span class="ot">&lt;-</span> time <span class="sc">%&gt;%</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale</span>() </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"jj"</span>]] <span class="ot">&lt;-</span> jj <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"mean_j"</span>]] <span class="ot">&lt;-</span> <span class="fu">attributes</span>(jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"sd_j"</span>]] <span class="ot">&lt;-</span> <span class="fu">attributes</span>(jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  j_out</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>resamp <span class="ot">&lt;-</span> <span class="cf">function</span>(data,<span class="at">boot =</span> <span class="cn">FALSE</span>){</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> data</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set.seed(seed)</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("Running SEED", seed, "\n")</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("\n")</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("Resampling Data", "\n")</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(df<span class="sc">$</span>id))</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters), <span class="fu">length</span>(clusters), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters[index])</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  boot_df <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(boot <span class="sc">==</span> F) {</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># not doing bootstrap</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    boot_df <span class="ot">&lt;-</span> df </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loop over repeated id</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>id, zzz)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>      boot_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(boot_df, cc)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  boot_df<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(boot_df<span class="sc">$</span>j)<span class="sc">$</span>jj</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>  boot_df</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>fitg <span class="ot">&lt;-</span> <span class="cf">function</span>(data,<span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">yreg =</span> <span class="st">"binomial"</span>){</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <span class="fu">resamp</span>(<span class="at">data =</span> data<span class="sc">$</span>df,<span class="at">boot =</span> boot)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  fitR <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>df <span class="ot">&lt;-</span> res_df <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">#----- fit parametric models for</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Mediator models</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(mreg) <span class="sc">!=</span> <span class="fu">length</span>(data<span class="sc">$</span>fm)){</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"the defined regression of M is not equal"</span>)</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>fm)){</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    fitM <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fm[[i]])</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>    fitR<span class="sc">$</span>M[[i]] <span class="ot">&lt;-</span> <span class="fu">glm</span>(fitM ,<span class="at">family =</span> mreg[i], <span class="at">data =</span> res_df) </span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Covariate models</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(lreg) <span class="sc">!=</span> <span class="fu">length</span>(data<span class="sc">$</span>fl)){</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"the defined regression of L is not equal"</span>)</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>fl)){</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>    fitL <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fl[[i]])</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>    fitR<span class="sc">$</span>L[[i]] <span class="ot">&lt;-</span> <span class="fu">glm</span>(fitL ,<span class="at">family =</span> lreg[i], <span class="at">data =</span> res_df) </span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Outcome model: </span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>  fitY <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fy)</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>Y <span class="ot">&lt;-</span>  <span class="fu">glm</span>(fitY ,<span class="at">family =</span> yreg, <span class="at">data =</span> res_df) </span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>am <span class="ot">&lt;-</span> data<span class="sc">$</span>am</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>  fitR</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="output-with-continuous-exposure-and-splines-list" class="level2">
<h2 class="anchored" data-anchor-id="output-with-continuous-exposure-and-splines-list">Output with continuous exposure and splines list</h2>
<p>Chổ này run ra coefficient của mình bị NA. Em có check lại bằng skeleton code thì cũng v. Em nghĩ do data mới này có vấn đề. Em import lại data chưa có 12mo thì mọi thứ bình thường á a.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> T,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"mm"</span>,<span class="st">"L1"</span>,<span class="st">"sex"</span>),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"bs"</span>,<span class="st">"bs"</span>,<span class="st">"ns"</span>),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>  <span class="fu">fitg</span>(<span class="at">boot=</span>T,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">yreg =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$df
# A tibble: 1,141 × 21
      id    v1    v2    v3    v4     A1   A1l1    M1  M1l1    L1  L1l1    L2
   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1  10.9     1     1     0 -1.92  -1.92      0     0     0     0  80  
 2     1  10.9     1     1     0  0.274 -1.92      0     0     0     0  88.1
 3     1  10.9     1     1     0 -0.112  0.274     0     0     0     0  97.6
 4     1  10.9     1     1     0  0.603 -0.112     0     0     0     0 112. 
 5     1  10.9     1     1     0 -0.176  0.603     0     0     0     0 108. 
 6     1  10.9     1     1     0  1.05  -0.176     0     0     0     0 123. 
 7     1  10.9     1     1     0 -0.567  1.05      0     0     0     0 128. 
 8     1  10.9     1     1     0  1.05  -0.567     0     0     0     0 114. 
 9     1  10.9     1     1     0  2.04   1.05      0     0     0     0 127. 
10     1  10.9     1     1     0  0.601  2.04      0     0     0     0 102. 
# ℹ 1,131 more rows
# ℹ 9 more variables: L2l1 &lt;dbl&gt;, A1l2 &lt;dbl&gt;, M1l2 &lt;dbl&gt;, L1l2 &lt;dbl&gt;,
#   L2l2 &lt;dbl&gt;, Y &lt;dbl&gt;, j &lt;dbl&gt;, bid &lt;chr&gt;, jj &lt;dbl&gt;

$M
$M[[1]]

Call:  glm(formula = fitM, family = mreg[i], data = res_df)

Coefficients:
               (Intercept)                          A1  
                   -9.6769                     -0.2938  
                      A1l1                        A1l2  
                   -1.2805                     -0.8468  
                      M1l1                        M1l2  
                   22.6549                      0.2143  
  splines::bs(L1, df = 3)1    splines::bs(L1, df = 3)2  
                        NA                          NA  
  splines::bs(L1, df = 3)3  splines::bs(L1l1, df = 3)1  
                        NA                          NA  
splines::bs(L1l1, df = 3)2  splines::bs(L1l1, df = 3)3  
                        NA                          NA  
splines::bs(L1l2, df = 3)1  splines::bs(L1l2, df = 3)2  
                        NA                          NA  
splines::bs(L1l2, df = 3)3    splines::ns(v2, df = 4)1  
                        NA                          NA  
  splines::ns(v2, df = 4)2    splines::ns(v2, df = 4)3  
                  -10.9655                          NA  
  splines::ns(v2, df = 4)4    splines::bs(jj, df = 3)1  
                        NA                      2.2213  
  splines::bs(jj, df = 3)2    splines::bs(jj, df = 3)3  
                   11.6284                      0.0660  

Degrees of Freedom: 1140 Total (i.e. Null);  1131 Residual
Null Deviance:      353.2 
Residual Deviance: 122.8    AIC: 142.8


$L
$L[[1]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
               (Intercept)                          A1  
                -2.657e+01                   1.294e-14  
                      A1l1                        A1l2  
                -9.513e-15                  -1.068e-14  
                        M1                        M1l1  
                 9.775e-15                   3.577e-15  
                      M1l2    splines::bs(L1, df = 3)1  
                -9.340e-15                          NA  
  splines::bs(L1, df = 3)2    splines::bs(L1, df = 3)3  
                        NA                          NA  
splines::bs(L1l1, df = 3)1  splines::bs(L1l1, df = 3)2  
                        NA                          NA  
splines::bs(L1l1, df = 3)3  splines::bs(L1l2, df = 3)1  
                        NA                          NA  
splines::bs(L1l2, df = 3)2  splines::bs(L1l2, df = 3)3  
                        NA                          NA  
  splines::ns(v2, df = 4)1    splines::ns(v2, df = 4)2  
                        NA                   7.464e-13  
  splines::ns(v2, df = 4)3    splines::ns(v2, df = 4)4  
                        NA                          NA  
  splines::bs(jj, df = 3)1    splines::bs(jj, df = 3)2  
                 4.154e-13                   7.641e-14  
  splines::bs(jj, df = 3)3  
                 2.141e-13  

Degrees of Freedom: 1140 Total (i.e. Null);  1130 Residual
Null Deviance:      0 
Residual Deviance: 6.62e-09     AIC: 22

$L[[2]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
               (Intercept)                          A1  
                   91.2548                      2.6446  
                      A1l1                        A1l2  
                    1.2534                      0.6164  
                        M1                        M1l1  
                   -3.0208                     -4.2969  
                      M1l2    splines::bs(L1, df = 3)1  
                   -2.7736                          NA  
  splines::bs(L1, df = 3)2    splines::bs(L1, df = 3)3  
                        NA                          NA  
splines::bs(L1l1, df = 3)1  splines::bs(L1l1, df = 3)2  
                        NA                          NA  
splines::bs(L1l1, df = 3)3  splines::bs(L1l2, df = 3)1  
                        NA                          NA  
splines::bs(L1l2, df = 3)2  splines::bs(L1l2, df = 3)3  
                        NA                          NA  
  splines::ns(v2, df = 4)1    splines::ns(v2, df = 4)2  
                        NA                      1.1402  
  splines::ns(v2, df = 4)3    splines::ns(v2, df = 4)4  
                        NA                          NA  
  splines::bs(jj, df = 3)1    splines::bs(jj, df = 3)2  
                   38.6469                      1.8062  
  splines::bs(jj, df = 3)3  
                   18.4857  

Degrees of Freedom: 1140 Total (i.e. Null);  1130 Residual
Null Deviance:      157900 
Residual Deviance: 74230    AIC: 8026


$Y

Call:  glm(formula = fitY, family = yreg, data = res_df)

Coefficients:
               (Intercept)                          A1  
                  -18.9370                      0.6805  
                      A1l1                        A1l2  
                   -0.9694                      0.1323  
                        M1                        M1l1  
                    5.8327                      2.0787  
                      M1l2    splines::bs(L1, df = 3)1  
                   -0.5915                          NA  
  splines::bs(L1, df = 3)2    splines::bs(L1, df = 3)3  
                        NA                          NA  
splines::bs(L1l1, df = 3)1  splines::bs(L1l1, df = 3)2  
                        NA                          NA  
splines::bs(L1l1, df = 3)3  splines::bs(L1l2, df = 3)1  
                        NA                          NA  
splines::bs(L1l2, df = 3)2  splines::bs(L1l2, df = 3)3  
                        NA                          NA  
  splines::ns(v2, df = 4)1    splines::ns(v2, df = 4)2  
                        NA                      5.7282  
  splines::ns(v2, df = 4)3    splines::ns(v2, df = 4)4  
                        NA                          NA  
  splines::bs(jj, df = 3)1    splines::bs(jj, df = 3)2  
                   24.7683                      3.8317  
  splines::bs(jj, df = 3)3  
                   13.0276  

Degrees of Freedom: 1140 Total (i.e. Null);  1130 Residual
Null Deviance:      159.8 
Residual Deviance: 49.22    AIC: 71.22

$norev_var
[1] "M1"

$am
[1] 0</code></pre>
</div>
</div>
</section>
<section id="data-cũ" class="level2">
<h2 class="anchored" data-anchor-id="data-cũ">data cũ</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/tvmed_dat100.RDS"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> T,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"mm"</span>,<span class="st">"L1"</span>,<span class="st">"sex"</span>),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"bs"</span>,<span class="st">"bs"</span>,<span class="st">"ns"</span>),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat1</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>  <span class="fu">fitg</span>(<span class="at">boot=</span>T,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">yreg =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$df
# A tibble: 2,852 × 21
      id    v1    v2    v3    v4     A1   A1l1    M1  M1l1    L1  L1l1    L2
   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1  10.9     1     1     0 -1.83  -1.83      0     0     0     0  80  
 2     1  10.9     1     1     0  0.199 -1.83      0     0     0     0  88.1
 3     1  10.9     1     1     0 -0.158  0.199     0     0     0     0  97.6
 4     1  10.9     1     1     0  0.504 -0.158     0     0     0     0 112. 
 5     1  10.9     1     1     0 -0.218  0.504     0     0     0     0 108. 
 6     1  10.9     1     1     0  0.916 -0.218     0     0     0     0 123. 
 7     1  10.9     1     1     0 -0.580  0.916     0     0     0     0 128. 
 8     1  10.9     1     1     0  0.914 -0.580     0     0     0     0 114. 
 9     1  10.9     1     1     0  1.83   0.914     0     0     0     0 127. 
10     1  10.9     1     1     0  0.502  1.83      0     0     0     0 102. 
# ℹ 2,842 more rows
# ℹ 9 more variables: L2l1 &lt;dbl&gt;, A1l2 &lt;dbl&gt;, M1l2 &lt;dbl&gt;, L1l2 &lt;dbl&gt;,
#   L2l2 &lt;dbl&gt;, Y &lt;dbl&gt;, j &lt;dbl&gt;, bid &lt;chr&gt;, jj &lt;dbl&gt;

$M
$M[[1]]

Call:  glm(formula = fitM, family = mreg[i], data = res_df)

Coefficients:
               (Intercept)                          A1  
                  -17.8036                     -2.8723  
                      A1l1                        A1l2  
                   -0.3240                      0.9038  
                      M1l1                        M1l2  
                   30.1256                    580.6877  
  splines::bs(L1, df = 3)1    splines::bs(L1, df = 3)2  
                        NA                          NA  
  splines::bs(L1, df = 3)3  splines::bs(L1l1, df = 3)1  
                  -16.8582                          NA  
splines::bs(L1l1, df = 3)2  splines::bs(L1l1, df = 3)3  
                        NA                    534.5970  
splines::bs(L1l2, df = 3)1  splines::bs(L1l2, df = 3)2  
                        NA                          NA  
splines::bs(L1l2, df = 3)3    splines::ns(v2, df = 4)1  
                    2.1007                          NA  
  splines::ns(v2, df = 4)2    splines::ns(v2, df = 4)3  
                    0.6401                          NA  
  splines::ns(v2, df = 4)4    splines::bs(jj, df = 3)1  
                        NA                    196.5898  
  splines::bs(jj, df = 3)2    splines::bs(jj, df = 3)3  
                -1387.1565                     -4.5136  

Degrees of Freedom: 2851 Total (i.e. Null);  2839 Residual
Null Deviance:      2084 
Residual Deviance: 113.2    AIC: 139.2


$L
$L[[1]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
               (Intercept)                          A1  
                -2.657e+01                   8.496e-14  
                      A1l1                        A1l2  
                 2.265e-14                  -1.397e-14  
                        M1                        M1l1  
                 3.804e-13                  -7.396e-14  
                      M1l2    splines::bs(L1, df = 3)1  
                -1.420e-13                          NA  
  splines::bs(L1, df = 3)2    splines::bs(L1, df = 3)3  
                        NA                   5.313e+01  
splines::bs(L1l1, df = 3)1  splines::bs(L1l1, df = 3)2  
                        NA                          NA  
splines::bs(L1l1, df = 3)3  splines::bs(L1l2, df = 3)1  
                -4.087e-15                          NA  
splines::bs(L1l2, df = 3)2  splines::bs(L1l2, df = 3)3  
                        NA                   3.080e-16  
  splines::ns(v2, df = 4)1    splines::ns(v2, df = 4)2  
                        NA                   2.404e-12  
  splines::ns(v2, df = 4)3    splines::ns(v2, df = 4)4  
                        NA                          NA  
  splines::bs(jj, df = 3)1    splines::bs(jj, df = 3)2  
                 1.135e-12                   2.268e-14  
  splines::bs(jj, df = 3)3  
                 5.654e-13  

Degrees of Freedom: 2851 Total (i.e. Null);  2838 Residual
Null Deviance:      60.55 
Residual Deviance: 1.655e-08    AIC: 28

$L[[2]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
               (Intercept)                          A1  
                   100.814                       2.356  
                      A1l1                        A1l2  
                     2.258                       1.574  
                        M1                        M1l1  
                    -6.249                      -4.985  
                      M1l2    splines::bs(L1, df = 3)1  
                    -1.090                          NA  
  splines::bs(L1, df = 3)2    splines::bs(L1, df = 3)3  
                        NA                      -2.584  
splines::bs(L1l1, df = 3)1  splines::bs(L1l1, df = 3)2  
                        NA                          NA  
splines::bs(L1l1, df = 3)3  splines::bs(L1l2, df = 3)1  
                    -1.212                          NA  
splines::bs(L1l2, df = 3)2  splines::bs(L1l2, df = 3)3  
                        NA                      -1.546  
  splines::ns(v2, df = 4)1    splines::ns(v2, df = 4)2  
                        NA                     -18.876  
  splines::ns(v2, df = 4)3    splines::ns(v2, df = 4)4  
                        NA                          NA  
  splines::bs(jj, df = 3)1    splines::bs(jj, df = 3)2  
                    17.598                       0.266  
  splines::bs(jj, df = 3)3  
                     8.500  

Degrees of Freedom: 2851 Total (i.e. Null);  2838 Residual
Null Deviance:      457300 
Residual Deviance: 224300   AIC: 20570


$Y

Call:  glm(formula = fitY, family = yreg, data = res_df)

Coefficients:
               (Intercept)                          A1  
                  -39.3492                      0.7245  
                      A1l1                        A1l2  
                    0.6083                      0.2291  
                        M1                        M1l1  
                   13.9981                     -0.8152  
                      M1l2    splines::bs(L1, df = 3)1  
                   22.0403                          NA  
  splines::bs(L1, df = 3)2    splines::bs(L1, df = 3)3  
                        NA                    -21.3602  
splines::bs(L1l1, df = 3)1  splines::bs(L1l1, df = 3)2  
                        NA                          NA  
splines::bs(L1l1, df = 3)3  splines::bs(L1l2, df = 3)1  
                  -21.0296                          NA  
splines::bs(L1l2, df = 3)2  splines::bs(L1l2, df = 3)3  
                        NA                    -20.4701  
  splines::ns(v2, df = 4)1    splines::ns(v2, df = 4)2  
                        NA                     -0.4411  
  splines::ns(v2, df = 4)3    splines::ns(v2, df = 4)4  
                        NA                          NA  
  splines::bs(jj, df = 3)1    splines::bs(jj, df = 3)2  
                   12.9672                    -10.3965  
  splines::bs(jj, df = 3)3  
                   18.6337  

Degrees of Freedom: 2851 Total (i.e. Null);  2838 Residual
Null Deviance:      351 
Residual Deviance: 174.8    AIC: 202.8

$norev_var
[1] "M1"

$am
[1] 0</code></pre>
</div>
</div>
</section>
</section>
<section id="baseline_mc-function" class="level1">
<h1>Baseline_mc function</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>baseline_mc <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> fitR2,<span class="at">montecarlo =</span> <span class="dv">10000</span>){</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  boot <span class="ot">&lt;-</span> data<span class="sc">$</span>df</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select baseline visit</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  df0 <span class="ot">&lt;-</span> boot[boot<span class="sc">$</span>j<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  df0<span class="sc">$</span>idn <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df0)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  MC <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(df0<span class="sc">$</span>idn, <span class="at">size =</span> montecarlo, <span class="at">replace =</span> T)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">table</span>(samples)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    cc <span class="ot">&lt;-</span> df0[df0<span class="sc">$</span>idn <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>idn, zzz)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    MC <span class="ot">&lt;-</span> <span class="fu">rbind</span>(MC, cc)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  MC<span class="sc">$</span>idsim <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>montecarlo</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>res_df <span class="ot">&lt;-</span> MC <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  data</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="output-with-standardized-continous-exposure" class="level2">
<h2 class="anchored" data-anchor-id="output-with-standardized-continous-exposure">Output with standardized continous exposure</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> T,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>  <span class="fu">fitg</span>(<span class="at">boot=</span>T,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">yreg =</span> <span class="st">"binomial"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$df
# A tibble: 1,163 × 21
      id    v1    v2    v3    v4     A1   A1l1    M1  M1l1    L1  L1l1    L2
   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     2  9.28     0     0     1 -1.92  -1.92      0     0     0     0  80  
 2     2  9.28     0     0     1 -0.317 -1.92      0     0     0     0  99.8
 3     2  9.28     0     0     1 -0.991 -0.317     0     0     0     0  99.8
 4     2  9.28     0     0     1  0.525 -0.991     0     0     0     0 101. 
 5     2  9.28     0     0     1 -1.29   0.525     0     0     0     0 104. 
 6     2  9.28     0     0     1  0.201 -1.29      0     0     0     0 104. 
 7     2  9.28     0     0     1 -0.348  0.201     1     0     0     0  84.9
 8     2  9.28     0     0     1 -1.47  -0.348     1     1     0     0  82.6
 9     3  7.96     0     1     0 -1.92  -1.92      0     0     0     0  80  
10     3  7.96     0     1     0  0.439 -1.92      0     0     0     0 102. 
# ℹ 1,153 more rows
# ℹ 9 more variables: L2l1 &lt;dbl&gt;, A1l2 &lt;dbl&gt;, M1l2 &lt;dbl&gt;, L1l2 &lt;dbl&gt;,
#   L2l2 &lt;dbl&gt;, Y &lt;dbl&gt;, j &lt;dbl&gt;, bid &lt;chr&gt;, jj &lt;dbl&gt;

$M
$M[[1]]

Call:  glm(formula = fitM, family = mreg[i], data = res_df)

Coefficients:
             (Intercept)                        A1                      A1l1  
                -56.6335                   -3.1924                    1.0514  
                    A1l2                      M1l1                      M1l2  
                 -0.3191                   28.1504                   17.2459  
                    L1l1                      L2l1                      L1l2  
                      NA                    0.0348                        NA  
                    L2l2                        v1                        v2  
                  0.2384                   -0.1680                    2.0031  
                      v3                        v4  splines::bs(jj, df = 3)1  
                  1.0842                   24.5905                  -19.1326  
splines::bs(jj, df = 3)2  splines::bs(jj, df = 3)3  
                 29.2544                  -24.9020  

Degrees of Freedom: 1162 Total (i.e. Null);  1148 Residual
Null Deviance:      264 
Residual Deviance: 37.6     AIC: 67.6


$L
$L[[1]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
             (Intercept)                        A1                      A1l1  
              -2.657e+01                -9.311e-15                -2.006e-14  
                    A1l2                        M1                      M1l1  
              -1.707e-14                 7.674e-14                -4.179e-14  
                    M1l2                      L1l1                      L2l1  
              -3.588e-14                        NA                -2.098e-15  
                    L1l2                      L2l2                        v1  
                      NA                -1.767e-15                -5.047e-15  
                      v2                        v3                        v4  
               4.253e-14                 1.835e-14                -1.790e-13  
splines::bs(jj, df = 3)1  splines::bs(jj, df = 3)2  splines::bs(jj, df = 3)3  
               6.862e-13                 2.541e-13                 4.066e-13  

Degrees of Freedom: 1162 Total (i.e. Null);  1147 Residual
Null Deviance:      0 
Residual Deviance: 6.747e-09    AIC: 32

$L[[2]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
             (Intercept)                        A1                      A1l1  
               8.649e+01                 1.505e+00                 2.043e-01  
                    A1l2                        M1                      M1l1  
              -5.336e-01                -1.428e+01                -2.779e+00  
                    M1l2                      L1l1                      L2l1  
               8.719e+00                        NA                 4.500e-02  
                    L1l2                      L2l2                        v1  
                      NA                -6.426e-04                -4.833e-01  
                      v2                        v3                        v4  
               7.630e-01                 8.112e-01                -5.387e+00  
splines::bs(jj, df = 3)1  splines::bs(jj, df = 3)2  splines::bs(jj, df = 3)3  
               4.633e+01                 1.002e+01                 2.375e+01  

Degrees of Freedom: 1162 Total (i.e. Null);  1147 Residual
Null Deviance:      169200 
Residual Deviance: 69320    AIC: 8089


$Y

Call:  glm(formula = fitY, family = yreg, data = res_df)

Coefficients:
             (Intercept)                        A1                      A1l1  
                 37.0117                  -22.6737                  -11.9892  
                    A1l2                        M1                      M1l1  
                 10.1542                   54.3952                   19.0994  
                    M1l2                        L1                      L1l1  
                 37.1478                        NA                        NA  
                      L2                      L2l1                      L1l2  
                 -0.3827                   -1.7961                        NA  
                    L2l2                        v1                        v2  
                  0.9049                  -11.8242                   -8.3862  
                      v3                        v4  splines::bs(jj, df = 3)1  
                 -1.3748                  -24.8292                  141.3645  
splines::bs(jj, df = 3)2  splines::bs(jj, df = 3)3  
                 81.9276                   87.7418  

Degrees of Freedom: 1162 Total (i.e. Null);  1146 Residual
Null Deviance:      124.4 
Residual Deviance: 1.457e-07    AIC: 34

$norev_var
[1] "M1"

$am
[1] 0

$res_df
# A tibble: 10,000 × 23
      id    v1    v2    v3    v4    A1  A1l1    M1  M1l1    L1  L1l1    L2  L2l1
   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     2  9.28     0     0     1 -1.92 -1.92     0     0     0     0    80    80
 2     3  7.96     0     1     0 -1.92 -1.92     0     0     0     0    80    80
 3     4 15.7      1     1     0 -1.92 -1.92     0     0     0     0    80    80
 4     6 11.7      0     0     0 -1.92 -1.92     0     0     0     0    80    80
 5     8 10.6      0     0     0 -1.92 -1.92     0     0     0     0    80    80
 6    10 15.1      1     0     0 -1.92 -1.92     0     0     0     0    80    80
 7    11 11.0      0     0     0 -1.92 -1.92     0     0     0     0    80    80
 8    13 11.6      0     0     0 -1.92 -1.92     0     0     0     0    80    80
 9    15 12.0      0     1     0 -1.92 -1.92     0     0     0     0    80    80
10    16  1.25     0     1     0 -1.92 -1.92     0     0     0     0    80    80
# ℹ 9,990 more rows
# ℹ 10 more variables: A1l2 &lt;dbl&gt;, M1l2 &lt;dbl&gt;, L1l2 &lt;dbl&gt;, L2l2 &lt;dbl&gt;, Y &lt;dbl&gt;,
#   j &lt;dbl&gt;, bid &lt;chr&gt;, jj &lt;dbl&gt;, idn &lt;int&gt;, idsim &lt;int&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="g_form-function" class="level1">
<h1>g_form function</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>rFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_prob))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>g_form <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> fitR2, <span class="at">ii =</span> <span class="dv">2</span>, <span class="at">followup =</span> <span class="dv">12</span>, <span class="at">am =</span> <span class="dv">1</span>, <span class="at">ay =</span> <span class="dv">0</span>){</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  dddd <span class="ot">&lt;-</span> data<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  lagg <span class="ot">&lt;-</span> dddd <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"L1l"</span>)) <span class="sc">%&gt;%</span> <span class="fu">ncol</span>() </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  d2 <span class="ot">&lt;-</span> dddd[dddd<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d2<span class="sc">$</span>idsim</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d2<span class="sc">$</span>id</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  followup <span class="ot">&lt;-</span> followup</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>))</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  Yp2 <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  Yp2[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(data<span class="sc">$</span>df<span class="sc">$</span>j)</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mediator</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  Mp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>M)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Mp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M))</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  Mp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Mp)) </span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to mediator models)</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  Lmp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>L)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>  Lmp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Lmp)) </span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to outcome models)</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> lagg<span class="sc">:</span>followup) {</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*</span><span class="sc">\\</span><span class="st">(([^,]+),.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, var_fm)</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*</span><span class="sc">\\</span><span class="st">(([^,]+),.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, var_fl)</span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-130"><a href="#cb21-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb21-131"><a href="#cb21-131" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb21-132"><a href="#cb21-132" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-133"><a href="#cb21-133" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-134"><a href="#cb21-134" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-135"><a href="#cb21-135" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb21-136"><a href="#cb21-136" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-137"><a href="#cb21-137" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb21-138"><a href="#cb21-138" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb21-139"><a href="#cb21-139" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb21-140"><a href="#cb21-140" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb21-141"><a href="#cb21-141" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-142"><a href="#cb21-142" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb21-143"><a href="#cb21-143" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-144"><a href="#cb21-144" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb21-145"><a href="#cb21-145" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-146"><a href="#cb21-146" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb21-147"><a href="#cb21-147" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb21-148"><a href="#cb21-148" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb21-149"><a href="#cb21-149" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb21-150"><a href="#cb21-150" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-151"><a href="#cb21-151" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-152"><a href="#cb21-152" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-153"><a href="#cb21-153" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-154"><a href="#cb21-154" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-155"><a href="#cb21-155" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb21-156"><a href="#cb21-156" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb21-157"><a href="#cb21-157" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-158"><a href="#cb21-158" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb21-159"><a href="#cb21-159" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb21-160"><a href="#cb21-160" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb21-161"><a href="#cb21-161" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-162"><a href="#cb21-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb21-163"><a href="#cb21-163" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-164"><a href="#cb21-164" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb21-165"><a href="#cb21-165" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb21-166"><a href="#cb21-166" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb21-167"><a href="#cb21-167" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb21-168"><a href="#cb21-168" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb21-169"><a href="#cb21-169" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb21-170"><a href="#cb21-170" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb21-171"><a href="#cb21-171" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-172"><a href="#cb21-172" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-173"><a href="#cb21-173" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-174"><a href="#cb21-174" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb21-175"><a href="#cb21-175" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-176"><a href="#cb21-176" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb21-177"><a href="#cb21-177" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-178"><a href="#cb21-178" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb21-179"><a href="#cb21-179" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb21-180"><a href="#cb21-180" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb21-181"><a href="#cb21-181" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-182"><a href="#cb21-182" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb21-183"><a href="#cb21-183" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb21-184"><a href="#cb21-184" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb21-185"><a href="#cb21-185" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb21-186"><a href="#cb21-186" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb21-187"><a href="#cb21-187" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb21-188"><a href="#cb21-188" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb21-189"><a href="#cb21-189" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb21-190"><a href="#cb21-190" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-191"><a href="#cb21-191" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-192"><a href="#cb21-192" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb21-193"><a href="#cb21-193" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-194"><a href="#cb21-194" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb21-195"><a href="#cb21-195" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb21-196"><a href="#cb21-196" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb21-197"><a href="#cb21-197" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb21-198"><a href="#cb21-198" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-199"><a href="#cb21-199" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb21-200"><a href="#cb21-200" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb21-201"><a href="#cb21-201" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-202"><a href="#cb21-202" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-203"><a href="#cb21-203" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb21-204"><a href="#cb21-204" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb21-205"><a href="#cb21-205" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-206"><a href="#cb21-206" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-207"><a href="#cb21-207" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb21-208"><a href="#cb21-208" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb21-209"><a href="#cb21-209" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*</span><span class="sc">\\</span><span class="st">(([^,]+),.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, var_y)</span>
<span id="cb21-210"><a href="#cb21-210" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb21-211"><a href="#cb21-211" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-212"><a href="#cb21-212" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb21-213"><a href="#cb21-213" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb21-214"><a href="#cb21-214" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb21-215"><a href="#cb21-215" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb21-216"><a href="#cb21-216" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-217"><a href="#cb21-217" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb21-218"><a href="#cb21-218" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-219"><a href="#cb21-219" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb21-220"><a href="#cb21-220" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb21-221"><a href="#cb21-221" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb21-222"><a href="#cb21-222" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb21-223"><a href="#cb21-223" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb21-224"><a href="#cb21-224" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb21-225"><a href="#cb21-225" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-226"><a href="#cb21-226" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-227"><a href="#cb21-227" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-228"><a href="#cb21-228" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-229"><a href="#cb21-229" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb21-230"><a href="#cb21-230" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-231"><a href="#cb21-231" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-232"><a href="#cb21-232" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-233"><a href="#cb21-233" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb21-234"><a href="#cb21-234" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-235"><a href="#cb21-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-236"><a href="#cb21-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lmp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb21-237"><a href="#cb21-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Lp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb21-238"><a href="#cb21-238" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-239"><a href="#cb21-239" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num &lt;- seed</span></span>
<span id="cb21-240"><a href="#cb21-240" aria-hidden="true" tabindex="-1"></a>  gdat2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, Mp, Yp2,</span>
<span id="cb21-241"><a href="#cb21-241" aria-hidden="true" tabindex="-1"></a>                      Lmp, Lp, Vp)</span>
<span id="cb21-242"><a href="#cb21-242" aria-hidden="true" tabindex="-1"></a>  gdat2<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat2<span class="sc">$</span>id, <span class="at">fromLast =</span> T))</span>
<span id="cb21-243"><a href="#cb21-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gdat2)</span>
<span id="cb21-244"><a href="#cb21-244" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="output-with-continous-exposuse-and-not-standardize" class="level2">
<h2 class="anchored" data-anchor-id="output-with-continous-exposuse-and-not-standardize">Output with continous exposuse and not standardize</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> F,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"mm"</span>,<span class="st">"L1"</span>),</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"ns"</span>,<span class="st">"bs"</span>,<span class="st">"bs"</span>),</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>  <span class="fu">fitg</span>(<span class="at">boot=</span>T,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">yreg =</span> <span class="st">"binomial"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>am <span class="ot">&lt;-</span> fitR2<span class="sc">$</span>am</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="sc">%&gt;%</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">followup =</span> <span class="dv">12</span>, <span class="at">am =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">ay =</span> am<span class="sc">+</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id id_ori mm       Ay       Am M1 Yp2 Lmp1      Lmp2 Lp1       Lp2       v1
1   2      3  1 127.8392 127.8392  0   0    0  80.00000   0  80.00000 7.955373
2   2      3  2 127.8392 127.8392  0   0    0  98.92919   0  98.92919 7.955373
3   2      3  3 127.8392 127.8392  0   0    0 105.40326   0 105.40326 7.955373
4   2      3  4 127.8392 127.8392  0   0    0 109.21601   0 109.21601 7.955373
5   2      3  5 127.8392 127.8392  0   0    0 110.91598   0 110.91598 7.955373
6   2      3  6 127.8392 127.8392  0   0    0 111.05169   0 111.05169 7.955373
7   2      3  7 127.8392 127.8392  0   0    0 110.17168   0 110.17168 7.955373
8   2      3  8 127.8392 127.8392  0   0    0 108.82447   0 108.82447 7.955373
9   2      3  9 127.8392 127.8392  0   0    0 107.55860   0 107.55860 7.955373
10  2      3 10 127.8392 127.8392  0   0    0 106.92260   0 106.92260 7.955373
11  2      3 11 127.8392 127.8392  0   0    0 107.46500   0 107.46500 7.955373
12  2      3 12 127.8392 127.8392  0   0    0 109.73433   0 109.73433 7.955373
   v2 v3 v4 lastid
1   0  1  0      0
2   0  1  0      0
3   0  1  0      0
4   0  1  0      0
5   0  1  0      0
6   0  1  0      0
7   0  1  0      0
8   0  1  0      0
9   0  1  0      0
10  0  1  0      0
11  0  1  0      0
12  0  1  0      1</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="sc">%&gt;%</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">followup =</span> <span class="dv">12</span>, <span class="at">am =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">ay =</span> am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id id_ori mm       Ay       Am M1 Yp2 Lmp1      Lmp2 Lp1       Lp2       v1
1   2      3  1 126.8392 127.8392  0   0    0  80.00000   0  80.00000 7.955373
2   2      3  2 126.8392 127.8392  0   0    0  98.92919   0  98.72272 7.955373
3   2      3  3 126.8392 127.8392  0   0    0 105.40326   0 105.19679 7.955373
4   2      3  4 126.8392 127.8392  0   0    0 109.21601   0 109.00955 7.955373
5   2      3  5 126.8392 127.8392  0   0    0 110.91598   0 110.70951 7.955373
6   2      3  6 126.8392 127.8392  0   0    0 111.05169   0 110.84523 7.955373
7   2      3  7 126.8392 127.8392  0   0    0 110.17168   0 109.96521 7.955373
8   2      3  8 126.8392 127.8392  0   0    0 108.82447   0 108.61801 7.955373
9   2      3  9 126.8392 127.8392  0   0    0 107.55860   0 107.35214 7.955373
10  2      3 10 126.8392 127.8392  0   0    0 106.92260   0 106.71614 7.955373
11  2      3 11 126.8392 127.8392  0   0    0 107.46500   0 107.25854 7.955373
12  2      3 12 126.8392 127.8392  0   0    0 109.73433   0 109.52787 7.955373
   v2 v3 v4 lastid
1   0  1  0      0
2   0  1  0      0
3   0  1  0      0
4   0  1  0      0
5   0  1  0      0
6   0  1  0      0
7   0  1  0      0
8   0  1  0      0
9   0  1  0      0
10  0  1  0      0
11  0  1  0      0
12  0  1  0      1</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="sc">%&gt;%</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">followup =</span> <span class="dv">12</span>, <span class="at">am =</span> am, <span class="at">ay =</span> am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id id_ori mm       Ay       Am M1 Yp2 Lmp1      Lmp2 Lp1       Lp2       v1
1   2      3  1 126.8392 126.8392  0   0    0  80.00000   0  80.00000 7.955373
2   2      3  2 126.8392 126.8392  0   0    0  98.72272   0  98.72272 7.955373
3   2      3  3 126.8392 126.8392  0   0    0 105.19679   0 105.19679 7.955373
4   2      3  4 126.8392 126.8392  0   0    0 109.00955   0 109.00955 7.955373
5   2      3  5 126.8392 126.8392  0   0    0 110.70951   0 110.70951 7.955373
6   2      3  6 126.8392 126.8392  0   0    0 110.84523   0 110.84523 7.955373
7   2      3  7 126.8392 126.8392  0   0    0 109.96521   0 109.96521 7.955373
8   2      3  8 126.8392 126.8392  0   0    0 108.61801   0 108.61801 7.955373
9   2      3  9 126.8392 126.8392  0   0    0 107.35214   0 107.35214 7.955373
10  2      3 10 126.8392 126.8392  0   0    0 106.71614   0 106.71614 7.955373
11  2      3 11 126.8392 126.8392  0   0    0 107.25854   0 107.25854 7.955373
12  2      3 12 126.8392 126.8392  0   0    0 109.52787   0 109.52787 7.955373
   v2 v3 v4 lastid
1   0  1  0      0
2   0  1  0      0
3   0  1  0      0
4   0  1  0      0
5   0  1  0      0
6   0  1  0      0
7   0  1  0      0
8   0  1  0      0
9   0  1  0      0
10  0  1  0      0
11  0  1  0      0
12  0  1  0      1</code></pre>
</div>
</div>
</section>
</section>
<section id="additional-function" class="level1">
<h1>Additional function</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ExtResult2 <span class="ot">&lt;-</span> <span class="cf">function</span>(data,am) {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  Q11 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span>am<span class="sc">+</span><span class="dv">1</span> <span class="sc">&amp;</span> Am <span class="sc">==</span>am<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  Q10 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span>am<span class="sc">+</span><span class="dv">1</span> <span class="sc">&amp;</span> Am <span class="sc">==</span>am)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  Q00 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span>am <span class="sc">&amp;</span> Am <span class="sc">==</span>am)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  qq <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mQ11 =</span> <span class="fu">mean</span>(Q11<span class="sc">$</span>Yp2),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mQ10 =</span> <span class="fu">mean</span>(Q10<span class="sc">$</span>Yp2),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mQ00 =</span> <span class="fu">mean</span>(Q00<span class="sc">$</span>Yp2))</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  qq</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>cal_ci <span class="ot">&lt;-</span> <span class="cf">function</span>(data,<span class="at">ci =</span> <span class="fl">0.95</span>,<span class="at">boot =</span> T){</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (boot <span class="sc">==</span> F){</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    resu <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    qnt <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">probs =</span> <span class="fu">c</span>((<span class="dv">1</span><span class="sc">-</span>ci)<span class="sc">/</span><span class="dv">2</span>,<span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">-</span>ci)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    resu <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"("</span>,<span class="fu">round</span>(qnt[<span class="dv">1</span>],<span class="dv">3</span>),<span class="st">","</span>,<span class="fu">round</span>(qnt[<span class="dv">2</span>],<span class="dv">3</span>),<span class="st">")"</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  resu</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="final-tvmedg-function" class="level1">
<h1>Final tvmedg function</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>tvmedg <span class="ot">&lt;-</span> <span class="cf">function</span>(data,basec,expo,med,tvar,outc,time,<span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">norev =</span> <span class="cn">NULL</span>, <span class="at">cont_exp =</span> <span class="cn">NULL</span>,<span class="at">cont_exp_std =</span> F,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tvar_to_med =</span> F,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sp_list =</span> <span class="cn">NULL</span>,<span class="at">sp_type =</span> <span class="cn">NULL</span>,<span class="at">sp_df=</span> <span class="cn">NULL</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">followup =</span> <span class="dv">12</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed =</span> <span class="dv">0</span>,<span class="at">montecarlo =</span> <span class="dv">10</span>,<span class="at">boot =</span> <span class="cn">FALSE</span>,<span class="at">nboot =</span> <span class="dv">1</span>,<span class="at">ci =</span> .<span class="dv">95</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">parallel=</span><span class="cn">TRUE</span>){</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  qqq <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(qqq) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mQ11"</span>,<span class="st">"mQ10"</span>,<span class="st">"mQ00"</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  qqq_ci <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(qqq_ci) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mQ11"</span>,<span class="st">"mQ10"</span>,<span class="st">"mQ00"</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## point estimate</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">basec =</span> basec,</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">expo =</span> expo,</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> med,</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvar =</span> tvar,</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">outc =</span> outc,</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag =</span> lag,</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> time,</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">norev =</span> norev,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvar_to_med =</span> tvar_to_med,</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">cont_exp =</span> cont_exp,</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">cont_exp_std =</span> cont_exp_std,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">sp_list =</span> sp_list,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">sp_type =</span> sp_type,</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">sp_df =</span> sp_df,</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fitg</span>(<span class="at">boot=</span>boot,</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">mreg =</span> mreg,</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">lreg =</span> lreg,</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">yreg =</span> yreg) <span class="sc">%&gt;%</span> </span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> montecarlo)</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>  am <span class="ot">&lt;-</span> fitR2<span class="sc">$</span>am</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (parallel <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    gform_wrapper2 <span class="ot">&lt;-</span> <span class="cf">function</span>(iii, data, followup) {</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>      outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>      outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am)</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>      outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am, <span class="at">am =</span> am)</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_rows</span>(outdat11, outdat10, outdat00)</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>    resultDatM <span class="ot">&lt;-</span> <span class="fu">future_map_dfr</span>(<span class="dv">1</span><span class="sc">:</span>montecarlo,  </span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>                                 <span class="sc">~</span> <span class="fu">gform_wrapper2</span>(<span class="at">ii =</span> .x, <span class="at">data =</span> fitR2, <span class="at">followup =</span> followup))</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>    resultDatM <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (iii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>montecarlo){</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>      outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>      outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am)</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>      outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am, <span class="at">am =</span> am)</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>      resultDatM2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(outdat11, outdat10, outdat00)</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>      resultDatM <span class="ot">&lt;-</span> <span class="fu">rbind</span>(resultDatM,resultDatM2)</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>  qqq <span class="ot">&lt;-</span> <span class="fu">ExtResult2</span>(resultDatM,<span class="at">am =</span> am) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">rIE_b =</span> mQ11 <span class="sc">-</span> mQ10,</span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">rDE_b =</span> mQ10 <span class="sc">-</span> mQ00,</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">rTE_b =</span> mQ11 <span class="sc">-</span> mQ00,</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">rPE_b =</span> rIE_b<span class="sc">/</span> rTE_b</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (boot <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (it <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nboot){</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>      <span class="do">## boostrap</span></span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>      fitR2a <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">basec =</span> basec,</span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">expo =</span> expo,</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">med =</span> med,</span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">tvar =</span> tvar,</span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">outc =</span> outc,</span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">lag =</span> lag,</span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a>        <span class="at">time =</span> time,</span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">norev =</span> norev,</span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">tvar_to_med =</span> tvar_to_med,</span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">cont_exp =</span> cont_exp,</span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">cont_exp_std =</span> cont_exp_std,</span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a>        <span class="at">sp_list =</span> sp_list,</span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">sp_type =</span> sp_type,</span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a>        <span class="at">sp_df =</span> sp_df,</span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> data)  <span class="sc">%&gt;%</span> </span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fitg</span>(<span class="at">boot=</span>boot,</span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a>             <span class="at">mreg =</span> mreg,</span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>             <span class="at">lreg =</span> lreg,</span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>             <span class="at">yreg =</span> yreg) <span class="sc">%&gt;%</span> </span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a>        <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> montecarlo)</span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a>      am_ci <span class="ot">&lt;-</span> fitR2a<span class="sc">$</span>am</span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-108"><a href="#cb31-108" aria-hidden="true" tabindex="-1"></a>      <span class="do">## extract mean of q11,q10,q00 of the ith iter</span></span>
<span id="cb31-109"><a href="#cb31-109" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (parallel <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a>        gform_wrapper2 <span class="ot">&lt;-</span> <span class="cf">function</span>(iii, data, followup) {</span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a>          outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am_ci<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a>          outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am_ci)</span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a>          outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci, <span class="at">am =</span> am_ci)</span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_rows</span>(outdat11, outdat10, outdat00)</span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a>        resultDatM_ci <span class="ot">&lt;-</span> <span class="fu">future_map_dfr</span>(<span class="dv">1</span><span class="sc">:</span>montecarlo,  </span>
<span id="cb31-119"><a href="#cb31-119" aria-hidden="true" tabindex="-1"></a>                                        <span class="sc">~</span> <span class="fu">gform_wrapper2</span>(<span class="at">ii =</span> .x, <span class="at">data =</span> fitR2a, <span class="at">followup =</span> followup))</span>
<span id="cb31-120"><a href="#cb31-120" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb31-121"><a href="#cb31-121" aria-hidden="true" tabindex="-1"></a>        resultDatM <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb31-122"><a href="#cb31-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (iii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>montecarlo){</span>
<span id="cb31-123"><a href="#cb31-123" aria-hidden="true" tabindex="-1"></a>          outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am_ci<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb31-124"><a href="#cb31-124" aria-hidden="true" tabindex="-1"></a>          outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am_ci)</span>
<span id="cb31-125"><a href="#cb31-125" aria-hidden="true" tabindex="-1"></a>          outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci, <span class="at">am =</span> am_ci)</span>
<span id="cb31-126"><a href="#cb31-126" aria-hidden="true" tabindex="-1"></a>          resultDatM2_ci <span class="ot">&lt;-</span> <span class="fu">rbind</span>(outdat11, outdat10, outdat00)</span>
<span id="cb31-127"><a href="#cb31-127" aria-hidden="true" tabindex="-1"></a>          resultDatM_ci <span class="ot">&lt;-</span> <span class="fu">rbind</span>(resultDatM_ci,resultDatM2_ci)</span>
<span id="cb31-128"><a href="#cb31-128" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-129"><a href="#cb31-129" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb31-130"><a href="#cb31-130" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb31-131"><a href="#cb31-131" aria-hidden="true" tabindex="-1"></a>      qqq_ci[it,] <span class="ot">&lt;-</span> <span class="fu">ExtResult2</span>(resultDatM_ci,<span class="at">am =</span> am_ci)</span>
<span id="cb31-132"><a href="#cb31-132" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-133"><a href="#cb31-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-134"><a href="#cb31-134" aria-hidden="true" tabindex="-1"></a>    qqq_ci <span class="ot">&lt;-</span> qqq_ci <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb31-135"><a href="#cb31-135" aria-hidden="true" tabindex="-1"></a>      <span class="at">rIE_b =</span> mQ11 <span class="sc">-</span> mQ10,</span>
<span id="cb31-136"><a href="#cb31-136" aria-hidden="true" tabindex="-1"></a>      <span class="at">rDE_b =</span> mQ10 <span class="sc">-</span> mQ00,</span>
<span id="cb31-137"><a href="#cb31-137" aria-hidden="true" tabindex="-1"></a>      <span class="at">rTE_b =</span> mQ11 <span class="sc">-</span> mQ00,</span>
<span id="cb31-138"><a href="#cb31-138" aria-hidden="true" tabindex="-1"></a>      <span class="at">rPE_b =</span> rIE_b<span class="sc">/</span> rTE_b</span>
<span id="cb31-139"><a href="#cb31-139" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-140"><a href="#cb31-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-141"><a href="#cb31-141" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-142"><a href="#cb31-142" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-143"><a href="#cb31-143" aria-hidden="true" tabindex="-1"></a>  end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb31-144"><a href="#cb31-144" aria-hidden="true" tabindex="-1"></a>  elapsed_time <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span>
<span id="cb31-145"><a href="#cb31-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-146"><a href="#cb31-146" aria-hidden="true" tabindex="-1"></a>  obj <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb31-147"><a href="#cb31-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-148"><a href="#cb31-148" aria-hidden="true" tabindex="-1"></a>  obj<span class="sc">$</span>ori_df <span class="ot">&lt;-</span> fitR2<span class="sc">$</span>df</span>
<span id="cb31-149"><a href="#cb31-149" aria-hidden="true" tabindex="-1"></a>  obj<span class="sc">$</span>dat_MC <span class="ot">&lt;-</span> resultDatM</span>
<span id="cb31-150"><a href="#cb31-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(obj) <span class="ot">&lt;-</span> <span class="st">"tvmedg"</span></span>
<span id="cb31-151"><a href="#cb31-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-152"><a href="#cb31-152" aria-hidden="true" tabindex="-1"></a>  <span class="do">## print result</span></span>
<span id="cb31-153"><a href="#cb31-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(a,a):"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>mQ11, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>mQ11,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb31-154"><a href="#cb31-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(a,a*):"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>mQ10, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>mQ10,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb31-155"><a href="#cb31-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(a*,a*):"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>mQ00, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>mQ00,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb31-156"><a href="#cb31-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-157"><a href="#cb31-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Indirect:"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>rIE_b, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>rIE_b,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb31-158"><a href="#cb31-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Direct:"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>rDE_b, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>rDE_b,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb31-159"><a href="#cb31-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Total:"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>rTE_b, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>rTE_b,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb31-160"><a href="#cb31-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Proportional explain:"</span>, </span>
<span id="cb31-161"><a href="#cb31-161" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(qqq<span class="sc">$</span>rPE_b, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>rPE_b,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb31-162"><a href="#cb31-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-163"><a href="#cb31-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Total time elapsed:"</span>,elapsed_time,<span class="fu">attr</span>(elapsed_time,<span class="st">"units"</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb31-164"><a href="#cb31-164" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-165"><a href="#cb31-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(obj)</span>
<span id="cb31-166"><a href="#cb31-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-167"><a href="#cb31-167" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="run" class="level1">
<h1>run</h1>
<section id="default" class="level2">
<h2 class="anchored" data-anchor-id="default">Default</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">8</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tvmedg</span>(<span class="at">data =</span> dat0,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">cont_exp =</span> <span class="cn">NULL</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">cont_exp_std =</span> F,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar_to_med =</span> F,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">yreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_list =</span> <span class="cn">NULL</span>,</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_type =</span> <span class="cn">NULL</span>,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_df=</span> <span class="cn">NULL</span>,</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">followup =</span> <span class="dv">12</span>,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">seed =</span> <span class="dv">0</span>,</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">montecarlo =</span> <span class="dv">10</span>,</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">boot =</span> <span class="cn">FALSE</span>, </span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">nboot =</span> <span class="dv">1</span>,</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">ci =</span> .<span class="dv">95</span>,</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">parallel=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Q(a,a): 0 
Q(a,a*): 0.1 
Q(a*,a*): 0 
Indirect: -0.1 
Direct: 0.1 
Total: 0 
Proportional explain: -Inf 
Total time elapsed: 17.02032 secs </code></pre>
</div>
</div>
</section>
<section id="đổi-các-agument" class="level2">
<h2 class="anchored" data-anchor-id="đổi-các-agument">Đổi các agument</h2>
<p>Gồm: continuous exposure,cont_exp_std,tvar_to_med =T, thêm splines + dof, bootraping</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tvmedg</span>(<span class="at">data =</span> dat0,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">cont_exp_std =</span> T,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar_to_med =</span> T,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">yreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"mm"</span>,<span class="st">"L1"</span>),</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"ns"</span>,<span class="st">"bs"</span>,<span class="st">"bs"</span>),</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">followup =</span> <span class="dv">12</span>,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">montecarlo =</span> <span class="dv">10</span>,</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">boot =</span> T, </span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">nboot =</span> <span class="dv">2</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">ci =</span> .<span class="dv">95</span>,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">parallel=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Q(a,a): 0.3 (0.302,0.398) 
Q(a,a*): 0.7 (0.502,0.598) 
Q(a*,a*): 0.6 (0.31,0.69) 
Indirect: -0.4 (-0.2,-0.2) 
Direct: 0.1 (-0.093,0.193) 
Total: -0.3 (-0.292,-0.007) 
Proportional explain: 1.333 (-Inf,-Inf) 
Total time elapsed: 29.8812 secs </code></pre>
</div>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb36" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Update tvmedg"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="an">message:</span><span class="co"> false</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="an">warning:</span><span class="co"> false</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="fu"># Import data</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/tvmed_dat100_12mo.RDS"</span>)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>dat0 <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a><span class="fu"># Process data function</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>Em rút gọn continuous exposure còn 2 argument thôi, cont_exp = NULL =&gt; binary, cont_exp_std = F giới hạn chỉ xài được khi đã define continous exposure</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>Về phần splines em định nghĩa là nếu mọi thứ null thì mình smooth time variables với df là 3 luôn, mình có thể có options là nếu mọi thứ NULL thì không smooth time. Do em quên không note nên khúc đó không nhớ nhóm mình có thống nhất với nhau không, em đọc lại study plan thì trước mắt là code theo ý hiểu của em như thế này.</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>Có một vấn đề mình cần cân nhắc là splines và standardize có apply cho lag luôn không? Em đang code là apply cho lag luôn</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>process_data <span class="ot">&lt;-</span> <span class="cf">function</span>(basec,expo,med,tvar,lag,outc,time,</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>                         <span class="at">norev =</span> <span class="cn">NULL</span>,<span class="at">tvar_to_med =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cont_exp =</span> <span class="cn">NULL</span>,<span class="at">cont_exp_std =</span> F,</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sp_list =</span> <span class="cn">NULL</span>,</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sp_type =</span> <span class="cn">NULL</span>,</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sp_df=</span> <span class="cn">NULL</span>, data){</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>  <span class="do">## detect which variables are non-reversible</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(expo <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    norev_expo <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"A"</span>,<span class="fu">which</span>(expo <span class="sc">%in%</span> norev))</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    norev_expo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(med <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>    norev_med <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="fu">which</span>(med <span class="sc">%in%</span> norev))</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>    norev_med <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(tvar <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>    norev_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="fu">which</span>(tvar <span class="sc">%in%</span> norev))</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>    norev_tvar <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>  norev_var <span class="ot">&lt;-</span> <span class="fu">c</span>(norev_expo,norev_med,norev_tvar)</span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>  sp_var <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>  <span class="do">## detect which variables in splines list</span></span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>  <span class="do">### time-fixed var</span></span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(sp_list <span class="sc">%in%</span> basec)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>    sp_fix <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"v"</span>,<span class="fu">which</span>(basec <span class="sc">%in%</span> sp_list))</span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a>    sp_fix <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>  sp_var[<span class="fu">which</span>(sp_list <span class="sc">%in%</span> basec)] <span class="ot">&lt;-</span> sp_fix</span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a>  <span class="do">## exposure var</span></span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(sp_list <span class="sc">%in%</span> expo)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a>    sp_expo <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"A"</span>,<span class="fu">which</span>(expo <span class="sc">%in%</span> sp_list))</span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>    sp_expo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>  sp_var[<span class="fu">which</span>(sp_list <span class="sc">%in%</span> expo)] <span class="ot">&lt;-</span> sp_expo</span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>  <span class="do">## mediator var</span></span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(sp_list <span class="sc">%in%</span> med)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a>    sp_med <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="fu">which</span>(med <span class="sc">%in%</span> sp_list))</span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a>    sp_med <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a>  sp_var[<span class="fu">which</span>(sp_list <span class="sc">%in%</span> med)] <span class="ot">&lt;-</span> sp_med</span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-varying var</span></span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(sp_list <span class="sc">%in%</span> tvar)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a>    sp_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="fu">which</span>(tvar <span class="sc">%in%</span> sp_list))</span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true" tabindex="-1"></a>    sp_tvar <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true" tabindex="-1"></a>  sp_var[<span class="fu">which</span>(sp_list <span class="sc">%in%</span> tvar)] <span class="ot">&lt;-</span> sp_tvar</span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time var</span></span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(sp_list <span class="sc">%in%</span> time)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true" tabindex="-1"></a>    sp_time <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"j"</span>)</span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true" tabindex="-1"></a>    sp_time <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true" tabindex="-1"></a>  sp_var[<span class="fu">which</span>(sp_list <span class="sc">%in%</span> time)] <span class="ot">&lt;-</span> sp_time</span>
<span id="cb36-119"><a href="#cb36-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-120"><a href="#cb36-120" aria-hidden="true" tabindex="-1"></a>  <span class="do">## continous exposure</span></span>
<span id="cb36-121"><a href="#cb36-121" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(cont_exp) <span class="sc">&amp;</span> cont_exp_std <span class="sc">==</span> T){</span>
<span id="cb36-122"><a href="#cb36-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"standardize only applicable when continuous exposure was defined, default is NULL"</span>)</span>
<span id="cb36-123"><a href="#cb36-123" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.null</span>(cont_exp) <span class="sc">&amp;</span> cont_exp_std <span class="sc">==</span> F){</span>
<span id="cb36-124"><a href="#cb36-124" aria-hidden="true" tabindex="-1"></a>    <span class="do">## binary exposure</span></span>
<span id="cb36-125"><a href="#cb36-125" aria-hidden="true" tabindex="-1"></a>    expo_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb36-126"><a href="#cb36-126" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cont_exp) <span class="sc">&amp;</span> cont_exp <span class="sc">!=</span> expo){</span>
<span id="cb36-127"><a href="#cb36-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"defined continuous exposure was not the input exposure"</span>)</span>
<span id="cb36-128"><a href="#cb36-128" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cont_exp) <span class="sc">&amp;</span> cont_exp_std <span class="sc">==</span> F){</span>
<span id="cb36-129"><a href="#cb36-129" aria-hidden="true" tabindex="-1"></a>    <span class="do">## continuous exposure without standardize</span></span>
<span id="cb36-130"><a href="#cb36-130" aria-hidden="true" tabindex="-1"></a>    expo_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(data[,expo])</span>
<span id="cb36-131"><a href="#cb36-131" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cont_exp) <span class="sc">&amp;</span> cont_exp_std <span class="sc">==</span> T){</span>
<span id="cb36-132"><a href="#cb36-132" aria-hidden="true" tabindex="-1"></a>    <span class="do">## continuous exposure with standardize</span></span>
<span id="cb36-133"><a href="#cb36-133" aria-hidden="true" tabindex="-1"></a>    expo_mean <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb36-134"><a href="#cb36-134" aria-hidden="true" tabindex="-1"></a>    data[,expo] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(data[,expo]))</span>
<span id="cb36-135"><a href="#cb36-135" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-136"><a href="#cb36-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-137"><a href="#cb36-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-138"><a href="#cb36-138" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of time-fixed variables</span></span>
<span id="cb36-139"><a href="#cb36-139" aria-hidden="true" tabindex="-1"></a>  name_v <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"v"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(basec))</span>
<span id="cb36-140"><a href="#cb36-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-141"><a href="#cb36-141" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> data<span class="sc">$</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb36-142"><a href="#cb36-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(data[,basec]) <span class="sc">%&gt;%</span> </span>
<span id="cb36-143"><a href="#cb36-143" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">c</span>(<span class="st">"id"</span>,name_v))</span>
<span id="cb36-144"><a href="#cb36-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-145"><a href="#cb36-145" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of exposure variables  </span></span>
<span id="cb36-146"><a href="#cb36-146" aria-hidden="true" tabindex="-1"></a>  name_e <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"A"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(expo))</span>
<span id="cb36-147"><a href="#cb36-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-148"><a href="#cb36-148" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of mediator variables  </span></span>
<span id="cb36-149"><a href="#cb36-149" aria-hidden="true" tabindex="-1"></a>  name_me <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med))</span>
<span id="cb36-150"><a href="#cb36-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-151"><a href="#cb36-151" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of time-varying variables  </span></span>
<span id="cb36-152"><a href="#cb36-152" aria-hidden="true" tabindex="-1"></a>  name_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar))</span>
<span id="cb36-153"><a href="#cb36-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-154"><a href="#cb36-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-155"><a href="#cb36-155" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lag){</span>
<span id="cb36-156"><a href="#cb36-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-157"><a href="#cb36-157" aria-hidden="true" tabindex="-1"></a>    <span class="do">## column name of lag effect on exposure variable</span></span>
<span id="cb36-158"><a href="#cb36-158" aria-hidden="true" tabindex="-1"></a>    co_ex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_e,<span class="st">"l"</span>,i)</span>
<span id="cb36-159"><a href="#cb36-159" aria-hidden="true" tabindex="-1"></a>    co_me <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_me,<span class="st">"l"</span>,i)</span>
<span id="cb36-160"><a href="#cb36-160" aria-hidden="true" tabindex="-1"></a>    co_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_tvar,<span class="st">"l"</span>,i)</span>
<span id="cb36-161"><a href="#cb36-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-162"><a href="#cb36-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_e)){</span>
<span id="cb36-163"><a href="#cb36-163" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-164"><a href="#cb36-164" aria-hidden="true" tabindex="-1"></a>      out[,name_e[k]] <span class="ot">&lt;-</span> data[,expo[k]]</span>
<span id="cb36-165"><a href="#cb36-165" aria-hidden="true" tabindex="-1"></a>      name_ep <span class="ot">&lt;-</span> {{co_ex}}[k]</span>
<span id="cb36-166"><a href="#cb36-166" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb36-167"><a href="#cb36-167" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb36-168"><a href="#cb36-168" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb36-169"><a href="#cb36-169" aria-hidden="true" tabindex="-1"></a>          {{name_ep}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_e[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,expo[k]])</span>
<span id="cb36-170"><a href="#cb36-170" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb36-171"><a href="#cb36-171" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-172"><a href="#cb36-172" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb36-173"><a href="#cb36-173" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-174"><a href="#cb36-174" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_me)){</span>
<span id="cb36-175"><a href="#cb36-175" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-176"><a href="#cb36-176" aria-hidden="true" tabindex="-1"></a>      out[,name_me[k]] <span class="ot">&lt;-</span> data[,med[k]]</span>
<span id="cb36-177"><a href="#cb36-177" aria-hidden="true" tabindex="-1"></a>      name_med <span class="ot">&lt;-</span> {{co_me}}[k]</span>
<span id="cb36-178"><a href="#cb36-178" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb36-179"><a href="#cb36-179" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb36-180"><a href="#cb36-180" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb36-181"><a href="#cb36-181" aria-hidden="true" tabindex="-1"></a>          {{name_med}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_me[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,med[k]])</span>
<span id="cb36-182"><a href="#cb36-182" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb36-183"><a href="#cb36-183" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-184"><a href="#cb36-184" aria-hidden="true" tabindex="-1"></a>    }  </span>
<span id="cb36-185"><a href="#cb36-185" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-186"><a href="#cb36-186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_tvar)){</span>
<span id="cb36-187"><a href="#cb36-187" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-188"><a href="#cb36-188" aria-hidden="true" tabindex="-1"></a>      out[,name_tvar[k]] <span class="ot">&lt;-</span> data[,tvar[k]]</span>
<span id="cb36-189"><a href="#cb36-189" aria-hidden="true" tabindex="-1"></a>      name_tv <span class="ot">&lt;-</span> {{co_tvar}}[k]</span>
<span id="cb36-190"><a href="#cb36-190" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb36-191"><a href="#cb36-191" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb36-192"><a href="#cb36-192" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb36-193"><a href="#cb36-193" aria-hidden="true" tabindex="-1"></a>          {{name_tv}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_tvar[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,tvar[k]])</span>
<span id="cb36-194"><a href="#cb36-194" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb36-195"><a href="#cb36-195" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-196"><a href="#cb36-196" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-197"><a href="#cb36-197" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-198"><a href="#cb36-198" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-199"><a href="#cb36-199" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-200"><a href="#cb36-200" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-201"><a href="#cb36-201" aria-hidden="true" tabindex="-1"></a>  <span class="do">## outcome variable</span></span>
<span id="cb36-202"><a href="#cb36-202" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>Y <span class="ot">&lt;-</span> data[,outc]</span>
<span id="cb36-203"><a href="#cb36-203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-204"><a href="#cb36-204" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time variable</span></span>
<span id="cb36-205"><a href="#cb36-205" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>j <span class="ot">&lt;-</span> data[,time]</span>
<span id="cb36-206"><a href="#cb36-206" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-207"><a href="#cb36-207" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-208"><a href="#cb36-208" aria-hidden="true" tabindex="-1"></a>  kq <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb36-209"><a href="#cb36-209" aria-hidden="true" tabindex="-1"></a>  kq<span class="sc">$</span>df <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() </span>
<span id="cb36-210"><a href="#cb36-210" aria-hidden="true" tabindex="-1"></a>  kq<span class="sc">$</span>norev_var <span class="ot">&lt;-</span> norev_var</span>
<span id="cb36-211"><a href="#cb36-211" aria-hidden="true" tabindex="-1"></a>  kq<span class="sc">$</span>am <span class="ot">&lt;-</span>  expo_mean</span>
<span id="cb36-212"><a href="#cb36-212" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-213"><a href="#cb36-213" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column name</span></span>
<span id="cb36-214"><a href="#cb36-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-215"><a href="#cb36-215" aria-hidden="true" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"A"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb36-216"><a href="#cb36-216" aria-hidden="true" tabindex="-1"></a>  tf <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb36-217"><a href="#cb36-217" aria-hidden="true" tabindex="-1"></a>  tva <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"L"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb36-218"><a href="#cb36-218" aria-hidden="true" tabindex="-1"></a>  mediator <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"M"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb36-219"><a href="#cb36-219" aria-hidden="true" tabindex="-1"></a>  outcome <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"Y"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb36-220"><a href="#cb36-220" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"j"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb36-221"><a href="#cb36-221" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-222"><a href="#cb36-222" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-223"><a href="#cb36-223" aria-hidden="true" tabindex="-1"></a>  <span class="do">### exposure variable</span></span>
<span id="cb36-224"><a href="#cb36-224" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(eps <span class="sc">%in%</span> sp_var)){</span>
<span id="cb36-225"><a href="#cb36-225" aria-hidden="true" tabindex="-1"></a>    ep_sp <span class="ot">&lt;-</span> sp_type[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> eps)]</span>
<span id="cb36-226"><a href="#cb36-226" aria-hidden="true" tabindex="-1"></a>    ep_df <span class="ot">&lt;-</span> sp_df[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> eps)]</span>
<span id="cb36-227"><a href="#cb36-227" aria-hidden="true" tabindex="-1"></a>    eps <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,ep_sp,<span class="st">"("</span>,eps,<span class="st">",df="</span>,ep_df,<span class="st">")"</span>)</span>
<span id="cb36-228"><a href="#cb36-228" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb36-229"><a href="#cb36-229" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-230"><a href="#cb36-230" aria-hidden="true" tabindex="-1"></a>  <span class="do">### time-fixed variables</span></span>
<span id="cb36-231"><a href="#cb36-231" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(tf <span class="sc">%in%</span> sp_var)){</span>
<span id="cb36-232"><a href="#cb36-232" aria-hidden="true" tabindex="-1"></a>    tf_sp <span class="ot">&lt;-</span> sp_type[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> tf)]</span>
<span id="cb36-233"><a href="#cb36-233" aria-hidden="true" tabindex="-1"></a>    tf_df <span class="ot">&lt;-</span> sp_df[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> tf)]</span>
<span id="cb36-234"><a href="#cb36-234" aria-hidden="true" tabindex="-1"></a>    tf_v <span class="ot">&lt;-</span> <span class="fu">keep</span>(tf, <span class="sc">~</span> <span class="fu">any</span>(<span class="fu">str_starts</span>(.x, sp_var)))</span>
<span id="cb36-235"><a href="#cb36-235" aria-hidden="true" tabindex="-1"></a>    tf <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,tf_sp,<span class="st">"("</span>,tf_v,<span class="st">",df="</span>,tf_df,<span class="st">")"</span>)</span>
<span id="cb36-236"><a href="#cb36-236" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb36-237"><a href="#cb36-237" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-238"><a href="#cb36-238" aria-hidden="true" tabindex="-1"></a>  <span class="do">### mediator variables</span></span>
<span id="cb36-239"><a href="#cb36-239" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(mediator <span class="sc">%in%</span> sp_var)){</span>
<span id="cb36-240"><a href="#cb36-240" aria-hidden="true" tabindex="-1"></a>    mediator_sp <span class="ot">&lt;-</span> sp_type[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> mediator)]</span>
<span id="cb36-241"><a href="#cb36-241" aria-hidden="true" tabindex="-1"></a>    mediator_df <span class="ot">&lt;-</span> sp_df[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> mediator)]</span>
<span id="cb36-242"><a href="#cb36-242" aria-hidden="true" tabindex="-1"></a>    mediator_v <span class="ot">&lt;-</span> <span class="fu">keep</span>(tva, <span class="sc">~</span> <span class="fu">any</span>(<span class="fu">str_starts</span>(.x, sp_var)))</span>
<span id="cb36-243"><a href="#cb36-243" aria-hidden="true" tabindex="-1"></a>    mediator <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,mediator_sp,<span class="st">"("</span>,mediator_v,<span class="st">",df="</span>,mediator_df,<span class="st">")"</span>)</span>
<span id="cb36-244"><a href="#cb36-244" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb36-245"><a href="#cb36-245" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-246"><a href="#cb36-246" aria-hidden="true" tabindex="-1"></a>  <span class="do">### time-varying variables</span></span>
<span id="cb36-247"><a href="#cb36-247" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(tva <span class="sc">%in%</span> sp_var)){</span>
<span id="cb36-248"><a href="#cb36-248" aria-hidden="true" tabindex="-1"></a>    tva_sp <span class="ot">&lt;-</span> sp_type[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> tva)]</span>
<span id="cb36-249"><a href="#cb36-249" aria-hidden="true" tabindex="-1"></a>    tva_df <span class="ot">&lt;-</span> sp_df[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> tva)]</span>
<span id="cb36-250"><a href="#cb36-250" aria-hidden="true" tabindex="-1"></a>    tva_v <span class="ot">&lt;-</span> <span class="fu">keep</span>(tva, <span class="sc">~</span> <span class="fu">any</span>(<span class="fu">str_starts</span>(.x, sp_var)))</span>
<span id="cb36-251"><a href="#cb36-251" aria-hidden="true" tabindex="-1"></a>    tva <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,tva_sp,<span class="st">"("</span>,tva_v,<span class="st">",df="</span>,tva_df,<span class="st">")"</span>)</span>
<span id="cb36-252"><a href="#cb36-252" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb36-253"><a href="#cb36-253" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-254"><a href="#cb36-254" aria-hidden="true" tabindex="-1"></a>  <span class="do">### time variables</span></span>
<span id="cb36-255"><a href="#cb36-255" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(timee <span class="sc">%in%</span> sp_var)){</span>
<span id="cb36-256"><a href="#cb36-256" aria-hidden="true" tabindex="-1"></a>    timee_sp <span class="ot">&lt;-</span> sp_type[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> timee)]</span>
<span id="cb36-257"><a href="#cb36-257" aria-hidden="true" tabindex="-1"></a>    timee_df <span class="ot">&lt;-</span> sp_df[<span class="fu">which</span>(sp_var <span class="sc">%in%</span> timee)]</span>
<span id="cb36-258"><a href="#cb36-258" aria-hidden="true" tabindex="-1"></a>    timee <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,timee_sp,<span class="st">"(jj,df="</span>,timee_df,<span class="st">")"</span>)</span>
<span id="cb36-259"><a href="#cb36-259" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-260"><a href="#cb36-260" aria-hidden="true" tabindex="-1"></a>    timee <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"splines::"</span>,<span class="st">"bs"</span>,<span class="st">"(jj,df="</span>,<span class="dv">3</span>,<span class="st">")"</span>)</span>
<span id="cb36-261"><a href="#cb36-261" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-262"><a href="#cb36-262" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-263"><a href="#cb36-263" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-264"><a href="#cb36-264" aria-hidden="true" tabindex="-1"></a>  <span class="do">## formula for M(t)</span></span>
<span id="cb36-265"><a href="#cb36-265" aria-hidden="true" tabindex="-1"></a>  l_tm1 <span class="ot">&lt;-</span> tva[<span class="sc">!</span>tva <span class="sc">%in%</span> name_tvar]</span>
<span id="cb36-266"><a href="#cb36-266" aria-hidden="true" tabindex="-1"></a>  m_tm1 <span class="ot">&lt;-</span> mediator[<span class="sc">!</span>mediator <span class="sc">%in%</span> name_me]</span>
<span id="cb36-267"><a href="#cb36-267" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-268"><a href="#cb36-268" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tvar_to_med <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb36-269"><a href="#cb36-269" aria-hidden="true" tabindex="-1"></a>    formula_mt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb36-270"><a href="#cb36-270" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-271"><a href="#cb36-271" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med)){</span>
<span id="cb36-272"><a href="#cb36-272" aria-hidden="true" tabindex="-1"></a>      formula_mt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_me[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,l_tm1,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb36-273"><a href="#cb36-273" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-274"><a href="#cb36-274" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-275"><a href="#cb36-275" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fm <span class="ot">&lt;-</span> formula_mt</span>
<span id="cb36-276"><a href="#cb36-276" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-277"><a href="#cb36-277" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for L(t)</span></span>
<span id="cb36-278"><a href="#cb36-278" aria-hidden="true" tabindex="-1"></a>    formular_lt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb36-279"><a href="#cb36-279" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-280"><a href="#cb36-280" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar)){</span>
<span id="cb36-281"><a href="#cb36-281" aria-hidden="true" tabindex="-1"></a>      formular_lt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_tvar[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,mediator,l_tm1,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb36-282"><a href="#cb36-282" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-283"><a href="#cb36-283" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-284"><a href="#cb36-284" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fl <span class="ot">&lt;-</span> formular_lt</span>
<span id="cb36-285"><a href="#cb36-285" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-286"><a href="#cb36-286" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for Y(t)</span></span>
<span id="cb36-287"><a href="#cb36-287" aria-hidden="true" tabindex="-1"></a>    formular_y <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome,<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,mediator,tva,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb36-288"><a href="#cb36-288" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fy <span class="ot">&lt;-</span> formular_y</span>
<span id="cb36-289"><a href="#cb36-289" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-290"><a href="#cb36-290" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-291"><a href="#cb36-291" aria-hidden="true" tabindex="-1"></a>    formula_mt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb36-292"><a href="#cb36-292" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-293"><a href="#cb36-293" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med)){</span>
<span id="cb36-294"><a href="#cb36-294" aria-hidden="true" tabindex="-1"></a>      formula_mt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_me[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,name_tvar,l_tm1,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb36-295"><a href="#cb36-295" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-296"><a href="#cb36-296" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-297"><a href="#cb36-297" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fm <span class="ot">&lt;-</span> formula_mt</span>
<span id="cb36-298"><a href="#cb36-298" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-299"><a href="#cb36-299" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for L(t)</span></span>
<span id="cb36-300"><a href="#cb36-300" aria-hidden="true" tabindex="-1"></a>    formular_lt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb36-301"><a href="#cb36-301" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-302"><a href="#cb36-302" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar)){</span>
<span id="cb36-303"><a href="#cb36-303" aria-hidden="true" tabindex="-1"></a>      formular_lt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_tvar[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,l_tm1,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb36-304"><a href="#cb36-304" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-305"><a href="#cb36-305" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-306"><a href="#cb36-306" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fl <span class="ot">&lt;-</span> formular_lt</span>
<span id="cb36-307"><a href="#cb36-307" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-308"><a href="#cb36-308" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for Y(t)</span></span>
<span id="cb36-309"><a href="#cb36-309" aria-hidden="true" tabindex="-1"></a>    formular_y <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome,<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,tva,mediator,tf,timee),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb36-310"><a href="#cb36-310" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fy <span class="ot">&lt;-</span> formular_y</span>
<span id="cb36-311"><a href="#cb36-311" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-312"><a href="#cb36-312" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-313"><a href="#cb36-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(kq)</span>
<span id="cb36-314"><a href="#cb36-314" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-315"><a href="#cb36-315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-316"><a href="#cb36-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-317"><a href="#cb36-317" aria-hidden="true" tabindex="-1"></a><span class="fu">## Default output</span></span>
<span id="cb36-318"><a href="#cb36-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-321"><a href="#cb36-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-322"><a href="#cb36-322" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb36-323"><a href="#cb36-323" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb36-324"><a href="#cb36-324" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-325"><a href="#cb36-325" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-326"><a href="#cb36-326" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb36-327"><a href="#cb36-327" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb36-328"><a href="#cb36-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-329"><a href="#cb36-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb36-330"><a href="#cb36-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-331"><a href="#cb36-331" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb36-332"><a href="#cb36-332" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cont_exp = c("L2"),</span></span>
<span id="cb36-333"><a href="#cb36-333" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cont_exp_std = T,</span></span>
<span id="cb36-334"><a href="#cb36-334" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_list = c("mm","L1","sex"),</span></span>
<span id="cb36-335"><a href="#cb36-335" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_type = c("ns","bs","bs"),</span></span>
<span id="cb36-336"><a href="#cb36-336" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_df= c(3,3,3),</span></span>
<span id="cb36-337"><a href="#cb36-337" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb36-338"><a href="#cb36-338" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb36-339"><a href="#cb36-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-340"><a href="#cb36-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-341"><a href="#cb36-341" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output with tvar_to_med = TRUE   </span></span>
<span id="cb36-342"><a href="#cb36-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-345"><a href="#cb36-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-346"><a href="#cb36-346" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb36-347"><a href="#cb36-347" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb36-348"><a href="#cb36-348" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-349"><a href="#cb36-349" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-350"><a href="#cb36-350" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb36-351"><a href="#cb36-351" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb36-352"><a href="#cb36-352" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-353"><a href="#cb36-353" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb36-354"><a href="#cb36-354" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-355"><a href="#cb36-355" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> T,</span>
<span id="cb36-356"><a href="#cb36-356" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cont_exp = c("L2"),</span></span>
<span id="cb36-357"><a href="#cb36-357" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cont_exp_std = T,</span></span>
<span id="cb36-358"><a href="#cb36-358" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_list = c("mm","L1","sex"),</span></span>
<span id="cb36-359"><a href="#cb36-359" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_type = c("ns","bs","bs"),</span></span>
<span id="cb36-360"><a href="#cb36-360" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sp_df= c(3,3,3),</span></span>
<span id="cb36-361"><a href="#cb36-361" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb36-362"><a href="#cb36-362" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb36-363"><a href="#cb36-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-364"><a href="#cb36-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-365"><a href="#cb36-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-366"><a href="#cb36-366" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output with continous exposure with standardize, splines, </span></span>
<span id="cb36-367"><a href="#cb36-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-370"><a href="#cb36-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-371"><a href="#cb36-371" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb36-372"><a href="#cb36-372" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb36-373"><a href="#cb36-373" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-374"><a href="#cb36-374" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-375"><a href="#cb36-375" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb36-376"><a href="#cb36-376" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb36-377"><a href="#cb36-377" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-378"><a href="#cb36-378" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb36-379"><a href="#cb36-379" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-380"><a href="#cb36-380" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb36-381"><a href="#cb36-381" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-382"><a href="#cb36-382" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> T,</span>
<span id="cb36-383"><a href="#cb36-383" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"mm"</span>,<span class="st">"L1"</span>,<span class="st">"sex"</span>),</span>
<span id="cb36-384"><a href="#cb36-384" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"bs"</span>,<span class="st">"bs"</span>,<span class="st">"ns"</span>),</span>
<span id="cb36-385"><a href="#cb36-385" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb36-386"><a href="#cb36-386" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb36-387"><a href="#cb36-387" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb36-388"><a href="#cb36-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-389"><a href="#cb36-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-390"><a href="#cb36-390" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output with continous exposure without standardize, splines</span></span>
<span id="cb36-391"><a href="#cb36-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-394"><a href="#cb36-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-395"><a href="#cb36-395" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb36-396"><a href="#cb36-396" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb36-397"><a href="#cb36-397" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-398"><a href="#cb36-398" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-399"><a href="#cb36-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb36-400"><a href="#cb36-400" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb36-401"><a href="#cb36-401" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-402"><a href="#cb36-402" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb36-403"><a href="#cb36-403" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-404"><a href="#cb36-404" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb36-405"><a href="#cb36-405" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-406"><a href="#cb36-406" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> F,</span>
<span id="cb36-407"><a href="#cb36-407" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"mm"</span>,<span class="st">"L1"</span>,<span class="st">"sex"</span>),</span>
<span id="cb36-408"><a href="#cb36-408" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"bs"</span>,<span class="st">"bs"</span>,<span class="st">"ns"</span>),</span>
<span id="cb36-409"><a href="#cb36-409" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb36-410"><a href="#cb36-410" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb36-411"><a href="#cb36-411" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb36-412"><a href="#cb36-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-413"><a href="#cb36-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-414"><a href="#cb36-414" aria-hidden="true" tabindex="-1"></a><span class="fu"># fitg function</span></span>
<span id="cb36-415"><a href="#cb36-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-416"><a href="#cb36-416" aria-hidden="true" tabindex="-1"></a>Chổ binomial và gaussian em không đổi được, do em assign nó thẳng vô family của glm luôn. Rồi lúc predict ở dưới em extract từ model ra nên nếu chuyển sang lm với logistic nó hơi lằng nhằng :))</span>
<span id="cb36-417"><a href="#cb36-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-420"><a href="#cb36-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-421"><a href="#cb36-421" aria-hidden="true" tabindex="-1"></a><span class="do">## cen_and_scale function</span></span>
<span id="cb36-422"><a href="#cb36-422" aria-hidden="true" tabindex="-1"></a>cen_and_scale <span class="ot">&lt;-</span> <span class="cf">function</span>(time){</span>
<span id="cb36-423"><a href="#cb36-423" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-424"><a href="#cb36-424" aria-hidden="true" tabindex="-1"></a>  j_out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb36-425"><a href="#cb36-425" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-426"><a href="#cb36-426" aria-hidden="true" tabindex="-1"></a>  jj <span class="ot">&lt;-</span> time <span class="sc">%&gt;%</span> </span>
<span id="cb36-427"><a href="#cb36-427" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale</span>() </span>
<span id="cb36-428"><a href="#cb36-428" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-429"><a href="#cb36-429" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"jj"</span>]] <span class="ot">&lt;-</span> jj <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb36-430"><a href="#cb36-430" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"mean_j"</span>]] <span class="ot">&lt;-</span> <span class="fu">attributes</span>(jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb36-431"><a href="#cb36-431" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"sd_j"</span>]] <span class="ot">&lt;-</span> <span class="fu">attributes</span>(jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb36-432"><a href="#cb36-432" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-433"><a href="#cb36-433" aria-hidden="true" tabindex="-1"></a>  j_out</span>
<span id="cb36-434"><a href="#cb36-434" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-435"><a href="#cb36-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-436"><a href="#cb36-436" aria-hidden="true" tabindex="-1"></a>resamp <span class="ot">&lt;-</span> <span class="cf">function</span>(data,<span class="at">boot =</span> <span class="cn">FALSE</span>){</span>
<span id="cb36-437"><a href="#cb36-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-438"><a href="#cb36-438" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> data</span>
<span id="cb36-439"><a href="#cb36-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-440"><a href="#cb36-440" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set.seed(seed)</span></span>
<span id="cb36-441"><a href="#cb36-441" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("Running SEED", seed, "\n")</span></span>
<span id="cb36-442"><a href="#cb36-442" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("\n")</span></span>
<span id="cb36-443"><a href="#cb36-443" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("Resampling Data", "\n")</span></span>
<span id="cb36-444"><a href="#cb36-444" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-445"><a href="#cb36-445" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(df<span class="sc">$</span>id))</span>
<span id="cb36-446"><a href="#cb36-446" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters), <span class="fu">length</span>(clusters), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-447"><a href="#cb36-447" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters[index])</span>
<span id="cb36-448"><a href="#cb36-448" aria-hidden="true" tabindex="-1"></a>  boot_df <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-449"><a href="#cb36-449" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-450"><a href="#cb36-450" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(boot <span class="sc">==</span> F) {</span>
<span id="cb36-451"><a href="#cb36-451" aria-hidden="true" tabindex="-1"></a>    <span class="co"># not doing bootstrap</span></span>
<span id="cb36-452"><a href="#cb36-452" aria-hidden="true" tabindex="-1"></a>    boot_df <span class="ot">&lt;-</span> df </span>
<span id="cb36-453"><a href="#cb36-453" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-454"><a href="#cb36-454" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb36-455"><a href="#cb36-455" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loop over repeated id</span></span>
<span id="cb36-456"><a href="#cb36-456" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb36-457"><a href="#cb36-457" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>id, zzz)</span>
<span id="cb36-458"><a href="#cb36-458" aria-hidden="true" tabindex="-1"></a>      boot_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(boot_df, cc)</span>
<span id="cb36-459"><a href="#cb36-459" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-460"><a href="#cb36-460" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-461"><a href="#cb36-461" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-462"><a href="#cb36-462" aria-hidden="true" tabindex="-1"></a>  boot_df<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(boot_df<span class="sc">$</span>j)<span class="sc">$</span>jj</span>
<span id="cb36-463"><a href="#cb36-463" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-464"><a href="#cb36-464" aria-hidden="true" tabindex="-1"></a>  boot_df</span>
<span id="cb36-465"><a href="#cb36-465" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-466"><a href="#cb36-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-467"><a href="#cb36-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-468"><a href="#cb36-468" aria-hidden="true" tabindex="-1"></a>fitg <span class="ot">&lt;-</span> <span class="cf">function</span>(data,<span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-469"><a href="#cb36-469" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-470"><a href="#cb36-470" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb36-471"><a href="#cb36-471" aria-hidden="true" tabindex="-1"></a>                 <span class="at">yreg =</span> <span class="st">"binomial"</span>){</span>
<span id="cb36-472"><a href="#cb36-472" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-473"><a href="#cb36-473" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <span class="fu">resamp</span>(<span class="at">data =</span> data<span class="sc">$</span>df,<span class="at">boot =</span> boot)</span>
<span id="cb36-474"><a href="#cb36-474" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-475"><a href="#cb36-475" aria-hidden="true" tabindex="-1"></a>  fitR <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb36-476"><a href="#cb36-476" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-477"><a href="#cb36-477" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>df <span class="ot">&lt;-</span> res_df <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb36-478"><a href="#cb36-478" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-479"><a href="#cb36-479" aria-hidden="true" tabindex="-1"></a>  <span class="co">#----- fit parametric models for</span></span>
<span id="cb36-480"><a href="#cb36-480" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Mediator models</span></span>
<span id="cb36-481"><a href="#cb36-481" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-482"><a href="#cb36-482" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(mreg) <span class="sc">!=</span> <span class="fu">length</span>(data<span class="sc">$</span>fm)){</span>
<span id="cb36-483"><a href="#cb36-483" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"the defined regression of M is not equal"</span>)</span>
<span id="cb36-484"><a href="#cb36-484" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-485"><a href="#cb36-485" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-486"><a href="#cb36-486" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>fm)){</span>
<span id="cb36-487"><a href="#cb36-487" aria-hidden="true" tabindex="-1"></a>    fitM <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fm[[i]])</span>
<span id="cb36-488"><a href="#cb36-488" aria-hidden="true" tabindex="-1"></a>    fitR<span class="sc">$</span>M[[i]] <span class="ot">&lt;-</span> <span class="fu">glm</span>(fitM ,<span class="at">family =</span> mreg[i], <span class="at">data =</span> res_df) </span>
<span id="cb36-489"><a href="#cb36-489" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-490"><a href="#cb36-490" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-491"><a href="#cb36-491" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-492"><a href="#cb36-492" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Covariate models</span></span>
<span id="cb36-493"><a href="#cb36-493" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(lreg) <span class="sc">!=</span> <span class="fu">length</span>(data<span class="sc">$</span>fl)){</span>
<span id="cb36-494"><a href="#cb36-494" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"the defined regression of L is not equal"</span>)</span>
<span id="cb36-495"><a href="#cb36-495" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-496"><a href="#cb36-496" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-497"><a href="#cb36-497" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>fl)){</span>
<span id="cb36-498"><a href="#cb36-498" aria-hidden="true" tabindex="-1"></a>    fitL <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fl[[i]])</span>
<span id="cb36-499"><a href="#cb36-499" aria-hidden="true" tabindex="-1"></a>    fitR<span class="sc">$</span>L[[i]] <span class="ot">&lt;-</span> <span class="fu">glm</span>(fitL ,<span class="at">family =</span> lreg[i], <span class="at">data =</span> res_df) </span>
<span id="cb36-500"><a href="#cb36-500" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-501"><a href="#cb36-501" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-502"><a href="#cb36-502" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Outcome model: </span></span>
<span id="cb36-503"><a href="#cb36-503" aria-hidden="true" tabindex="-1"></a>  fitY <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fy)</span>
<span id="cb36-504"><a href="#cb36-504" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>Y <span class="ot">&lt;-</span>  <span class="fu">glm</span>(fitY ,<span class="at">family =</span> yreg, <span class="at">data =</span> res_df) </span>
<span id="cb36-505"><a href="#cb36-505" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-506"><a href="#cb36-506" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb36-507"><a href="#cb36-507" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-508"><a href="#cb36-508" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>am <span class="ot">&lt;-</span> data<span class="sc">$</span>am</span>
<span id="cb36-509"><a href="#cb36-509" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-510"><a href="#cb36-510" aria-hidden="true" tabindex="-1"></a>  fitR</span>
<span id="cb36-511"><a href="#cb36-511" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-512"><a href="#cb36-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-513"><a href="#cb36-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-514"><a href="#cb36-514" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output with continuous exposure and splines list</span></span>
<span id="cb36-515"><a href="#cb36-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-516"><a href="#cb36-516" aria-hidden="true" tabindex="-1"></a>Chổ này run ra coefficient của mình bị NA. Em có check lại bằng skeleton code thì cũng v. Em nghĩ do data mới này có vấn đề. Em import lại data chưa có 12mo thì mọi thứ bình thường á a.</span>
<span id="cb36-517"><a href="#cb36-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-520"><a href="#cb36-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-521"><a href="#cb36-521" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb36-522"><a href="#cb36-522" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb36-523"><a href="#cb36-523" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-524"><a href="#cb36-524" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-525"><a href="#cb36-525" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb36-526"><a href="#cb36-526" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb36-527"><a href="#cb36-527" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-528"><a href="#cb36-528" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb36-529"><a href="#cb36-529" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-530"><a href="#cb36-530" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb36-531"><a href="#cb36-531" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-532"><a href="#cb36-532" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> T,</span>
<span id="cb36-533"><a href="#cb36-533" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"mm"</span>,<span class="st">"L1"</span>,<span class="st">"sex"</span>),</span>
<span id="cb36-534"><a href="#cb36-534" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"bs"</span>,<span class="st">"bs"</span>,<span class="st">"ns"</span>),</span>
<span id="cb36-535"><a href="#cb36-535" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb36-536"><a href="#cb36-536" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb36-537"><a href="#cb36-537" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>  <span class="fu">fitg</span>(<span class="at">boot=</span>T,</span>
<span id="cb36-538"><a href="#cb36-538" aria-hidden="true" tabindex="-1"></a>            <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-539"><a href="#cb36-539" aria-hidden="true" tabindex="-1"></a>            <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb36-540"><a href="#cb36-540" aria-hidden="true" tabindex="-1"></a>            <span class="at">yreg =</span> <span class="st">"binomial"</span>)</span>
<span id="cb36-541"><a href="#cb36-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-542"><a href="#cb36-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-543"><a href="#cb36-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-544"><a href="#cb36-544" aria-hidden="true" tabindex="-1"></a><span class="fu">## data cũ</span></span>
<span id="cb36-545"><a href="#cb36-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-548"><a href="#cb36-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-549"><a href="#cb36-549" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/tvmed_dat100.RDS"</span>)</span>
<span id="cb36-550"><a href="#cb36-550" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb36-551"><a href="#cb36-551" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb36-552"><a href="#cb36-552" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-553"><a href="#cb36-553" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-554"><a href="#cb36-554" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb36-555"><a href="#cb36-555" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb36-556"><a href="#cb36-556" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-557"><a href="#cb36-557" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb36-558"><a href="#cb36-558" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-559"><a href="#cb36-559" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb36-560"><a href="#cb36-560" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-561"><a href="#cb36-561" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> T,</span>
<span id="cb36-562"><a href="#cb36-562" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"mm"</span>,<span class="st">"L1"</span>,<span class="st">"sex"</span>),</span>
<span id="cb36-563"><a href="#cb36-563" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"bs"</span>,<span class="st">"bs"</span>,<span class="st">"ns"</span>),</span>
<span id="cb36-564"><a href="#cb36-564" aria-hidden="true" tabindex="-1"></a>  <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb36-565"><a href="#cb36-565" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat1</span>
<span id="cb36-566"><a href="#cb36-566" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>  <span class="fu">fitg</span>(<span class="at">boot=</span>T,</span>
<span id="cb36-567"><a href="#cb36-567" aria-hidden="true" tabindex="-1"></a>            <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-568"><a href="#cb36-568" aria-hidden="true" tabindex="-1"></a>            <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb36-569"><a href="#cb36-569" aria-hidden="true" tabindex="-1"></a>            <span class="at">yreg =</span> <span class="st">"binomial"</span>)</span>
<span id="cb36-570"><a href="#cb36-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-571"><a href="#cb36-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-572"><a href="#cb36-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-573"><a href="#cb36-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-574"><a href="#cb36-574" aria-hidden="true" tabindex="-1"></a><span class="fu"># Baseline_mc function</span></span>
<span id="cb36-575"><a href="#cb36-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-578"><a href="#cb36-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-579"><a href="#cb36-579" aria-hidden="true" tabindex="-1"></a>baseline_mc <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> fitR2,<span class="at">montecarlo =</span> <span class="dv">10000</span>){</span>
<span id="cb36-580"><a href="#cb36-580" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-581"><a href="#cb36-581" aria-hidden="true" tabindex="-1"></a>  boot <span class="ot">&lt;-</span> data<span class="sc">$</span>df</span>
<span id="cb36-582"><a href="#cb36-582" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select baseline visit</span></span>
<span id="cb36-583"><a href="#cb36-583" aria-hidden="true" tabindex="-1"></a>  df0 <span class="ot">&lt;-</span> boot[boot<span class="sc">$</span>j<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb36-584"><a href="#cb36-584" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-585"><a href="#cb36-585" aria-hidden="true" tabindex="-1"></a>  df0<span class="sc">$</span>idn <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df0)</span>
<span id="cb36-586"><a href="#cb36-586" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-587"><a href="#cb36-587" aria-hidden="true" tabindex="-1"></a>  MC <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-588"><a href="#cb36-588" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-589"><a href="#cb36-589" aria-hidden="true" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(df0<span class="sc">$</span>idn, <span class="at">size =</span> montecarlo, <span class="at">replace =</span> T)</span>
<span id="cb36-590"><a href="#cb36-590" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">table</span>(samples)</span>
<span id="cb36-591"><a href="#cb36-591" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-592"><a href="#cb36-592" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb36-593"><a href="#cb36-593" aria-hidden="true" tabindex="-1"></a>    cc <span class="ot">&lt;-</span> df0[df0<span class="sc">$</span>idn <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb36-594"><a href="#cb36-594" aria-hidden="true" tabindex="-1"></a>    cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>idn, zzz)</span>
<span id="cb36-595"><a href="#cb36-595" aria-hidden="true" tabindex="-1"></a>    MC <span class="ot">&lt;-</span> <span class="fu">rbind</span>(MC, cc)</span>
<span id="cb36-596"><a href="#cb36-596" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-597"><a href="#cb36-597" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-598"><a href="#cb36-598" aria-hidden="true" tabindex="-1"></a>  MC<span class="sc">$</span>idsim <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>montecarlo</span>
<span id="cb36-599"><a href="#cb36-599" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-600"><a href="#cb36-600" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>res_df <span class="ot">&lt;-</span> MC <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb36-601"><a href="#cb36-601" aria-hidden="true" tabindex="-1"></a>  data</span>
<span id="cb36-602"><a href="#cb36-602" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-603"><a href="#cb36-603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-604"><a href="#cb36-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-605"><a href="#cb36-605" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output with standardized continous exposure </span></span>
<span id="cb36-606"><a href="#cb36-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-609"><a href="#cb36-609" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-610"><a href="#cb36-610" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb36-611"><a href="#cb36-611" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb36-612"><a href="#cb36-612" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-613"><a href="#cb36-613" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-614"><a href="#cb36-614" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb36-615"><a href="#cb36-615" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb36-616"><a href="#cb36-616" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-617"><a href="#cb36-617" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb36-618"><a href="#cb36-618" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-619"><a href="#cb36-619" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb36-620"><a href="#cb36-620" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-621"><a href="#cb36-621" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> T,</span>
<span id="cb36-622"><a href="#cb36-622" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb36-623"><a href="#cb36-623" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>  <span class="fu">fitg</span>(<span class="at">boot=</span>T,</span>
<span id="cb36-624"><a href="#cb36-624" aria-hidden="true" tabindex="-1"></a>            <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-625"><a href="#cb36-625" aria-hidden="true" tabindex="-1"></a>            <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb36-626"><a href="#cb36-626" aria-hidden="true" tabindex="-1"></a>            <span class="at">yreg =</span> <span class="st">"binomial"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb36-627"><a href="#cb36-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>)</span>
<span id="cb36-628"><a href="#cb36-628" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-629"><a href="#cb36-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-630"><a href="#cb36-630" aria-hidden="true" tabindex="-1"></a><span class="fu"># g_form function</span></span>
<span id="cb36-631"><a href="#cb36-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-634"><a href="#cb36-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-635"><a href="#cb36-635" aria-hidden="true" tabindex="-1"></a>rFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb36-636"><a href="#cb36-636" aria-hidden="true" tabindex="-1"></a>  pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb36-637"><a href="#cb36-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_prob))</span>
<span id="cb36-638"><a href="#cb36-638" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-639"><a href="#cb36-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-640"><a href="#cb36-640" aria-hidden="true" tabindex="-1"></a>g_form <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> fitR2, <span class="at">ii =</span> <span class="dv">2</span>, <span class="at">followup =</span> <span class="dv">12</span>, <span class="at">am =</span> <span class="dv">1</span>, <span class="at">ay =</span> <span class="dv">0</span>){</span>
<span id="cb36-641"><a href="#cb36-641" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-642"><a href="#cb36-642" aria-hidden="true" tabindex="-1"></a>  norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb36-643"><a href="#cb36-643" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-644"><a href="#cb36-644" aria-hidden="true" tabindex="-1"></a>  dddd <span class="ot">&lt;-</span> data<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb36-645"><a href="#cb36-645" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-646"><a href="#cb36-646" aria-hidden="true" tabindex="-1"></a>  lagg <span class="ot">&lt;-</span> dddd <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"L1l"</span>)) <span class="sc">%&gt;%</span> <span class="fu">ncol</span>() </span>
<span id="cb36-647"><a href="#cb36-647" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-648"><a href="#cb36-648" aria-hidden="true" tabindex="-1"></a>  d2 <span class="ot">&lt;-</span> dddd[dddd<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb36-649"><a href="#cb36-649" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-650"><a href="#cb36-650" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d2<span class="sc">$</span>idsim</span>
<span id="cb36-651"><a href="#cb36-651" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d2<span class="sc">$</span>id</span>
<span id="cb36-652"><a href="#cb36-652" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-653"><a href="#cb36-653" aria-hidden="true" tabindex="-1"></a>  followup <span class="ot">&lt;-</span> followup</span>
<span id="cb36-654"><a href="#cb36-654" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-655"><a href="#cb36-655" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb36-656"><a href="#cb36-656" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>))</span>
<span id="cb36-657"><a href="#cb36-657" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-658"><a href="#cb36-658" aria-hidden="true" tabindex="-1"></a>  Yp2 <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb36-659"><a href="#cb36-659" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-660"><a href="#cb36-660" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb36-661"><a href="#cb36-661" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-662"><a href="#cb36-662" aria-hidden="true" tabindex="-1"></a>  Yp2[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb36-663"><a href="#cb36-663" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-664"><a href="#cb36-664" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(data<span class="sc">$</span>df<span class="sc">$</span>j)</span>
<span id="cb36-665"><a href="#cb36-665" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-666"><a href="#cb36-666" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mediator</span></span>
<span id="cb36-667"><a href="#cb36-667" aria-hidden="true" tabindex="-1"></a>  Mp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>M)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb36-668"><a href="#cb36-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Mp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M))</span>
<span id="cb36-669"><a href="#cb36-669" aria-hidden="true" tabindex="-1"></a>  Mp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Mp)) </span>
<span id="cb36-670"><a href="#cb36-670" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-671"><a href="#cb36-671" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-672"><a href="#cb36-672" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to mediator models)</span></span>
<span id="cb36-673"><a href="#cb36-673" aria-hidden="true" tabindex="-1"></a>  Lmp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>L)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb36-674"><a href="#cb36-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb36-675"><a href="#cb36-675" aria-hidden="true" tabindex="-1"></a>  Lmp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Lmp)) </span>
<span id="cb36-676"><a href="#cb36-676" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to outcome models)</span></span>
<span id="cb36-677"><a href="#cb36-677" aria-hidden="true" tabindex="-1"></a>  Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb36-678"><a href="#cb36-678" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-679"><a href="#cb36-679" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> lagg<span class="sc">:</span>followup) {</span>
<span id="cb36-680"><a href="#cb36-680" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-681"><a href="#cb36-681" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb36-682"><a href="#cb36-682" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb36-683"><a href="#cb36-683" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb36-684"><a href="#cb36-684" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-685"><a href="#cb36-685" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb36-686"><a href="#cb36-686" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb36-687"><a href="#cb36-687" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-688"><a href="#cb36-688" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*</span><span class="sc">\\</span><span class="st">(([^,]+),.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, var_fm)</span>
<span id="cb36-689"><a href="#cb36-689" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-690"><a href="#cb36-690" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb36-691"><a href="#cb36-691" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-692"><a href="#cb36-692" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-693"><a href="#cb36-693" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb36-694"><a href="#cb36-694" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-695"><a href="#cb36-695" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb36-696"><a href="#cb36-696" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-697"><a href="#cb36-697" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-698"><a href="#cb36-698" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb36-699"><a href="#cb36-699" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-700"><a href="#cb36-700" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb36-701"><a href="#cb36-701" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb36-702"><a href="#cb36-702" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb36-703"><a href="#cb36-703" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb36-704"><a href="#cb36-704" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb36-705"><a href="#cb36-705" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb36-706"><a href="#cb36-706" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-707"><a href="#cb36-707" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-708"><a href="#cb36-708" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-709"><a href="#cb36-709" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-710"><a href="#cb36-710" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-711"><a href="#cb36-711" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb36-712"><a href="#cb36-712" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-713"><a href="#cb36-713" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb36-714"><a href="#cb36-714" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-715"><a href="#cb36-715" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb36-716"><a href="#cb36-716" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-717"><a href="#cb36-717" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb36-718"><a href="#cb36-718" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb36-719"><a href="#cb36-719" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb36-720"><a href="#cb36-720" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb36-721"><a href="#cb36-721" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb36-722"><a href="#cb36-722" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb36-723"><a href="#cb36-723" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb36-724"><a href="#cb36-724" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb36-725"><a href="#cb36-725" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-726"><a href="#cb36-726" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb36-727"><a href="#cb36-727" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-728"><a href="#cb36-728" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb36-729"><a href="#cb36-729" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb36-730"><a href="#cb36-730" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb36-731"><a href="#cb36-731" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb36-732"><a href="#cb36-732" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-733"><a href="#cb36-733" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-734"><a href="#cb36-734" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-735"><a href="#cb36-735" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-736"><a href="#cb36-736" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-737"><a href="#cb36-737" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb36-738"><a href="#cb36-738" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb36-739"><a href="#cb36-739" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb36-740"><a href="#cb36-740" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*</span><span class="sc">\\</span><span class="st">(([^,]+),.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, var_fl)</span>
<span id="cb36-741"><a href="#cb36-741" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb36-742"><a href="#cb36-742" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-743"><a href="#cb36-743" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb36-744"><a href="#cb36-744" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb36-745"><a href="#cb36-745" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb36-746"><a href="#cb36-746" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-747"><a href="#cb36-747" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-748"><a href="#cb36-748" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb36-749"><a href="#cb36-749" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-750"><a href="#cb36-750" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb36-751"><a href="#cb36-751" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb36-752"><a href="#cb36-752" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb36-753"><a href="#cb36-753" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb36-754"><a href="#cb36-754" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb36-755"><a href="#cb36-755" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb36-756"><a href="#cb36-756" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-757"><a href="#cb36-757" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-758"><a href="#cb36-758" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-759"><a href="#cb36-759" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-760"><a href="#cb36-760" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb36-761"><a href="#cb36-761" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-762"><a href="#cb36-762" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb36-763"><a href="#cb36-763" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-764"><a href="#cb36-764" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb36-765"><a href="#cb36-765" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb36-766"><a href="#cb36-766" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-767"><a href="#cb36-767" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb36-768"><a href="#cb36-768" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-769"><a href="#cb36-769" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb36-770"><a href="#cb36-770" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-771"><a href="#cb36-771" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb36-772"><a href="#cb36-772" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb36-773"><a href="#cb36-773" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb36-774"><a href="#cb36-774" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb36-775"><a href="#cb36-775" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-776"><a href="#cb36-776" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb36-777"><a href="#cb36-777" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-778"><a href="#cb36-778" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb36-779"><a href="#cb36-779" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-780"><a href="#cb36-780" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb36-781"><a href="#cb36-781" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb36-782"><a href="#cb36-782" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb36-783"><a href="#cb36-783" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb36-784"><a href="#cb36-784" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-785"><a href="#cb36-785" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-786"><a href="#cb36-786" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-787"><a href="#cb36-787" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-788"><a href="#cb36-788" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-789"><a href="#cb36-789" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb36-790"><a href="#cb36-790" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb36-791"><a href="#cb36-791" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-792"><a href="#cb36-792" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb36-793"><a href="#cb36-793" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb36-794"><a href="#cb36-794" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb36-795"><a href="#cb36-795" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-796"><a href="#cb36-796" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb36-797"><a href="#cb36-797" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-798"><a href="#cb36-798" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb36-799"><a href="#cb36-799" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb36-800"><a href="#cb36-800" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb36-801"><a href="#cb36-801" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb36-802"><a href="#cb36-802" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb36-803"><a href="#cb36-803" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb36-804"><a href="#cb36-804" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb36-805"><a href="#cb36-805" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-806"><a href="#cb36-806" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-807"><a href="#cb36-807" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-808"><a href="#cb36-808" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb36-809"><a href="#cb36-809" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-810"><a href="#cb36-810" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb36-811"><a href="#cb36-811" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-812"><a href="#cb36-812" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb36-813"><a href="#cb36-813" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb36-814"><a href="#cb36-814" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb36-815"><a href="#cb36-815" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb36-816"><a href="#cb36-816" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb36-817"><a href="#cb36-817" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb36-818"><a href="#cb36-818" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb36-819"><a href="#cb36-819" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb36-820"><a href="#cb36-820" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb36-821"><a href="#cb36-821" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb36-822"><a href="#cb36-822" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb36-823"><a href="#cb36-823" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb36-824"><a href="#cb36-824" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb36-825"><a href="#cb36-825" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-826"><a href="#cb36-826" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb36-827"><a href="#cb36-827" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-828"><a href="#cb36-828" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb36-829"><a href="#cb36-829" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb36-830"><a href="#cb36-830" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb36-831"><a href="#cb36-831" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb36-832"><a href="#cb36-832" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-833"><a href="#cb36-833" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb36-834"><a href="#cb36-834" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb36-835"><a href="#cb36-835" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-836"><a href="#cb36-836" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-837"><a href="#cb36-837" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb36-838"><a href="#cb36-838" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb36-839"><a href="#cb36-839" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-840"><a href="#cb36-840" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-841"><a href="#cb36-841" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb36-842"><a href="#cb36-842" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb36-843"><a href="#cb36-843" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*</span><span class="sc">\\</span><span class="st">(([^,]+),.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, var_y)</span>
<span id="cb36-844"><a href="#cb36-844" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb36-845"><a href="#cb36-845" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-846"><a href="#cb36-846" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb36-847"><a href="#cb36-847" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb36-848"><a href="#cb36-848" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb36-849"><a href="#cb36-849" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb36-850"><a href="#cb36-850" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-851"><a href="#cb36-851" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb36-852"><a href="#cb36-852" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-853"><a href="#cb36-853" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb36-854"><a href="#cb36-854" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb36-855"><a href="#cb36-855" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb36-856"><a href="#cb36-856" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb36-857"><a href="#cb36-857" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb36-858"><a href="#cb36-858" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb36-859"><a href="#cb36-859" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-860"><a href="#cb36-860" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-861"><a href="#cb36-861" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-862"><a href="#cb36-862" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-863"><a href="#cb36-863" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb36-864"><a href="#cb36-864" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-865"><a href="#cb36-865" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-866"><a href="#cb36-866" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-867"><a href="#cb36-867" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb36-868"><a href="#cb36-868" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-869"><a href="#cb36-869" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-870"><a href="#cb36-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lmp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb36-871"><a href="#cb36-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Lp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb36-872"><a href="#cb36-872" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-873"><a href="#cb36-873" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num &lt;- seed</span></span>
<span id="cb36-874"><a href="#cb36-874" aria-hidden="true" tabindex="-1"></a>  gdat2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, Mp, Yp2,</span>
<span id="cb36-875"><a href="#cb36-875" aria-hidden="true" tabindex="-1"></a>                      Lmp, Lp, Vp)</span>
<span id="cb36-876"><a href="#cb36-876" aria-hidden="true" tabindex="-1"></a>  gdat2<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat2<span class="sc">$</span>id, <span class="at">fromLast =</span> T))</span>
<span id="cb36-877"><a href="#cb36-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gdat2)</span>
<span id="cb36-878"><a href="#cb36-878" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-879"><a href="#cb36-879" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-880"><a href="#cb36-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-881"><a href="#cb36-881" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output with continous exposuse and not standardize</span></span>
<span id="cb36-882"><a href="#cb36-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-885"><a href="#cb36-885" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-886"><a href="#cb36-886" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb36-887"><a href="#cb36-887" aria-hidden="true" tabindex="-1"></a>  <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb36-888"><a href="#cb36-888" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-889"><a href="#cb36-889" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-890"><a href="#cb36-890" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb36-891"><a href="#cb36-891" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb36-892"><a href="#cb36-892" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-893"><a href="#cb36-893" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb36-894"><a href="#cb36-894" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-895"><a href="#cb36-895" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar_to_med =</span> F,</span>
<span id="cb36-896"><a href="#cb36-896" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-897"><a href="#cb36-897" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_exp_std =</span> F,</span>
<span id="cb36-898"><a href="#cb36-898" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"mm"</span>,<span class="st">"L1"</span>),</span>
<span id="cb36-899"><a href="#cb36-899" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"ns"</span>,<span class="st">"bs"</span>,<span class="st">"bs"</span>),</span>
<span id="cb36-900"><a href="#cb36-900" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb36-901"><a href="#cb36-901" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb36-902"><a href="#cb36-902" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>  <span class="fu">fitg</span>(<span class="at">boot=</span>T,</span>
<span id="cb36-903"><a href="#cb36-903" aria-hidden="true" tabindex="-1"></a>            <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-904"><a href="#cb36-904" aria-hidden="true" tabindex="-1"></a>            <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb36-905"><a href="#cb36-905" aria-hidden="true" tabindex="-1"></a>            <span class="at">yreg =</span> <span class="st">"binomial"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb36-906"><a href="#cb36-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>)</span>
<span id="cb36-907"><a href="#cb36-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-908"><a href="#cb36-908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-909"><a href="#cb36-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-912"><a href="#cb36-912" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-913"><a href="#cb36-913" aria-hidden="true" tabindex="-1"></a>am <span class="ot">&lt;-</span> fitR2<span class="sc">$</span>am</span>
<span id="cb36-914"><a href="#cb36-914" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="sc">%&gt;%</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">followup =</span> <span class="dv">12</span>, <span class="at">am =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">ay =</span> am<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb36-915"><a href="#cb36-915" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="sc">%&gt;%</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">followup =</span> <span class="dv">12</span>, <span class="at">am =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">ay =</span> am)</span>
<span id="cb36-916"><a href="#cb36-916" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="sc">%&gt;%</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">followup =</span> <span class="dv">12</span>, <span class="at">am =</span> am, <span class="at">ay =</span> am)</span>
<span id="cb36-917"><a href="#cb36-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-918"><a href="#cb36-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-919"><a href="#cb36-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-920"><a href="#cb36-920" aria-hidden="true" tabindex="-1"></a><span class="fu"># Additional function</span></span>
<span id="cb36-921"><a href="#cb36-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-924"><a href="#cb36-924" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-925"><a href="#cb36-925" aria-hidden="true" tabindex="-1"></a>ExtResult2 <span class="ot">&lt;-</span> <span class="cf">function</span>(data,am) {</span>
<span id="cb36-926"><a href="#cb36-926" aria-hidden="true" tabindex="-1"></a>  Q11 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span>am<span class="sc">+</span><span class="dv">1</span> <span class="sc">&amp;</span> Am <span class="sc">==</span>am<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb36-927"><a href="#cb36-927" aria-hidden="true" tabindex="-1"></a>  Q10 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span>am<span class="sc">+</span><span class="dv">1</span> <span class="sc">&amp;</span> Am <span class="sc">==</span>am)</span>
<span id="cb36-928"><a href="#cb36-928" aria-hidden="true" tabindex="-1"></a>  Q00 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span>am <span class="sc">&amp;</span> Am <span class="sc">==</span>am)</span>
<span id="cb36-929"><a href="#cb36-929" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-930"><a href="#cb36-930" aria-hidden="true" tabindex="-1"></a>  qq <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mQ11 =</span> <span class="fu">mean</span>(Q11<span class="sc">$</span>Yp2),</span>
<span id="cb36-931"><a href="#cb36-931" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mQ10 =</span> <span class="fu">mean</span>(Q10<span class="sc">$</span>Yp2),</span>
<span id="cb36-932"><a href="#cb36-932" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mQ00 =</span> <span class="fu">mean</span>(Q00<span class="sc">$</span>Yp2))</span>
<span id="cb36-933"><a href="#cb36-933" aria-hidden="true" tabindex="-1"></a>  qq</span>
<span id="cb36-934"><a href="#cb36-934" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-935"><a href="#cb36-935" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-936"><a href="#cb36-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-937"><a href="#cb36-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-940"><a href="#cb36-940" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-941"><a href="#cb36-941" aria-hidden="true" tabindex="-1"></a>cal_ci <span class="ot">&lt;-</span> <span class="cf">function</span>(data,<span class="at">ci =</span> <span class="fl">0.95</span>,<span class="at">boot =</span> T){</span>
<span id="cb36-942"><a href="#cb36-942" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-943"><a href="#cb36-943" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (boot <span class="sc">==</span> F){</span>
<span id="cb36-944"><a href="#cb36-944" aria-hidden="true" tabindex="-1"></a>    resu <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-945"><a href="#cb36-945" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-946"><a href="#cb36-946" aria-hidden="true" tabindex="-1"></a>    qnt <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">probs =</span> <span class="fu">c</span>((<span class="dv">1</span><span class="sc">-</span>ci)<span class="sc">/</span><span class="dv">2</span>,<span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span><span class="sc">-</span>ci)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb36-947"><a href="#cb36-947" aria-hidden="true" tabindex="-1"></a>    resu <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"("</span>,<span class="fu">round</span>(qnt[<span class="dv">1</span>],<span class="dv">3</span>),<span class="st">","</span>,<span class="fu">round</span>(qnt[<span class="dv">2</span>],<span class="dv">3</span>),<span class="st">")"</span>)</span>
<span id="cb36-948"><a href="#cb36-948" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-949"><a href="#cb36-949" aria-hidden="true" tabindex="-1"></a>  resu</span>
<span id="cb36-950"><a href="#cb36-950" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-951"><a href="#cb36-951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-952"><a href="#cb36-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-953"><a href="#cb36-953" aria-hidden="true" tabindex="-1"></a><span class="fu"># Final tvmedg function</span></span>
<span id="cb36-954"><a href="#cb36-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-957"><a href="#cb36-957" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-958"><a href="#cb36-958" aria-hidden="true" tabindex="-1"></a>tvmedg <span class="ot">&lt;-</span> <span class="cf">function</span>(data,basec,expo,med,tvar,outc,time,<span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-959"><a href="#cb36-959" aria-hidden="true" tabindex="-1"></a>                   <span class="at">norev =</span> <span class="cn">NULL</span>, <span class="at">cont_exp =</span> <span class="cn">NULL</span>,<span class="at">cont_exp_std =</span> F,</span>
<span id="cb36-960"><a href="#cb36-960" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tvar_to_med =</span> F,</span>
<span id="cb36-961"><a href="#cb36-961" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-962"><a href="#cb36-962" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb36-963"><a href="#cb36-963" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-964"><a href="#cb36-964" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sp_list =</span> <span class="cn">NULL</span>,<span class="at">sp_type =</span> <span class="cn">NULL</span>,<span class="at">sp_df=</span> <span class="cn">NULL</span>,</span>
<span id="cb36-965"><a href="#cb36-965" aria-hidden="true" tabindex="-1"></a>                   <span class="at">followup =</span> <span class="dv">12</span>,</span>
<span id="cb36-966"><a href="#cb36-966" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seed =</span> <span class="dv">0</span>,<span class="at">montecarlo =</span> <span class="dv">10</span>,<span class="at">boot =</span> <span class="cn">FALSE</span>,<span class="at">nboot =</span> <span class="dv">1</span>,<span class="at">ci =</span> .<span class="dv">95</span>,</span>
<span id="cb36-967"><a href="#cb36-967" aria-hidden="true" tabindex="-1"></a>                   <span class="at">parallel=</span><span class="cn">TRUE</span>){</span>
<span id="cb36-968"><a href="#cb36-968" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-969"><a href="#cb36-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb36-970"><a href="#cb36-970" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-971"><a href="#cb36-971" aria-hidden="true" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb36-972"><a href="#cb36-972" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-973"><a href="#cb36-973" aria-hidden="true" tabindex="-1"></a>  qqq <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb36-974"><a href="#cb36-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(qqq) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mQ11"</span>,<span class="st">"mQ10"</span>,<span class="st">"mQ00"</span>)</span>
<span id="cb36-975"><a href="#cb36-975" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-976"><a href="#cb36-976" aria-hidden="true" tabindex="-1"></a>  qqq_ci <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb36-977"><a href="#cb36-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(qqq_ci) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mQ11"</span>,<span class="st">"mQ10"</span>,<span class="st">"mQ00"</span>)</span>
<span id="cb36-978"><a href="#cb36-978" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-979"><a href="#cb36-979" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-980"><a href="#cb36-980" aria-hidden="true" tabindex="-1"></a>  <span class="do">## point estimate</span></span>
<span id="cb36-981"><a href="#cb36-981" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-982"><a href="#cb36-982" aria-hidden="true" tabindex="-1"></a>  fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb36-983"><a href="#cb36-983" aria-hidden="true" tabindex="-1"></a>    <span class="at">basec =</span> basec,</span>
<span id="cb36-984"><a href="#cb36-984" aria-hidden="true" tabindex="-1"></a>    <span class="at">expo =</span> expo,</span>
<span id="cb36-985"><a href="#cb36-985" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> med,</span>
<span id="cb36-986"><a href="#cb36-986" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvar =</span> tvar,</span>
<span id="cb36-987"><a href="#cb36-987" aria-hidden="true" tabindex="-1"></a>    <span class="at">outc =</span> outc,</span>
<span id="cb36-988"><a href="#cb36-988" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag =</span> lag,</span>
<span id="cb36-989"><a href="#cb36-989" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> time,</span>
<span id="cb36-990"><a href="#cb36-990" aria-hidden="true" tabindex="-1"></a>    <span class="at">norev =</span> norev,</span>
<span id="cb36-991"><a href="#cb36-991" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvar_to_med =</span> tvar_to_med,</span>
<span id="cb36-992"><a href="#cb36-992" aria-hidden="true" tabindex="-1"></a>    <span class="at">cont_exp =</span> cont_exp,</span>
<span id="cb36-993"><a href="#cb36-993" aria-hidden="true" tabindex="-1"></a>    <span class="at">cont_exp_std =</span> cont_exp_std,</span>
<span id="cb36-994"><a href="#cb36-994" aria-hidden="true" tabindex="-1"></a>    <span class="at">sp_list =</span> sp_list,</span>
<span id="cb36-995"><a href="#cb36-995" aria-hidden="true" tabindex="-1"></a>    <span class="at">sp_type =</span> sp_type,</span>
<span id="cb36-996"><a href="#cb36-996" aria-hidden="true" tabindex="-1"></a>    <span class="at">sp_df =</span> sp_df,</span>
<span id="cb36-997"><a href="#cb36-997" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data</span>
<span id="cb36-998"><a href="#cb36-998" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb36-999"><a href="#cb36-999" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fitg</span>(<span class="at">boot=</span>boot,</span>
<span id="cb36-1000"><a href="#cb36-1000" aria-hidden="true" tabindex="-1"></a>         <span class="at">mreg =</span> mreg,</span>
<span id="cb36-1001"><a href="#cb36-1001" aria-hidden="true" tabindex="-1"></a>         <span class="at">lreg =</span> lreg,</span>
<span id="cb36-1002"><a href="#cb36-1002" aria-hidden="true" tabindex="-1"></a>         <span class="at">yreg =</span> yreg) <span class="sc">%&gt;%</span> </span>
<span id="cb36-1003"><a href="#cb36-1003" aria-hidden="true" tabindex="-1"></a>    <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> montecarlo)</span>
<span id="cb36-1004"><a href="#cb36-1004" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1005"><a href="#cb36-1005" aria-hidden="true" tabindex="-1"></a>  am <span class="ot">&lt;-</span> fitR2<span class="sc">$</span>am</span>
<span id="cb36-1006"><a href="#cb36-1006" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1007"><a href="#cb36-1007" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (parallel <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb36-1008"><a href="#cb36-1008" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-1009"><a href="#cb36-1009" aria-hidden="true" tabindex="-1"></a>    gform_wrapper2 <span class="ot">&lt;-</span> <span class="cf">function</span>(iii, data, followup) {</span>
<span id="cb36-1010"><a href="#cb36-1010" aria-hidden="true" tabindex="-1"></a>      outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb36-1011"><a href="#cb36-1011" aria-hidden="true" tabindex="-1"></a>      outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am)</span>
<span id="cb36-1012"><a href="#cb36-1012" aria-hidden="true" tabindex="-1"></a>      outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am, <span class="at">am =</span> am)</span>
<span id="cb36-1013"><a href="#cb36-1013" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_rows</span>(outdat11, outdat10, outdat00)</span>
<span id="cb36-1014"><a href="#cb36-1014" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-1015"><a href="#cb36-1015" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-1016"><a href="#cb36-1016" aria-hidden="true" tabindex="-1"></a>    resultDatM <span class="ot">&lt;-</span> <span class="fu">future_map_dfr</span>(<span class="dv">1</span><span class="sc">:</span>montecarlo,  </span>
<span id="cb36-1017"><a href="#cb36-1017" aria-hidden="true" tabindex="-1"></a>                                 <span class="sc">~</span> <span class="fu">gform_wrapper2</span>(<span class="at">ii =</span> .x, <span class="at">data =</span> fitR2, <span class="at">followup =</span> followup))</span>
<span id="cb36-1018"><a href="#cb36-1018" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-1019"><a href="#cb36-1019" aria-hidden="true" tabindex="-1"></a>    resultDatM <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb36-1020"><a href="#cb36-1020" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (iii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>montecarlo){</span>
<span id="cb36-1021"><a href="#cb36-1021" aria-hidden="true" tabindex="-1"></a>      outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb36-1022"><a href="#cb36-1022" aria-hidden="true" tabindex="-1"></a>      outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am)</span>
<span id="cb36-1023"><a href="#cb36-1023" aria-hidden="true" tabindex="-1"></a>      outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am, <span class="at">am =</span> am)</span>
<span id="cb36-1024"><a href="#cb36-1024" aria-hidden="true" tabindex="-1"></a>      resultDatM2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(outdat11, outdat10, outdat00)</span>
<span id="cb36-1025"><a href="#cb36-1025" aria-hidden="true" tabindex="-1"></a>      resultDatM <span class="ot">&lt;-</span> <span class="fu">rbind</span>(resultDatM,resultDatM2)</span>
<span id="cb36-1026"><a href="#cb36-1026" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-1027"><a href="#cb36-1027" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-1028"><a href="#cb36-1028" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1029"><a href="#cb36-1029" aria-hidden="true" tabindex="-1"></a>  qqq <span class="ot">&lt;-</span> <span class="fu">ExtResult2</span>(resultDatM,<span class="at">am =</span> am) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb36-1030"><a href="#cb36-1030" aria-hidden="true" tabindex="-1"></a>    <span class="at">rIE_b =</span> mQ11 <span class="sc">-</span> mQ10,</span>
<span id="cb36-1031"><a href="#cb36-1031" aria-hidden="true" tabindex="-1"></a>    <span class="at">rDE_b =</span> mQ10 <span class="sc">-</span> mQ00,</span>
<span id="cb36-1032"><a href="#cb36-1032" aria-hidden="true" tabindex="-1"></a>    <span class="at">rTE_b =</span> mQ11 <span class="sc">-</span> mQ00,</span>
<span id="cb36-1033"><a href="#cb36-1033" aria-hidden="true" tabindex="-1"></a>    <span class="at">rPE_b =</span> rIE_b<span class="sc">/</span> rTE_b</span>
<span id="cb36-1034"><a href="#cb36-1034" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-1035"><a href="#cb36-1035" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1036"><a href="#cb36-1036" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (boot <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb36-1037"><a href="#cb36-1037" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-1038"><a href="#cb36-1038" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (it <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nboot){</span>
<span id="cb36-1039"><a href="#cb36-1039" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-1040"><a href="#cb36-1040" aria-hidden="true" tabindex="-1"></a>      <span class="do">## boostrap</span></span>
<span id="cb36-1041"><a href="#cb36-1041" aria-hidden="true" tabindex="-1"></a>      fitR2a <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb36-1042"><a href="#cb36-1042" aria-hidden="true" tabindex="-1"></a>        <span class="at">basec =</span> basec,</span>
<span id="cb36-1043"><a href="#cb36-1043" aria-hidden="true" tabindex="-1"></a>        <span class="at">expo =</span> expo,</span>
<span id="cb36-1044"><a href="#cb36-1044" aria-hidden="true" tabindex="-1"></a>        <span class="at">med =</span> med,</span>
<span id="cb36-1045"><a href="#cb36-1045" aria-hidden="true" tabindex="-1"></a>        <span class="at">tvar =</span> tvar,</span>
<span id="cb36-1046"><a href="#cb36-1046" aria-hidden="true" tabindex="-1"></a>        <span class="at">outc =</span> outc,</span>
<span id="cb36-1047"><a href="#cb36-1047" aria-hidden="true" tabindex="-1"></a>        <span class="at">lag =</span> lag,</span>
<span id="cb36-1048"><a href="#cb36-1048" aria-hidden="true" tabindex="-1"></a>        <span class="at">time =</span> time,</span>
<span id="cb36-1049"><a href="#cb36-1049" aria-hidden="true" tabindex="-1"></a>        <span class="at">norev =</span> norev,</span>
<span id="cb36-1050"><a href="#cb36-1050" aria-hidden="true" tabindex="-1"></a>        <span class="at">tvar_to_med =</span> tvar_to_med,</span>
<span id="cb36-1051"><a href="#cb36-1051" aria-hidden="true" tabindex="-1"></a>        <span class="at">cont_exp =</span> cont_exp,</span>
<span id="cb36-1052"><a href="#cb36-1052" aria-hidden="true" tabindex="-1"></a>        <span class="at">cont_exp_std =</span> cont_exp_std,</span>
<span id="cb36-1053"><a href="#cb36-1053" aria-hidden="true" tabindex="-1"></a>        <span class="at">sp_list =</span> sp_list,</span>
<span id="cb36-1054"><a href="#cb36-1054" aria-hidden="true" tabindex="-1"></a>        <span class="at">sp_type =</span> sp_type,</span>
<span id="cb36-1055"><a href="#cb36-1055" aria-hidden="true" tabindex="-1"></a>        <span class="at">sp_df =</span> sp_df,</span>
<span id="cb36-1056"><a href="#cb36-1056" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> data)  <span class="sc">%&gt;%</span> </span>
<span id="cb36-1057"><a href="#cb36-1057" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fitg</span>(<span class="at">boot=</span>boot,</span>
<span id="cb36-1058"><a href="#cb36-1058" aria-hidden="true" tabindex="-1"></a>             <span class="at">mreg =</span> mreg,</span>
<span id="cb36-1059"><a href="#cb36-1059" aria-hidden="true" tabindex="-1"></a>             <span class="at">lreg =</span> lreg,</span>
<span id="cb36-1060"><a href="#cb36-1060" aria-hidden="true" tabindex="-1"></a>             <span class="at">yreg =</span> yreg) <span class="sc">%&gt;%</span> </span>
<span id="cb36-1061"><a href="#cb36-1061" aria-hidden="true" tabindex="-1"></a>        <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> montecarlo)</span>
<span id="cb36-1062"><a href="#cb36-1062" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-1063"><a href="#cb36-1063" aria-hidden="true" tabindex="-1"></a>      am_ci <span class="ot">&lt;-</span> fitR2a<span class="sc">$</span>am</span>
<span id="cb36-1064"><a href="#cb36-1064" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-1065"><a href="#cb36-1065" aria-hidden="true" tabindex="-1"></a>      <span class="do">## extract mean of q11,q10,q00 of the ith iter</span></span>
<span id="cb36-1066"><a href="#cb36-1066" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (parallel <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb36-1067"><a href="#cb36-1067" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-1068"><a href="#cb36-1068" aria-hidden="true" tabindex="-1"></a>        gform_wrapper2 <span class="ot">&lt;-</span> <span class="cf">function</span>(iii, data, followup) {</span>
<span id="cb36-1069"><a href="#cb36-1069" aria-hidden="true" tabindex="-1"></a>          outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am_ci<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb36-1070"><a href="#cb36-1070" aria-hidden="true" tabindex="-1"></a>          outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am_ci)</span>
<span id="cb36-1071"><a href="#cb36-1071" aria-hidden="true" tabindex="-1"></a>          outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci, <span class="at">am =</span> am_ci)</span>
<span id="cb36-1072"><a href="#cb36-1072" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_rows</span>(outdat11, outdat10, outdat00)</span>
<span id="cb36-1073"><a href="#cb36-1073" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-1074"><a href="#cb36-1074" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-1075"><a href="#cb36-1075" aria-hidden="true" tabindex="-1"></a>        resultDatM_ci <span class="ot">&lt;-</span> <span class="fu">future_map_dfr</span>(<span class="dv">1</span><span class="sc">:</span>montecarlo,  </span>
<span id="cb36-1076"><a href="#cb36-1076" aria-hidden="true" tabindex="-1"></a>                                        <span class="sc">~</span> <span class="fu">gform_wrapper2</span>(<span class="at">ii =</span> .x, <span class="at">data =</span> fitR2a, <span class="at">followup =</span> followup))</span>
<span id="cb36-1077"><a href="#cb36-1077" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb36-1078"><a href="#cb36-1078" aria-hidden="true" tabindex="-1"></a>        resultDatM <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb36-1079"><a href="#cb36-1079" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (iii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>montecarlo){</span>
<span id="cb36-1080"><a href="#cb36-1080" aria-hidden="true" tabindex="-1"></a>          outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am_ci<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb36-1081"><a href="#cb36-1081" aria-hidden="true" tabindex="-1"></a>          outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci<span class="sc">+</span><span class="dv">1</span>, <span class="at">am =</span> am_ci)</span>
<span id="cb36-1082"><a href="#cb36-1082" aria-hidden="true" tabindex="-1"></a>          outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">followup =</span> followup, <span class="at">ay =</span> am_ci, <span class="at">am =</span> am_ci)</span>
<span id="cb36-1083"><a href="#cb36-1083" aria-hidden="true" tabindex="-1"></a>          resultDatM2_ci <span class="ot">&lt;-</span> <span class="fu">rbind</span>(outdat11, outdat10, outdat00)</span>
<span id="cb36-1084"><a href="#cb36-1084" aria-hidden="true" tabindex="-1"></a>          resultDatM_ci <span class="ot">&lt;-</span> <span class="fu">rbind</span>(resultDatM_ci,resultDatM2_ci)</span>
<span id="cb36-1085"><a href="#cb36-1085" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-1086"><a href="#cb36-1086" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-1087"><a href="#cb36-1087" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-1088"><a href="#cb36-1088" aria-hidden="true" tabindex="-1"></a>      qqq_ci[it,] <span class="ot">&lt;-</span> <span class="fu">ExtResult2</span>(resultDatM_ci,<span class="at">am =</span> am_ci)</span>
<span id="cb36-1089"><a href="#cb36-1089" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-1090"><a href="#cb36-1090" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-1091"><a href="#cb36-1091" aria-hidden="true" tabindex="-1"></a>    qqq_ci <span class="ot">&lt;-</span> qqq_ci <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb36-1092"><a href="#cb36-1092" aria-hidden="true" tabindex="-1"></a>      <span class="at">rIE_b =</span> mQ11 <span class="sc">-</span> mQ10,</span>
<span id="cb36-1093"><a href="#cb36-1093" aria-hidden="true" tabindex="-1"></a>      <span class="at">rDE_b =</span> mQ10 <span class="sc">-</span> mQ00,</span>
<span id="cb36-1094"><a href="#cb36-1094" aria-hidden="true" tabindex="-1"></a>      <span class="at">rTE_b =</span> mQ11 <span class="sc">-</span> mQ00,</span>
<span id="cb36-1095"><a href="#cb36-1095" aria-hidden="true" tabindex="-1"></a>      <span class="at">rPE_b =</span> rIE_b<span class="sc">/</span> rTE_b</span>
<span id="cb36-1096"><a href="#cb36-1096" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-1097"><a href="#cb36-1097" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-1098"><a href="#cb36-1098" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-1099"><a href="#cb36-1099" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1100"><a href="#cb36-1100" aria-hidden="true" tabindex="-1"></a>  end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb36-1101"><a href="#cb36-1101" aria-hidden="true" tabindex="-1"></a>  elapsed_time <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span>
<span id="cb36-1102"><a href="#cb36-1102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1103"><a href="#cb36-1103" aria-hidden="true" tabindex="-1"></a>  obj <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb36-1104"><a href="#cb36-1104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1105"><a href="#cb36-1105" aria-hidden="true" tabindex="-1"></a>  obj<span class="sc">$</span>ori_df <span class="ot">&lt;-</span> fitR2<span class="sc">$</span>df</span>
<span id="cb36-1106"><a href="#cb36-1106" aria-hidden="true" tabindex="-1"></a>  obj<span class="sc">$</span>dat_MC <span class="ot">&lt;-</span> resultDatM</span>
<span id="cb36-1107"><a href="#cb36-1107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(obj) <span class="ot">&lt;-</span> <span class="st">"tvmedg"</span></span>
<span id="cb36-1108"><a href="#cb36-1108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1109"><a href="#cb36-1109" aria-hidden="true" tabindex="-1"></a>  <span class="do">## print result</span></span>
<span id="cb36-1110"><a href="#cb36-1110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(a,a):"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>mQ11, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>mQ11,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb36-1111"><a href="#cb36-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(a,a*):"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>mQ10, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>mQ10,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb36-1112"><a href="#cb36-1112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(a*,a*):"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>mQ00, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>mQ00,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb36-1113"><a href="#cb36-1113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1114"><a href="#cb36-1114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Indirect:"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>rIE_b, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>rIE_b,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb36-1115"><a href="#cb36-1115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Direct:"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>rDE_b, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>rDE_b,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb36-1116"><a href="#cb36-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Total:"</span>, <span class="fu">round</span>(qqq<span class="sc">$</span>rTE_b, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>rTE_b,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb36-1117"><a href="#cb36-1117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Proportional explain:"</span>, </span>
<span id="cb36-1118"><a href="#cb36-1118" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(qqq<span class="sc">$</span>rPE_b, <span class="dv">3</span>),<span class="fu">cal_ci</span>(qqq_ci<span class="sc">$</span>rPE_b,ci,<span class="at">boot =</span> boot),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb36-1119"><a href="#cb36-1119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1120"><a href="#cb36-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Total time elapsed:"</span>,elapsed_time,<span class="fu">attr</span>(elapsed_time,<span class="st">"units"</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb36-1121"><a href="#cb36-1121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1122"><a href="#cb36-1122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(obj)</span>
<span id="cb36-1123"><a href="#cb36-1123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1124"><a href="#cb36-1124" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-1125"><a href="#cb36-1125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1126"><a href="#cb36-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1127"><a href="#cb36-1127" aria-hidden="true" tabindex="-1"></a><span class="fu"># run</span></span>
<span id="cb36-1128"><a href="#cb36-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1129"><a href="#cb36-1129" aria-hidden="true" tabindex="-1"></a><span class="fu">## Default</span></span>
<span id="cb36-1130"><a href="#cb36-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1133"><a href="#cb36-1133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-1134"><a href="#cb36-1134" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb36-1135"><a href="#cb36-1135" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb36-1136"><a href="#cb36-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1137"><a href="#cb36-1137" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">8</span>)</span>
<span id="cb36-1138"><a href="#cb36-1138" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb36-1139"><a href="#cb36-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1140"><a href="#cb36-1140" aria-hidden="true" tabindex="-1"></a><span class="fu">tvmedg</span>(<span class="at">data =</span> dat0,</span>
<span id="cb36-1141"><a href="#cb36-1141" aria-hidden="true" tabindex="-1"></a>       <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb36-1142"><a href="#cb36-1142" aria-hidden="true" tabindex="-1"></a>       <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb36-1143"><a href="#cb36-1143" aria-hidden="true" tabindex="-1"></a>       <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-1144"><a href="#cb36-1144" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb36-1145"><a href="#cb36-1145" aria-hidden="true" tabindex="-1"></a>       <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb36-1146"><a href="#cb36-1146" aria-hidden="true" tabindex="-1"></a>       <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb36-1147"><a href="#cb36-1147" aria-hidden="true" tabindex="-1"></a>       <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-1148"><a href="#cb36-1148" aria-hidden="true" tabindex="-1"></a>       <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-1149"><a href="#cb36-1149" aria-hidden="true" tabindex="-1"></a>       <span class="at">cont_exp =</span> <span class="cn">NULL</span>,</span>
<span id="cb36-1150"><a href="#cb36-1150" aria-hidden="true" tabindex="-1"></a>       <span class="at">cont_exp_std =</span> F,</span>
<span id="cb36-1151"><a href="#cb36-1151" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar_to_med =</span> F,</span>
<span id="cb36-1152"><a href="#cb36-1152" aria-hidden="true" tabindex="-1"></a>       <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-1153"><a href="#cb36-1153" aria-hidden="true" tabindex="-1"></a>       <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb36-1154"><a href="#cb36-1154" aria-hidden="true" tabindex="-1"></a>       <span class="at">yreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-1155"><a href="#cb36-1155" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_list =</span> <span class="cn">NULL</span>,</span>
<span id="cb36-1156"><a href="#cb36-1156" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_type =</span> <span class="cn">NULL</span>,</span>
<span id="cb36-1157"><a href="#cb36-1157" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_df=</span> <span class="cn">NULL</span>,</span>
<span id="cb36-1158"><a href="#cb36-1158" aria-hidden="true" tabindex="-1"></a>       <span class="at">followup =</span> <span class="dv">12</span>,</span>
<span id="cb36-1159"><a href="#cb36-1159" aria-hidden="true" tabindex="-1"></a>       <span class="at">seed =</span> <span class="dv">0</span>,</span>
<span id="cb36-1160"><a href="#cb36-1160" aria-hidden="true" tabindex="-1"></a>       <span class="at">montecarlo =</span> <span class="dv">10</span>,</span>
<span id="cb36-1161"><a href="#cb36-1161" aria-hidden="true" tabindex="-1"></a>       <span class="at">boot =</span> <span class="cn">FALSE</span>, </span>
<span id="cb36-1162"><a href="#cb36-1162" aria-hidden="true" tabindex="-1"></a>       <span class="at">nboot =</span> <span class="dv">1</span>,</span>
<span id="cb36-1163"><a href="#cb36-1163" aria-hidden="true" tabindex="-1"></a>       <span class="at">ci =</span> .<span class="dv">95</span>,</span>
<span id="cb36-1164"><a href="#cb36-1164" aria-hidden="true" tabindex="-1"></a>       <span class="at">parallel=</span><span class="cn">TRUE</span>)</span>
<span id="cb36-1165"><a href="#cb36-1165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1166"><a href="#cb36-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1167"><a href="#cb36-1167" aria-hidden="true" tabindex="-1"></a><span class="fu">## Đổi các agument</span></span>
<span id="cb36-1168"><a href="#cb36-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1169"><a href="#cb36-1169" aria-hidden="true" tabindex="-1"></a>Gồm: continuous exposure,cont_exp_std,tvar_to_med =T, thêm splines + dof, bootraping</span>
<span id="cb36-1170"><a href="#cb36-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1173"><a href="#cb36-1173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-1174"><a href="#cb36-1174" aria-hidden="true" tabindex="-1"></a><span class="fu">tvmedg</span>(<span class="at">data =</span> dat0,</span>
<span id="cb36-1175"><a href="#cb36-1175" aria-hidden="true" tabindex="-1"></a>       <span class="at">basec =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb36-1176"><a href="#cb36-1176" aria-hidden="true" tabindex="-1"></a>       <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-1177"><a href="#cb36-1177" aria-hidden="true" tabindex="-1"></a>       <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-1178"><a href="#cb36-1178" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L3"</span>),</span>
<span id="cb36-1179"><a href="#cb36-1179" aria-hidden="true" tabindex="-1"></a>       <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb36-1180"><a href="#cb36-1180" aria-hidden="true" tabindex="-1"></a>       <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb36-1181"><a href="#cb36-1181" aria-hidden="true" tabindex="-1"></a>       <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb36-1182"><a href="#cb36-1182" aria-hidden="true" tabindex="-1"></a>       <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb36-1183"><a href="#cb36-1183" aria-hidden="true" tabindex="-1"></a>       <span class="at">cont_exp =</span> <span class="fu">c</span>(<span class="st">"L2"</span>),</span>
<span id="cb36-1184"><a href="#cb36-1184" aria-hidden="true" tabindex="-1"></a>       <span class="at">cont_exp_std =</span> T,</span>
<span id="cb36-1185"><a href="#cb36-1185" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar_to_med =</span> T,</span>
<span id="cb36-1186"><a href="#cb36-1186" aria-hidden="true" tabindex="-1"></a>       <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-1187"><a href="#cb36-1187" aria-hidden="true" tabindex="-1"></a>       <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb36-1188"><a href="#cb36-1188" aria-hidden="true" tabindex="-1"></a>       <span class="at">yreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb36-1189"><a href="#cb36-1189" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_list =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"mm"</span>,<span class="st">"L1"</span>),</span>
<span id="cb36-1190"><a href="#cb36-1190" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_type =</span> <span class="fu">c</span>(<span class="st">"ns"</span>,<span class="st">"bs"</span>,<span class="st">"bs"</span>),</span>
<span id="cb36-1191"><a href="#cb36-1191" aria-hidden="true" tabindex="-1"></a>       <span class="at">sp_df=</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb36-1192"><a href="#cb36-1192" aria-hidden="true" tabindex="-1"></a>       <span class="at">followup =</span> <span class="dv">12</span>,</span>
<span id="cb36-1193"><a href="#cb36-1193" aria-hidden="true" tabindex="-1"></a>       <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb36-1194"><a href="#cb36-1194" aria-hidden="true" tabindex="-1"></a>       <span class="at">montecarlo =</span> <span class="dv">10</span>,</span>
<span id="cb36-1195"><a href="#cb36-1195" aria-hidden="true" tabindex="-1"></a>       <span class="at">boot =</span> T, </span>
<span id="cb36-1196"><a href="#cb36-1196" aria-hidden="true" tabindex="-1"></a>       <span class="at">nboot =</span> <span class="dv">2</span>,</span>
<span id="cb36-1197"><a href="#cb36-1197" aria-hidden="true" tabindex="-1"></a>       <span class="at">ci =</span> .<span class="dv">95</span>,</span>
<span id="cb36-1198"><a href="#cb36-1198" aria-hidden="true" tabindex="-1"></a>       <span class="at">parallel=</span><span class="cn">TRUE</span>)</span>
<span id="cb36-1199"><a href="#cb36-1199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>