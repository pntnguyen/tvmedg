<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>tvmedg package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="package final_files/libs/clipboard/clipboard.min.js"></script>
<script src="package final_files/libs/quarto-html/quarto.js"></script>
<script src="package final_files/libs/quarto-html/popper.min.js"></script>
<script src="package final_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="package final_files/libs/quarto-html/anchor.min.js"></script>
<link href="package final_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="package final_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="package final_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="package final_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="package final_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#import-data" id="toc-import-data" class="nav-link active" data-scroll-target="#import-data">Import data</a></li>
  <li><a href="#process-data-function" id="toc-process-data-function" class="nav-link" data-scroll-target="#process-data-function">Process data function</a>
  <ul class="collapse">
  <li><a href="#output" id="toc-output" class="nav-link" data-scroll-target="#output">Output</a></li>
  <li><a href="#compare-m-before-l-and-l-before-m" id="toc-compare-m-before-l-and-l-before-m" class="nav-link" data-scroll-target="#compare-m-before-l-and-l-before-m">Compare M before L, and L before M</a></li>
  </ul></li>
  <li><a href="#cen_and_scale-function" id="toc-cen_and_scale-function" class="nav-link" data-scroll-target="#cen_and_scale-function">cen_and_scale function</a></li>
  <li><a href="#resamp-function" id="toc-resamp-function" class="nav-link" data-scroll-target="#resamp-function">resamp function</a></li>
  <li><a href="#fitg-function" id="toc-fitg-function" class="nav-link" data-scroll-target="#fitg-function">fitg function</a>
  <ul class="collapse">
  <li><a href="#output-1" id="toc-output-1" class="nav-link" data-scroll-target="#output-1">Output</a></li>
  </ul></li>
  <li><a href="#baseline_mc" id="toc-baseline_mc" class="nav-link" data-scroll-target="#baseline_mc">baseline_mc</a>
  <ul class="collapse">
  <li><a href="#output-2" id="toc-output-2" class="nav-link" data-scroll-target="#output-2">Output</a></li>
  </ul></li>
  <li><a href="#g_form-function" id="toc-g_form-function" class="nav-link" data-scroll-target="#g_form-function">g_form function</a>
  <ul class="collapse">
  <li><a href="#output-3" id="toc-output-3" class="nav-link" data-scroll-target="#output-3">Output</a></li>
  <li><a href="#output-with-non-reversible-variable-and-bootstrap" id="toc-output-with-non-reversible-variable-and-bootstrap" class="nav-link" data-scroll-target="#output-with-non-reversible-variable-and-bootstrap">Output with non-reversible variable, and bootstrap</a></li>
  <li><a href="#output-with-non-reversible-variable-and-bootstrap-l-before-m" id="toc-output-with-non-reversible-variable-and-bootstrap-l-before-m" class="nav-link" data-scroll-target="#output-with-non-reversible-variable-and-bootstrap-l-before-m">Output with non-reversible variable, and bootstrap, L before M</a></li>
  </ul></li>
  <li><a href="#test" id="toc-test" class="nav-link" data-scroll-target="#test">Test</a>
  <ul class="collapse">
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set up</a>
  <ul class="collapse">
  <li><a href="#df_prep" id="toc-df_prep" class="nav-link" data-scroll-target="#df_prep">df_prep</a></li>
  <li><a href="#gform" id="toc-gform" class="nav-link" data-scroll-target="#gform">gform</a></li>
  </ul></li>
  <li><a href="#process-data-function-1" id="toc-process-data-function-1" class="nav-link" data-scroll-target="#process-data-function-1">Process data function</a></li>
  <li><a href="#fitg-function-1" id="toc-fitg-function-1" class="nav-link" data-scroll-target="#fitg-function-1">fitg function</a>
  <ul class="collapse">
  <li><a href="#seed-0-no-bootstrap" id="toc-seed-0-no-bootstrap" class="nav-link" data-scroll-target="#seed-0-no-bootstrap">seed = 0, no bootstrap</a></li>
  <li><a href="#seed-0-bootstrap" id="toc-seed-0-bootstrap" class="nav-link" data-scroll-target="#seed-0-bootstrap">seed != 0, bootstrap</a></li>
  </ul></li>
  <li><a href="#baseline_mc-function" id="toc-baseline_mc-function" class="nav-link" data-scroll-target="#baseline_mc-function">baseline_mc function</a></li>
  <li><a href="#g_form-function-1" id="toc-g_form-function-1" class="nav-link" data-scroll-target="#g_form-function-1">g_form function</a>
  <ul class="collapse">
  <li><a href="#ay-1-am-1" id="toc-ay-1-am-1" class="nav-link" data-scroll-target="#ay-1-am-1">ay = 1, am = 1</a></li>
  <li><a href="#ay-0-am-0" id="toc-ay-0-am-0" class="nav-link" data-scroll-target="#ay-0-am-0">ay = 0, am = 0</a></li>
  <li><a href="#ay-0-am-1" id="toc-ay-0-am-1" class="nav-link" data-scroll-target="#ay-0-am-1">ay = 0, am = 1</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#ay-am-bị-lỗi" id="toc-ay-am-bị-lỗi" class="nav-link" data-scroll-target="#ay-am-bị-lỗi">ay != am bị lỗi</a>
  <ul class="collapse">
  <li><a href="#data-bỏ-vô-g-formula-giống-nhau" id="toc-data-bỏ-vô-g-formula-giống-nhau" class="nav-link" data-scroll-target="#data-bỏ-vô-g-formula-giống-nhau">2 data bỏ vô g formula giống nhau</a></li>
  <li><a href="#tách-data-time-5" id="toc-tách-data-time-5" class="nav-link" data-scroll-target="#tách-data-time-5">tách data time = 5</a></li>
  <li><a href="#predict-time-6" id="toc-predict-time-6" class="nav-link" data-scroll-target="#predict-time-6">predict time = 6</a></li>
  <li><a href="#predict-đến-length" id="toc-predict-đến-length" class="nav-link" data-scroll-target="#predict-đến-length">predict đến length</a></li>
  <li><a href="#output-4" id="toc-output-4" class="nav-link" data-scroll-target="#output-4">output</a></li>
  </ul></li>
  <li><a href="#function-bự-tvmedg" id="toc-function-bự-tvmedg" class="nav-link" data-scroll-target="#function-bự-tvmedg">Function bự (tvmedg)</a>
  <ul class="collapse">
  <li><a href="#tvmedg" id="toc-tvmedg" class="nav-link" data-scroll-target="#tvmedg">tvmedg</a></li>
  <li><a href="#g_boot" id="toc-g_boot" class="nav-link" data-scroll-target="#g_boot">g_boot</a></li>
  <li><a href="#run" id="toc-run" class="nav-link" data-scroll-target="#run">Run</a></li>
  <li><a href="#output-5" id="toc-output-5" class="nav-link" data-scroll-target="#output-5">Output</a></li>
  <li><a href="#extract-variables" id="toc-extract-variables" class="nav-link" data-scroll-target="#extract-variables">Extract variables</a></li>
  </ul></li>
  <li><a href="#final-tvmedg-function" id="toc-final-tvmedg-function" class="nav-link" data-scroll-target="#final-tvmedg-function">Final tvmedg function</a></li>
  <li><a href="#note" id="toc-note" class="nav-link" data-scroll-target="#note">Note</a></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">tvmedg package</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="import-data" class="level1">
<h1>Import data</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/tvmed_dat100.RDS"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dat0 <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,774 × 13
      id    mm    Ap    Mp    L1    L2    L3    Yp   age   sex    ow  risk
   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1     1     1     0     0     0  100   80       0  10.9     1     1     0
 2     1     2     0     0     0  131.  88.1     0  10.9     1     1     0
 3     1     3     0     0     0  125.  97.6     0  10.9     1     1     0
 4     1     4     0     0     0  135. 112.      0  10.9     1     1     0
 5     1     5     0     0     0  124. 108.      0  10.9     1     1     0
 6     1     6     0     0     0  141. 123.      0  10.9     1     1     0
 7     1     7     0     0     0  119. 128.      0  10.9     1     1     0
 8     1     8     0     0     0  141. 114.      0  10.9     1     1     0
 9     1     9     0     0     0  155. 127.      0  10.9     1     1     0
10     1    10     0     0     0  135. 102.      0  10.9     1     1     0
# ℹ 2,764 more rows
# ℹ 1 more variable: lastid &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="process-data-function" class="level1">
<h1>Process data function</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>process_data <span class="ot">&lt;-</span> <span class="cf">function</span>(fix,expo,med,tvar,lag,outc,time,<span class="at">norev =</span> <span class="cn">NULL</span>,<span class="at">LM =</span> <span class="cn">FALSE</span>,data){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## detect which variables are non-reversible</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(expo <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    norev_expo <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"A"</span>,<span class="fu">which</span>(expo <span class="sc">%in%</span> norev))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    norev_expo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(med <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    norev_med <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="fu">which</span>(med <span class="sc">%in%</span> norev))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    norev_med <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(tvar <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    norev_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="fu">which</span>(tvar <span class="sc">%in%</span> norev))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    norev_tvar <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  norev_var <span class="ot">&lt;-</span> <span class="fu">c</span>(norev_expo,norev_med,norev_tvar)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of time-fixed variables</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  name_v <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"v"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(fix))</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> data<span class="sc">$</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(data[,fix]) <span class="sc">%&gt;%</span> </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">c</span>(<span class="st">"id"</span>,name_v))</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of exposure variables  </span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  name_e <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"A"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(expo))</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of mediator variables  </span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  name_me <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med))</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of time-varying variables  </span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  name_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar))</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lag){</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="do">## column name of lag effect on exposure variable</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    co_ex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_e,<span class="st">"l"</span>,i)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    co_me <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_me,<span class="st">"l"</span>,i)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    co_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_tvar,<span class="st">"l"</span>,i)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_e)){</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>      out[,name_e[k]] <span class="ot">&lt;-</span> data[,expo[k]]</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>      name_ep <span class="ot">&lt;-</span> {{co_ex}}[k]</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>          {{name_ep}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_e[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,expo[k]])</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_me)){</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>      out[,name_me[k]] <span class="ot">&lt;-</span> data[,med[k]]</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>      name_med <span class="ot">&lt;-</span> {{co_me}}[k]</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>          {{name_med}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_me[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,med[k]])</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    }  </span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_tvar)){</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>      out[,name_tvar[k]] <span class="ot">&lt;-</span> data[,tvar[k]]</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>      name_tv <span class="ot">&lt;-</span> {{co_tvar}}[k]</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>          {{name_tv}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_tvar[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,tvar[k]])</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  <span class="do">## outcome variable</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>Y <span class="ot">&lt;-</span> data[,outc]</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time variable</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>j <span class="ot">&lt;-</span> data[,time]</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>  kq <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>  kq<span class="sc">$</span>df <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() </span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>  kq<span class="sc">$</span>norev_var <span class="ot">&lt;-</span> norev_var</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column name</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"A"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>  tf <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>  tva <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"L"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>  mediator <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"M"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>  outcome <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"Y"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"j"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>  <span class="do">## formula for M(t)</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>  l_tm1 <span class="ot">&lt;-</span> tva[<span class="sc">!</span>tva <span class="sc">%in%</span> name_tvar]</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>  m_tm1 <span class="ot">&lt;-</span> mediator[<span class="sc">!</span>mediator <span class="sc">%in%</span> name_me]</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (LM <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>    formula_mt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med)){</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>      formula_mt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_me[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,l_tm1,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fm <span class="ot">&lt;-</span> formula_mt</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for L(t)</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>    formular_lt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar)){</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>      formular_lt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_tvar[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,mediator,l_tm1,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fl <span class="ot">&lt;-</span> formular_lt</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for Y(t)</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>    formular_y <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome,<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,mediator,tva,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fy <span class="ot">&lt;-</span> formular_y</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>    formula_mt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med)){</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>      formula_mt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_me[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,name_tvar,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fm <span class="ot">&lt;-</span> formula_mt</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for L(t)</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>    formular_lt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar)){</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>      formular_lt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_tvar[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,l_tm1,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fl <span class="ot">&lt;-</span> formular_lt</span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for Y(t)</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>    formular_y <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome,<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,tva,mediator,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fy <span class="ot">&lt;-</span> formular_y</span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(kq)</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="output" class="level2">
<h2 class="anchored" data-anchor-id="output">Output</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">LM =</span> F,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>)  <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 5
 $ df       :'data.frame':  2774 obs. of  22 variables:
  ..$ id  : int [1:2774] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v1  : num [1:2774] 10.9 10.9 10.9 10.9 10.9 ...
  ..$ v2  : int [1:2774] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v3  : int [1:2774] 1 1 1 1 1 1 1 1 1 1 ...
  ..$ v4  : int [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ A1  : num [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ A1l1: num [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ M1  : num [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ M1l1: num [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1  : num [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1l1: num [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L2  : num [1:2774] 100 131 125 135 124 ...
  ..$ L2l1: num [1:2774] 100 100 131 125 135 ...
  ..$ L3  : num [1:2774] 80 88.1 97.6 112.2 108.1 ...
  ..$ L3l1: num [1:2774] 80 80 88.1 97.6 112.2 ...
  ..$ A1l2: num [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ M1l2: num [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L1l2: num [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ L2l2: num [1:2774] 100 100 100 131 125 ...
  ..$ L3l2: num [1:2774] 80 80 80 88.1 97.6 ...
  ..$ Y   : num [1:2774] 0 0 0 0 0 0 0 0 0 0 ...
  ..$ j   : num [1:2774] 1 2 3 4 5 6 7 8 9 10 ...
 $ norev_var: chr "M1"
 $ fm       :List of 1
  ..$ : chr "M1 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"
 $ fl       :List of 3
  ..$ : chr "L1 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"
  ..$ : chr "L2 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"
  ..$ : chr "L3 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"
 $ fy       : chr "Y ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + L1 + L1l1 + L2 + L2l1 + L3 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"</code></pre>
</div>
</div>
</section>
<section id="compare-m-before-l-and-l-before-m" class="level2">
<h2 class="anchored" data-anchor-id="compare-m-before-l-and-l-before-m">Compare M before L, and L before M</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ml <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">LM =</span> F,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>)  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>lm <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">LM =</span> T,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>)  </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>ml<span class="sc">$</span>fm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "M1 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>lm<span class="sc">$</span>fm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "M1 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + L1 + L2 + L3 + v1 + v2 + v3 + v4"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ml<span class="sc">$</span>fl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "L1 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"

[[2]]
[1] "L2 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"

[[3]]
[1] "L3 ~ A1 + A1l1 + A1l2 + M1 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>lm<span class="sc">$</span>fl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "L1 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"

[[2]]
[1] "L2 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"

[[3]]
[1] "L3 ~ A1 + A1l1 + A1l2 + M1l1 + M1l2 + L1l1 + L2l1 + L3l1 + L1l2 + L2l2 + L3l2 + v1 + v2 + v3 + v4"</code></pre>
</div>
</div>
</section>
</section>
<section id="cen_and_scale-function" class="level1">
<h1>cen_and_scale function</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cen_and_scale <span class="ot">&lt;-</span> <span class="cf">function</span>(time){</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  j_out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  jj <span class="ot">&lt;-</span> time <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale</span>() </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"jj"</span>]] <span class="ot">&lt;-</span> jj <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"mean_j"</span>]] <span class="ot">&lt;-</span> <span class="fu">attributes</span>(jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"sd_j"</span>]] <span class="ot">&lt;-</span> <span class="fu">attributes</span>(jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  j_out</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="resamp-function" class="level1">
<h1>resamp function</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>resamp <span class="ot">&lt;-</span> <span class="cf">function</span>(data,<span class="at">bootstr =</span> <span class="cn">FALSE</span>){</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> data</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set.seed(seed)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("Running SEED", seed, "\n")</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("\n")</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("Resampling Data", "\n")</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(df<span class="sc">$</span>id))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters), <span class="fu">length</span>(clusters), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters[index])</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  boot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(bootstr <span class="sc">==</span> F) {</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># not doing bootstrap</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    boot <span class="ot">&lt;-</span> df </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loop over repeated id</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>id, zzz)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>      boot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(boot, cc)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(boot<span class="sc">$</span>j)<span class="sc">$</span>jj</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  boot</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fitg-function" class="level1">
<h1>fitg function</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fitg <span class="ot">&lt;-</span> <span class="cf">function</span>(data,<span class="at">bootstr =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>){</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <span class="fu">resamp</span>(<span class="at">data =</span> data<span class="sc">$</span>df,<span class="at">bootstr =</span> bootstr)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  fitR <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>df <span class="ot">&lt;-</span> res_df <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#----- fit parametric models for</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Mediator models</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(mreg) <span class="sc">!=</span> <span class="fu">length</span>(data<span class="sc">$</span>fm)){</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"the defined regression of M is not equal"</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>fm)){</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    fitM <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fm[[i]],<span class="st">"+"</span>,<span class="st">"bs(jj,df="</span>,dof,<span class="st">")"</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    fitR<span class="sc">$</span>M[[i]] <span class="ot">&lt;-</span> <span class="fu">glm</span>(fitM ,<span class="at">family =</span> mreg[i], <span class="at">data =</span> res_df) </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Covariate models</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(lreg) <span class="sc">!=</span> <span class="fu">length</span>(data<span class="sc">$</span>fl)){</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"the defined regression of L is not equal"</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>fl)){</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    fitL <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fl[[i]],<span class="st">"+"</span>,<span class="st">"bs(jj,df="</span>,dof,<span class="st">")"</span>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    fitR<span class="sc">$</span>L[[i]] <span class="ot">&lt;-</span> <span class="fu">glm</span>(fitL ,<span class="at">family =</span> lreg[i], <span class="at">data =</span> res_df) </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Outcome model: </span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>  fitY <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fy,<span class="st">"+"</span>,<span class="st">"bs(jj,df="</span>,dof,<span class="st">")"</span>)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>Y <span class="ot">&lt;-</span>  <span class="fu">glm</span>(fitY ,<span class="at">family =</span> yreg, <span class="at">data =</span> res_df) </span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>  fitR</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="output-1" class="level2">
<h2 class="anchored" data-anchor-id="output-1">Output</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="cn">NULL</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$df
# A tibble: 2,650 × 24
      id    v1    v2    v3    v4    A1  A1l1    M1  M1l1    L1  L1l1    L2  L2l1
   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     2  6.88     1     0     0     0     0     0     0     0     0  100   100 
 2     2  6.88     1     0     0     0     0     0     0     0     0  121.  100 
 3     2  6.88     1     0     0     0     0     0     0     0     0  131.  121.
 4     2  6.88     1     0     0     0     0     0     0     0     0  129.  131.
 5     2  6.88     1     0     0     0     0     0     0     0     0  137.  129.
 6     2  6.88     1     0     0     0     0     0     0     0     0  154.  137.
 7     2  6.88     1     0     0     0     0     0     0     0     0  142.  154.
 8     2  6.88     1     0     0     0     0     0     0     0     0  142.  142.
 9     2  6.88     1     0     0     0     0     0     0     0     0  144.  142.
10     2  6.88     1     0     0     0     0     0     0     0     0  140.  144.
# ℹ 2,640 more rows
# ℹ 11 more variables: L3 &lt;dbl&gt;, L3l1 &lt;dbl&gt;, A1l2 &lt;dbl&gt;, M1l2 &lt;dbl&gt;,
#   L1l2 &lt;dbl&gt;, L2l2 &lt;dbl&gt;, L3l2 &lt;dbl&gt;, Y &lt;dbl&gt;, j &lt;dbl&gt;, bid &lt;chr&gt;, jj &lt;dbl&gt;

$M
$M[[1]]

Call:  glm(formula = fitM, family = mreg[i], data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
     -173.70599         37.39629         21.11546          4.11137  
           M1l1             M1l2             L1l1             L2l1  
       19.51027         61.31385          8.38428          0.03514  
           L3l1             L1l2             L2l2             L3l2  
       -0.10252          4.07116          0.46120          0.95105  
             v1               v2               v3               v4  
        0.25177         -1.09051         -0.72343         32.44751  
bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
     -208.92347          9.52588       -103.05768  

Degrees of Freedom: 2649 Total (i.e. Null);  2631 Residual
Null Deviance:      2172 
Residual Deviance: 48.37    AIC: 86.37


$L
$L[[1]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
      -0.046064       -13.917430         0.294028        16.015558  
             M1             M1l1             M1l2             L1l1  
       0.832046        -4.186879        15.776261       -19.447173  
           L2l1             L3l1             L1l2             L2l2  
       0.002094        -0.082092       -18.999347         0.033020  
           L3l2               v1               v2               v3  
      -0.038807        -0.147092        -0.056833       -17.477664  
             v4  bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
     -14.875072         5.629218         2.581273        -0.003715  

Degrees of Freedom: 2649 Total (i.e. Null);  2630 Residual
Null Deviance:      59.96 
Residual Deviance: 43.19    AIC: 83.19

$L[[2]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
       81.85607          5.21602         -9.91602         -4.37668  
             M1             M1l1             M1l2             L1l1  
        7.49227          0.84650         -7.07569          6.30919  
           L2l1             L3l1             L1l2             L2l2  
        0.15252          0.08151         -0.46213          0.08242  
           L3l2               v1               v2               v3  
        0.07073         -0.40421          0.79637          0.83560  
             v4  bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
       -8.92743         20.32779         -3.36196         10.30676  

Degrees of Freedom: 2649 Total (i.e. Null);  2630 Residual
Null Deviance:      570200 
Residual Deviance: 275000   AIC: 19860

$L[[3]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
       65.89091          5.06947        -10.75560         -2.09262  
             M1             M1l1             M1l2             L1l1  
        5.31875         -1.88055         -4.91378         -0.68768  
           L2l1             L3l1             L1l2             L2l2  
        0.07484          0.15661          2.59145          0.04640  
           L3l2               v1               v2               v3  
        0.04800         -0.33260          1.72256          0.92472  
             v4  bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
       -5.82460         19.44889          1.48454         10.49394  

Degrees of Freedom: 2649 Total (i.e. Null);  2630 Residual
Null Deviance:      420200 
Residual Deviance: 183000   AIC: 18790


$Y

Call:  glm(formula = fitY, family = yreg, data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
     -32.586245       -18.080816        -3.968978        24.170979  
             M1             M1l1             M1l2               L1  
      20.499402       -22.267237        21.296826       -19.234823  
           L1l1               L2             L2l1               L3  
     -18.122253         0.015033         0.028668         0.053049  
           L3l1             L1l2             L2l2             L3l2  
       0.072666       -19.500209         0.006979        -0.078553  
             v1               v2               v3               v4  
      -0.108753         0.535033        -0.673450         2.799415  
bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
     -11.430217        10.763939        -8.880777  

Degrees of Freedom: 2649 Total (i.e. Null);  2627 Residual
Null Deviance:      406.5 
Residual Deviance: 188  AIC: 234</code></pre>
</div>
</div>
</section>
</section>
<section id="baseline_mc" class="level1">
<h1>baseline_mc</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>baseline_mc <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> fitR2,<span class="at">montecarlo =</span> <span class="dv">10000</span>){</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  boot <span class="ot">&lt;-</span> data<span class="sc">$</span>df</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select baseline visit</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  df0 <span class="ot">&lt;-</span> boot[boot<span class="sc">$</span>j<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  df0<span class="sc">$</span>idn <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df0)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  MC <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(df0<span class="sc">$</span>idn, <span class="at">size =</span> montecarlo, <span class="at">replace =</span> T)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">table</span>(samples)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    cc <span class="ot">&lt;-</span> df0[df0<span class="sc">$</span>idn <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>idn, zzz)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    MC <span class="ot">&lt;-</span> <span class="fu">rbind</span>(MC, cc)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  MC<span class="sc">$</span>idsim <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>montecarlo</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>res_df <span class="ot">&lt;-</span> MC <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  data</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="output-2" class="level2">
<h2 class="anchored" data-anchor-id="output-2">Output</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># norev = c("Mp","L1"),</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>F,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$df
# A tibble: 2,774 × 23
      id    v1    v2    v3    v4    A1  A1l1    M1  M1l1    L1  L1l1    L2  L2l1
   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1  10.9     1     1     0     0     0     0     0     0     0  100   100 
 2     1  10.9     1     1     0     0     0     0     0     0     0  131.  100 
 3     1  10.9     1     1     0     0     0     0     0     0     0  125.  131.
 4     1  10.9     1     1     0     0     0     0     0     0     0  135.  125.
 5     1  10.9     1     1     0     0     0     0     0     0     0  124.  135.
 6     1  10.9     1     1     0     0     0     0     0     0     0  141.  124.
 7     1  10.9     1     1     0     0     0     0     0     0     0  119.  141.
 8     1  10.9     1     1     0     0     0     0     0     0     0  141.  119.
 9     1  10.9     1     1     0     0     0     0     0     0     0  155.  141.
10     1  10.9     1     1     0     0     0     0     0     0     0  135.  155.
# ℹ 2,764 more rows
# ℹ 10 more variables: L3 &lt;dbl&gt;, L3l1 &lt;dbl&gt;, A1l2 &lt;dbl&gt;, M1l2 &lt;dbl&gt;,
#   L1l2 &lt;dbl&gt;, L2l2 &lt;dbl&gt;, L3l2 &lt;dbl&gt;, Y &lt;dbl&gt;, j &lt;dbl&gt;, jj &lt;dbl&gt;

$M
$M[[1]]

Call:  glm(formula = fitM, family = mreg[i], data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
     -240.88425         39.21362         18.97987         10.83923  
           M1l1             M1l2             L1l1             L2l1  
       24.59988         78.21822         25.27907          0.00822  
           L3l1             L1l2             L2l2             L3l2  
        0.10588         10.71800          0.81109          1.03562  
             v1               v2               v3               v4  
        0.14558         -0.60014         -0.16353         44.55293  
bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
     -236.93584          3.74983       -132.15397  

Degrees of Freedom: 2773 Total (i.e. Null);  2755 Residual
Null Deviance:      2400 
Residual Deviance: 48.1     AIC: 86.1


$L
$L[[1]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
       4.206631         2.845048       -14.471424        14.387169  
             M1             M1l1             M1l2             L1l1  
     -14.858355        -2.158233        13.429153       -17.309493  
           L2l1             L3l1             L1l2             L2l2  
      -0.001921        -0.095073       -16.469006         0.031015  
           L3l2               v1               v2               v3  
      -0.059729        -0.383600         0.824396        -1.695992  
             v4  bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
       0.604237         7.714448         2.923929         1.697610  

Degrees of Freedom: 2773 Total (i.e. Null);  2754 Residual
Null Deviance:      73.18 
Residual Deviance: 51.1     AIC: 91.1

$L[[2]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
       82.39992          7.44622         -9.48032         -6.90332  
             M1             M1l1             M1l2             L1l1  
        4.79900          2.54224         -7.02645          3.03767  
           L2l1             L3l1             L1l2             L2l2  
        0.14871          0.09416          1.06203          0.08706  
           L3l2               v1               v2               v3  
        0.04482         -0.39261          1.07723          0.73786  
             v4  bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
       -8.60204         21.18702         -1.76697         10.21276  

Degrees of Freedom: 2773 Total (i.e. Null);  2754 Residual
Null Deviance:      631000 
Residual Deviance: 290100   AIC: 20810

$L[[3]]

Call:  glm(formula = fitL, family = lreg[i], data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
       63.34265          5.38620        -10.72615         -2.51187  
             M1             M1l1             M1l2             L1l1  
        4.27167         -1.33230         -2.86263          0.85973  
           L2l1             L3l1             L1l2             L2l2  
        0.08799          0.15451          2.17593          0.06448  
           L3l2               v1               v2               v3  
        0.05777         -0.37256          1.14948          0.75518  
             v4  bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
       -6.64862         17.03216         -0.17021          8.87493  

Degrees of Freedom: 2773 Total (i.e. Null);  2754 Residual
Null Deviance:      475200 
Residual Deviance: 195500   AIC: 19720


$Y

Call:  glm(formula = fitY, family = yreg, data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
     -29.377122       -16.602939        -3.379008        21.321504  
             M1             M1l1             M1l2               L1  
      18.770659       -21.024247        20.463150       -18.601596  
           L1l1               L2             L2l1               L3  
     -18.360383         0.022442         0.034648         0.018100  
           L3l1             L1l2             L2l2             L3l2  
       0.007391       -18.573730        -0.002407        -0.023889  
             v1               v2               v3               v4  
      -0.125958         0.611451        -0.540768         2.903149  
bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
      -2.637604         4.352905        -2.249624  

Degrees of Freedom: 2773 Total (i.e. Null);  2751 Residual
Null Deviance:      375.6 
Residual Deviance: 208.6    AIC: 254.6

$res_df
# A tibble: 10,000 × 26
      id     v1    v2    v3    v4    A1  A1l1    M1  M1l1    L1  L1l1    L2
   &lt;int&gt;  &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1     1 10.9       1     1     0     0     0     0     0     0     0   100
 2     2  6.88      1     0     0     0     0     0     0     0     0   100
 3     3  9.79      1     0     0     0     0     0     0     0     0   100
 4     4  5.40      1     0     0     0     0     0     0     0     0   100
 5     5 12.2       0     0     1     0     0     0     0     0     0   100
 6     6  0.123     0     0     1     0     0     0     0     0     0   100
 7     7 12.7       0     0     0     0     0     0     0     0     0   100
 8     8 13.2       0     1     0     0     0     0     0     0     0   100
 9     9  6.13      0     1     0     0     0     0     0     0     0   100
10    10 13.5       0     0     1     0     0     0     0     0     0   100
# ℹ 9,990 more rows
# ℹ 14 more variables: L2l1 &lt;dbl&gt;, L3 &lt;dbl&gt;, L3l1 &lt;dbl&gt;, A1l2 &lt;dbl&gt;,
#   M1l2 &lt;dbl&gt;, L1l2 &lt;dbl&gt;, L2l2 &lt;dbl&gt;, L3l2 &lt;dbl&gt;, Y &lt;dbl&gt;, j &lt;dbl&gt;, jj &lt;dbl&gt;,
#   idn &lt;int&gt;, bid &lt;chr&gt;, idsim &lt;int&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="g_form-function" class="level1">
<h1>g_form function</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> <span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>rFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_prob))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>g_form <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">ii =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">am =</span> <span class="dv">1</span>, <span class="at">ay =</span> <span class="dv">0</span>){</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  dddd <span class="ot">&lt;-</span> data<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  lagg <span class="ot">&lt;-</span> dddd <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"L1l"</span>)) <span class="sc">%&gt;%</span> <span class="fu">ncol</span>() </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  d2 <span class="ot">&lt;-</span> dddd[dddd<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d2<span class="sc">$</span>idsim</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d2<span class="sc">$</span>id</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>))</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  Yp2 <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  Yp2[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(data<span class="sc">$</span>df<span class="sc">$</span>j)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mediator</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  Mp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>M)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Mp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M))</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  Mp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Mp)) </span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to mediator models)</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  Lmp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>L)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  Lmp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Lmp)) </span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to outcome models)</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> lagg<span class="sc">:</span>length) {</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb24-170"><a href="#cb24-170" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb24-171"><a href="#cb24-171" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb24-172"><a href="#cb24-172" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-173"><a href="#cb24-173" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb24-174"><a href="#cb24-174" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb24-175"><a href="#cb24-175" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb24-176"><a href="#cb24-176" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb24-177"><a href="#cb24-177" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb24-178"><a href="#cb24-178" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb24-179"><a href="#cb24-179" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb24-180"><a href="#cb24-180" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb24-181"><a href="#cb24-181" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb24-182"><a href="#cb24-182" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-183"><a href="#cb24-183" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb24-184"><a href="#cb24-184" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-185"><a href="#cb24-185" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb24-186"><a href="#cb24-186" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb24-187"><a href="#cb24-187" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb24-188"><a href="#cb24-188" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-189"><a href="#cb24-189" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-190"><a href="#cb24-190" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb24-191"><a href="#cb24-191" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-192"><a href="#cb24-192" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-193"><a href="#cb24-193" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-194"><a href="#cb24-194" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb24-195"><a href="#cb24-195" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb24-196"><a href="#cb24-196" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb24-197"><a href="#cb24-197" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-198"><a href="#cb24-198" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb24-199"><a href="#cb24-199" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb24-200"><a href="#cb24-200" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb24-201"><a href="#cb24-201" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-202"><a href="#cb24-202" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb24-203"><a href="#cb24-203" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb24-204"><a href="#cb24-204" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb24-205"><a href="#cb24-205" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb24-206"><a href="#cb24-206" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-207"><a href="#cb24-207" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb24-208"><a href="#cb24-208" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-209"><a href="#cb24-209" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb24-210"><a href="#cb24-210" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb24-211"><a href="#cb24-211" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb24-212"><a href="#cb24-212" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb24-213"><a href="#cb24-213" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb24-214"><a href="#cb24-214" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb24-215"><a href="#cb24-215" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-216"><a href="#cb24-216" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-217"><a href="#cb24-217" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb24-218"><a href="#cb24-218" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-219"><a href="#cb24-219" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb24-220"><a href="#cb24-220" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-221"><a href="#cb24-221" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-222"><a href="#cb24-222" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-223"><a href="#cb24-223" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb24-224"><a href="#cb24-224" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-225"><a href="#cb24-225" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-226"><a href="#cb24-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lmp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb24-227"><a href="#cb24-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Lp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb24-228"><a href="#cb24-228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-229"><a href="#cb24-229" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num &lt;- seed</span></span>
<span id="cb24-230"><a href="#cb24-230" aria-hidden="true" tabindex="-1"></a>  gdat2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, Mp, Yp2,</span>
<span id="cb24-231"><a href="#cb24-231" aria-hidden="true" tabindex="-1"></a>                     Lmp, Lp, Vp)</span>
<span id="cb24-232"><a href="#cb24-232" aria-hidden="true" tabindex="-1"></a>  gdat2<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat2<span class="sc">$</span>id, <span class="at">fromLast =</span> T))</span>
<span id="cb24-233"><a href="#cb24-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gdat2)</span>
<span id="cb24-234"><a href="#cb24-234" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="output-3" class="level2">
<h2 class="anchored" data-anchor-id="output-3">Output</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>F,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">am =</span> <span class="dv">1</span>, <span class="at">ay =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id id_ori mm Ay Am M1 Yp2 Lmp1     Lmp2      Lmp3 Lp1      Lp2       Lp3
1   2      2  1  0  1  0   0    0 100.0000  80.00000   0 100.0000  80.00000
2   2      2  2  0  1  0   0    0 108.2455  87.68416   0 117.1829  95.53598
3   2      2  3  0  1  0   0    0 111.6999  90.81518   0 122.7058 100.66655
4   2      2  4  0  1  0   0    0 114.8813  93.64593   0 127.5130 105.01808
5   2      2  5  0  1  0   0    0 117.1896  95.69204   0 130.4760 107.69111
6   2      2  6  0  1  0   0    0 119.0850  97.37133   0 132.7375 109.71754
7   2      2  7  0  1  0   0    0 120.6124  98.73063   0 134.4372 111.24112
8   2      2  8  0  1  0   0    0 121.8528  99.84340   0 135.7661 112.43809
9   2      2  9  0  1  0   0    0 122.8421 100.74219   0 136.7989 113.37827
10  2      2 10  0  1  0   0    0 123.6103 101.45310   0 137.5889 114.10997
11  2      2 11  0  1  0   0    0 124.1798 101.99548   0 138.1693 114.66268
12  2      2 12  0  1  0   0    0 124.5707 102.38618   0 138.5656 115.05854
         v1 v2 v3 v4 lastid
1  6.877086  1  0  0      0
2  6.877086  1  0  0      0
3  6.877086  1  0  0      0
4  6.877086  1  0  0      0
5  6.877086  1  0  0      0
6  6.877086  1  0  0      0
7  6.877086  1  0  0      0
8  6.877086  1  0  0      0
9  6.877086  1  0  0      0
10 6.877086  1  0  0      0
11 6.877086  1  0  0      0
12 6.877086  1  0  0      1</code></pre>
</div>
</div>
</section>
<section id="output-with-non-reversible-variable-and-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="output-with-non-reversible-variable-and-bootstrap">Output with non-reversible variable, and bootstrap</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">am =</span> <span class="dv">1</span>, <span class="at">ay =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id id_ori mm Ay Am M1 Yp2 Lmp1     Lmp2      Lmp3 Lp1      Lp2       Lp3
1   2      2  1  0  1  0   0    0 100.0000  80.00000   0 100.0000  80.00000
2   2      2  2  0  1  0   0    0 108.0018  87.72544   0 116.9888  95.38392
3   2      2  3  0  1  0   0    0 110.8012  90.92613   0 121.5348 100.68976
4   2      2  4  0  1  0   0    0 114.0705  93.58350   0 126.9483 104.72420
5   2      2  5  0  1  0   0    0 116.2007  95.55946   0 129.8536 107.34199
6   2      2  6  0  1  0   0    0 118.0196  97.17172   0 132.2108 109.31419
7   2      2  7  0  1  0   0    1 119.4443  98.48236   0 133.8846 110.81028
8   2      2  8  0  1  0   0    0 126.6966  99.11822   0 135.1957 111.98562
9   2      2  9  0  1  0   0    0 121.7883 104.37024   0 136.2013 112.90986
10  2      2 10  0  1  0   0    0 123.3558 101.99245   0 136.9767 113.63168
11  2      2 11  0  1  0   0    0 123.3586 102.15318   0 137.5567 114.18136
12  2      2 12  0  1  0   0    0 123.5509 102.28048   0 137.9702 114.58165
         v1 v2 v3 v4 lastid
1  6.877086  1  0  0      0
2  6.877086  1  0  0      0
3  6.877086  1  0  0      0
4  6.877086  1  0  0      0
5  6.877086  1  0  0      0
6  6.877086  1  0  0      0
7  6.877086  1  0  0      0
8  6.877086  1  0  0      0
9  6.877086  1  0  0      0
10 6.877086  1  0  0      0
11 6.877086  1  0  0      0
12 6.877086  1  0  0      1</code></pre>
</div>
</div>
</section>
<section id="output-with-non-reversible-variable-and-bootstrap-l-before-m" class="level2">
<h2 class="anchored" data-anchor-id="output-with-non-reversible-variable-and-bootstrap-l-before-m">Output with non-reversible variable, and bootstrap, L before M</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">LM =</span> <span class="cn">TRUE</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">44</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">am =</span> <span class="dv">1</span>, <span class="at">ay =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id id_ori mm Ay Am M1 Yp2 Lmp1     Lmp2      Lmp3 Lp1      Lp2       Lp3
1  44     70  1  0  1  0   0    0 100.0000  80.00000   0 100.0000  80.00000
2  44     70  2  0  1  0   0    1 109.0500  88.26776   0 116.6969  96.61184
3  44     70  3  0  1  0   0    0 116.1094  92.91960   0 122.8213 101.90610
4  44     70  4  0  1  0   0    0 118.3713  97.33215   0 127.8361 106.23921
5  44     70  5  0  1  0   0    1 120.0752  97.71578   0 131.0718 108.99213
6  44     70  6  0  1  0   0    0 124.8928 100.40625   0 133.5454 111.08820
7  44     70  7  0  1  0   0    0 125.1197 103.03392   0 135.4484 112.68919
8  44     70  8  0  1  0   0    0 125.5255 102.29620   0 136.9568 113.94984
9  44     70  9  0  1  0   0    1 126.2443 102.84274   0 138.1478 114.93735
10 44     70 10  0  1  0   0    0 129.9174 104.56930   0 139.0723 115.69658
11 44     70 11  0  1  0   0    0 129.2048 106.40173   0 139.7636 116.25693
12 44     70 12  0  1  0   0    0 128.7018 104.88835   0 140.2476 116.64143
         v1 v2 v3 v4 lastid
1  4.419612  1  0  0      0
2  4.419612  1  0  0      0
3  4.419612  1  0  0      0
4  4.419612  1  0  0      0
5  4.419612  1  0  0      0
6  4.419612  1  0  0      0
7  4.419612  1  0  0      0
8  4.419612  1  0  0      0
9  4.419612  1  0  0      0
10 4.419612  1  0  0      0
11 4.419612  1  0  0      0
12 4.419612  1  0  0      1</code></pre>
</div>
</div>
</section>
</section>
<section id="test" class="level1">
<h1>Test</h1>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set up</h2>
<section id="df_prep" class="level3">
<h3 class="anchored" data-anchor-id="df_prep">df_prep</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df_prep <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> data<span class="sc">$</span>id)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline characteristics</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>v1 <span class="ot">&lt;-</span> data<span class="sc">$</span>age</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>v2 <span class="ot">&lt;-</span> data<span class="sc">$</span>sex</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>v3 <span class="ot">&lt;-</span> data<span class="sc">$</span>ow</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>v4 <span class="ot">&lt;-</span> data<span class="sc">$</span>risk</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying treatment</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>A <span class="ot">&lt;-</span> data<span class="sc">$</span>Ap</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>Al1 <span class="ot">&lt;-</span> data<span class="sc">$</span>A_lag1</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>Al2 <span class="ot">&lt;-</span> data<span class="sc">$</span>A_lag2</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-dependent covariate</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T1 <span class="ot">&lt;-</span> data<span class="sc">$</span>L1</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T1l1 <span class="ot">&lt;-</span> data<span class="sc">$</span>L1_lag1</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T1l2 <span class="ot">&lt;-</span> data<span class="sc">$</span>L1_lag2</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T2 <span class="ot">&lt;-</span> data<span class="sc">$</span>L2</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T2l1 <span class="ot">&lt;-</span> data<span class="sc">$</span>L2_lag1</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T2l2 <span class="ot">&lt;-</span> data<span class="sc">$</span>L2_lag2</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T3 <span class="ot">&lt;-</span> data<span class="sc">$</span>L3</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T3l1 <span class="ot">&lt;-</span> data<span class="sc">$</span>L3_lag1</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T3l2 <span class="ot">&lt;-</span> data<span class="sc">$</span>L3_lag2</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mediator</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>M1 <span class="ot">&lt;-</span> data<span class="sc">$</span>Mp</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>M1l1 <span class="ot">&lt;-</span> data<span class="sc">$</span>M_lag1</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>M1l2 <span class="ot">&lt;-</span> data<span class="sc">$</span>M_lag2</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># outcomes</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>Y <span class="ot">&lt;-</span> data<span class="sc">$</span>Yp</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>j <span class="ot">&lt;-</span> data<span class="sc">$</span>mm</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="gform" class="level3">
<h3 class="anchored" data-anchor-id="gform">gform</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>gform <span class="ot">&lt;-</span> <span class="cf">function</span>(ii, pgdat, length, am, ay) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  pFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> <span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  rFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_prob))</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> pgdat</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d[d<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d<span class="sc">$</span>idsim</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d<span class="sc">$</span>id</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("...", paste0(ii, "(", id_ori, ")"))</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d[, <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>, <span class="st">"v3"</span>, <span class="st">"v4"</span>)]</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  T1p <span class="ot">&lt;-</span> T2p <span class="ot">&lt;-</span> T3p  <span class="ot">&lt;-</span> M1p <span class="ot">&lt;-</span> Yp <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  T1mp <span class="ot">&lt;-</span> T2mp <span class="ot">&lt;-</span> T3mp <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>  M1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>  Yp[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to outcome model</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>  T1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>  T2p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>  T3p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to mediator model</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>  T1mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>  T2mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>  T3mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>length) {</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a>      T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>      T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a>      T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>      T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a>      T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a>      T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a>      M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a>      dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a>                         <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a>                         <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T1</span></span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a>      dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a>      T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb32-108"><a href="#cb32-108" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T2</span></span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a>      dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb32-116"><a href="#cb32-116" aria-hidden="true" tabindex="-1"></a>      T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb32-117"><a href="#cb32-117" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-118"><a href="#cb32-118" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T3</span></span>
<span id="cb32-119"><a href="#cb32-119" aria-hidden="true" tabindex="-1"></a>      dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb32-120"><a href="#cb32-120" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb32-121"><a href="#cb32-121" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb32-122"><a href="#cb32-122" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb32-123"><a href="#cb32-123" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb32-124"><a href="#cb32-124" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb32-125"><a href="#cb32-125" aria-hidden="true" tabindex="-1"></a>      T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb32-126"><a href="#cb32-126" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-127"><a href="#cb32-127" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-128"><a href="#cb32-128" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb32-129"><a href="#cb32-129" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb32-130"><a href="#cb32-130" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-131"><a href="#cb32-131" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb32-132"><a href="#cb32-132" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb32-133"><a href="#cb32-133" aria-hidden="true" tabindex="-1"></a>        dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb32-134"><a href="#cb32-134" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb32-135"><a href="#cb32-135" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb32-136"><a href="#cb32-136" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb32-137"><a href="#cb32-137" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb32-138"><a href="#cb32-138" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb32-139"><a href="#cb32-139" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb32-140"><a href="#cb32-140" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-141"><a href="#cb32-141" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb32-142"><a href="#cb32-142" aria-hidden="true" tabindex="-1"></a>        dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb32-143"><a href="#cb32-143" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb32-144"><a href="#cb32-144" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb32-145"><a href="#cb32-145" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb32-146"><a href="#cb32-146" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb32-147"><a href="#cb32-147" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb32-148"><a href="#cb32-148" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb32-149"><a href="#cb32-149" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-150"><a href="#cb32-150" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb32-151"><a href="#cb32-151" aria-hidden="true" tabindex="-1"></a>        dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb32-152"><a href="#cb32-152" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb32-153"><a href="#cb32-153" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb32-154"><a href="#cb32-154" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb32-155"><a href="#cb32-155" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb32-156"><a href="#cb32-156" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb32-157"><a href="#cb32-157" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb32-158"><a href="#cb32-158" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-159"><a href="#cb32-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-160"><a href="#cb32-160" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-161"><a href="#cb32-161" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb32-162"><a href="#cb32-162" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb32-163"><a href="#cb32-163" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb32-164"><a href="#cb32-164" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb32-165"><a href="#cb32-165" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb32-166"><a href="#cb32-166" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-167"><a href="#cb32-167" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb32-168"><a href="#cb32-168" aria-hidden="true" tabindex="-1"></a>      dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb32-169"><a href="#cb32-169" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb32-170"><a href="#cb32-170" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb32-171"><a href="#cb32-171" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb32-172"><a href="#cb32-172" aria-hidden="true" tabindex="-1"></a>                        <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb32-173"><a href="#cb32-173" aria-hidden="true" tabindex="-1"></a>      Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb32-174"><a href="#cb32-174" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb32-175"><a href="#cb32-175" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb32-176"><a href="#cb32-176" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb32-177"><a href="#cb32-177" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-178"><a href="#cb32-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-179"><a href="#cb32-179" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb32-180"><a href="#cb32-180" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-181"><a href="#cb32-181" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-182"><a href="#cb32-182" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-183"><a href="#cb32-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-184"><a href="#cb32-184" aria-hidden="true" tabindex="-1"></a>  boot_num <span class="ot">&lt;-</span> seed</span>
<span id="cb32-185"><a href="#cb32-185" aria-hidden="true" tabindex="-1"></a>  gdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(boot_num, id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, M1p, Yp,</span>
<span id="cb32-186"><a href="#cb32-186" aria-hidden="true" tabindex="-1"></a>                     T1mp, T1p, T2mp, T2p, T3mp, T3p, Vp)</span>
<span id="cb32-187"><a href="#cb32-187" aria-hidden="true" tabindex="-1"></a>  gdat<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat<span class="sc">$</span>id, <span class="at">fromLast =</span> T))</span>
<span id="cb32-188"><a href="#cb32-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gdat)</span>
<span id="cb32-189"><a href="#cb32-189" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="process-data-function-1" class="level2">
<h2 class="anchored" data-anchor-id="process-data-function-1">Process data function</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat0 <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">A_lag1 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">A_lag2 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">M_lag1 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">M_lag2 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">L1_lag1 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">L1_lag2 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">L2_lag1 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">L2_lag2 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">L3_lag1 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">80</span>),</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">L3_lag2 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">80</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">df_prep</span>()</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  id       v1 v2 v3 v4 A Al1 Al2 T1 T1l1 T1l2       T2     T2l1     T2l2
1  1 10.92764  1  1  0 0   0   0  0    0    0 100.0000 100.0000 100.0000
2  1 10.92764  1  1  0 0   0   0  0    0    0 130.6644 100.0000 100.0000
3  1 10.92764  1  1  0 0   0   0  0    0    0 125.2740 130.6644 100.0000
4  1 10.92764  1  1  0 0   0   0  0    0    0 135.2596 125.2740 130.6644
5  1 10.92764  1  1  0 0   0   0  0    0    0 124.3786 135.2596 125.2740
6  1 10.92764  1  1  0 0   0   0  0    0    0 141.4882 124.3786 135.2596
         T3      T3l1      T3l2 M1 M1l1 M1l2 Y j
1  80.00000  80.00000  80.00000  0    0    0 0 1
2  88.06184  80.00000  80.00000  0    0    0 0 2
3  97.63087  88.06184  80.00000  0    0    0 0 3
4 112.20273  97.63087  88.06184  0    0    0 0 4
5 108.05454 112.20273  97.63087  0    0    0 0 5
6 123.36927 108.05454 112.20273  0    0    0 0 6</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data_pro <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat0</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>data_pro<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  id       v1 v2 v3 v4 A1 A1l1 M1 M1l1 L1 L1l1       L2     L2l1        L3
1  1 10.92764  1  1  0  0    0  0    0  0    0 100.0000 100.0000  80.00000
2  1 10.92764  1  1  0  0    0  0    0  0    0 130.6644 100.0000  88.06184
3  1 10.92764  1  1  0  0    0  0    0  0    0 125.2740 130.6644  97.63087
4  1 10.92764  1  1  0  0    0  0    0  0    0 135.2596 125.2740 112.20273
5  1 10.92764  1  1  0  0    0  0    0  0    0 124.3786 135.2596 108.05454
6  1 10.92764  1  1  0  0    0  0    0  0    0 141.4882 124.3786 123.36927
       L3l1 A1l2 M1l2 L1l2     L2l2      L3l2 Y j
1  80.00000    0    0    0 100.0000  80.00000 0 1
2  80.00000    0    0    0 100.0000  80.00000 0 2
3  88.06184    0    0    0 100.0000  80.00000 0 3
4  97.63087    0    0    0 130.6644  88.06184 0 4
5 112.20273    0    0    0 125.2740  97.63087 0 5
6 108.05454    0    0    0 135.2596 112.20273 0 6</code></pre>
</div>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"process_data function"</span>, {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## id, v1 - v4</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)])</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## exposure variables</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"A"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"A1"</span>)])</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"Al1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"A1l1"</span>)])</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"Al2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"A1l2"</span>)])</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L1"</span>)])</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L2"</span>)])</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T3"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L3"</span>)])</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate + lag</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T1l1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L1l1"</span>)])</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T2l1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L2l1"</span>)])</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T3l1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L3l1"</span>)])</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T1l2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L1l2"</span>)])</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T2l2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L2l2"</span>)])</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T3l2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L3l2"</span>)])</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mediator</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"M1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)])</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)])</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## outcome and time</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"Y"</span>,<span class="st">"j"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"Y"</span>,<span class="st">"j"</span>)])</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🎉</code></pre>
</div>
</div>
</section>
<section id="fitg-function-1" class="level2">
<h2 class="anchored" data-anchor-id="fitg-function-1">fitg function</h2>
<section id="seed-0-no-bootstrap" class="level3">
<h3 class="anchored" data-anchor-id="seed-0-no-bootstrap">seed = 0, no bootstrap</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> dat0 <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag1 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag2 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag1 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag2 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag1 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag2 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag1 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag2 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag1 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">80</span>),</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag2 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">80</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">df_prep</span>()</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>boot <span class="ot">&lt;-</span> df</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">scale</span>(boot<span class="sc">$</span>j)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>mean_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>sd_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(boot<span class="sc">$</span>jj)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co">#----- fit parametric models for</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Mediator models</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>mM1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  fitM1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(M1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>                 v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitM1)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitM1)</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Covariate models</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>mT1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>  fitT1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(T1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>                 v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT1)</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitT1)</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>mT2 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>  fitT2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T2 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>                v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT2)</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>mT3 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>  fitT3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T3 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>                v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT3)</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome model: E(Y|a, m, l, v)</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>mY <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>  fitY <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> </span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>                T3 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span>  v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitY)</span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitY)</span></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit all models and save in a list</span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>mR <span class="ot">&lt;-</span> <span class="fu">c</span>(mM1, mY, mT1, mT2, mT3)</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>fitR <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="cf">function</span>(x) mR[[x]](k))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>F,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"fitg function"</span>, {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model M(t)</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model Y</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L1</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L2</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L3</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😀</code></pre>
</div>
</div>
</section>
<section id="seed-0-bootstrap" class="level3">
<h3 class="anchored" data-anchor-id="seed-0-bootstrap">seed != 0, bootstrap</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## seed = 123</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> dat0 <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag1 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag2 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag1 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag2 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag1 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag2 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag1 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag2 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag1 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">80</span>),</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag2 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">80</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">df_prep</span>()</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(df<span class="sc">$</span>id))</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters), <span class="fu">length</span>(clusters), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters[index])</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>boot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loop over repeated id</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>id, zzz)</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>      boot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(boot, cc)</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">scale</span>(boot<span class="sc">$</span>j)</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>mean_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>sd_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(boot<span class="sc">$</span>jj)</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="co">#----- fit parametric models for</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Mediator models</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>mM1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>  fitM1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(M1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>                 v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitM1)</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitM1)</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Covariate models</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>mT1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>  fitT1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(T1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>                 v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT1)</span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitT1)</span></span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>mT2 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>  fitT2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T2 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>                v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT2)</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>mT3 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>  fitT3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T3 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>                v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT3)</span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome model: E(Y|a, m, l, v)</span></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a>mY <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a>  fitY <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> </span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>                T3 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span>  v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitY)</span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitY)</span></span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit all models and save in a list</span></span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a>mR <span class="ot">&lt;-</span> <span class="fu">c</span>(mM1, mY, mT1, mT2, mT3)</span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a>fitR <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="cf">function</span>(x) mR[[x]](k))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"fitg function"</span>, {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model M(t)</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model Y</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L1</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L2</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L3</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🎉</code></pre>
</div>
</div>
</section>
</section>
<section id="baseline_mc-function" class="level2">
<h2 class="anchored" data-anchor-id="baseline_mc-function">baseline_mc function</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## seed = 123</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> dat0 <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag1 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag2 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag1 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag2 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag1 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag2 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag1 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag2 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag1 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">80</span>),</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag2 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">80</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">df_prep</span>()</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(df<span class="sc">$</span>id))</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters), <span class="fu">length</span>(clusters), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters[index])</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>boot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loop over repeated id</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>id, zzz)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>      boot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(boot, cc)</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">scale</span>(boot<span class="sc">$</span>j)</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>mean_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>sd_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(boot<span class="sc">$</span>jj)</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>montecarlo <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Select baseline visit</span></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>  df0 <span class="ot">&lt;-</span> boot[boot<span class="sc">$</span>j<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>  df0<span class="sc">$</span>idn <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df0)</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>  MC <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>    samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(df0<span class="sc">$</span>idn, <span class="at">size =</span> montecarlo, <span class="at">replace =</span> T)</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>    bb <span class="ot">&lt;-</span> <span class="fu">table</span>(samples)</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df0[df0<span class="sc">$</span>idn <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>idn, zzz)</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>      MC <span class="ot">&lt;-</span> <span class="fu">rbind</span>(MC, cc)</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>    MC<span class="sc">$</span>idsim <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>montecarlo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>along_redf <span class="ot">&lt;-</span> MC <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>test_redf <span class="ot">&lt;-</span> fitR2<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"baseline_mc function"</span>, {</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># id, v1 - v4</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">1</span>],test_redf[,<span class="dv">1</span>])</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">2</span>],test_redf[,<span class="dv">2</span>])</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">3</span>],test_redf[,<span class="dv">3</span>])</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">4</span>],test_redf[,<span class="dv">4</span>])</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">5</span>],test_redf[,<span class="dv">5</span>])</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exposure variables</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"A"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1"</span>)])</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Al1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1l1"</span>)])</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Al2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1l2"</span>)])</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1"</span>)])</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2"</span>)])</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3"</span>)])</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate + lag</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1l1"</span>)])</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2l1"</span>)])</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3l1"</span>)])</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1l2"</span>)])</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2l2"</span>)])</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3l2"</span>)])</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mediator</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)])</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)])</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>  <span class="do">## outcome and time</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Y"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Y"</span>)])</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"j"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"j"</span>)])</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😸</code></pre>
</div>
</div>
</section>
<section id="g_form-function-1" class="level2">
<h2 class="anchored" data-anchor-id="g_form-function-1">g_form function</h2>
<section id="ay-1-am-1" class="level3">
<h3 class="anchored" data-anchor-id="ay-1-am-1">ay = 1, am = 1</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">=</span> <span class="dv">123</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(seed)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>along_redf <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">1</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>test_redf <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"gform function"</span>, {</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num - Am</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)],test_redf[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)])</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"v1"</span>,<span class="st">"v2"</span>,<span class="st">"v3"</span>,<span class="st">"v4"</span>,<span class="st">"lastid"</span>)],</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>               test_redf[,<span class="fu">c</span>(<span class="st">"v1"</span>,<span class="st">"v2"</span>,<span class="st">"v3"</span>,<span class="st">"v4"</span>,<span class="st">"lastid"</span>)])</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp1"</span>)])</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lp1"</span>)])</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp2"</span>)])</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lp2"</span>)])</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp3"</span>)])</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3p"</span>)], test_redf[,<span class="fu">c</span>(<span class="st">"Lp3"</span>)])</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Yp"</span>)], test_redf[,<span class="fu">c</span>(<span class="st">"Yp2"</span>)])</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🥳</code></pre>
</div>
</div>
</section>
<section id="ay-0-am-0" class="level3">
<h3 class="anchored" data-anchor-id="ay-0-am-0">ay = 0, am = 0</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">=</span> <span class="dv">123</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(seed)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>along_redf <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>test_redf <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"gform function"</span>, {</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num - Am</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)],test_redf[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)])</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"v1"</span>,<span class="st">"v2"</span>,<span class="st">"v3"</span>,<span class="st">"v4"</span>,<span class="st">"lastid"</span>)],</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>               test_redf[,<span class="fu">c</span>(<span class="st">"v1"</span>,<span class="st">"v2"</span>,<span class="st">"v3"</span>,<span class="st">"v4"</span>,<span class="st">"lastid"</span>)])</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp1"</span>)])</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lp1"</span>)])</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp2"</span>)])</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lp2"</span>)])</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp3"</span>)])</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3p"</span>)], test_redf[,<span class="fu">c</span>(<span class="st">"Lp3"</span>)])</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Yp"</span>)], test_redf[,<span class="fu">c</span>(<span class="st">"Yp2"</span>)])</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🥳</code></pre>
</div>
</div>
</section>
<section id="ay-0-am-1" class="level3">
<h3 class="anchored" data-anchor-id="ay-0-am-1">ay = 0, am = 1</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">=</span> <span class="dv">123</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>along_redf <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>along_redf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   boot_num id id_ori mm Ay Am M1p Yp T1mp T1p     T2mp      T2p     T3mp
1       123  2      6  1  0  1   0  0    0   0 100.0000 100.0000 80.00000
2       123  2      6  2  0  1   1  0    1   0 109.2691 117.3313 86.67002
3       123  2      6  3  0  1   1  0    0   0 113.0204 119.9078 87.40802
4       123  2      6  4  0  1   1  0    0   0 112.0796 120.6063 89.11429
5       123  2      6  5  0  1   1  0    0   0 110.6218 122.1934 89.29994
6       123  2      6  6  0  1   1  0    0   0 111.2710 123.5688 90.01439
7       123  2      6  7  0  1   1  0    0   0 112.0467 124.8438 90.79845
8       123  2      6  8  0  1   1  0    0   0 112.9227 125.9341 91.65432
9       123  2      6  9  0  1   1  0    0   0 113.7151 126.8413 92.42541
10      123  2      6 10  0  1   1  0    0   0 114.3841 127.5653 93.07686
11      123  2      6 11  0  1   1  0    0   0 114.9071 128.1159 93.59106
12      123  2      6 12  0  1   1  0    0   0 115.2830 128.5055 93.96841
         T3p        v1 v2 v3 v4 lastid
1   80.00000 0.1226858  0  0  1      0
2   94.66629 0.1226858  0  0  1      0
3   97.82790 0.1226858  0  0  1      0
4   98.89958 0.1226858  0  0  1      0
5  100.40023 0.1226858  0  0  1      0
6  101.71747 0.1226858  0  0  1      0
7  102.92888 0.1226858  0  0  1      0
8  103.96793 0.1226858  0  0  1      0
9  104.83566 0.1226858  0  0  1      0
10 105.53357 0.1226858  0  0  1      0
11 106.07117 0.1226858  0  0  1      0
12 106.46005 0.1226858  0  0  1      1</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>test_redf <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>test_redf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id id_ori mm Ay Am M1 Yp2 Lmp1     Lmp2     Lmp3 Lp1      Lp2       Lp3
1   2      6  1  0  1  0   0    0 100.0000 80.00000   0 100.0000  80.00000
2   2      6  2  0  1  1   0    1 109.2691 86.67002   0 117.3313  94.66629
3   2      6  3  0  1  1   0    0 113.0204 87.40802   0 119.9078  97.82790
4   2      6  4  0  1  1   0    0 112.0796 89.11429   0 120.6063  98.89958
5   2      6  5  0  1  1   0    0 110.6218 89.29994   0 122.1934 100.40023
6   2      6  6  0  1  1   0    0 111.2710 90.01439   0 123.5688 101.71747
7   2      6  7  0  1  1   0    0 112.0467 90.79845   0 124.8438 102.92888
8   2      6  8  0  1  1   0    0 112.9227 91.65432   0 125.9341 103.96793
9   2      6  9  0  1  1   0    0 113.7151 92.42541   0 126.8413 104.83566
10  2      6 10  0  1  1   1    0 114.3841 93.07686   0 127.5653 105.53357
          v1 v2 v3 v4 lastid
1  0.1226858  0  0  1      0
2  0.1226858  0  0  1      0
3  0.1226858  0  0  1      0
4  0.1226858  0  0  1      0
5  0.1226858  0  0  1      0
6  0.1226858  0  0  1      0
7  0.1226858  0  0  1      0
8  0.1226858  0  0  1      0
9  0.1226858  0  0  1      0
10 0.1226858  0  0  1      1</code></pre>
</div>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test_that("gform function", {</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   # boot_num - Am</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c(2:6)],test_redf[,c(1:5)])</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("v1","v2","v3","v4","lastid","Yp")],</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                test_redf[,c("v1","v2","v3","v4","lastid","Yp")])</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("M1p")],test_redf[,c("M1")])</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T1mp")],test_redf[,c("Lmp1")])</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T1p")],test_redf[,c("Lp1")])</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T2mp")],test_redf[,c("Lmp2")])</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T2p")],test_redf[,c("Lp2")])</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T3mp")],test_redf[,c("Lmp3")])</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T3p")], test_redf[,c("Lp3")])</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="ay-am-bị-lỗi" class="level1">
<h1>ay != am bị lỗi</h1>
<p>Như trường hợp tính khi am = 1, ay = 0 giữa 2 code k giống nhau nên em làm section để chạy lẻ các code xem lỗi ở đâu. Ở function của a Long thì chạy hết length nhưng Y vẫn = 0, còn function của em thì chạy tới 10 là Y = 1. Em nghĩ sự khác nhau giữa 2 outcome do cơ chế set.seed của R.</p>
<section id="data-bỏ-vô-g-formula-giống-nhau" class="level2">
<h2 class="anchored" data-anchor-id="data-bỏ-vô-g-formula-giống-nhau">2 data bỏ vô g formula giống nhau</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>along_redf <span class="ot">&lt;-</span> MC <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>test_redf <span class="ot">&lt;-</span> fitR2<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"baseline_mc function"</span>, {</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># id, v1 - v4</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">1</span>],test_redf[,<span class="dv">1</span>])</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">2</span>],test_redf[,<span class="dv">2</span>])</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">3</span>],test_redf[,<span class="dv">3</span>])</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">4</span>],test_redf[,<span class="dv">4</span>])</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">5</span>],test_redf[,<span class="dv">5</span>])</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exposure variables</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"A"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1"</span>)])</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Al1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1l1"</span>)])</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Al2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1l2"</span>)])</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1"</span>)])</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2"</span>)])</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3"</span>)])</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate + lag</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1l1"</span>)])</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2l1"</span>)])</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3l1"</span>)])</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1l2"</span>)])</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2l2"</span>)])</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3l2"</span>)])</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mediator</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)])</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)])</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>  <span class="do">## outcome and time</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Y"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Y"</span>)])</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"j"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"j"</span>)])</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🎉</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>ii <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>length <span class="ot">=</span> <span class="dv">12</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>am <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>ay <span class="ot">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<p>package code</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> fitR2</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  dddd <span class="ot">&lt;-</span> data<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  lagg <span class="ot">&lt;-</span> dddd <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"L1l"</span>)) <span class="sc">%&gt;%</span> <span class="fu">ncol</span>() </span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  d2 <span class="ot">&lt;-</span> dddd[dddd<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d2<span class="sc">$</span>idsim</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d2<span class="sc">$</span>id</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>))</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  Yp2 <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>  Yp2[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(data<span class="sc">$</span>df<span class="sc">$</span>j)</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mediator</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>  Mp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>M)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Mp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M))</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>  Mp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Mp)) </span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to mediator models)</span></span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>  Lmp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>L)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>  Lmp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Lmp)) </span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to outcome models)</span></span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>  Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> lagg<span class="sc">:</span>length) {</span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb67-46"><a href="#cb67-46" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb67-47"><a href="#cb67-47" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-48"><a href="#cb67-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb67-49"><a href="#cb67-49" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb67-50"><a href="#cb67-50" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb67-51"><a href="#cb67-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-52"><a href="#cb67-52" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-53"><a href="#cb67-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb67-54"><a href="#cb67-54" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-55"><a href="#cb67-55" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb67-56"><a href="#cb67-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-57"><a href="#cb67-57" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-58"><a href="#cb67-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb67-59"><a href="#cb67-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-60"><a href="#cb67-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb67-61"><a href="#cb67-61" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb67-62"><a href="#cb67-62" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb67-63"><a href="#cb67-63" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb67-64"><a href="#cb67-64" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb67-65"><a href="#cb67-65" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb67-66"><a href="#cb67-66" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb67-67"><a href="#cb67-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-68"><a href="#cb67-68" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb67-69"><a href="#cb67-69" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-70"><a href="#cb67-70" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-71"><a href="#cb67-71" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb67-72"><a href="#cb67-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-73"><a href="#cb67-73" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb67-74"><a href="#cb67-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-75"><a href="#cb67-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb67-76"><a href="#cb67-76" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-77"><a href="#cb67-77" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb67-78"><a href="#cb67-78" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb67-79"><a href="#cb67-79" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb67-80"><a href="#cb67-80" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb67-81"><a href="#cb67-81" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb67-82"><a href="#cb67-82" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb67-83"><a href="#cb67-83" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb67-84"><a href="#cb67-84" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb67-85"><a href="#cb67-85" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-86"><a href="#cb67-86" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb67-87"><a href="#cb67-87" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-88"><a href="#cb67-88" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb67-89"><a href="#cb67-89" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb67-90"><a href="#cb67-90" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb67-91"><a href="#cb67-91" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb67-92"><a href="#cb67-92" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-93"><a href="#cb67-93" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb67-94"><a href="#cb67-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-95"><a href="#cb67-95" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb67-96"><a href="#cb67-96" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-97"><a href="#cb67-97" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb67-98"><a href="#cb67-98" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb67-99"><a href="#cb67-99" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb67-100"><a href="#cb67-100" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb67-101"><a href="#cb67-101" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-102"><a href="#cb67-102" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb67-103"><a href="#cb67-103" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb67-104"><a href="#cb67-104" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb67-105"><a href="#cb67-105" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-106"><a href="#cb67-106" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-107"><a href="#cb67-107" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb67-108"><a href="#cb67-108" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-109"><a href="#cb67-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb67-110"><a href="#cb67-110" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb67-111"><a href="#cb67-111" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb67-112"><a href="#cb67-112" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb67-113"><a href="#cb67-113" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb67-114"><a href="#cb67-114" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb67-115"><a href="#cb67-115" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb67-116"><a href="#cb67-116" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-117"><a href="#cb67-117" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb67-118"><a href="#cb67-118" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-119"><a href="#cb67-119" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb67-120"><a href="#cb67-120" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-121"><a href="#cb67-121" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb67-122"><a href="#cb67-122" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-123"><a href="#cb67-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb67-124"><a href="#cb67-124" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb67-125"><a href="#cb67-125" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb67-126"><a href="#cb67-126" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb67-127"><a href="#cb67-127" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb67-128"><a href="#cb67-128" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb67-129"><a href="#cb67-129" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb67-130"><a href="#cb67-130" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb67-131"><a href="#cb67-131" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb67-132"><a href="#cb67-132" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb67-133"><a href="#cb67-133" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb67-134"><a href="#cb67-134" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb67-135"><a href="#cb67-135" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb67-136"><a href="#cb67-136" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-137"><a href="#cb67-137" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb67-138"><a href="#cb67-138" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-139"><a href="#cb67-139" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb67-140"><a href="#cb67-140" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb67-141"><a href="#cb67-141" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb67-142"><a href="#cb67-142" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb67-143"><a href="#cb67-143" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-144"><a href="#cb67-144" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb67-145"><a href="#cb67-145" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-146"><a href="#cb67-146" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb67-147"><a href="#cb67-147" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-148"><a href="#cb67-148" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb67-149"><a href="#cb67-149" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb67-150"><a href="#cb67-150" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-151"><a href="#cb67-151" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb67-152"><a href="#cb67-152" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb67-153"><a href="#cb67-153" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb67-154"><a href="#cb67-154" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-155"><a href="#cb67-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb67-156"><a href="#cb67-156" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-157"><a href="#cb67-157" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb67-158"><a href="#cb67-158" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb67-159"><a href="#cb67-159" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb67-160"><a href="#cb67-160" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb67-161"><a href="#cb67-161" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb67-162"><a href="#cb67-162" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb67-163"><a href="#cb67-163" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb67-164"><a href="#cb67-164" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-165"><a href="#cb67-165" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb67-166"><a href="#cb67-166" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-167"><a href="#cb67-167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb67-168"><a href="#cb67-168" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-169"><a href="#cb67-169" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb67-170"><a href="#cb67-170" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-171"><a href="#cb67-171" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb67-172"><a href="#cb67-172" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb67-173"><a href="#cb67-173" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb67-174"><a href="#cb67-174" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb67-175"><a href="#cb67-175" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb67-176"><a href="#cb67-176" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb67-177"><a href="#cb67-177" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb67-178"><a href="#cb67-178" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb67-179"><a href="#cb67-179" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb67-180"><a href="#cb67-180" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb67-181"><a href="#cb67-181" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb67-182"><a href="#cb67-182" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb67-183"><a href="#cb67-183" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb67-184"><a href="#cb67-184" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb67-185"><a href="#cb67-185" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb67-186"><a href="#cb67-186" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb67-187"><a href="#cb67-187" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb67-188"><a href="#cb67-188" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb67-189"><a href="#cb67-189" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb67-190"><a href="#cb67-190" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb67-191"><a href="#cb67-191" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb67-192"><a href="#cb67-192" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb67-193"><a href="#cb67-193" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb67-194"><a href="#cb67-194" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb67-195"><a href="#cb67-195" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-196"><a href="#cb67-196" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb67-197"><a href="#cb67-197" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb67-198"><a href="#cb67-198" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb67-199"><a href="#cb67-199" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-200"><a href="#cb67-200" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb67-201"><a href="#cb67-201" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb67-202"><a href="#cb67-202" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb67-203"><a href="#cb67-203" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-204"><a href="#cb67-204" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb67-205"><a href="#cb67-205" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb67-206"><a href="#cb67-206" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb67-207"><a href="#cb67-207" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb67-208"><a href="#cb67-208" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-209"><a href="#cb67-209" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb67-210"><a href="#cb67-210" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-211"><a href="#cb67-211" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb67-212"><a href="#cb67-212" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb67-213"><a href="#cb67-213" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb67-214"><a href="#cb67-214" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb67-215"><a href="#cb67-215" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb67-216"><a href="#cb67-216" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb67-217"><a href="#cb67-217" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb67-218"><a href="#cb67-218" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-219"><a href="#cb67-219" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb67-220"><a href="#cb67-220" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-221"><a href="#cb67-221" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb67-222"><a href="#cb67-222" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb67-223"><a href="#cb67-223" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb67-224"><a href="#cb67-224" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-225"><a href="#cb67-225" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb67-226"><a href="#cb67-226" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb67-227"><a href="#cb67-227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-228"><a href="#cb67-228" aria-hidden="true" tabindex="-1"></a>  Yp2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0 0 0 1</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>a Long code</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>pgdat <span class="ot">=</span> MC</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> pgdat</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d[d<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d<span class="sc">$</span>idsim</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d<span class="sc">$</span>id</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("...", paste0(ii, "(", id_ori, ")"))</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d[, <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>, <span class="st">"v3"</span>, <span class="st">"v4"</span>)]</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  T1p <span class="ot">&lt;-</span> T2p <span class="ot">&lt;-</span> T3p  <span class="ot">&lt;-</span> M1p <span class="ot">&lt;-</span> Yp <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  T1mp <span class="ot">&lt;-</span> T2mp <span class="ot">&lt;-</span> T3mp <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>  M1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>  Yp[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to outcome model</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>  T1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>  T2p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>  T3p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to mediator model</span></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>  T1mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>  T2mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>  T3mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>length) {</span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-65"><a href="#cb69-65" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-66"><a href="#cb69-66" aria-hidden="true" tabindex="-1"></a>      T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb69-67"><a href="#cb69-67" aria-hidden="true" tabindex="-1"></a>      T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb69-68"><a href="#cb69-68" aria-hidden="true" tabindex="-1"></a>      T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb69-69"><a href="#cb69-69" aria-hidden="true" tabindex="-1"></a>      T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb69-70"><a href="#cb69-70" aria-hidden="true" tabindex="-1"></a>      T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb69-71"><a href="#cb69-71" aria-hidden="true" tabindex="-1"></a>      T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb69-72"><a href="#cb69-72" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-73"><a href="#cb69-73" aria-hidden="true" tabindex="-1"></a>      M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb69-74"><a href="#cb69-74" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-75"><a href="#cb69-75" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-76"><a href="#cb69-76" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-77"><a href="#cb69-77" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb69-78"><a href="#cb69-78" aria-hidden="true" tabindex="-1"></a>      dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb69-79"><a href="#cb69-79" aria-hidden="true" tabindex="-1"></a>                         <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb69-80"><a href="#cb69-80" aria-hidden="true" tabindex="-1"></a>                         <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb69-81"><a href="#cb69-81" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-82"><a href="#cb69-82" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb69-83"><a href="#cb69-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb69-84"><a href="#cb69-84" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb69-85"><a href="#cb69-85" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb69-86"><a href="#cb69-86" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb69-87"><a href="#cb69-87" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-88"><a href="#cb69-88" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-89"><a href="#cb69-89" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-90"><a href="#cb69-90" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-91"><a href="#cb69-91" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb69-92"><a href="#cb69-92" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T1</span></span>
<span id="cb69-93"><a href="#cb69-93" aria-hidden="true" tabindex="-1"></a>      dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb69-94"><a href="#cb69-94" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb69-95"><a href="#cb69-95" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb69-96"><a href="#cb69-96" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb69-97"><a href="#cb69-97" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb69-98"><a href="#cb69-98" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb69-99"><a href="#cb69-99" aria-hidden="true" tabindex="-1"></a>      T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb69-100"><a href="#cb69-100" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-101"><a href="#cb69-101" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T2</span></span>
<span id="cb69-102"><a href="#cb69-102" aria-hidden="true" tabindex="-1"></a>      dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb69-103"><a href="#cb69-103" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb69-104"><a href="#cb69-104" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb69-105"><a href="#cb69-105" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb69-106"><a href="#cb69-106" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb69-107"><a href="#cb69-107" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb69-108"><a href="#cb69-108" aria-hidden="true" tabindex="-1"></a>      T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb69-109"><a href="#cb69-109" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-110"><a href="#cb69-110" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T3</span></span>
<span id="cb69-111"><a href="#cb69-111" aria-hidden="true" tabindex="-1"></a>      dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb69-112"><a href="#cb69-112" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb69-113"><a href="#cb69-113" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb69-114"><a href="#cb69-114" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb69-115"><a href="#cb69-115" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb69-116"><a href="#cb69-116" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb69-117"><a href="#cb69-117" aria-hidden="true" tabindex="-1"></a>      T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb69-118"><a href="#cb69-118" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-119"><a href="#cb69-119" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-120"><a href="#cb69-120" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb69-121"><a href="#cb69-121" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb69-122"><a href="#cb69-122" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-123"><a href="#cb69-123" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb69-124"><a href="#cb69-124" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb69-125"><a href="#cb69-125" aria-hidden="true" tabindex="-1"></a>        dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb69-126"><a href="#cb69-126" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb69-127"><a href="#cb69-127" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb69-128"><a href="#cb69-128" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb69-129"><a href="#cb69-129" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb69-130"><a href="#cb69-130" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb69-131"><a href="#cb69-131" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb69-132"><a href="#cb69-132" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-133"><a href="#cb69-133" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb69-134"><a href="#cb69-134" aria-hidden="true" tabindex="-1"></a>        dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb69-135"><a href="#cb69-135" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb69-136"><a href="#cb69-136" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb69-137"><a href="#cb69-137" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb69-138"><a href="#cb69-138" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb69-139"><a href="#cb69-139" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb69-140"><a href="#cb69-140" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb69-141"><a href="#cb69-141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-142"><a href="#cb69-142" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb69-143"><a href="#cb69-143" aria-hidden="true" tabindex="-1"></a>        dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb69-144"><a href="#cb69-144" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb69-145"><a href="#cb69-145" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb69-146"><a href="#cb69-146" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb69-147"><a href="#cb69-147" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb69-148"><a href="#cb69-148" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb69-149"><a href="#cb69-149" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb69-150"><a href="#cb69-150" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-151"><a href="#cb69-151" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-152"><a href="#cb69-152" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-153"><a href="#cb69-153" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb69-154"><a href="#cb69-154" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb69-155"><a href="#cb69-155" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb69-156"><a href="#cb69-156" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb69-157"><a href="#cb69-157" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-158"><a href="#cb69-158" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-159"><a href="#cb69-159" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb69-160"><a href="#cb69-160" aria-hidden="true" tabindex="-1"></a>      dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb69-161"><a href="#cb69-161" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb69-162"><a href="#cb69-162" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb69-163"><a href="#cb69-163" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb69-164"><a href="#cb69-164" aria-hidden="true" tabindex="-1"></a>                        <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb69-165"><a href="#cb69-165" aria-hidden="true" tabindex="-1"></a>      Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb69-166"><a href="#cb69-166" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb69-167"><a href="#cb69-167" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb69-168"><a href="#cb69-168" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb69-169"><a href="#cb69-169" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb69-170"><a href="#cb69-170" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-171"><a href="#cb69-171" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb69-172"><a href="#cb69-172" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-173"><a href="#cb69-173" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-174"><a href="#cb69-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-175"><a href="#cb69-175" aria-hidden="true" tabindex="-1"></a>Yp  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 0 0 0 0 0 0 0 0 0 0 0</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="tách-data-time-5" class="level2">
<h2 class="anchored" data-anchor-id="tách-data-time-5">tách data time = 5</h2>
<p>theo như code của package thì ở time thứ 5 fit predict Y ở time thứ 6 = 1</p>
<p>nên em tách lúc time = 5 để xem data dùng để predict Y và sau đó l = 6 để predict</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>package code</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> fitR2</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  dddd <span class="ot">&lt;-</span> data<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  lagg <span class="ot">&lt;-</span> dddd <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"L1l"</span>)) <span class="sc">%&gt;%</span> <span class="fu">ncol</span>() </span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  d2 <span class="ot">&lt;-</span> dddd[dddd<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d2<span class="sc">$</span>idsim</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d2<span class="sc">$</span>id</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>))</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>  Yp2 <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>  Yp2[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(data<span class="sc">$</span>df<span class="sc">$</span>j)</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mediator</span></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>  Mp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>M)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Mp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M))</span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>  Mp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Mp)) </span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to mediator models)</span></span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>  Lmp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>L)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a>  Lmp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Lmp)) </span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to outcome models)</span></span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>  Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> lagg<span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb71-45"><a href="#cb71-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb71-46"><a href="#cb71-46" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb71-47"><a href="#cb71-47" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-48"><a href="#cb71-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb71-49"><a href="#cb71-49" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb71-50"><a href="#cb71-50" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb71-51"><a href="#cb71-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-52"><a href="#cb71-52" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-53"><a href="#cb71-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb71-54"><a href="#cb71-54" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-55"><a href="#cb71-55" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb71-56"><a href="#cb71-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-57"><a href="#cb71-57" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-58"><a href="#cb71-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb71-59"><a href="#cb71-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-60"><a href="#cb71-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb71-61"><a href="#cb71-61" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb71-62"><a href="#cb71-62" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb71-63"><a href="#cb71-63" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb71-64"><a href="#cb71-64" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb71-65"><a href="#cb71-65" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb71-66"><a href="#cb71-66" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb71-67"><a href="#cb71-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-68"><a href="#cb71-68" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb71-69"><a href="#cb71-69" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-70"><a href="#cb71-70" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-71"><a href="#cb71-71" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb71-72"><a href="#cb71-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-73"><a href="#cb71-73" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb71-74"><a href="#cb71-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-75"><a href="#cb71-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb71-76"><a href="#cb71-76" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-77"><a href="#cb71-77" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb71-78"><a href="#cb71-78" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb71-79"><a href="#cb71-79" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb71-80"><a href="#cb71-80" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb71-81"><a href="#cb71-81" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb71-82"><a href="#cb71-82" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb71-83"><a href="#cb71-83" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb71-84"><a href="#cb71-84" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb71-85"><a href="#cb71-85" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-86"><a href="#cb71-86" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb71-87"><a href="#cb71-87" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-88"><a href="#cb71-88" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb71-89"><a href="#cb71-89" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb71-90"><a href="#cb71-90" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb71-91"><a href="#cb71-91" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb71-92"><a href="#cb71-92" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-93"><a href="#cb71-93" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb71-94"><a href="#cb71-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-95"><a href="#cb71-95" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb71-96"><a href="#cb71-96" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-97"><a href="#cb71-97" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb71-98"><a href="#cb71-98" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb71-99"><a href="#cb71-99" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb71-100"><a href="#cb71-100" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb71-101"><a href="#cb71-101" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-102"><a href="#cb71-102" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb71-103"><a href="#cb71-103" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb71-104"><a href="#cb71-104" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb71-105"><a href="#cb71-105" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-106"><a href="#cb71-106" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-107"><a href="#cb71-107" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb71-108"><a href="#cb71-108" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-109"><a href="#cb71-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb71-110"><a href="#cb71-110" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb71-111"><a href="#cb71-111" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb71-112"><a href="#cb71-112" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb71-113"><a href="#cb71-113" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb71-114"><a href="#cb71-114" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb71-115"><a href="#cb71-115" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb71-116"><a href="#cb71-116" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-117"><a href="#cb71-117" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb71-118"><a href="#cb71-118" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-119"><a href="#cb71-119" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb71-120"><a href="#cb71-120" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-121"><a href="#cb71-121" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb71-122"><a href="#cb71-122" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-123"><a href="#cb71-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb71-124"><a href="#cb71-124" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb71-125"><a href="#cb71-125" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb71-126"><a href="#cb71-126" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb71-127"><a href="#cb71-127" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb71-128"><a href="#cb71-128" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb71-129"><a href="#cb71-129" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb71-130"><a href="#cb71-130" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb71-131"><a href="#cb71-131" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb71-132"><a href="#cb71-132" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb71-133"><a href="#cb71-133" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb71-134"><a href="#cb71-134" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb71-135"><a href="#cb71-135" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb71-136"><a href="#cb71-136" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-137"><a href="#cb71-137" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb71-138"><a href="#cb71-138" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-139"><a href="#cb71-139" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb71-140"><a href="#cb71-140" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb71-141"><a href="#cb71-141" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb71-142"><a href="#cb71-142" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb71-143"><a href="#cb71-143" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-144"><a href="#cb71-144" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb71-145"><a href="#cb71-145" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-146"><a href="#cb71-146" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb71-147"><a href="#cb71-147" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-148"><a href="#cb71-148" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb71-149"><a href="#cb71-149" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb71-150"><a href="#cb71-150" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-151"><a href="#cb71-151" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb71-152"><a href="#cb71-152" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb71-153"><a href="#cb71-153" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb71-154"><a href="#cb71-154" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-155"><a href="#cb71-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb71-156"><a href="#cb71-156" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-157"><a href="#cb71-157" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb71-158"><a href="#cb71-158" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb71-159"><a href="#cb71-159" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb71-160"><a href="#cb71-160" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb71-161"><a href="#cb71-161" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb71-162"><a href="#cb71-162" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb71-163"><a href="#cb71-163" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb71-164"><a href="#cb71-164" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-165"><a href="#cb71-165" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb71-166"><a href="#cb71-166" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-167"><a href="#cb71-167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb71-168"><a href="#cb71-168" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-169"><a href="#cb71-169" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb71-170"><a href="#cb71-170" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-171"><a href="#cb71-171" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb71-172"><a href="#cb71-172" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb71-173"><a href="#cb71-173" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb71-174"><a href="#cb71-174" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb71-175"><a href="#cb71-175" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb71-176"><a href="#cb71-176" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb71-177"><a href="#cb71-177" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb71-178"><a href="#cb71-178" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb71-179"><a href="#cb71-179" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb71-180"><a href="#cb71-180" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb71-181"><a href="#cb71-181" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb71-182"><a href="#cb71-182" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb71-183"><a href="#cb71-183" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb71-184"><a href="#cb71-184" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb71-185"><a href="#cb71-185" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb71-186"><a href="#cb71-186" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb71-187"><a href="#cb71-187" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb71-188"><a href="#cb71-188" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb71-189"><a href="#cb71-189" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb71-190"><a href="#cb71-190" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb71-191"><a href="#cb71-191" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb71-192"><a href="#cb71-192" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb71-193"><a href="#cb71-193" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb71-194"><a href="#cb71-194" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb71-195"><a href="#cb71-195" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-196"><a href="#cb71-196" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb71-197"><a href="#cb71-197" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb71-198"><a href="#cb71-198" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb71-199"><a href="#cb71-199" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-200"><a href="#cb71-200" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb71-201"><a href="#cb71-201" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb71-202"><a href="#cb71-202" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb71-203"><a href="#cb71-203" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-204"><a href="#cb71-204" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb71-205"><a href="#cb71-205" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb71-206"><a href="#cb71-206" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb71-207"><a href="#cb71-207" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb71-208"><a href="#cb71-208" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-209"><a href="#cb71-209" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb71-210"><a href="#cb71-210" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-211"><a href="#cb71-211" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb71-212"><a href="#cb71-212" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb71-213"><a href="#cb71-213" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb71-214"><a href="#cb71-214" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb71-215"><a href="#cb71-215" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb71-216"><a href="#cb71-216" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb71-217"><a href="#cb71-217" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb71-218"><a href="#cb71-218" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb71-219"><a href="#cb71-219" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb71-220"><a href="#cb71-220" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-221"><a href="#cb71-221" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb71-222"><a href="#cb71-222" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb71-223"><a href="#cb71-223" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb71-224"><a href="#cb71-224" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-225"><a href="#cb71-225" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb71-226"><a href="#cb71-226" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div><div class="column" style="width:50%;">
<p>a Long code</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>pgdat <span class="ot">=</span> MC</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> pgdat</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d[d<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d<span class="sc">$</span>idsim</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d<span class="sc">$</span>id</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("...", paste0(ii, "(", id_ori, ")"))</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d[, <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>, <span class="st">"v3"</span>, <span class="st">"v4"</span>)]</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>  T1p <span class="ot">&lt;-</span> T2p <span class="ot">&lt;-</span> T3p  <span class="ot">&lt;-</span> M1p <span class="ot">&lt;-</span> Yp <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  T1mp <span class="ot">&lt;-</span> T2mp <span class="ot">&lt;-</span> T3mp <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>  M1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>  Yp[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to outcome model</span></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>  T1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>  T2p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>  T3p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to mediator model</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>  T1mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>  T2mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>  T3mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a>      T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a>      T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a>      T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a>      T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a>      T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a>      T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a>      M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a>      dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb72-79"><a href="#cb72-79" aria-hidden="true" tabindex="-1"></a>                         <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb72-80"><a href="#cb72-80" aria-hidden="true" tabindex="-1"></a>                         <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb72-81"><a href="#cb72-81" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-82"><a href="#cb72-82" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb72-83"><a href="#cb72-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb72-84"><a href="#cb72-84" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb72-85"><a href="#cb72-85" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb72-86"><a href="#cb72-86" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb72-87"><a href="#cb72-87" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb72-88"><a href="#cb72-88" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-89"><a href="#cb72-89" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-90"><a href="#cb72-90" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-91"><a href="#cb72-91" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb72-92"><a href="#cb72-92" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T1</span></span>
<span id="cb72-93"><a href="#cb72-93" aria-hidden="true" tabindex="-1"></a>      dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb72-94"><a href="#cb72-94" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb72-95"><a href="#cb72-95" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb72-96"><a href="#cb72-96" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb72-97"><a href="#cb72-97" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb72-98"><a href="#cb72-98" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb72-99"><a href="#cb72-99" aria-hidden="true" tabindex="-1"></a>      T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb72-100"><a href="#cb72-100" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-101"><a href="#cb72-101" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T2</span></span>
<span id="cb72-102"><a href="#cb72-102" aria-hidden="true" tabindex="-1"></a>      dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb72-103"><a href="#cb72-103" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb72-104"><a href="#cb72-104" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb72-105"><a href="#cb72-105" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb72-106"><a href="#cb72-106" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb72-107"><a href="#cb72-107" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb72-108"><a href="#cb72-108" aria-hidden="true" tabindex="-1"></a>      T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb72-109"><a href="#cb72-109" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-110"><a href="#cb72-110" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T3</span></span>
<span id="cb72-111"><a href="#cb72-111" aria-hidden="true" tabindex="-1"></a>      dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb72-112"><a href="#cb72-112" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb72-113"><a href="#cb72-113" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb72-114"><a href="#cb72-114" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb72-115"><a href="#cb72-115" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb72-116"><a href="#cb72-116" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb72-117"><a href="#cb72-117" aria-hidden="true" tabindex="-1"></a>      T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb72-118"><a href="#cb72-118" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-119"><a href="#cb72-119" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-120"><a href="#cb72-120" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb72-121"><a href="#cb72-121" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb72-122"><a href="#cb72-122" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-123"><a href="#cb72-123" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb72-124"><a href="#cb72-124" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb72-125"><a href="#cb72-125" aria-hidden="true" tabindex="-1"></a>        dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb72-126"><a href="#cb72-126" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb72-127"><a href="#cb72-127" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb72-128"><a href="#cb72-128" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb72-129"><a href="#cb72-129" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb72-130"><a href="#cb72-130" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb72-131"><a href="#cb72-131" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb72-132"><a href="#cb72-132" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-133"><a href="#cb72-133" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb72-134"><a href="#cb72-134" aria-hidden="true" tabindex="-1"></a>        dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb72-135"><a href="#cb72-135" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb72-136"><a href="#cb72-136" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb72-137"><a href="#cb72-137" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb72-138"><a href="#cb72-138" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb72-139"><a href="#cb72-139" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb72-140"><a href="#cb72-140" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb72-141"><a href="#cb72-141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-142"><a href="#cb72-142" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb72-143"><a href="#cb72-143" aria-hidden="true" tabindex="-1"></a>        dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb72-144"><a href="#cb72-144" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb72-145"><a href="#cb72-145" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb72-146"><a href="#cb72-146" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb72-147"><a href="#cb72-147" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb72-148"><a href="#cb72-148" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb72-149"><a href="#cb72-149" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb72-150"><a href="#cb72-150" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-151"><a href="#cb72-151" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-152"><a href="#cb72-152" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb72-153"><a href="#cb72-153" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb72-154"><a href="#cb72-154" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb72-155"><a href="#cb72-155" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb72-156"><a href="#cb72-156" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb72-157"><a href="#cb72-157" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb72-158"><a href="#cb72-158" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-159"><a href="#cb72-159" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb72-160"><a href="#cb72-160" aria-hidden="true" tabindex="-1"></a>      dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb72-161"><a href="#cb72-161" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb72-162"><a href="#cb72-162" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb72-163"><a href="#cb72-163" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb72-164"><a href="#cb72-164" aria-hidden="true" tabindex="-1"></a>                        <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb72-165"><a href="#cb72-165" aria-hidden="true" tabindex="-1"></a>      Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb72-166"><a href="#cb72-166" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb72-167"><a href="#cb72-167" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb72-168"><a href="#cb72-168" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb72-169"><a href="#cb72-169" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb72-170"><a href="#cb72-170" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-171"><a href="#cb72-171" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb72-172"><a href="#cb72-172" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-173"><a href="#cb72-173" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="do">## package</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>dfYp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  A1 A1l1 A1l2 M1 M1l1 M1l2 L1 L1l1     L2l1     L3l1 L1l2       L2     L2l2
2  0    0    0  1    1    1  0    0 120.6063 98.89958    0 122.1934 119.9078
     L3l2       L3        v1 v2 v3 v4        jj
2 97.8279 100.4002 0.1226858  0  0  1 -1.160303</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="do">## a Long code</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>dYp </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           v1 v2 v3 v4 A Al1 Al2 M1 M1l1 M1l2 T1 T1l1 T1l2       T2     T2l1
150 0.1226858  0  0  1 0   0   0  1    1    1  0    0    0 122.1934 120.6063
        T2l2       T3     T3l1    T3l2        jj
150 119.9078 100.4002 98.89958 97.8279 -1.160303</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="do">### test</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"dataY function"</span>, {</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num - Am</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expect_equal(dfYp[,c(2:6)],dYp[,c(1:5)])</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"v1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"v1"</span>)])</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"v2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"v2"</span>)])</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"v3"</span>],dYp[,<span class="fu">c</span>(<span class="st">"v3"</span>)])</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"v4"</span>],dYp[,<span class="fu">c</span>(<span class="st">"v4"</span>)])</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"A1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"A"</span>)])</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"A1l1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"Al1"</span>)])</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"A1l2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"Al2"</span>)])</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"M1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"M1l1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)])</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"M1l2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)])</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T1"</span>)])</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L1l1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T1l1"</span>)])</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L1l2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T1l2"</span>)])</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T2"</span>)])</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L2l1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T2l1"</span>)])</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L2l2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T2l2"</span>)])</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L3"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T3"</span>)])</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L3l1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T3l1"</span>)])</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L3l2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T3l2"</span>)])</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😀</code></pre>
</div>
</div>
<p>và model dùng để fit thì giống nhau</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = fitY, family = yreg, data = res_df)

Coefficients:
    (Intercept)               A1             A1l1             A1l2  
     -23.577911       -16.459683        -3.429148        20.810859  
             M1             M1l1             M1l2               L1  
      20.428251       -21.320683        20.989388        -1.254449  
           L1l1               L2             L2l1               L3  
      -1.193337        -0.006302        -0.011774         0.039251  
           L3l1             L1l2             L2l2             L3l2  
       0.002412        -1.350684         0.008298        -0.004499  
             v1               v2               v3               v4  
      -0.208470         0.283218        -0.436540         1.445172  
bs(jj, df = 3)1  bs(jj, df = 3)2  bs(jj, df = 3)3  
      -5.923461         5.238234        -1.524138  

Degrees of Freedom: 2859 Total (i.e. Null);  2837 Residual
Null Deviance:      342.2 
Residual Deviance: 174  AIC: 220</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>fitR[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = Y ~ A + Al1 + Al2 + M1 + M1l1 + M1l2 + T1 + T1l1 + 
    T1l2 + T2 + T2l1 + T2l2 + T3 + T3l1 + T3l2 + v1 + v2 + v3 + 
    v4 + splines::bs(jj, df = 3), family = binomial, data = boot)

Coefficients:
             (Intercept)                         A                       Al1  
              -23.577911                -16.459683                 -3.429148  
                     Al2                        M1                      M1l1  
               20.810859                 20.428251                -21.320683  
                    M1l2                        T1                      T1l1  
               20.989388                 -1.254449                 -1.193337  
                    T1l2                        T2                      T2l1  
               -1.350684                 -0.006302                 -0.011774  
                    T2l2                        T3                      T3l1  
                0.008298                  0.039251                  0.002412  
                    T3l2                        v1                        v2  
               -0.004499                 -0.208470                  0.283218  
                      v3                        v4  splines::bs(jj, df = 3)1  
               -0.436540                  1.445172                 -5.923461  
splines::bs(jj, df = 3)2  splines::bs(jj, df = 3)3  
                5.238234                 -1.524138  

Degrees of Freedom: 2859 Total (i.e. Null);  2837 Residual
Null Deviance:      342.2 
Residual Deviance: 174  AIC: 220</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="predict-time-6" class="level2">
<h2 class="anchored" data-anchor-id="predict-time-6">predict time = 6</h2>
<p>lúc này ở trên data đang có đến time = 5, nên em chỉ cần l = 6 để predict Y, thì lúc này predict lại ra là 0</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>package code</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for (l in lagg:5) {</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb83-44"><a href="#cb83-44" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-45"><a href="#cb83-45" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb83-46"><a href="#cb83-46" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-47"><a href="#cb83-47" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb83-48"><a href="#cb83-48" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb83-49"><a href="#cb83-49" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb83-50"><a href="#cb83-50" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb83-51"><a href="#cb83-51" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-52"><a href="#cb83-52" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb83-53"><a href="#cb83-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-54"><a href="#cb83-54" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb83-55"><a href="#cb83-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-56"><a href="#cb83-56" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb83-57"><a href="#cb83-57" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb83-58"><a href="#cb83-58" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb83-59"><a href="#cb83-59" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb83-60"><a href="#cb83-60" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-61"><a href="#cb83-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb83-62"><a href="#cb83-62" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb83-63"><a href="#cb83-63" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb83-64"><a href="#cb83-64" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-65"><a href="#cb83-65" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-66"><a href="#cb83-66" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb83-67"><a href="#cb83-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-68"><a href="#cb83-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb83-69"><a href="#cb83-69" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb83-70"><a href="#cb83-70" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb83-71"><a href="#cb83-71" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb83-72"><a href="#cb83-72" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb83-73"><a href="#cb83-73" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb83-74"><a href="#cb83-74" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb83-75"><a href="#cb83-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-76"><a href="#cb83-76" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb83-77"><a href="#cb83-77" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-78"><a href="#cb83-78" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb83-79"><a href="#cb83-79" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-80"><a href="#cb83-80" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb83-81"><a href="#cb83-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-82"><a href="#cb83-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb83-83"><a href="#cb83-83" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb83-84"><a href="#cb83-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-85"><a href="#cb83-85" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb83-86"><a href="#cb83-86" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-87"><a href="#cb83-87" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb83-88"><a href="#cb83-88" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-89"><a href="#cb83-89" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb83-90"><a href="#cb83-90" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb83-91"><a href="#cb83-91" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb83-92"><a href="#cb83-92" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb83-93"><a href="#cb83-93" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-94"><a href="#cb83-94" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb83-95"><a href="#cb83-95" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-96"><a href="#cb83-96" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb83-97"><a href="#cb83-97" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-98"><a href="#cb83-98" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb83-99"><a href="#cb83-99" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb83-100"><a href="#cb83-100" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb83-101"><a href="#cb83-101" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb83-102"><a href="#cb83-102" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-103"><a href="#cb83-103" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb83-104"><a href="#cb83-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-105"><a href="#cb83-105" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb83-106"><a href="#cb83-106" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-107"><a href="#cb83-107" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb83-108"><a href="#cb83-108" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb83-109"><a href="#cb83-109" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-110"><a href="#cb83-110" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb83-111"><a href="#cb83-111" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb83-112"><a href="#cb83-112" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb83-113"><a href="#cb83-113" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-114"><a href="#cb83-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb83-115"><a href="#cb83-115" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-116"><a href="#cb83-116" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb83-117"><a href="#cb83-117" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb83-118"><a href="#cb83-118" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb83-119"><a href="#cb83-119" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb83-120"><a href="#cb83-120" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb83-121"><a href="#cb83-121" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb83-122"><a href="#cb83-122" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb83-123"><a href="#cb83-123" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-124"><a href="#cb83-124" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb83-125"><a href="#cb83-125" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-126"><a href="#cb83-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb83-127"><a href="#cb83-127" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-128"><a href="#cb83-128" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb83-129"><a href="#cb83-129" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-130"><a href="#cb83-130" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb83-131"><a href="#cb83-131" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb83-132"><a href="#cb83-132" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb83-133"><a href="#cb83-133" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb83-134"><a href="#cb83-134" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb83-135"><a href="#cb83-135" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb83-136"><a href="#cb83-136" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb83-137"><a href="#cb83-137" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb83-138"><a href="#cb83-138" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb83-139"><a href="#cb83-139" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb83-140"><a href="#cb83-140" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb83-141"><a href="#cb83-141" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb83-142"><a href="#cb83-142" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb83-143"><a href="#cb83-143" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-144"><a href="#cb83-144" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb83-145"><a href="#cb83-145" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-146"><a href="#cb83-146" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb83-147"><a href="#cb83-147" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb83-148"><a href="#cb83-148" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb83-149"><a href="#cb83-149" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb83-150"><a href="#cb83-150" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb83-151"><a href="#cb83-151" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb83-152"><a href="#cb83-152" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-153"><a href="#cb83-153" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb83-154"><a href="#cb83-154" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-155"><a href="#cb83-155" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb83-156"><a href="#cb83-156" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb83-157"><a href="#cb83-157" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb83-158"><a href="#cb83-158" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-159"><a href="#cb83-159" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb83-160"><a href="#cb83-160" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb83-161"><a href="#cb83-161" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb83-162"><a href="#cb83-162" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-163"><a href="#cb83-163" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb83-164"><a href="#cb83-164" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb83-165"><a href="#cb83-165" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb83-166"><a href="#cb83-166" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb83-167"><a href="#cb83-167" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-168"><a href="#cb83-168" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb83-169"><a href="#cb83-169" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-170"><a href="#cb83-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb83-171"><a href="#cb83-171" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb83-172"><a href="#cb83-172" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb83-173"><a href="#cb83-173" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb83-174"><a href="#cb83-174" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb83-175"><a href="#cb83-175" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb83-176"><a href="#cb83-176" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb83-177"><a href="#cb83-177" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-178"><a href="#cb83-178" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb83-179"><a href="#cb83-179" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-180"><a href="#cb83-180" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb83-181"><a href="#cb83-181" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-182"><a href="#cb83-182" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-183"><a href="#cb83-183" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-184"><a href="#cb83-184" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb83-185"><a href="#cb83-185" aria-hidden="true" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb83-186"><a href="#cb83-186" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-187"><a href="#cb83-187" aria-hidden="true" tabindex="-1"></a> Yp2 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0 0 0 0</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for (l in 2:5) {</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    l <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>      T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>      T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>      T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>      T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>      T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>      T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>      M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>      dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a>                         <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a>                         <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb85-53"><a href="#cb85-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T1</span></span>
<span id="cb85-54"><a href="#cb85-54" aria-hidden="true" tabindex="-1"></a>      dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb85-55"><a href="#cb85-55" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb85-56"><a href="#cb85-56" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb85-57"><a href="#cb85-57" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb85-58"><a href="#cb85-58" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb85-59"><a href="#cb85-59" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb85-60"><a href="#cb85-60" aria-hidden="true" tabindex="-1"></a>      T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb85-61"><a href="#cb85-61" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-62"><a href="#cb85-62" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T2</span></span>
<span id="cb85-63"><a href="#cb85-63" aria-hidden="true" tabindex="-1"></a>      dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb85-64"><a href="#cb85-64" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb85-65"><a href="#cb85-65" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb85-66"><a href="#cb85-66" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb85-67"><a href="#cb85-67" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb85-68"><a href="#cb85-68" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb85-69"><a href="#cb85-69" aria-hidden="true" tabindex="-1"></a>      T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb85-70"><a href="#cb85-70" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-71"><a href="#cb85-71" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T3</span></span>
<span id="cb85-72"><a href="#cb85-72" aria-hidden="true" tabindex="-1"></a>      dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb85-73"><a href="#cb85-73" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb85-74"><a href="#cb85-74" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb85-75"><a href="#cb85-75" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb85-76"><a href="#cb85-76" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb85-77"><a href="#cb85-77" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb85-78"><a href="#cb85-78" aria-hidden="true" tabindex="-1"></a>      T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb85-79"><a href="#cb85-79" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-80"><a href="#cb85-80" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-81"><a href="#cb85-81" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb85-82"><a href="#cb85-82" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb85-83"><a href="#cb85-83" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-84"><a href="#cb85-84" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb85-85"><a href="#cb85-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb85-86"><a href="#cb85-86" aria-hidden="true" tabindex="-1"></a>        dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb85-87"><a href="#cb85-87" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb85-88"><a href="#cb85-88" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb85-89"><a href="#cb85-89" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb85-90"><a href="#cb85-90" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb85-91"><a href="#cb85-91" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb85-92"><a href="#cb85-92" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb85-93"><a href="#cb85-93" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-94"><a href="#cb85-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb85-95"><a href="#cb85-95" aria-hidden="true" tabindex="-1"></a>        dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb85-96"><a href="#cb85-96" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb85-97"><a href="#cb85-97" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb85-98"><a href="#cb85-98" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb85-99"><a href="#cb85-99" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb85-100"><a href="#cb85-100" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb85-101"><a href="#cb85-101" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb85-102"><a href="#cb85-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-103"><a href="#cb85-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb85-104"><a href="#cb85-104" aria-hidden="true" tabindex="-1"></a>        dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb85-105"><a href="#cb85-105" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb85-106"><a href="#cb85-106" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb85-107"><a href="#cb85-107" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb85-108"><a href="#cb85-108" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb85-109"><a href="#cb85-109" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb85-110"><a href="#cb85-110" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb85-111"><a href="#cb85-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-112"><a href="#cb85-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-113"><a href="#cb85-113" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb85-114"><a href="#cb85-114" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb85-115"><a href="#cb85-115" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb85-116"><a href="#cb85-116" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb85-117"><a href="#cb85-117" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb85-118"><a href="#cb85-118" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb85-119"><a href="#cb85-119" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-120"><a href="#cb85-120" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb85-121"><a href="#cb85-121" aria-hidden="true" tabindex="-1"></a>      dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb85-122"><a href="#cb85-122" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb85-123"><a href="#cb85-123" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb85-124"><a href="#cb85-124" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb85-125"><a href="#cb85-125" aria-hidden="true" tabindex="-1"></a>                        <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb85-126"><a href="#cb85-126" aria-hidden="true" tabindex="-1"></a>      Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb85-127"><a href="#cb85-127" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb85-128"><a href="#cb85-128" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb85-129"><a href="#cb85-129" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb85-130"><a href="#cb85-130" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb85-131"><a href="#cb85-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-132"><a href="#cb85-132" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb85-133"><a href="#cb85-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-134"><a href="#cb85-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb85-135"><a href="#cb85-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-136"><a href="#cb85-136" aria-hidden="true" tabindex="-1"></a>Yp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0 0 0 0</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="predict-đến-length" class="level2">
<h2 class="anchored" data-anchor-id="predict-đến-length">predict đến length</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>package code</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>) {</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb87-57"><a href="#cb87-57" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb87-58"><a href="#cb87-58" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb87-59"><a href="#cb87-59" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb87-60"><a href="#cb87-60" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb87-61"><a href="#cb87-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb87-62"><a href="#cb87-62" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb87-63"><a href="#cb87-63" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb87-64"><a href="#cb87-64" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-65"><a href="#cb87-65" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-66"><a href="#cb87-66" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb87-67"><a href="#cb87-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-68"><a href="#cb87-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb87-69"><a href="#cb87-69" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb87-70"><a href="#cb87-70" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb87-71"><a href="#cb87-71" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb87-72"><a href="#cb87-72" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb87-73"><a href="#cb87-73" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb87-74"><a href="#cb87-74" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb87-75"><a href="#cb87-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-76"><a href="#cb87-76" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb87-77"><a href="#cb87-77" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-78"><a href="#cb87-78" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb87-79"><a href="#cb87-79" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-80"><a href="#cb87-80" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb87-81"><a href="#cb87-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-82"><a href="#cb87-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb87-83"><a href="#cb87-83" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb87-84"><a href="#cb87-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-85"><a href="#cb87-85" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb87-86"><a href="#cb87-86" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-87"><a href="#cb87-87" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb87-88"><a href="#cb87-88" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-89"><a href="#cb87-89" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb87-90"><a href="#cb87-90" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb87-91"><a href="#cb87-91" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb87-92"><a href="#cb87-92" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb87-93"><a href="#cb87-93" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-94"><a href="#cb87-94" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb87-95"><a href="#cb87-95" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-96"><a href="#cb87-96" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb87-97"><a href="#cb87-97" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-98"><a href="#cb87-98" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb87-99"><a href="#cb87-99" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb87-100"><a href="#cb87-100" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb87-101"><a href="#cb87-101" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb87-102"><a href="#cb87-102" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-103"><a href="#cb87-103" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb87-104"><a href="#cb87-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-105"><a href="#cb87-105" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb87-106"><a href="#cb87-106" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-107"><a href="#cb87-107" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb87-108"><a href="#cb87-108" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb87-109"><a href="#cb87-109" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb87-110"><a href="#cb87-110" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb87-111"><a href="#cb87-111" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb87-112"><a href="#cb87-112" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb87-113"><a href="#cb87-113" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-114"><a href="#cb87-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb87-115"><a href="#cb87-115" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-116"><a href="#cb87-116" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb87-117"><a href="#cb87-117" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb87-118"><a href="#cb87-118" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb87-119"><a href="#cb87-119" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb87-120"><a href="#cb87-120" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb87-121"><a href="#cb87-121" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb87-122"><a href="#cb87-122" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb87-123"><a href="#cb87-123" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-124"><a href="#cb87-124" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb87-125"><a href="#cb87-125" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-126"><a href="#cb87-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb87-127"><a href="#cb87-127" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-128"><a href="#cb87-128" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb87-129"><a href="#cb87-129" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-130"><a href="#cb87-130" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb87-131"><a href="#cb87-131" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb87-132"><a href="#cb87-132" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb87-133"><a href="#cb87-133" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb87-134"><a href="#cb87-134" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb87-135"><a href="#cb87-135" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb87-136"><a href="#cb87-136" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb87-137"><a href="#cb87-137" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb87-138"><a href="#cb87-138" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb87-139"><a href="#cb87-139" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb87-140"><a href="#cb87-140" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb87-141"><a href="#cb87-141" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb87-142"><a href="#cb87-142" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb87-143"><a href="#cb87-143" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-144"><a href="#cb87-144" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb87-145"><a href="#cb87-145" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-146"><a href="#cb87-146" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb87-147"><a href="#cb87-147" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb87-148"><a href="#cb87-148" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb87-149"><a href="#cb87-149" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb87-150"><a href="#cb87-150" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb87-151"><a href="#cb87-151" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb87-152"><a href="#cb87-152" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb87-153"><a href="#cb87-153" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb87-154"><a href="#cb87-154" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-155"><a href="#cb87-155" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb87-156"><a href="#cb87-156" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb87-157"><a href="#cb87-157" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb87-158"><a href="#cb87-158" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-159"><a href="#cb87-159" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb87-160"><a href="#cb87-160" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb87-161"><a href="#cb87-161" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb87-162"><a href="#cb87-162" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb87-163"><a href="#cb87-163" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb87-164"><a href="#cb87-164" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb87-165"><a href="#cb87-165" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb87-166"><a href="#cb87-166" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb87-167"><a href="#cb87-167" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-168"><a href="#cb87-168" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb87-169"><a href="#cb87-169" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-170"><a href="#cb87-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb87-171"><a href="#cb87-171" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb87-172"><a href="#cb87-172" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb87-173"><a href="#cb87-173" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb87-174"><a href="#cb87-174" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb87-175"><a href="#cb87-175" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb87-176"><a href="#cb87-176" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb87-177"><a href="#cb87-177" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-178"><a href="#cb87-178" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb87-179"><a href="#cb87-179" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-180"><a href="#cb87-180" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb87-181"><a href="#cb87-181" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb87-182"><a href="#cb87-182" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb87-183"><a href="#cb87-183" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-184"><a href="#cb87-184" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb87-185"><a href="#cb87-185" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb87-186"><a href="#cb87-186" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-187"><a href="#cb87-187" aria-hidden="true" tabindex="-1"></a> Yp2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0 0 0 0 0 1</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">colnames</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lmp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Lp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num &lt;- seed</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  gdat2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, Mp, Yp2,</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>                     Lmp, Lp, Vp)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  gdat2<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat2<span class="sc">$</span>id, <span class="at">fromLast =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div><div class="column" style="width:50%;">
<p>a Long code</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>) {</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>      T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>      T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>      T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>      T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>      T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>      T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>      M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>      dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>                         <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>                         <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T1</span></span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a>      dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb90-59"><a href="#cb90-59" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a>      T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-62"><a href="#cb90-62" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T2</span></span>
<span id="cb90-63"><a href="#cb90-63" aria-hidden="true" tabindex="-1"></a>      dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb90-64"><a href="#cb90-64" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb90-65"><a href="#cb90-65" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb90-66"><a href="#cb90-66" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb90-67"><a href="#cb90-67" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb90-68"><a href="#cb90-68" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb90-69"><a href="#cb90-69" aria-hidden="true" tabindex="-1"></a>      T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb90-70"><a href="#cb90-70" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-71"><a href="#cb90-71" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T3</span></span>
<span id="cb90-72"><a href="#cb90-72" aria-hidden="true" tabindex="-1"></a>      dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb90-73"><a href="#cb90-73" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb90-74"><a href="#cb90-74" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb90-75"><a href="#cb90-75" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb90-76"><a href="#cb90-76" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb90-77"><a href="#cb90-77" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb90-78"><a href="#cb90-78" aria-hidden="true" tabindex="-1"></a>      T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb90-79"><a href="#cb90-79" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-80"><a href="#cb90-80" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-81"><a href="#cb90-81" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb90-82"><a href="#cb90-82" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb90-83"><a href="#cb90-83" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-84"><a href="#cb90-84" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb90-85"><a href="#cb90-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb90-86"><a href="#cb90-86" aria-hidden="true" tabindex="-1"></a>        dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb90-87"><a href="#cb90-87" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb90-88"><a href="#cb90-88" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb90-89"><a href="#cb90-89" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb90-90"><a href="#cb90-90" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb90-91"><a href="#cb90-91" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb90-92"><a href="#cb90-92" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb90-93"><a href="#cb90-93" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-94"><a href="#cb90-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb90-95"><a href="#cb90-95" aria-hidden="true" tabindex="-1"></a>        dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb90-96"><a href="#cb90-96" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb90-97"><a href="#cb90-97" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb90-98"><a href="#cb90-98" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb90-99"><a href="#cb90-99" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb90-100"><a href="#cb90-100" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb90-101"><a href="#cb90-101" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb90-102"><a href="#cb90-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-103"><a href="#cb90-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb90-104"><a href="#cb90-104" aria-hidden="true" tabindex="-1"></a>        dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb90-105"><a href="#cb90-105" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb90-106"><a href="#cb90-106" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb90-107"><a href="#cb90-107" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb90-108"><a href="#cb90-108" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb90-109"><a href="#cb90-109" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb90-110"><a href="#cb90-110" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb90-111"><a href="#cb90-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-112"><a href="#cb90-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-113"><a href="#cb90-113" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb90-114"><a href="#cb90-114" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb90-115"><a href="#cb90-115" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb90-116"><a href="#cb90-116" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb90-117"><a href="#cb90-117" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb90-118"><a href="#cb90-118" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-119"><a href="#cb90-119" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-120"><a href="#cb90-120" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb90-121"><a href="#cb90-121" aria-hidden="true" tabindex="-1"></a>      dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb90-122"><a href="#cb90-122" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb90-123"><a href="#cb90-123" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb90-124"><a href="#cb90-124" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb90-125"><a href="#cb90-125" aria-hidden="true" tabindex="-1"></a>                        <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb90-126"><a href="#cb90-126" aria-hidden="true" tabindex="-1"></a>      Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb90-127"><a href="#cb90-127" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb90-128"><a href="#cb90-128" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb90-129"><a href="#cb90-129" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb90-130"><a href="#cb90-130" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-131"><a href="#cb90-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-132"><a href="#cb90-132" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb90-133"><a href="#cb90-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-134"><a href="#cb90-134" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-135"><a href="#cb90-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-136"><a href="#cb90-136" aria-hidden="true" tabindex="-1"></a>Yp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 0 0 0 0 0 0 0 0 0 1</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># boot_num &lt;- seed</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a> gdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, M1p, Yp,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                     T1mp, T1p, T2mp, T2p, T3mp, T3p, Vp)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  gdat<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat<span class="sc">$</span>id, <span class="at">fromLast =</span> T)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
<section id="output-4" class="level2">
<h2 class="anchored" data-anchor-id="output-4">output</h2>
<p>Theo output này thì các biến dùng để fit model Y ở time thứ 7 ở 2 code đều giống nhau. Nhưng predict lại ra khác nhau. Em nghĩ vì pFunc có runif() nên xác xuất ra khác nhau. Và thêm 1 phần là khi mình set am != ay thì các biến Lp của mình khác với các biến Lmp nên predict dễ gây sự khác nhau trong việc predict &gt; runif(1) hơn so với khi am == ay thì Lp &lt;- Lmp.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>gdat2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  id id_ori mm Ay Am M1 Yp2 Lmp1     Lmp2     Lmp3 Lp1      Lp2       Lp3
1  2      6  1  0  1  0   0    0 100.0000 80.00000   0 100.0000  80.00000
2  2      6  2  0  1  1   0    1 109.2691 86.67002   0 117.3313  94.66629
3  2      6  3  0  1  1   0    0 113.0204 87.40802   0 119.9078  97.82790
4  2      6  4  0  1  1   0    0 112.0796 89.11429   0 120.6063  98.89958
5  2      6  5  0  1  1   0    0 110.6218 89.29994   0 122.1934 100.40023
6  2      6  6  0  1  1   0    0 111.2710 90.01439   0 123.5688 101.71747
7  2      6  7  0  1  1   0    0 112.0467 90.79845   0 124.8438 102.92888
8  2      6  8  0  1  1   1    0 112.9227 91.65432   0 125.9341 103.96793
         v1 v2 v3 v4 lastid
1 0.1226858  0  0  1      0
2 0.1226858  0  0  1      0
3 0.1226858  0  0  1      0
4 0.1226858  0  0  1      0
5 0.1226858  0  0  1      0
6 0.1226858  0  0  1      0
7 0.1226858  0  0  1      0
8 0.1226858  0  0  1      1</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>gdat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id id_ori mm Ay Am M1p Yp T1mp T1p     T2mp      T2p     T3mp       T3p
1   2      6  1  0  1   0  0    0   0 100.0000 100.0000 80.00000  80.00000
2   2      6  2  0  1   1  0    1   0 109.2691 117.3313 86.67002  94.66629
3   2      6  3  0  1   1  0    0   0 113.0204 119.9078 87.40802  97.82790
4   2      6  4  0  1   1  0    0   0 112.0796 120.6063 89.11429  98.89958
5   2      6  5  0  1   1  0    0   0 110.6218 122.1934 89.29994 100.40023
6   2      6  6  0  1   1  0    0   0 111.2710 123.5688 90.01439 101.71747
7   2      6  7  0  1   1  0    0   0 112.0467 124.8438 90.79845 102.92888
8   2      6  8  0  1   1  0    0   0 112.9227 125.9341 91.65432 103.96793
9   2      6  9  0  1   1  0    0   0 113.7151 126.8413 92.42541 104.83566
10  2      6 10  0  1   1  0    0   0 114.3841 127.5653 93.07686 105.53357
11  2      6 11  0  1   1  1    0   0 114.9071 128.1159 93.59106 106.07117
          v1 v2 v3 v4 lastid
1  0.1226858  0  0  1      0
2  0.1226858  0  0  1      0
3  0.1226858  0  0  1      0
4  0.1226858  0  0  1      0
5  0.1226858  0  0  1      0
6  0.1226858  0  0  1      0
7  0.1226858  0  0  1      0
8  0.1226858  0  0  1      0
9  0.1226858  0  0  1      0
10 0.1226858  0  0  1      0
11 0.1226858  0  0  1      1</code></pre>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="function-bự-tvmedg" class="level1">
<h1>Function bự (tvmedg)</h1>
<section id="tvmedg" class="level2">
<h2 class="anchored" data-anchor-id="tvmedg">tvmedg</h2>
<p>bước đầu em setup ở ii = 2 để chạy so với g_boot của anh Long</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>tvmedg <span class="ot">&lt;-</span> <span class="cf">function</span>(data,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>                   fix,expo,med,tvar,lag,outc,time,<span class="at">norev =</span> <span class="cn">NULL</span>,<span class="at">LM =</span> <span class="cn">FALSE</span>,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bootstr =</span> <span class="cn">FALSE</span>, <span class="at">seed =</span> <span class="dv">0</span>,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>,</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">montecarlo =</span> <span class="dv">10000</span>,<span class="at">length =</span> <span class="dv">12</span>,<span class="at">parallel=</span><span class="cn">TRUE</span>){</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>  fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix =</span> fix,</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">expo =</span> expo,</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> med,</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvar =</span> tvar,</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">outc =</span> outc,</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag =</span> lag,</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> time,</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">norev =</span> norev,</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">LM =</span> LM,</span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data</span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fitg</span>(<span class="at">bootstr=</span>bootstr,</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">mreg =</span> mreg,</span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">lreg =</span> lreg,</span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">yreg =</span> yreg,<span class="at">dof =</span> dof) <span class="sc">%&gt;%</span> </span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> montecarlo)</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>    outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>,<span class="at">data=</span>fitR2, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>)</span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>    outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>,<span class="at">data=</span>fitR2, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>    outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>,<span class="at">data=</span>fitR2, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(outdat11, outdat10, outdat00)</span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="g_boot" class="level2">
<h2 class="anchored" data-anchor-id="g_boot">g_boot</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>g_boot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">montecarlo =</span> <span class="dv">0</span>, <span class="at">seed =</span> <span class="dv">0</span>,<span class="at">boostr =</span> F) { </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"g-formula for single mediator"</span>,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">df_prep</span>(<span class="at">data =</span> data)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Running SEED"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Resampling Data"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Resampling based on id and store in `boot` dataset</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(df<span class="sc">$</span>id))</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters), <span class="fu">length</span>(clusters), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters[index])</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  boot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(boostr <span class="sc">==</span> F) {</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># not doing bootstrap</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>    boot <span class="ot">&lt;-</span> df </span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loop over repeated id</span></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>id, zzz)</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>      boot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(boot, cc)</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check boot data</span></span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Resampled data identical to original for seed ="</span>, seed, <span class="st">"?:"</span>, <span class="fu">identical</span>(boot, df),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Centering and scaling the time-scale variable</span></span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>  boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">scale</span>(boot<span class="sc">$</span>j)</span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>  mean_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>  sd_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>  boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(boot<span class="sc">$</span>jj)</span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#----- fit parametric models for</span></span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Mediator models</span></span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a>  mM1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a>    fitM1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(M1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb98-47"><a href="#cb98-47" aria-hidden="true" tabindex="-1"></a>                   v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb98-48"><a href="#cb98-48" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb98-49"><a href="#cb98-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fitM1)</span>
<span id="cb98-50"><a href="#cb98-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-51"><a href="#cb98-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-52"><a href="#cb98-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PseudoR2(fitM1)</span></span>
<span id="cb98-53"><a href="#cb98-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Covariate models</span></span>
<span id="cb98-54"><a href="#cb98-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-55"><a href="#cb98-55" aria-hidden="true" tabindex="-1"></a>  mT1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb98-56"><a href="#cb98-56" aria-hidden="true" tabindex="-1"></a>    fitT1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(T1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb98-57"><a href="#cb98-57" aria-hidden="true" tabindex="-1"></a>                   v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb98-58"><a href="#cb98-58" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb98-59"><a href="#cb98-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fitT1)</span>
<span id="cb98-60"><a href="#cb98-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-61"><a href="#cb98-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-62"><a href="#cb98-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PseudoR2(fitT1)</span></span>
<span id="cb98-63"><a href="#cb98-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-64"><a href="#cb98-64" aria-hidden="true" tabindex="-1"></a>  mT2 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb98-65"><a href="#cb98-65" aria-hidden="true" tabindex="-1"></a>    fitT2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T2 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb98-66"><a href="#cb98-66" aria-hidden="true" tabindex="-1"></a>                  v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb98-67"><a href="#cb98-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fitT2)</span>
<span id="cb98-68"><a href="#cb98-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-69"><a href="#cb98-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-70"><a href="#cb98-70" aria-hidden="true" tabindex="-1"></a>  mT3 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb98-71"><a href="#cb98-71" aria-hidden="true" tabindex="-1"></a>    fitT3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T3 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb98-72"><a href="#cb98-72" aria-hidden="true" tabindex="-1"></a>                  v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb98-73"><a href="#cb98-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fitT3)</span>
<span id="cb98-74"><a href="#cb98-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-75"><a href="#cb98-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-76"><a href="#cb98-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Outcome model: E(Y|a, m, l, v)</span></span>
<span id="cb98-77"><a href="#cb98-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-78"><a href="#cb98-78" aria-hidden="true" tabindex="-1"></a>  mY <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb98-79"><a href="#cb98-79" aria-hidden="true" tabindex="-1"></a>    fitY <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> </span>
<span id="cb98-80"><a href="#cb98-80" aria-hidden="true" tabindex="-1"></a>                  T3 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span>  v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb98-81"><a href="#cb98-81" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb98-82"><a href="#cb98-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fitY)</span>
<span id="cb98-83"><a href="#cb98-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-84"><a href="#cb98-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-85"><a href="#cb98-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PseudoR2(fitY)</span></span>
<span id="cb98-86"><a href="#cb98-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-87"><a href="#cb98-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit all models and save in a list</span></span>
<span id="cb98-88"><a href="#cb98-88" aria-hidden="true" tabindex="-1"></a>  mR <span class="ot">&lt;-</span> <span class="fu">c</span>(mM1, mY, mT1, mT2, mT3)</span>
<span id="cb98-89"><a href="#cb98-89" aria-hidden="true" tabindex="-1"></a>  fitR <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="cf">function</span>(x) mR[[x]](k))</span>
<span id="cb98-90"><a href="#cb98-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-91"><a href="#cb98-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-92"><a href="#cb98-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-93"><a href="#cb98-93" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select baseline visit</span></span>
<span id="cb98-94"><a href="#cb98-94" aria-hidden="true" tabindex="-1"></a>  df0 <span class="ot">&lt;-</span> boot[boot<span class="sc">$</span>j<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb98-95"><a href="#cb98-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-96"><a href="#cb98-96" aria-hidden="true" tabindex="-1"></a>  df0<span class="sc">$</span>idn <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df0)</span>
<span id="cb98-97"><a href="#cb98-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-98"><a href="#cb98-98" aria-hidden="true" tabindex="-1"></a>  MC <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb98-99"><a href="#cb98-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-100"><a href="#cb98-100" aria-hidden="true" tabindex="-1"></a>    samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(df0<span class="sc">$</span>idn, <span class="at">size =</span> montecarlo, <span class="at">replace =</span> T)</span>
<span id="cb98-101"><a href="#cb98-101" aria-hidden="true" tabindex="-1"></a>    bb <span class="ot">&lt;-</span> <span class="fu">table</span>(samples)</span>
<span id="cb98-102"><a href="#cb98-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-103"><a href="#cb98-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb98-104"><a href="#cb98-104" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df0[df0<span class="sc">$</span>idn <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb98-105"><a href="#cb98-105" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>idn, zzz)</span>
<span id="cb98-106"><a href="#cb98-106" aria-hidden="true" tabindex="-1"></a>      MC <span class="ot">&lt;-</span> <span class="fu">rbind</span>(MC, cc)</span>
<span id="cb98-107"><a href="#cb98-107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb98-108"><a href="#cb98-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-109"><a href="#cb98-109" aria-hidden="true" tabindex="-1"></a>    MC<span class="sc">$</span>idsim <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>montecarlo</span>
<span id="cb98-110"><a href="#cb98-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-111"><a href="#cb98-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-112"><a href="#cb98-112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pgf function for predicting follow-up</span></span>
<span id="cb98-113"><a href="#cb98-113" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-----------------------------------------------------------------------------</span></span>
<span id="cb98-114"><a href="#cb98-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-115"><a href="#cb98-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-116"><a href="#cb98-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pgf function</span></span>
<span id="cb98-117"><a href="#cb98-117" aria-hidden="true" tabindex="-1"></a>  gform <span class="ot">&lt;-</span> <span class="cf">function</span>(ii, pgdat, length, am, ay) {</span>
<span id="cb98-118"><a href="#cb98-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-119"><a href="#cb98-119" aria-hidden="true" tabindex="-1"></a>    pFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb98-120"><a href="#cb98-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> <span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb98-121"><a href="#cb98-121" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb98-122"><a href="#cb98-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-123"><a href="#cb98-123" aria-hidden="true" tabindex="-1"></a>    rFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb98-124"><a href="#cb98-124" aria-hidden="true" tabindex="-1"></a>      pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb98-125"><a href="#cb98-125" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_prob))</span>
<span id="cb98-126"><a href="#cb98-126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb98-127"><a href="#cb98-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-128"><a href="#cb98-128" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> pgdat</span>
<span id="cb98-129"><a href="#cb98-129" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> d[d<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb98-130"><a href="#cb98-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-131"><a href="#cb98-131" aria-hidden="true" tabindex="-1"></a>    id <span class="ot">&lt;-</span> d<span class="sc">$</span>idsim</span>
<span id="cb98-132"><a href="#cb98-132" aria-hidden="true" tabindex="-1"></a>    id_ori <span class="ot">&lt;-</span> d<span class="sc">$</span>id</span>
<span id="cb98-133"><a href="#cb98-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-134"><a href="#cb98-134" aria-hidden="true" tabindex="-1"></a>    length <span class="ot">&lt;-</span> length</span>
<span id="cb98-135"><a href="#cb98-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-136"><a href="#cb98-136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-137"><a href="#cb98-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cat("...", paste0(ii, "(", id_ori, ")"))</span></span>
<span id="cb98-138"><a href="#cb98-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-139"><a href="#cb98-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-140"><a href="#cb98-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-141"><a href="#cb98-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Baseline covariates</span></span>
<span id="cb98-142"><a href="#cb98-142" aria-hidden="true" tabindex="-1"></a>    Vp <span class="ot">&lt;-</span> d[, <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>, <span class="st">"v3"</span>, <span class="st">"v4"</span>)]</span>
<span id="cb98-143"><a href="#cb98-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-144"><a href="#cb98-144" aria-hidden="true" tabindex="-1"></a>    T1p <span class="ot">&lt;-</span> T2p <span class="ot">&lt;-</span> T3p  <span class="ot">&lt;-</span> M1p <span class="ot">&lt;-</span> Yp <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb98-145"><a href="#cb98-145" aria-hidden="true" tabindex="-1"></a>    T1mp <span class="ot">&lt;-</span> T2mp <span class="ot">&lt;-</span> T3mp <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb98-146"><a href="#cb98-146" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-147"><a href="#cb98-147" aria-hidden="true" tabindex="-1"></a>    mm[<span class="dv">1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb98-148"><a href="#cb98-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-149"><a href="#cb98-149" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-150"><a href="#cb98-150" aria-hidden="true" tabindex="-1"></a>    M1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb98-151"><a href="#cb98-151" aria-hidden="true" tabindex="-1"></a>    Yp[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb98-152"><a href="#cb98-152" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-153"><a href="#cb98-153" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time-varying covariates contribute to outcome model</span></span>
<span id="cb98-154"><a href="#cb98-154" aria-hidden="true" tabindex="-1"></a>    T1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb98-155"><a href="#cb98-155" aria-hidden="true" tabindex="-1"></a>    T2p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb98-156"><a href="#cb98-156" aria-hidden="true" tabindex="-1"></a>    T3p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb98-157"><a href="#cb98-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-158"><a href="#cb98-158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time-varying covariates contribute to mediator model</span></span>
<span id="cb98-159"><a href="#cb98-159" aria-hidden="true" tabindex="-1"></a>    T1mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb98-160"><a href="#cb98-160" aria-hidden="true" tabindex="-1"></a>    T2mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb98-161"><a href="#cb98-161" aria-hidden="true" tabindex="-1"></a>    T3mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb98-162"><a href="#cb98-162" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-163"><a href="#cb98-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-164"><a href="#cb98-164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>length) {</span>
<span id="cb98-165"><a href="#cb98-165" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb98-166"><a href="#cb98-166" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb98-167"><a href="#cb98-167" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-168"><a href="#cb98-168" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb98-169"><a href="#cb98-169" aria-hidden="true" tabindex="-1"></a>          T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb98-170"><a href="#cb98-170" aria-hidden="true" tabindex="-1"></a>          T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb98-171"><a href="#cb98-171" aria-hidden="true" tabindex="-1"></a>          T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb98-172"><a href="#cb98-172" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb98-173"><a href="#cb98-173" aria-hidden="true" tabindex="-1"></a>          T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb98-174"><a href="#cb98-174" aria-hidden="true" tabindex="-1"></a>          T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb98-175"><a href="#cb98-175" aria-hidden="true" tabindex="-1"></a>          T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb98-176"><a href="#cb98-176" aria-hidden="true" tabindex="-1"></a>          M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb98-177"><a href="#cb98-177" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb98-178"><a href="#cb98-178" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb98-179"><a href="#cb98-179" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb98-180"><a href="#cb98-180" aria-hidden="true" tabindex="-1"></a>          T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb98-181"><a href="#cb98-181" aria-hidden="true" tabindex="-1"></a>          T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb98-182"><a href="#cb98-182" aria-hidden="true" tabindex="-1"></a>          T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb98-183"><a href="#cb98-183" aria-hidden="true" tabindex="-1"></a>          T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb98-184"><a href="#cb98-184" aria-hidden="true" tabindex="-1"></a>          T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb98-185"><a href="#cb98-185" aria-hidden="true" tabindex="-1"></a>          T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb98-186"><a href="#cb98-186" aria-hidden="true" tabindex="-1"></a>          M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb98-187"><a href="#cb98-187" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb98-188"><a href="#cb98-188" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb98-189"><a href="#cb98-189" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-190"><a href="#cb98-190" aria-hidden="true" tabindex="-1"></a>        T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb98-191"><a href="#cb98-191" aria-hidden="true" tabindex="-1"></a>        T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb98-192"><a href="#cb98-192" aria-hidden="true" tabindex="-1"></a>        T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb98-193"><a href="#cb98-193" aria-hidden="true" tabindex="-1"></a>        T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb98-194"><a href="#cb98-194" aria-hidden="true" tabindex="-1"></a>        T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb98-195"><a href="#cb98-195" aria-hidden="true" tabindex="-1"></a>        T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb98-196"><a href="#cb98-196" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-197"><a href="#cb98-197" aria-hidden="true" tabindex="-1"></a>        M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb98-198"><a href="#cb98-198" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-199"><a href="#cb98-199" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-200"><a href="#cb98-200" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-201"><a href="#cb98-201" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict mediator</span></span>
<span id="cb98-202"><a href="#cb98-202" aria-hidden="true" tabindex="-1"></a>        dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb98-203"><a href="#cb98-203" aria-hidden="true" tabindex="-1"></a>                           <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb98-204"><a href="#cb98-204" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb98-205"><a href="#cb98-205" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-206"><a href="#cb98-206" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb98-207"><a href="#cb98-207" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb98-208"><a href="#cb98-208" aria-hidden="true" tabindex="-1"></a>          M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb98-209"><a href="#cb98-209" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb98-210"><a href="#cb98-210" aria-hidden="true" tabindex="-1"></a>          M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb98-211"><a href="#cb98-211" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb98-212"><a href="#cb98-212" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-213"><a href="#cb98-213" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-214"><a href="#cb98-214" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-215"><a href="#cb98-215" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb98-216"><a href="#cb98-216" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb98-217"><a href="#cb98-217" aria-hidden="true" tabindex="-1"></a>        dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb98-218"><a href="#cb98-218" aria-hidden="true" tabindex="-1"></a>                            <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb98-219"><a href="#cb98-219" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb98-220"><a href="#cb98-220" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb98-221"><a href="#cb98-221" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb98-222"><a href="#cb98-222" aria-hidden="true" tabindex="-1"></a>                            <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb98-223"><a href="#cb98-223" aria-hidden="true" tabindex="-1"></a>        T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb98-224"><a href="#cb98-224" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-225"><a href="#cb98-225" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb98-226"><a href="#cb98-226" aria-hidden="true" tabindex="-1"></a>        dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb98-227"><a href="#cb98-227" aria-hidden="true" tabindex="-1"></a>                            <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb98-228"><a href="#cb98-228" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb98-229"><a href="#cb98-229" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb98-230"><a href="#cb98-230" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb98-231"><a href="#cb98-231" aria-hidden="true" tabindex="-1"></a>                            <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb98-232"><a href="#cb98-232" aria-hidden="true" tabindex="-1"></a>        T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb98-233"><a href="#cb98-233" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-234"><a href="#cb98-234" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb98-235"><a href="#cb98-235" aria-hidden="true" tabindex="-1"></a>        dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb98-236"><a href="#cb98-236" aria-hidden="true" tabindex="-1"></a>                            <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb98-237"><a href="#cb98-237" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb98-238"><a href="#cb98-238" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb98-239"><a href="#cb98-239" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb98-240"><a href="#cb98-240" aria-hidden="true" tabindex="-1"></a>                            <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb98-241"><a href="#cb98-241" aria-hidden="true" tabindex="-1"></a>        T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb98-242"><a href="#cb98-242" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-243"><a href="#cb98-243" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-244"><a href="#cb98-244" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb98-245"><a href="#cb98-245" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb98-246"><a href="#cb98-246" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-247"><a href="#cb98-247" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb98-248"><a href="#cb98-248" aria-hidden="true" tabindex="-1"></a>          <span class="co"># T1</span></span>
<span id="cb98-249"><a href="#cb98-249" aria-hidden="true" tabindex="-1"></a>          dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb98-250"><a href="#cb98-250" aria-hidden="true" tabindex="-1"></a>                             <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb98-251"><a href="#cb98-251" aria-hidden="true" tabindex="-1"></a>                             T1l1, T1l2, </span>
<span id="cb98-252"><a href="#cb98-252" aria-hidden="true" tabindex="-1"></a>                             T2l1, T2l2,  </span>
<span id="cb98-253"><a href="#cb98-253" aria-hidden="true" tabindex="-1"></a>                             T3l1, T3l2, </span>
<span id="cb98-254"><a href="#cb98-254" aria-hidden="true" tabindex="-1"></a>                             <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb98-255"><a href="#cb98-255" aria-hidden="true" tabindex="-1"></a>          T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb98-256"><a href="#cb98-256" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb98-257"><a href="#cb98-257" aria-hidden="true" tabindex="-1"></a>          <span class="co"># T2</span></span>
<span id="cb98-258"><a href="#cb98-258" aria-hidden="true" tabindex="-1"></a>          dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb98-259"><a href="#cb98-259" aria-hidden="true" tabindex="-1"></a>                             <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb98-260"><a href="#cb98-260" aria-hidden="true" tabindex="-1"></a>                             T1l1, T1l2, </span>
<span id="cb98-261"><a href="#cb98-261" aria-hidden="true" tabindex="-1"></a>                             T2l1, T2l2,  </span>
<span id="cb98-262"><a href="#cb98-262" aria-hidden="true" tabindex="-1"></a>                             T3l1, T3l2, </span>
<span id="cb98-263"><a href="#cb98-263" aria-hidden="true" tabindex="-1"></a>                             <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb98-264"><a href="#cb98-264" aria-hidden="true" tabindex="-1"></a>          T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb98-265"><a href="#cb98-265" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb98-266"><a href="#cb98-266" aria-hidden="true" tabindex="-1"></a>          <span class="co"># T3</span></span>
<span id="cb98-267"><a href="#cb98-267" aria-hidden="true" tabindex="-1"></a>          dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb98-268"><a href="#cb98-268" aria-hidden="true" tabindex="-1"></a>                             <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb98-269"><a href="#cb98-269" aria-hidden="true" tabindex="-1"></a>                             T1l1, T1l2, </span>
<span id="cb98-270"><a href="#cb98-270" aria-hidden="true" tabindex="-1"></a>                             T2l1, T2l2,  </span>
<span id="cb98-271"><a href="#cb98-271" aria-hidden="true" tabindex="-1"></a>                             T3l1, T3l2, </span>
<span id="cb98-272"><a href="#cb98-272" aria-hidden="true" tabindex="-1"></a>                             <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb98-273"><a href="#cb98-273" aria-hidden="true" tabindex="-1"></a>          T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb98-274"><a href="#cb98-274" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb98-275"><a href="#cb98-275" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb98-276"><a href="#cb98-276" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb98-277"><a href="#cb98-277" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb98-278"><a href="#cb98-278" aria-hidden="true" tabindex="-1"></a>          T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb98-279"><a href="#cb98-279" aria-hidden="true" tabindex="-1"></a>          T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb98-280"><a href="#cb98-280" aria-hidden="true" tabindex="-1"></a>          T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb98-281"><a href="#cb98-281" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb98-282"><a href="#cb98-282" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-283"><a href="#cb98-283" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Y</span></span>
<span id="cb98-284"><a href="#cb98-284" aria-hidden="true" tabindex="-1"></a>        dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb98-285"><a href="#cb98-285" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb98-286"><a href="#cb98-286" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb98-287"><a href="#cb98-287" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb98-288"><a href="#cb98-288" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb98-289"><a href="#cb98-289" aria-hidden="true" tabindex="-1"></a>        Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb98-290"><a href="#cb98-290" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb98-291"><a href="#cb98-291" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb98-292"><a href="#cb98-292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb98-293"><a href="#cb98-293" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb98-294"><a href="#cb98-294" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb98-295"><a href="#cb98-295" aria-hidden="true" tabindex="-1"></a>      mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb98-296"><a href="#cb98-296" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb98-297"><a href="#cb98-297" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb98-298"><a href="#cb98-298" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-299"><a href="#cb98-299" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-300"><a href="#cb98-300" aria-hidden="true" tabindex="-1"></a>    <span class="co"># boot_num &lt;- seed</span></span>
<span id="cb98-301"><a href="#cb98-301" aria-hidden="true" tabindex="-1"></a>    gdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, M1p, Yp,</span>
<span id="cb98-302"><a href="#cb98-302" aria-hidden="true" tabindex="-1"></a>                       T1mp, T1p, T2mp, T2p, T3mp, T3p, Vp)</span>
<span id="cb98-303"><a href="#cb98-303" aria-hidden="true" tabindex="-1"></a>    gdat<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat<span class="sc">$</span>id, <span class="at">fromLast =</span> T))</span>
<span id="cb98-304"><a href="#cb98-304" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(gdat)</span>
<span id="cb98-305"><a href="#cb98-305" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb98-306"><a href="#cb98-306" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-307"><a href="#cb98-307" aria-hidden="true" tabindex="-1"></a>    outdat11 <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>)</span>
<span id="cb98-308"><a href="#cb98-308" aria-hidden="true" tabindex="-1"></a>    outdat10 <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb98-309"><a href="#cb98-309" aria-hidden="true" tabindex="-1"></a>    outdat00 <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb98-310"><a href="#cb98-310" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb98-311"><a href="#cb98-311" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(outdat11, outdat10, outdat00)</span>
<span id="cb98-312"><a href="#cb98-312" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-313"><a href="#cb98-313" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="run" class="level2">
<h2 class="anchored" data-anchor-id="run">Run</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>aaa2 <span class="ot">&lt;-</span> <span class="fu">tvmedg</span>(<span class="at">data =</span> dat0,</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">LM =</span> F,</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">bootstr =</span> T,</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">seed =</span> <span class="dv">444</span>,</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>,</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">montecarlo =</span> <span class="dv">10000</span>,<span class="at">length =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/tvmed_dat100.RDS"</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag1 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag2 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag1 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag2 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag1 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag2 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag1 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag2 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag1 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">80</span>),</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag2 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">80</span>)</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>aaa <span class="ot">&lt;-</span>  <span class="fu">g_boot</span>(<span class="at">data =</span> dat, <span class="at">length =</span> <span class="dv">12</span>, </span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">montecarlo =</span> <span class="dv">10000</span>, <span class="at">seed =</span> <span class="dv">444</span>,</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">boostr =</span> T) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>g-formula for single mediator 
Running SEED 444 

Resampling Data 
Resampled data identical to original for seed = 444 ?: FALSE </code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="output-5" class="level2">
<h2 class="anchored" data-anchor-id="output-5">Output</h2>
<p>Em có extract những output cần so giữa 2 function với nhau ở dưới</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>tvmedg</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>aaa2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id id_ori mm Ay Am M1 Yp2 Lmp1     Lmp2      Lmp3 Lp1      Lp2       Lp3
1   2      3  1  1  1  0   0    0 100.0000  80.00000   0 100.0000  80.00000
2   2      3  2  1  1  0   0    0 107.1901  86.32591   0 107.1901  86.32591
3   2      3  3  1  1  0   0    0 110.1787  89.38897   0 110.1787  89.38897
4   2      3  4  1  1  0   0    0 113.2549  92.02082   0 113.2549  92.02082
5   2      3  5  1  1  0   0    0 115.4527  94.07254   0 115.4527  94.07254
6   2      3  6  1  1  0   0    0 117.3015  95.78261   0 117.3015  95.78261
7   2      3  7  1  1  0   0    0 118.7887  97.19490   0 118.7887  97.19490
8   2      3  8  1  1  0   0    0 120.0034  98.36067   0 120.0034  98.36067
9   2      3  9  1  1  0   0    0 120.9745  99.30731   0 120.9745  99.30731
10  2      3 10  1  1  0   0    0 121.7319 100.05807   0 121.7319 100.05807
11  2      3 11  1  1  0   0    0 122.2967 100.63177   0 122.2967 100.63177
12  2      3 12  1  1  0   0    0 122.6882 101.04560   0 122.6882 101.04560
13  2      3  1  1  0  0   0    0 100.0000  80.00000   0 100.0000  80.00000
14  2      3  2  1  0  0   0    0 115.4864  94.40056   0 107.1901  86.32591
15  2      3  3  1  0  0   0    0 120.5746  99.51169   0 110.1787  89.38897
16  2      3  4  1  0  0   0    0 125.6328 103.43649   0 113.2549  92.02082
17  2      3  5  1  0  0   0    0 128.6268 106.06276   0 115.4527  94.07254
18  2      3  6  1  0  0   0    0 130.9649 108.08580   0 117.3015  95.78261
19  2      3  7  1  0  0   0    0 132.6851 109.65414   0 118.7887  97.19490
20  2      3  8  1  0  0   0    0 134.0271 110.90214   0 120.0034  98.36067
21  2      3  9  1  0  0   0    0 135.0624 111.89095   0 120.9745  99.30731
22  2      3 10  1  0  0   0    0 135.8537 112.66370   0 121.7319 100.05807
23  2      3 11  1  0  0   0    0 136.4359 113.24876   0 122.2967 100.63177
24  2      3 12  1  0  0   0    0 136.8364 113.66849   0 122.6882 101.04560
25  2      3  1  0  0  0   0    0 100.0000  80.00000   0 100.0000  80.00000
26  2      3  2  0  0  0   0    0 115.4864  94.40056   0 115.4864  94.40056
27  2      3  3  0  0  0   0    0 120.5746  99.51169   0 120.5746  99.51169
28  2      3  4  0  0  0   0    0 125.6328 103.43649   0 125.6328 103.43649
29  2      3  5  0  0  0   0    0 128.6268 106.06276   0 128.6268 106.06276
30  2      3  6  0  0  0   0    0 130.9649 108.08580   0 130.9649 108.08580
31  2      3  7  0  0  0   0    0 132.6851 109.65414   0 132.6851 109.65414
32  2      3  8  0  0  0   0    0 134.0271 110.90214   0 134.0271 110.90214
33  2      3  9  0  0  0   0    0 135.0624 111.89095   0 135.0624 111.89095
34  2      3 10  0  0  0   0    0 135.8537 112.66370   0 135.8537 112.66370
35  2      3 11  0  0  0   0    0 136.4359 113.24876   0 136.4359 113.24876
36  2      3 12  0  0  0   0    0 136.8364 113.66849   0 136.8364 113.66849
         v1 v2 v3 v4 lastid
1  9.786848  1  0  0      0
2  9.786848  1  0  0      0
3  9.786848  1  0  0      0
4  9.786848  1  0  0      0
5  9.786848  1  0  0      0
6  9.786848  1  0  0      0
7  9.786848  1  0  0      0
8  9.786848  1  0  0      0
9  9.786848  1  0  0      0
10 9.786848  1  0  0      0
11 9.786848  1  0  0      0
12 9.786848  1  0  0      1
13 9.786848  1  0  0      0
14 9.786848  1  0  0      0
15 9.786848  1  0  0      0
16 9.786848  1  0  0      0
17 9.786848  1  0  0      0
18 9.786848  1  0  0      0
19 9.786848  1  0  0      0
20 9.786848  1  0  0      0
21 9.786848  1  0  0      0
22 9.786848  1  0  0      0
23 9.786848  1  0  0      0
24 9.786848  1  0  0      1
25 9.786848  1  0  0      0
26 9.786848  1  0  0      0
27 9.786848  1  0  0      0
28 9.786848  1  0  0      0
29 9.786848  1  0  0      0
30 9.786848  1  0  0      0
31 9.786848  1  0  0      0
32 9.786848  1  0  0      0
33 9.786848  1  0  0      0
34 9.786848  1  0  0      0
35 9.786848  1  0  0      0
36 9.786848  1  0  0      1</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>g_boot</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>aaa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   id id_ori mm Ay Am M1p Yp T1mp T1p     T2mp      T2p      T3mp       T3p
1   2      3  1  1  1   0  0    0   0 100.0000 100.0000  80.00000  80.00000
2   2      3  2  1  1   0  0    0   0 107.1901 107.1901  86.32591  86.32591
3   2      3  3  1  1   0  0    0   0 110.1787 110.1787  89.38897  89.38897
4   2      3  4  1  1   0  0    0   0 113.2549 113.2549  92.02082  92.02082
5   2      3  5  1  1   0  0    0   0 115.4527 115.4527  94.07254  94.07254
6   2      3  6  1  1   0  0    0   0 117.3015 117.3015  95.78261  95.78261
7   2      3  7  1  1   0  0    0   0 118.7887 118.7887  97.19490  97.19490
8   2      3  8  1  1   0  0    0   0 120.0034 120.0034  98.36067  98.36067
9   2      3  9  1  1   0  0    0   0 120.9745 120.9745  99.30731  99.30731
10  2      3 10  1  1   0  0    0   0 121.7319 121.7319 100.05807 100.05807
11  2      3 11  1  1   0  0    1   1 122.2967 122.2967 100.63177 100.63177
12  2      3 12  1  1   0  0    0   0 126.5429 126.5429 101.48479 101.48479
13  2      3  1  1  0   0  0    0   0 100.0000 100.0000  80.00000  80.00000
14  2      3  2  1  0   0  0    0   1 115.4864 107.1901  94.40056  86.32591
15  2      3  3  1  0   0  0    0   0 120.5746 114.0335  99.51169  89.82816
16  2      3  4  1  0   0  0    0   0 125.6328 115.2388 103.43649  94.56859
17  2      3  5  1  0   0  0    0   0 128.6268 116.5128 106.06276  94.85464
18  2      3  6  1  0   0  0    0   0 130.9649 117.9228 108.08580  96.21839
19  2      3  7  1  0   0  0    0   0 132.6851 119.0979 109.65414  97.40456
20  2      3  8  1  0   0  0    0   0 134.0271 120.1703 110.90214  98.47013
21  2      3  9  1  0   0  0    0   0 135.0624 121.0596 111.89095  99.36331
22  2      3 10  1  0   0  0    0   0 135.8537 121.7766 112.66370 100.08718
23  2      3 11  1  0   0  0    0   0 136.4359 122.3197 113.24876 100.64682
24  2      3 12  1  0   0  0    0   0 136.8364 122.7002 113.66849 101.05341
25  2      3  1  0  0   0  0    0   0 100.0000 100.0000  80.00000  80.00000
26  2      3  2  0  0   0  0    0   0 115.4864 115.4864  94.40056  94.40056
27  2      3  3  0  0   0  0    0   0 120.5746 120.5746  99.51169  99.51169
28  2      3  4  0  0   0  0    0   0 125.6328 125.6328 103.43649 103.43649
29  2      3  5  0  0   0  0    0   0 128.6268 128.6268 106.06276 106.06276
30  2      3  6  0  0   0  0    0   0 130.9649 130.9649 108.08580 108.08580
31  2      3  7  0  0   0  0    0   0 132.6851 132.6851 109.65414 109.65414
32  2      3  8  0  0   0  0    0   0 134.0271 134.0271 110.90214 110.90214
33  2      3  9  0  0   0  0    0   0 135.0624 135.0624 111.89095 111.89095
34  2      3 10  0  0   0  0    0   0 135.8537 135.8537 112.66370 112.66370
35  2      3 11  0  0   0  0    0   0 136.4359 136.4359 113.24876 113.24876
36  2      3 12  0  0   0  0    0   0 136.8364 136.8364 113.66849 113.66849
         v1 v2 v3 v4 lastid
1  9.786848  1  0  0      0
2  9.786848  1  0  0      0
3  9.786848  1  0  0      0
4  9.786848  1  0  0      0
5  9.786848  1  0  0      0
6  9.786848  1  0  0      0
7  9.786848  1  0  0      0
8  9.786848  1  0  0      0
9  9.786848  1  0  0      0
10 9.786848  1  0  0      0
11 9.786848  1  0  0      0
12 9.786848  1  0  0      1
13 9.786848  1  0  0      0
14 9.786848  1  0  0      0
15 9.786848  1  0  0      0
16 9.786848  1  0  0      0
17 9.786848  1  0  0      0
18 9.786848  1  0  0      0
19 9.786848  1  0  0      0
20 9.786848  1  0  0      0
21 9.786848  1  0  0      0
22 9.786848  1  0  0      0
23 9.786848  1  0  0      0
24 9.786848  1  0  0      1
25 9.786848  1  0  0      0
26 9.786848  1  0  0      0
27 9.786848  1  0  0      0
28 9.786848  1  0  0      0
29 9.786848  1  0  0      0
30 9.786848  1  0  0      0
31 9.786848  1  0  0      0
32 9.786848  1  0  0      0
33 9.786848  1  0  0      0
34 9.786848  1  0  0      0
35 9.786848  1  0  0      0
36 9.786848  1  0  0      1</code></pre>
</div>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test_that("process_data function", {</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,2:6],aaa2[,1:5])</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T1mp"],aaa2[,"Lmp1"])</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T2mp"],aaa2[,"Lmp2"])</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T3mp"],aaa2[,"Lmp3"])</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T1p"],aaa2[,"Lp1"])</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T2p"],aaa2[,"Lp2"])</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T3p"],aaa2[,"Lp3"])</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,c("v1","v2","v3","v4","lastid")],aaa2[,c("v1","v2","v3","v4","lastid")])</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="extract-variables" class="level2">
<h2 class="anchored" data-anchor-id="extract-variables">Extract variables</h2>
<p>Ở time 11, am = ap = 1 thì code a Long tính ra Tmp1 = Tp1 = 1 =&gt; dẫn đến các variables Lmp2, Lmp3 khác nhau ở time 12 và cũng có xác suất T1mp có thể ra 1. Ở time 2 am != ap, Tp1 = 1. Em nghĩ vấn đề khác nhau này thì mình chạy nhiều lấy mean thì k sao, nhưng mình k có test coverage cho package mình được.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>cp <span class="ot">&lt;-</span> <span class="fu">cbind</span>(aaa2[,<span class="fu">c</span>(<span class="st">"Ay"</span>,<span class="st">"Am"</span>,<span class="st">"mm"</span>,<span class="st">"M1"</span>,<span class="st">"Lmp1"</span>,<span class="st">"Lmp2"</span>,<span class="st">"Lmp3"</span>,<span class="st">"Lp1"</span>,<span class="st">"Lp2"</span>,<span class="st">"Lp3"</span>,<span class="st">"Yp2"</span>)],aaa[,<span class="fu">c</span>(<span class="st">"M1p"</span>,<span class="st">"T1mp"</span>,<span class="st">"T2mp"</span>,<span class="st">"T3mp"</span>,<span class="st">"T1p"</span>,<span class="st">"T2p"</span>,<span class="st">"T3p"</span>,<span class="st">"Yp"</span>)])</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>cp[,<span class="fu">c</span>(<span class="st">"Ay"</span>,<span class="st">"Am"</span>,<span class="st">"mm"</span>,<span class="st">"M1"</span>,<span class="st">"M1p"</span>,<span class="st">"Lmp1"</span>,<span class="st">"T1mp"</span>,<span class="st">"Lmp2"</span>,<span class="st">"T2mp"</span>,<span class="st">"Lmp3"</span>,<span class="st">"T3mp"</span>,<span class="st">"Lp1"</span>,<span class="st">"T1p"</span>,<span class="st">"Lp2"</span>,<span class="st">"T2p"</span>,<span class="st">"Lp3"</span>,<span class="st">"T3p"</span>,<span class="st">"Yp2"</span>,<span class="st">"Yp"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Ay Am mm M1 M1p Lmp1 T1mp     Lmp2     T2mp      Lmp3      T3mp Lp1 T1p
1   1  1  1  0   0    0    0 100.0000 100.0000  80.00000  80.00000   0   0
2   1  1  2  0   0    0    0 107.1901 107.1901  86.32591  86.32591   0   0
3   1  1  3  0   0    0    0 110.1787 110.1787  89.38897  89.38897   0   0
4   1  1  4  0   0    0    0 113.2549 113.2549  92.02082  92.02082   0   0
5   1  1  5  0   0    0    0 115.4527 115.4527  94.07254  94.07254   0   0
6   1  1  6  0   0    0    0 117.3015 117.3015  95.78261  95.78261   0   0
7   1  1  7  0   0    0    0 118.7887 118.7887  97.19490  97.19490   0   0
8   1  1  8  0   0    0    0 120.0034 120.0034  98.36067  98.36067   0   0
9   1  1  9  0   0    0    0 120.9745 120.9745  99.30731  99.30731   0   0
10  1  1 10  0   0    0    0 121.7319 121.7319 100.05807 100.05807   0   0
11  1  1 11  0   0    0    1 122.2967 122.2967 100.63177 100.63177   0   1
12  1  1 12  0   0    0    0 122.6882 126.5429 101.04560 101.48479   0   0
13  1  0  1  0   0    0    0 100.0000 100.0000  80.00000  80.00000   0   0
14  1  0  2  0   0    0    0 115.4864 115.4864  94.40056  94.40056   0   1
15  1  0  3  0   0    0    0 120.5746 120.5746  99.51169  99.51169   0   0
16  1  0  4  0   0    0    0 125.6328 125.6328 103.43649 103.43649   0   0
17  1  0  5  0   0    0    0 128.6268 128.6268 106.06276 106.06276   0   0
18  1  0  6  0   0    0    0 130.9649 130.9649 108.08580 108.08580   0   0
19  1  0  7  0   0    0    0 132.6851 132.6851 109.65414 109.65414   0   0
20  1  0  8  0   0    0    0 134.0271 134.0271 110.90214 110.90214   0   0
21  1  0  9  0   0    0    0 135.0624 135.0624 111.89095 111.89095   0   0
22  1  0 10  0   0    0    0 135.8537 135.8537 112.66370 112.66370   0   0
23  1  0 11  0   0    0    0 136.4359 136.4359 113.24876 113.24876   0   0
24  1  0 12  0   0    0    0 136.8364 136.8364 113.66849 113.66849   0   0
25  0  0  1  0   0    0    0 100.0000 100.0000  80.00000  80.00000   0   0
26  0  0  2  0   0    0    0 115.4864 115.4864  94.40056  94.40056   0   0
27  0  0  3  0   0    0    0 120.5746 120.5746  99.51169  99.51169   0   0
28  0  0  4  0   0    0    0 125.6328 125.6328 103.43649 103.43649   0   0
29  0  0  5  0   0    0    0 128.6268 128.6268 106.06276 106.06276   0   0
30  0  0  6  0   0    0    0 130.9649 130.9649 108.08580 108.08580   0   0
31  0  0  7  0   0    0    0 132.6851 132.6851 109.65414 109.65414   0   0
32  0  0  8  0   0    0    0 134.0271 134.0271 110.90214 110.90214   0   0
33  0  0  9  0   0    0    0 135.0624 135.0624 111.89095 111.89095   0   0
34  0  0 10  0   0    0    0 135.8537 135.8537 112.66370 112.66370   0   0
35  0  0 11  0   0    0    0 136.4359 136.4359 113.24876 113.24876   0   0
36  0  0 12  0   0    0    0 136.8364 136.8364 113.66849 113.66849   0   0
        Lp2      T2p       Lp3       T3p Yp2 Yp
1  100.0000 100.0000  80.00000  80.00000   0  0
2  107.1901 107.1901  86.32591  86.32591   0  0
3  110.1787 110.1787  89.38897  89.38897   0  0
4  113.2549 113.2549  92.02082  92.02082   0  0
5  115.4527 115.4527  94.07254  94.07254   0  0
6  117.3015 117.3015  95.78261  95.78261   0  0
7  118.7887 118.7887  97.19490  97.19490   0  0
8  120.0034 120.0034  98.36067  98.36067   0  0
9  120.9745 120.9745  99.30731  99.30731   0  0
10 121.7319 121.7319 100.05807 100.05807   0  0
11 122.2967 122.2967 100.63177 100.63177   0  0
12 122.6882 126.5429 101.04560 101.48479   0  0
13 100.0000 100.0000  80.00000  80.00000   0  0
14 107.1901 107.1901  86.32591  86.32591   0  0
15 110.1787 114.0335  89.38897  89.82816   0  0
16 113.2549 115.2388  92.02082  94.56859   0  0
17 115.4527 116.5128  94.07254  94.85464   0  0
18 117.3015 117.9228  95.78261  96.21839   0  0
19 118.7887 119.0979  97.19490  97.40456   0  0
20 120.0034 120.1703  98.36067  98.47013   0  0
21 120.9745 121.0596  99.30731  99.36331   0  0
22 121.7319 121.7766 100.05807 100.08718   0  0
23 122.2967 122.3197 100.63177 100.64682   0  0
24 122.6882 122.7002 101.04560 101.05341   0  0
25 100.0000 100.0000  80.00000  80.00000   0  0
26 115.4864 115.4864  94.40056  94.40056   0  0
27 120.5746 120.5746  99.51169  99.51169   0  0
28 125.6328 125.6328 103.43649 103.43649   0  0
29 128.6268 128.6268 106.06276 106.06276   0  0
30 130.9649 130.9649 108.08580 108.08580   0  0
31 132.6851 132.6851 109.65414 109.65414   0  0
32 134.0271 134.0271 110.90214 110.90214   0  0
33 135.0624 135.0624 111.89095 111.89095   0  0
34 135.8537 135.8537 112.66370 112.66370   0  0
35 136.4359 136.4359 113.24876 113.24876   0  0
36 136.8364 136.8364 113.66849 113.66849   0  0</code></pre>
</div>
</div>
</section>
</section>
<section id="final-tvmedg-function" class="level1">
<h1>Final tvmedg function</h1>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>tvmedg <span class="ot">&lt;-</span> <span class="cf">function</span>(data,</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>                   fix,expo,med,tvar,lag,outc,time,<span class="at">norev =</span> <span class="cn">NULL</span>,<span class="at">LM =</span> <span class="cn">FALSE</span>,</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bootstr =</span> <span class="cn">FALSE</span>, <span class="at">seed =</span> <span class="dv">0</span>,</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>,</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">montecarlo =</span> <span class="dv">10000</span>,<span class="at">length =</span> <span class="dv">12</span>,<span class="at">parallel=</span><span class="cn">TRUE</span>){</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>  fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix =</span> fix,</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">expo =</span> expo,</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> med,</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvar =</span> tvar,</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">outc =</span> outc,</span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag =</span> lag,</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> time,</span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">norev =</span> norev,</span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">LM =</span> LM,</span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data</span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fitg</span>(<span class="at">bootstr=</span>bootstr,</span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">mreg =</span> mreg,</span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">lreg =</span> lreg,</span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">yreg =</span> yreg,<span class="at">dof =</span> dof) <span class="sc">%&gt;%</span> </span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> montecarlo)</span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a>    start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (parallel <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a>      gform_wrapper2 <span class="ot">&lt;-</span> <span class="cf">function</span>(iii, data, length) {</span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a>        outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>)</span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a>        outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a>        outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bind_rows</span>(outdat11, outdat10, outdat00)</span>
<span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a>      resultDatM <span class="ot">&lt;-</span> <span class="fu">future_map_dfr</span>(<span class="dv">1</span><span class="sc">:</span>montecarlo,  </span>
<span id="cb109-41"><a href="#cb109-41" aria-hidden="true" tabindex="-1"></a>                                   <span class="sc">~</span> <span class="fu">gform_wrapper2</span>(<span class="at">ii =</span> .x, <span class="at">data =</span> fitR2, <span class="at">length =</span> length))</span>
<span id="cb109-42"><a href="#cb109-42" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb109-43"><a href="#cb109-43" aria-hidden="true" tabindex="-1"></a>      resultDatM <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb109-44"><a href="#cb109-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (iii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>montecarlo){</span>
<span id="cb109-45"><a href="#cb109-45" aria-hidden="true" tabindex="-1"></a>        outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>)</span>
<span id="cb109-46"><a href="#cb109-46" aria-hidden="true" tabindex="-1"></a>        outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb109-47"><a href="#cb109-47" aria-hidden="true" tabindex="-1"></a>        outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb109-48"><a href="#cb109-48" aria-hidden="true" tabindex="-1"></a>        resultDatM2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(outdat11, outdat10, outdat00)</span>
<span id="cb109-49"><a href="#cb109-49" aria-hidden="true" tabindex="-1"></a>        resultDatM <span class="ot">&lt;-</span> <span class="fu">rbind</span>(resultDatM,resultDatM2)</span>
<span id="cb109-50"><a href="#cb109-50" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb109-51"><a href="#cb109-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb109-52"><a href="#cb109-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-53"><a href="#cb109-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb109-54"><a href="#cb109-54" aria-hidden="true" tabindex="-1"></a>  end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb109-55"><a href="#cb109-55" aria-hidden="true" tabindex="-1"></a>  elapsed_time <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span>
<span id="cb109-56"><a href="#cb109-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb109-57"><a href="#cb109-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(elapsed_time)</span>
<span id="cb109-58"><a href="#cb109-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultDatM)</span>
<span id="cb109-59"><a href="#cb109-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb109-60"><a href="#cb109-60" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Em chạy trước montecarlo = 100 tại chạy 10000 nó lâu quá :)))</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">8</span>)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>datMC <span class="ot">&lt;-</span> <span class="fu">tvmedg</span>(<span class="at">data =</span> dat0,</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">LM =</span> F,</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">bootstr =</span> T,</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>,</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">montecarlo =</span> <span class="dv">100</span>,<span class="at">length =</span> <span class="dv">12</span>,</span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">parallel=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 1.056771 mins</code></pre>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>ExtResult <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  Q11 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Am <span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  Q10 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Am <span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  Q00 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> Am <span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(1,1):"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q11<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(1,0):"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q10<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(0,0):"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q00<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Indirect:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q11<span class="sc">$</span>Yp) <span class="sc">-</span> <span class="fu">mean</span>(Q10<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Direct:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q10<span class="sc">$</span>Yp) <span class="sc">-</span> <span class="fu">mean</span>(Q00<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Total:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q11<span class="sc">$</span>Yp) <span class="sc">-</span> <span class="fu">mean</span>(Q00<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Proportional explain:"</span>, </span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>((<span class="fu">mean</span>(Q11<span class="sc">$</span>Yp) <span class="sc">-</span> <span class="fu">mean</span>(Q10<span class="sc">$</span>Yp))<span class="sc">/</span>(<span class="fu">mean</span>(Q11<span class="sc">$</span>Yp) <span class="sc">-</span> <span class="fu">mean</span>(Q00<span class="sc">$</span>Yp)), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ExtResult</span>(datMC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Q(1,1): 0.19 
Q(1,0): 0 
Q(0,0): 0 
Indirect: 0.19 
Direct: 0 
Total: 0.19 
Proportional explain: 1 </code></pre>
</div>
</div>
</section>
<section id="note" class="level1">
<h1>Note</h1>
<p>Note những vấn đề e còn thắc mắc:</p>
<ul>
<li><p>Em chưa hiểu intergration của montecarlo sẽ làm như thế nào.</p></li>
<li><p>Việc 2 function cho ra kết quả khác nhau khi ay != am. Em vẫn đang lăn tăn là do em code có sai k. Em đã check việc dùng data và formula để fit và em vẫn nghĩ do tính random của rFunc() và Pfunc() nên ra kết quả khác nhau.</p></li>
<li><p>Em chưa làm function để tính 95% CI.</p></li>
</ul>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb115" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "tvmedg package"</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="an">message:</span><span class="co"> false</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="an">warning:</span><span class="co"> false</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a><span class="fu"># Import data</span></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/tvmed_dat100.RDS"</span>)</span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>dat0 <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-32"><a href="#cb115-32" aria-hidden="true" tabindex="-1"></a><span class="fu"># Process data function</span></span>
<span id="cb115-33"><a href="#cb115-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-36"><a href="#cb115-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-37"><a href="#cb115-37" aria-hidden="true" tabindex="-1"></a>process_data <span class="ot">&lt;-</span> <span class="cf">function</span>(fix,expo,med,tvar,lag,outc,time,<span class="at">norev =</span> <span class="cn">NULL</span>,<span class="at">LM =</span> <span class="cn">FALSE</span>,data){</span>
<span id="cb115-38"><a href="#cb115-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-39"><a href="#cb115-39" aria-hidden="true" tabindex="-1"></a>  <span class="do">## detect which variables are non-reversible</span></span>
<span id="cb115-40"><a href="#cb115-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(expo <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb115-41"><a href="#cb115-41" aria-hidden="true" tabindex="-1"></a>    norev_expo <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"A"</span>,<span class="fu">which</span>(expo <span class="sc">%in%</span> norev))</span>
<span id="cb115-42"><a href="#cb115-42" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb115-43"><a href="#cb115-43" aria-hidden="true" tabindex="-1"></a>    norev_expo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb115-44"><a href="#cb115-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-45"><a href="#cb115-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-46"><a href="#cb115-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(med <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb115-47"><a href="#cb115-47" aria-hidden="true" tabindex="-1"></a>    norev_med <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="fu">which</span>(med <span class="sc">%in%</span> norev))</span>
<span id="cb115-48"><a href="#cb115-48" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb115-49"><a href="#cb115-49" aria-hidden="true" tabindex="-1"></a>    norev_med <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb115-50"><a href="#cb115-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-51"><a href="#cb115-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-52"><a href="#cb115-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(tvar <span class="sc">%in%</span> norev)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb115-53"><a href="#cb115-53" aria-hidden="true" tabindex="-1"></a>    norev_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="fu">which</span>(tvar <span class="sc">%in%</span> norev))</span>
<span id="cb115-54"><a href="#cb115-54" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb115-55"><a href="#cb115-55" aria-hidden="true" tabindex="-1"></a>    norev_tvar <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb115-56"><a href="#cb115-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-57"><a href="#cb115-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-58"><a href="#cb115-58" aria-hidden="true" tabindex="-1"></a>  norev_var <span class="ot">&lt;-</span> <span class="fu">c</span>(norev_expo,norev_med,norev_tvar)</span>
<span id="cb115-59"><a href="#cb115-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-60"><a href="#cb115-60" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of time-fixed variables</span></span>
<span id="cb115-61"><a href="#cb115-61" aria-hidden="true" tabindex="-1"></a>  name_v <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"v"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(fix))</span>
<span id="cb115-62"><a href="#cb115-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-63"><a href="#cb115-63" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> data<span class="sc">$</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb115-64"><a href="#cb115-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(data[,fix]) <span class="sc">%&gt;%</span> </span>
<span id="cb115-65"><a href="#cb115-65" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">set_colnames</span>(<span class="fu">c</span>(<span class="st">"id"</span>,name_v))</span>
<span id="cb115-66"><a href="#cb115-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-67"><a href="#cb115-67" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of exposure variables  </span></span>
<span id="cb115-68"><a href="#cb115-68" aria-hidden="true" tabindex="-1"></a>  name_e <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"A"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(expo))</span>
<span id="cb115-69"><a href="#cb115-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-70"><a href="#cb115-70" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of mediator variables  </span></span>
<span id="cb115-71"><a href="#cb115-71" aria-hidden="true" tabindex="-1"></a>  name_me <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med))</span>
<span id="cb115-72"><a href="#cb115-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-73"><a href="#cb115-73" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column names of time-varying variables  </span></span>
<span id="cb115-74"><a href="#cb115-74" aria-hidden="true" tabindex="-1"></a>  name_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar))</span>
<span id="cb115-75"><a href="#cb115-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-76"><a href="#cb115-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-77"><a href="#cb115-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lag){</span>
<span id="cb115-78"><a href="#cb115-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-79"><a href="#cb115-79" aria-hidden="true" tabindex="-1"></a>    <span class="do">## column name of lag effect on exposure variable</span></span>
<span id="cb115-80"><a href="#cb115-80" aria-hidden="true" tabindex="-1"></a>    co_ex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_e,<span class="st">"l"</span>,i)</span>
<span id="cb115-81"><a href="#cb115-81" aria-hidden="true" tabindex="-1"></a>    co_me <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_me,<span class="st">"l"</span>,i)</span>
<span id="cb115-82"><a href="#cb115-82" aria-hidden="true" tabindex="-1"></a>    co_tvar <span class="ot">&lt;-</span> <span class="fu">paste0</span>(name_tvar,<span class="st">"l"</span>,i)</span>
<span id="cb115-83"><a href="#cb115-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-84"><a href="#cb115-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_e)){</span>
<span id="cb115-85"><a href="#cb115-85" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-86"><a href="#cb115-86" aria-hidden="true" tabindex="-1"></a>      out[,name_e[k]] <span class="ot">&lt;-</span> data[,expo[k]]</span>
<span id="cb115-87"><a href="#cb115-87" aria-hidden="true" tabindex="-1"></a>      name_ep <span class="ot">&lt;-</span> {{co_ex}}[k]</span>
<span id="cb115-88"><a href="#cb115-88" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb115-89"><a href="#cb115-89" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb115-90"><a href="#cb115-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb115-91"><a href="#cb115-91" aria-hidden="true" tabindex="-1"></a>          {{name_ep}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_e[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,expo[k]])</span>
<span id="cb115-92"><a href="#cb115-92" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb115-93"><a href="#cb115-93" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-94"><a href="#cb115-94" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb115-95"><a href="#cb115-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-96"><a href="#cb115-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_me)){</span>
<span id="cb115-97"><a href="#cb115-97" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-98"><a href="#cb115-98" aria-hidden="true" tabindex="-1"></a>      out[,name_me[k]] <span class="ot">&lt;-</span> data[,med[k]]</span>
<span id="cb115-99"><a href="#cb115-99" aria-hidden="true" tabindex="-1"></a>      name_med <span class="ot">&lt;-</span> {{co_me}}[k]</span>
<span id="cb115-100"><a href="#cb115-100" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb115-101"><a href="#cb115-101" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb115-102"><a href="#cb115-102" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb115-103"><a href="#cb115-103" aria-hidden="true" tabindex="-1"></a>          {{name_med}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_me[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,med[k]])</span>
<span id="cb115-104"><a href="#cb115-104" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb115-105"><a href="#cb115-105" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-106"><a href="#cb115-106" aria-hidden="true" tabindex="-1"></a>    }  </span>
<span id="cb115-107"><a href="#cb115-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-108"><a href="#cb115-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name_tvar)){</span>
<span id="cb115-109"><a href="#cb115-109" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-110"><a href="#cb115-110" aria-hidden="true" tabindex="-1"></a>      out[,name_tvar[k]] <span class="ot">&lt;-</span> data[,tvar[k]]</span>
<span id="cb115-111"><a href="#cb115-111" aria-hidden="true" tabindex="-1"></a>      name_tv <span class="ot">&lt;-</span> {{co_tvar}}[k]</span>
<span id="cb115-112"><a href="#cb115-112" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> </span>
<span id="cb115-113"><a href="#cb115-113" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb115-114"><a href="#cb115-114" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb115-115"><a href="#cb115-115" aria-hidden="true" tabindex="-1"></a>          {{name_tv}} <span class="sc">:</span><span class="er">=</span> <span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(name_tvar[k]),<span class="at">n=</span>i,<span class="at">default =</span> data[<span class="dv">1</span>,tvar[k]])</span>
<span id="cb115-116"><a href="#cb115-116" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb115-117"><a href="#cb115-117" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-118"><a href="#cb115-118" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-119"><a href="#cb115-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-120"><a href="#cb115-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-121"><a href="#cb115-121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-122"><a href="#cb115-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-123"><a href="#cb115-123" aria-hidden="true" tabindex="-1"></a>  <span class="do">## outcome variable</span></span>
<span id="cb115-124"><a href="#cb115-124" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>Y <span class="ot">&lt;-</span> data[,outc]</span>
<span id="cb115-125"><a href="#cb115-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-126"><a href="#cb115-126" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time variable</span></span>
<span id="cb115-127"><a href="#cb115-127" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>j <span class="ot">&lt;-</span> data[,time]</span>
<span id="cb115-128"><a href="#cb115-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-129"><a href="#cb115-129" aria-hidden="true" tabindex="-1"></a>  kq <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb115-130"><a href="#cb115-130" aria-hidden="true" tabindex="-1"></a>  kq<span class="sc">$</span>df <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() </span>
<span id="cb115-131"><a href="#cb115-131" aria-hidden="true" tabindex="-1"></a>  kq<span class="sc">$</span>norev_var <span class="ot">&lt;-</span> norev_var</span>
<span id="cb115-132"><a href="#cb115-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-133"><a href="#cb115-133" aria-hidden="true" tabindex="-1"></a>  <span class="do">## column name</span></span>
<span id="cb115-134"><a href="#cb115-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-135"><a href="#cb115-135" aria-hidden="true" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"A"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb115-136"><a href="#cb115-136" aria-hidden="true" tabindex="-1"></a>  tf <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb115-137"><a href="#cb115-137" aria-hidden="true" tabindex="-1"></a>  tva <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"L"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb115-138"><a href="#cb115-138" aria-hidden="true" tabindex="-1"></a>  mediator <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"M"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb115-139"><a href="#cb115-139" aria-hidden="true" tabindex="-1"></a>  outcome <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"Y"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb115-140"><a href="#cb115-140" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> kq<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"j"</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb115-141"><a href="#cb115-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-142"><a href="#cb115-142" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-143"><a href="#cb115-143" aria-hidden="true" tabindex="-1"></a>  <span class="do">## formula for M(t)</span></span>
<span id="cb115-144"><a href="#cb115-144" aria-hidden="true" tabindex="-1"></a>  l_tm1 <span class="ot">&lt;-</span> tva[<span class="sc">!</span>tva <span class="sc">%in%</span> name_tvar]</span>
<span id="cb115-145"><a href="#cb115-145" aria-hidden="true" tabindex="-1"></a>  m_tm1 <span class="ot">&lt;-</span> mediator[<span class="sc">!</span>mediator <span class="sc">%in%</span> name_me]</span>
<span id="cb115-146"><a href="#cb115-146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-147"><a href="#cb115-147" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (LM <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb115-148"><a href="#cb115-148" aria-hidden="true" tabindex="-1"></a>    formula_mt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb115-149"><a href="#cb115-149" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-150"><a href="#cb115-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med)){</span>
<span id="cb115-151"><a href="#cb115-151" aria-hidden="true" tabindex="-1"></a>      formula_mt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_me[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,l_tm1,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb115-152"><a href="#cb115-152" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-153"><a href="#cb115-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-154"><a href="#cb115-154" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fm <span class="ot">&lt;-</span> formula_mt</span>
<span id="cb115-155"><a href="#cb115-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-156"><a href="#cb115-156" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for L(t)</span></span>
<span id="cb115-157"><a href="#cb115-157" aria-hidden="true" tabindex="-1"></a>    formular_lt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb115-158"><a href="#cb115-158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-159"><a href="#cb115-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar)){</span>
<span id="cb115-160"><a href="#cb115-160" aria-hidden="true" tabindex="-1"></a>      formular_lt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_tvar[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,mediator,l_tm1,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb115-161"><a href="#cb115-161" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-162"><a href="#cb115-162" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-163"><a href="#cb115-163" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fl <span class="ot">&lt;-</span> formular_lt</span>
<span id="cb115-164"><a href="#cb115-164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-165"><a href="#cb115-165" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for Y(t)</span></span>
<span id="cb115-166"><a href="#cb115-166" aria-hidden="true" tabindex="-1"></a>    formular_y <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome,<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,mediator,tva,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb115-167"><a href="#cb115-167" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fy <span class="ot">&lt;-</span> formular_y</span>
<span id="cb115-168"><a href="#cb115-168" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-169"><a href="#cb115-169" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb115-170"><a href="#cb115-170" aria-hidden="true" tabindex="-1"></a>    formula_mt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb115-171"><a href="#cb115-171" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-172"><a href="#cb115-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med)){</span>
<span id="cb115-173"><a href="#cb115-173" aria-hidden="true" tabindex="-1"></a>      formula_mt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_me[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,name_tvar,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb115-174"><a href="#cb115-174" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-175"><a href="#cb115-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-176"><a href="#cb115-176" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fm <span class="ot">&lt;-</span> formula_mt</span>
<span id="cb115-177"><a href="#cb115-177" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-178"><a href="#cb115-178" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for L(t)</span></span>
<span id="cb115-179"><a href="#cb115-179" aria-hidden="true" tabindex="-1"></a>    formular_lt <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb115-180"><a href="#cb115-180" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-181"><a href="#cb115-181" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tvar)){</span>
<span id="cb115-182"><a href="#cb115-182" aria-hidden="true" tabindex="-1"></a>      formular_lt[i] <span class="ot">&lt;-</span> <span class="fu">paste</span>(name_tvar[i],<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,m_tm1,l_tm1,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb115-183"><a href="#cb115-183" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-184"><a href="#cb115-184" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-185"><a href="#cb115-185" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fl <span class="ot">&lt;-</span> formular_lt</span>
<span id="cb115-186"><a href="#cb115-186" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-187"><a href="#cb115-187" aria-hidden="true" tabindex="-1"></a>    <span class="do">## formula for Y(t)</span></span>
<span id="cb115-188"><a href="#cb115-188" aria-hidden="true" tabindex="-1"></a>    formular_y <span class="ot">&lt;-</span> <span class="fu">paste</span>(outcome,<span class="st">"~"</span>,<span class="fu">paste</span>(<span class="fu">c</span>(eps,tva,mediator,tf),<span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb115-189"><a href="#cb115-189" aria-hidden="true" tabindex="-1"></a>    kq<span class="sc">$</span>fy <span class="ot">&lt;-</span> formular_y</span>
<span id="cb115-190"><a href="#cb115-190" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-191"><a href="#cb115-191" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-192"><a href="#cb115-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(kq)</span>
<span id="cb115-193"><a href="#cb115-193" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-194"><a href="#cb115-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-195"><a href="#cb115-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-196"><a href="#cb115-196" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output</span></span>
<span id="cb115-197"><a href="#cb115-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-200"><a href="#cb115-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-201"><a href="#cb115-201" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb115-202"><a href="#cb115-202" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-203"><a href="#cb115-203" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-204"><a href="#cb115-204" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-205"><a href="#cb115-205" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-206"><a href="#cb115-206" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-207"><a href="#cb115-207" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-208"><a href="#cb115-208" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-209"><a href="#cb115-209" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-210"><a href="#cb115-210" aria-hidden="true" tabindex="-1"></a>  <span class="at">LM =</span> F,</span>
<span id="cb115-211"><a href="#cb115-211" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-212"><a href="#cb115-212" aria-hidden="true" tabindex="-1"></a>)  <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span>
<span id="cb115-213"><a href="#cb115-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-214"><a href="#cb115-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-215"><a href="#cb115-215" aria-hidden="true" tabindex="-1"></a><span class="fu">## Compare M before L, and L before M</span></span>
<span id="cb115-216"><a href="#cb115-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-219"><a href="#cb115-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-220"><a href="#cb115-220" aria-hidden="true" tabindex="-1"></a>ml <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-221"><a href="#cb115-221" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-222"><a href="#cb115-222" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-223"><a href="#cb115-223" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-224"><a href="#cb115-224" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-225"><a href="#cb115-225" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-226"><a href="#cb115-226" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-227"><a href="#cb115-227" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-228"><a href="#cb115-228" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-229"><a href="#cb115-229" aria-hidden="true" tabindex="-1"></a>  <span class="at">LM =</span> F,</span>
<span id="cb115-230"><a href="#cb115-230" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-231"><a href="#cb115-231" aria-hidden="true" tabindex="-1"></a>)  </span>
<span id="cb115-232"><a href="#cb115-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-233"><a href="#cb115-233" aria-hidden="true" tabindex="-1"></a>lm <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-234"><a href="#cb115-234" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-235"><a href="#cb115-235" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-236"><a href="#cb115-236" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-237"><a href="#cb115-237" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-238"><a href="#cb115-238" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-239"><a href="#cb115-239" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-240"><a href="#cb115-240" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-241"><a href="#cb115-241" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-242"><a href="#cb115-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">LM =</span> T,</span>
<span id="cb115-243"><a href="#cb115-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-244"><a href="#cb115-244" aria-hidden="true" tabindex="-1"></a>)  </span>
<span id="cb115-245"><a href="#cb115-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-246"><a href="#cb115-246" aria-hidden="true" tabindex="-1"></a>ml<span class="sc">$</span>fm</span>
<span id="cb115-247"><a href="#cb115-247" aria-hidden="true" tabindex="-1"></a>lm<span class="sc">$</span>fm</span>
<span id="cb115-248"><a href="#cb115-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-249"><a href="#cb115-249" aria-hidden="true" tabindex="-1"></a>ml<span class="sc">$</span>fl</span>
<span id="cb115-250"><a href="#cb115-250" aria-hidden="true" tabindex="-1"></a>lm<span class="sc">$</span>fl</span>
<span id="cb115-251"><a href="#cb115-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-252"><a href="#cb115-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-253"><a href="#cb115-253" aria-hidden="true" tabindex="-1"></a><span class="fu"># cen_and_scale function</span></span>
<span id="cb115-254"><a href="#cb115-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-257"><a href="#cb115-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-258"><a href="#cb115-258" aria-hidden="true" tabindex="-1"></a>cen_and_scale <span class="ot">&lt;-</span> <span class="cf">function</span>(time){</span>
<span id="cb115-259"><a href="#cb115-259" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-260"><a href="#cb115-260" aria-hidden="true" tabindex="-1"></a>  j_out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb115-261"><a href="#cb115-261" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-262"><a href="#cb115-262" aria-hidden="true" tabindex="-1"></a>  jj <span class="ot">&lt;-</span> time <span class="sc">%&gt;%</span> </span>
<span id="cb115-263"><a href="#cb115-263" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale</span>() </span>
<span id="cb115-264"><a href="#cb115-264" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-265"><a href="#cb115-265" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"jj"</span>]] <span class="ot">&lt;-</span> jj <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb115-266"><a href="#cb115-266" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"mean_j"</span>]] <span class="ot">&lt;-</span> <span class="fu">attributes</span>(jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb115-267"><a href="#cb115-267" aria-hidden="true" tabindex="-1"></a>  j_out[[<span class="st">"sd_j"</span>]] <span class="ot">&lt;-</span> <span class="fu">attributes</span>(jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb115-268"><a href="#cb115-268" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-269"><a href="#cb115-269" aria-hidden="true" tabindex="-1"></a>  j_out</span>
<span id="cb115-270"><a href="#cb115-270" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-271"><a href="#cb115-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-272"><a href="#cb115-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-273"><a href="#cb115-273" aria-hidden="true" tabindex="-1"></a><span class="fu"># resamp function</span></span>
<span id="cb115-274"><a href="#cb115-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-277"><a href="#cb115-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-278"><a href="#cb115-278" aria-hidden="true" tabindex="-1"></a>resamp <span class="ot">&lt;-</span> <span class="cf">function</span>(data,<span class="at">bootstr =</span> <span class="cn">FALSE</span>){</span>
<span id="cb115-279"><a href="#cb115-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-280"><a href="#cb115-280" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> data</span>
<span id="cb115-281"><a href="#cb115-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-282"><a href="#cb115-282" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set.seed(seed)</span></span>
<span id="cb115-283"><a href="#cb115-283" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("Running SEED", seed, "\n")</span></span>
<span id="cb115-284"><a href="#cb115-284" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("\n")</span></span>
<span id="cb115-285"><a href="#cb115-285" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("Resampling Data", "\n")</span></span>
<span id="cb115-286"><a href="#cb115-286" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-287"><a href="#cb115-287" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(df<span class="sc">$</span>id))</span>
<span id="cb115-288"><a href="#cb115-288" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters), <span class="fu">length</span>(clusters), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-289"><a href="#cb115-289" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters[index])</span>
<span id="cb115-290"><a href="#cb115-290" aria-hidden="true" tabindex="-1"></a>  boot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb115-291"><a href="#cb115-291" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-292"><a href="#cb115-292" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(bootstr <span class="sc">==</span> F) {</span>
<span id="cb115-293"><a href="#cb115-293" aria-hidden="true" tabindex="-1"></a>    <span class="co"># not doing bootstrap</span></span>
<span id="cb115-294"><a href="#cb115-294" aria-hidden="true" tabindex="-1"></a>    boot <span class="ot">&lt;-</span> df </span>
<span id="cb115-295"><a href="#cb115-295" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb115-296"><a href="#cb115-296" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb115-297"><a href="#cb115-297" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loop over repeated id</span></span>
<span id="cb115-298"><a href="#cb115-298" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb115-299"><a href="#cb115-299" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>id, zzz)</span>
<span id="cb115-300"><a href="#cb115-300" aria-hidden="true" tabindex="-1"></a>      boot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(boot, cc)</span>
<span id="cb115-301"><a href="#cb115-301" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-302"><a href="#cb115-302" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-303"><a href="#cb115-303" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-304"><a href="#cb115-304" aria-hidden="true" tabindex="-1"></a>  boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(boot<span class="sc">$</span>j)<span class="sc">$</span>jj</span>
<span id="cb115-305"><a href="#cb115-305" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-306"><a href="#cb115-306" aria-hidden="true" tabindex="-1"></a>  boot</span>
<span id="cb115-307"><a href="#cb115-307" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-308"><a href="#cb115-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-309"><a href="#cb115-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-310"><a href="#cb115-310" aria-hidden="true" tabindex="-1"></a><span class="fu"># fitg function</span></span>
<span id="cb115-311"><a href="#cb115-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-314"><a href="#cb115-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-315"><a href="#cb115-315" aria-hidden="true" tabindex="-1"></a>fitg <span class="ot">&lt;-</span> <span class="cf">function</span>(data,<span class="at">bootstr =</span> <span class="cn">FALSE</span>,</span>
<span id="cb115-316"><a href="#cb115-316" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-317"><a href="#cb115-317" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-318"><a href="#cb115-318" aria-hidden="true" tabindex="-1"></a>                 <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>){</span>
<span id="cb115-319"><a href="#cb115-319" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-320"><a href="#cb115-320" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <span class="fu">resamp</span>(<span class="at">data =</span> data<span class="sc">$</span>df,<span class="at">bootstr =</span> bootstr)</span>
<span id="cb115-321"><a href="#cb115-321" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-322"><a href="#cb115-322" aria-hidden="true" tabindex="-1"></a>  fitR <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb115-323"><a href="#cb115-323" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-324"><a href="#cb115-324" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>df <span class="ot">&lt;-</span> res_df <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb115-325"><a href="#cb115-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-326"><a href="#cb115-326" aria-hidden="true" tabindex="-1"></a>  <span class="co">#----- fit parametric models for</span></span>
<span id="cb115-327"><a href="#cb115-327" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Mediator models</span></span>
<span id="cb115-328"><a href="#cb115-328" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-329"><a href="#cb115-329" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(mreg) <span class="sc">!=</span> <span class="fu">length</span>(data<span class="sc">$</span>fm)){</span>
<span id="cb115-330"><a href="#cb115-330" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"the defined regression of M is not equal"</span>)</span>
<span id="cb115-331"><a href="#cb115-331" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-332"><a href="#cb115-332" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-333"><a href="#cb115-333" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>fm)){</span>
<span id="cb115-334"><a href="#cb115-334" aria-hidden="true" tabindex="-1"></a>    fitM <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fm[[i]],<span class="st">"+"</span>,<span class="st">"bs(jj,df="</span>,dof,<span class="st">")"</span>)</span>
<span id="cb115-335"><a href="#cb115-335" aria-hidden="true" tabindex="-1"></a>    fitR<span class="sc">$</span>M[[i]] <span class="ot">&lt;-</span> <span class="fu">glm</span>(fitM ,<span class="at">family =</span> mreg[i], <span class="at">data =</span> res_df) </span>
<span id="cb115-336"><a href="#cb115-336" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-337"><a href="#cb115-337" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-338"><a href="#cb115-338" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-339"><a href="#cb115-339" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Covariate models</span></span>
<span id="cb115-340"><a href="#cb115-340" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(lreg) <span class="sc">!=</span> <span class="fu">length</span>(data<span class="sc">$</span>fl)){</span>
<span id="cb115-341"><a href="#cb115-341" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"the defined regression of L is not equal"</span>)</span>
<span id="cb115-342"><a href="#cb115-342" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-343"><a href="#cb115-343" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-344"><a href="#cb115-344" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>fl)){</span>
<span id="cb115-345"><a href="#cb115-345" aria-hidden="true" tabindex="-1"></a>    fitL <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fl[[i]],<span class="st">"+"</span>,<span class="st">"bs(jj,df="</span>,dof,<span class="st">")"</span>)</span>
<span id="cb115-346"><a href="#cb115-346" aria-hidden="true" tabindex="-1"></a>    fitR<span class="sc">$</span>L[[i]] <span class="ot">&lt;-</span> <span class="fu">glm</span>(fitL ,<span class="at">family =</span> lreg[i], <span class="at">data =</span> res_df) </span>
<span id="cb115-347"><a href="#cb115-347" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-348"><a href="#cb115-348" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-349"><a href="#cb115-349" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Outcome model: </span></span>
<span id="cb115-350"><a href="#cb115-350" aria-hidden="true" tabindex="-1"></a>  fitY <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>fy,<span class="st">"+"</span>,<span class="st">"bs(jj,df="</span>,dof,<span class="st">")"</span>)</span>
<span id="cb115-351"><a href="#cb115-351" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-352"><a href="#cb115-352" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-353"><a href="#cb115-353" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>Y <span class="ot">&lt;-</span>  <span class="fu">glm</span>(fitY ,<span class="at">family =</span> yreg, <span class="at">data =</span> res_df) </span>
<span id="cb115-354"><a href="#cb115-354" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-355"><a href="#cb115-355" aria-hidden="true" tabindex="-1"></a>  fitR<span class="sc">$</span>norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb115-356"><a href="#cb115-356" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-357"><a href="#cb115-357" aria-hidden="true" tabindex="-1"></a>  fitR</span>
<span id="cb115-358"><a href="#cb115-358" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-359"><a href="#cb115-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-360"><a href="#cb115-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-361"><a href="#cb115-361" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output</span></span>
<span id="cb115-362"><a href="#cb115-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-365"><a href="#cb115-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-366"><a href="#cb115-366" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb115-367"><a href="#cb115-367" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-368"><a href="#cb115-368" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-369"><a href="#cb115-369" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-370"><a href="#cb115-370" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-371"><a href="#cb115-371" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-372"><a href="#cb115-372" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-373"><a href="#cb115-373" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-374"><a href="#cb115-374" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="cn">NULL</span>,</span>
<span id="cb115-375"><a href="#cb115-375" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-376"><a href="#cb115-376" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb115-377"><a href="#cb115-377" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-378"><a href="#cb115-378" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-379"><a href="#cb115-379" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>)</span>
<span id="cb115-380"><a href="#cb115-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-381"><a href="#cb115-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-382"><a href="#cb115-382" aria-hidden="true" tabindex="-1"></a><span class="fu"># baseline_mc</span></span>
<span id="cb115-383"><a href="#cb115-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-386"><a href="#cb115-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-387"><a href="#cb115-387" aria-hidden="true" tabindex="-1"></a>baseline_mc <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> fitR2,<span class="at">montecarlo =</span> <span class="dv">10000</span>){</span>
<span id="cb115-388"><a href="#cb115-388" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-389"><a href="#cb115-389" aria-hidden="true" tabindex="-1"></a>  boot <span class="ot">&lt;-</span> data<span class="sc">$</span>df</span>
<span id="cb115-390"><a href="#cb115-390" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select baseline visit</span></span>
<span id="cb115-391"><a href="#cb115-391" aria-hidden="true" tabindex="-1"></a>  df0 <span class="ot">&lt;-</span> boot[boot<span class="sc">$</span>j<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb115-392"><a href="#cb115-392" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-393"><a href="#cb115-393" aria-hidden="true" tabindex="-1"></a>  df0<span class="sc">$</span>idn <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df0)</span>
<span id="cb115-394"><a href="#cb115-394" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-395"><a href="#cb115-395" aria-hidden="true" tabindex="-1"></a>  MC <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb115-396"><a href="#cb115-396" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-397"><a href="#cb115-397" aria-hidden="true" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(df0<span class="sc">$</span>idn, <span class="at">size =</span> montecarlo, <span class="at">replace =</span> T)</span>
<span id="cb115-398"><a href="#cb115-398" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">table</span>(samples)</span>
<span id="cb115-399"><a href="#cb115-399" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-400"><a href="#cb115-400" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb115-401"><a href="#cb115-401" aria-hidden="true" tabindex="-1"></a>    cc <span class="ot">&lt;-</span> df0[df0<span class="sc">$</span>idn <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb115-402"><a href="#cb115-402" aria-hidden="true" tabindex="-1"></a>    cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>idn, zzz)</span>
<span id="cb115-403"><a href="#cb115-403" aria-hidden="true" tabindex="-1"></a>    MC <span class="ot">&lt;-</span> <span class="fu">rbind</span>(MC, cc)</span>
<span id="cb115-404"><a href="#cb115-404" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-405"><a href="#cb115-405" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-406"><a href="#cb115-406" aria-hidden="true" tabindex="-1"></a>  MC<span class="sc">$</span>idsim <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>montecarlo</span>
<span id="cb115-407"><a href="#cb115-407" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-408"><a href="#cb115-408" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>res_df <span class="ot">&lt;-</span> MC <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb115-409"><a href="#cb115-409" aria-hidden="true" tabindex="-1"></a>  data</span>
<span id="cb115-410"><a href="#cb115-410" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-411"><a href="#cb115-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-412"><a href="#cb115-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-413"><a href="#cb115-413" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output</span></span>
<span id="cb115-414"><a href="#cb115-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-417"><a href="#cb115-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-418"><a href="#cb115-418" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb115-419"><a href="#cb115-419" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-420"><a href="#cb115-420" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-421"><a href="#cb115-421" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-422"><a href="#cb115-422" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-423"><a href="#cb115-423" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-424"><a href="#cb115-424" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-425"><a href="#cb115-425" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-426"><a href="#cb115-426" aria-hidden="true" tabindex="-1"></a>  <span class="co"># norev = c("Mp","L1"),</span></span>
<span id="cb115-427"><a href="#cb115-427" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-428"><a href="#cb115-428" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>F,</span>
<span id="cb115-429"><a href="#cb115-429" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-430"><a href="#cb115-430" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-431"><a href="#cb115-431" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-432"><a href="#cb115-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>)</span>
<span id="cb115-433"><a href="#cb115-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-434"><a href="#cb115-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-435"><a href="#cb115-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-436"><a href="#cb115-436" aria-hidden="true" tabindex="-1"></a><span class="fu"># g_form function</span></span>
<span id="cb115-437"><a href="#cb115-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-440"><a href="#cb115-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-441"><a href="#cb115-441" aria-hidden="true" tabindex="-1"></a>pFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb115-442"><a href="#cb115-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> <span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb115-443"><a href="#cb115-443" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-444"><a href="#cb115-444" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-445"><a href="#cb115-445" aria-hidden="true" tabindex="-1"></a>rFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb115-446"><a href="#cb115-446" aria-hidden="true" tabindex="-1"></a>  pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb115-447"><a href="#cb115-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_prob))</span>
<span id="cb115-448"><a href="#cb115-448" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-449"><a href="#cb115-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-450"><a href="#cb115-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-451"><a href="#cb115-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-454"><a href="#cb115-454" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-455"><a href="#cb115-455" aria-hidden="true" tabindex="-1"></a>g_form <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">ii =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">am =</span> <span class="dv">1</span>, <span class="at">ay =</span> <span class="dv">0</span>){</span>
<span id="cb115-456"><a href="#cb115-456" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-457"><a href="#cb115-457" aria-hidden="true" tabindex="-1"></a>  norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb115-458"><a href="#cb115-458" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-459"><a href="#cb115-459" aria-hidden="true" tabindex="-1"></a>  dddd <span class="ot">&lt;-</span> data<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-460"><a href="#cb115-460" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-461"><a href="#cb115-461" aria-hidden="true" tabindex="-1"></a>  lagg <span class="ot">&lt;-</span> dddd <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"L1l"</span>)) <span class="sc">%&gt;%</span> <span class="fu">ncol</span>() </span>
<span id="cb115-462"><a href="#cb115-462" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-463"><a href="#cb115-463" aria-hidden="true" tabindex="-1"></a>  d2 <span class="ot">&lt;-</span> dddd[dddd<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb115-464"><a href="#cb115-464" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-465"><a href="#cb115-465" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d2<span class="sc">$</span>idsim</span>
<span id="cb115-466"><a href="#cb115-466" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d2<span class="sc">$</span>id</span>
<span id="cb115-467"><a href="#cb115-467" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-468"><a href="#cb115-468" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb115-469"><a href="#cb115-469" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-470"><a href="#cb115-470" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb115-471"><a href="#cb115-471" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>))</span>
<span id="cb115-472"><a href="#cb115-472" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-473"><a href="#cb115-473" aria-hidden="true" tabindex="-1"></a>  Yp2 <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-474"><a href="#cb115-474" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-475"><a href="#cb115-475" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-476"><a href="#cb115-476" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-477"><a href="#cb115-477" aria-hidden="true" tabindex="-1"></a>  Yp2[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-478"><a href="#cb115-478" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-479"><a href="#cb115-479" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(data<span class="sc">$</span>df<span class="sc">$</span>j)</span>
<span id="cb115-480"><a href="#cb115-480" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-481"><a href="#cb115-481" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mediator</span></span>
<span id="cb115-482"><a href="#cb115-482" aria-hidden="true" tabindex="-1"></a>  Mp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>M)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-483"><a href="#cb115-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Mp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M))</span>
<span id="cb115-484"><a href="#cb115-484" aria-hidden="true" tabindex="-1"></a>  Mp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Mp)) </span>
<span id="cb115-485"><a href="#cb115-485" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-486"><a href="#cb115-486" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-487"><a href="#cb115-487" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-488"><a href="#cb115-488" aria-hidden="true" tabindex="-1"></a>  Lmp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>L)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-489"><a href="#cb115-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb115-490"><a href="#cb115-490" aria-hidden="true" tabindex="-1"></a>  Lmp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Lmp)) </span>
<span id="cb115-491"><a href="#cb115-491" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to outcome models)</span></span>
<span id="cb115-492"><a href="#cb115-492" aria-hidden="true" tabindex="-1"></a>  Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb115-493"><a href="#cb115-493" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-494"><a href="#cb115-494" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> lagg<span class="sc">:</span>length) {</span>
<span id="cb115-495"><a href="#cb115-495" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-496"><a href="#cb115-496" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb115-497"><a href="#cb115-497" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb115-498"><a href="#cb115-498" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb115-499"><a href="#cb115-499" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-500"><a href="#cb115-500" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb115-501"><a href="#cb115-501" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-502"><a href="#cb115-502" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb115-503"><a href="#cb115-503" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-504"><a href="#cb115-504" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-505"><a href="#cb115-505" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-506"><a href="#cb115-506" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-507"><a href="#cb115-507" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb115-508"><a href="#cb115-508" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-509"><a href="#cb115-509" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-510"><a href="#cb115-510" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-511"><a href="#cb115-511" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-512"><a href="#cb115-512" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb115-513"><a href="#cb115-513" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-514"><a href="#cb115-514" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-515"><a href="#cb115-515" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-516"><a href="#cb115-516" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-517"><a href="#cb115-517" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-518"><a href="#cb115-518" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-519"><a href="#cb115-519" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-520"><a href="#cb115-520" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-521"><a href="#cb115-521" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-522"><a href="#cb115-522" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-523"><a href="#cb115-523" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb115-524"><a href="#cb115-524" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-525"><a href="#cb115-525" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-526"><a href="#cb115-526" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-527"><a href="#cb115-527" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-528"><a href="#cb115-528" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-529"><a href="#cb115-529" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb115-530"><a href="#cb115-530" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-531"><a href="#cb115-531" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-532"><a href="#cb115-532" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-533"><a href="#cb115-533" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb115-534"><a href="#cb115-534" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb115-535"><a href="#cb115-535" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-536"><a href="#cb115-536" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-537"><a href="#cb115-537" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-538"><a href="#cb115-538" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb115-539"><a href="#cb115-539" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-540"><a href="#cb115-540" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-541"><a href="#cb115-541" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb115-542"><a href="#cb115-542" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb115-543"><a href="#cb115-543" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb115-544"><a href="#cb115-544" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-545"><a href="#cb115-545" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-546"><a href="#cb115-546" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-547"><a href="#cb115-547" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-548"><a href="#cb115-548" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-549"><a href="#cb115-549" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-550"><a href="#cb115-550" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb115-551"><a href="#cb115-551" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-552"><a href="#cb115-552" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb115-553"><a href="#cb115-553" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-554"><a href="#cb115-554" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-555"><a href="#cb115-555" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb115-556"><a href="#cb115-556" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-557"><a href="#cb115-557" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-558"><a href="#cb115-558" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-559"><a href="#cb115-559" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-560"><a href="#cb115-560" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-561"><a href="#cb115-561" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-562"><a href="#cb115-562" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-563"><a href="#cb115-563" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-564"><a href="#cb115-564" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-565"><a href="#cb115-565" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-566"><a href="#cb115-566" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-567"><a href="#cb115-567" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-568"><a href="#cb115-568" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-569"><a href="#cb115-569" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-570"><a href="#cb115-570" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-571"><a href="#cb115-571" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb115-572"><a href="#cb115-572" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-573"><a href="#cb115-573" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-574"><a href="#cb115-574" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-575"><a href="#cb115-575" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-576"><a href="#cb115-576" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb115-577"><a href="#cb115-577" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-578"><a href="#cb115-578" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-579"><a href="#cb115-579" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-580"><a href="#cb115-580" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-581"><a href="#cb115-581" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-582"><a href="#cb115-582" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-583"><a href="#cb115-583" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb115-584"><a href="#cb115-584" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb115-585"><a href="#cb115-585" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-586"><a href="#cb115-586" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-587"><a href="#cb115-587" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-588"><a href="#cb115-588" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-589"><a href="#cb115-589" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb115-590"><a href="#cb115-590" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-591"><a href="#cb115-591" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-592"><a href="#cb115-592" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb115-593"><a href="#cb115-593" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb115-594"><a href="#cb115-594" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb115-595"><a href="#cb115-595" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-596"><a href="#cb115-596" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-597"><a href="#cb115-597" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-598"><a href="#cb115-598" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-599"><a href="#cb115-599" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-600"><a href="#cb115-600" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-601"><a href="#cb115-601" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-602"><a href="#cb115-602" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-603"><a href="#cb115-603" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-604"><a href="#cb115-604" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb115-605"><a href="#cb115-605" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-606"><a href="#cb115-606" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-607"><a href="#cb115-607" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-608"><a href="#cb115-608" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-609"><a href="#cb115-609" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-610"><a href="#cb115-610" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-611"><a href="#cb115-611" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb115-612"><a href="#cb115-612" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-613"><a href="#cb115-613" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb115-614"><a href="#cb115-614" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-615"><a href="#cb115-615" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-616"><a href="#cb115-616" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-617"><a href="#cb115-617" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-618"><a href="#cb115-618" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-619"><a href="#cb115-619" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb115-620"><a href="#cb115-620" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-621"><a href="#cb115-621" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-622"><a href="#cb115-622" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-623"><a href="#cb115-623" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-624"><a href="#cb115-624" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb115-625"><a href="#cb115-625" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-626"><a href="#cb115-626" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-627"><a href="#cb115-627" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-628"><a href="#cb115-628" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb115-629"><a href="#cb115-629" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-630"><a href="#cb115-630" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-631"><a href="#cb115-631" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb115-632"><a href="#cb115-632" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb115-633"><a href="#cb115-633" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb115-634"><a href="#cb115-634" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-635"><a href="#cb115-635" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb115-636"><a href="#cb115-636" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-637"><a href="#cb115-637" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-638"><a href="#cb115-638" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-639"><a href="#cb115-639" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-640"><a href="#cb115-640" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb115-641"><a href="#cb115-641" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb115-642"><a href="#cb115-642" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-643"><a href="#cb115-643" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-644"><a href="#cb115-644" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-645"><a href="#cb115-645" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-646"><a href="#cb115-646" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-647"><a href="#cb115-647" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-648"><a href="#cb115-648" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb115-649"><a href="#cb115-649" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb115-650"><a href="#cb115-650" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-651"><a href="#cb115-651" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-652"><a href="#cb115-652" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb115-653"><a href="#cb115-653" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-654"><a href="#cb115-654" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb115-655"><a href="#cb115-655" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-656"><a href="#cb115-656" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-657"><a href="#cb115-657" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb115-658"><a href="#cb115-658" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-659"><a href="#cb115-659" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb115-660"><a href="#cb115-660" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-661"><a href="#cb115-661" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-662"><a href="#cb115-662" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-663"><a href="#cb115-663" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-664"><a href="#cb115-664" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-665"><a href="#cb115-665" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-666"><a href="#cb115-666" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-667"><a href="#cb115-667" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-668"><a href="#cb115-668" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-669"><a href="#cb115-669" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-670"><a href="#cb115-670" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-671"><a href="#cb115-671" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-672"><a href="#cb115-672" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-673"><a href="#cb115-673" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb115-674"><a href="#cb115-674" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-675"><a href="#cb115-675" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-676"><a href="#cb115-676" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-677"><a href="#cb115-677" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-678"><a href="#cb115-678" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-679"><a href="#cb115-679" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-680"><a href="#cb115-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lmp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb115-681"><a href="#cb115-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Lp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb115-682"><a href="#cb115-682" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-683"><a href="#cb115-683" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num &lt;- seed</span></span>
<span id="cb115-684"><a href="#cb115-684" aria-hidden="true" tabindex="-1"></a>  gdat2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, Mp, Yp2,</span>
<span id="cb115-685"><a href="#cb115-685" aria-hidden="true" tabindex="-1"></a>                     Lmp, Lp, Vp)</span>
<span id="cb115-686"><a href="#cb115-686" aria-hidden="true" tabindex="-1"></a>  gdat2<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat2<span class="sc">$</span>id, <span class="at">fromLast =</span> T))</span>
<span id="cb115-687"><a href="#cb115-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gdat2)</span>
<span id="cb115-688"><a href="#cb115-688" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-689"><a href="#cb115-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-690"><a href="#cb115-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-691"><a href="#cb115-691" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output</span></span>
<span id="cb115-692"><a href="#cb115-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-695"><a href="#cb115-695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-696"><a href="#cb115-696" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb115-697"><a href="#cb115-697" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-698"><a href="#cb115-698" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-699"><a href="#cb115-699" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-700"><a href="#cb115-700" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-701"><a href="#cb115-701" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-702"><a href="#cb115-702" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-703"><a href="#cb115-703" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-704"><a href="#cb115-704" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-705"><a href="#cb115-705" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>F,</span>
<span id="cb115-706"><a href="#cb115-706" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-707"><a href="#cb115-707" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-708"><a href="#cb115-708" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-709"><a href="#cb115-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-710"><a href="#cb115-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">am =</span> <span class="dv">1</span>, <span class="at">ay =</span> <span class="dv">0</span>)</span>
<span id="cb115-711"><a href="#cb115-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-712"><a href="#cb115-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-713"><a href="#cb115-713" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output with non-reversible variable, and bootstrap</span></span>
<span id="cb115-714"><a href="#cb115-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-717"><a href="#cb115-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-718"><a href="#cb115-718" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb115-719"><a href="#cb115-719" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-720"><a href="#cb115-720" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-721"><a href="#cb115-721" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-722"><a href="#cb115-722" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-723"><a href="#cb115-723" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-724"><a href="#cb115-724" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-725"><a href="#cb115-725" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-726"><a href="#cb115-726" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-727"><a href="#cb115-727" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-728"><a href="#cb115-728" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb115-729"><a href="#cb115-729" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-730"><a href="#cb115-730" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-731"><a href="#cb115-731" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-732"><a href="#cb115-732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-733"><a href="#cb115-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">am =</span> <span class="dv">1</span>, <span class="at">ay =</span> <span class="dv">0</span>)</span>
<span id="cb115-734"><a href="#cb115-734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-735"><a href="#cb115-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-736"><a href="#cb115-736" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output with non-reversible variable, and bootstrap, L before M</span></span>
<span id="cb115-737"><a href="#cb115-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-740"><a href="#cb115-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-741"><a href="#cb115-741" aria-hidden="true" tabindex="-1"></a><span class="fu">process_data</span>(</span>
<span id="cb115-742"><a href="#cb115-742" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-743"><a href="#cb115-743" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-744"><a href="#cb115-744" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-745"><a href="#cb115-745" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-746"><a href="#cb115-746" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-747"><a href="#cb115-747" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-748"><a href="#cb115-748" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-749"><a href="#cb115-749" aria-hidden="true" tabindex="-1"></a>  <span class="at">LM =</span> <span class="cn">TRUE</span>,</span>
<span id="cb115-750"><a href="#cb115-750" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-751"><a href="#cb115-751" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-752"><a href="#cb115-752" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb115-753"><a href="#cb115-753" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-754"><a href="#cb115-754" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-755"><a href="#cb115-755" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-756"><a href="#cb115-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-757"><a href="#cb115-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">44</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">am =</span> <span class="dv">1</span>, <span class="at">ay =</span> <span class="dv">0</span>)</span>
<span id="cb115-758"><a href="#cb115-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-759"><a href="#cb115-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-760"><a href="#cb115-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-761"><a href="#cb115-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-762"><a href="#cb115-762" aria-hidden="true" tabindex="-1"></a><span class="fu"># Test</span></span>
<span id="cb115-763"><a href="#cb115-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-764"><a href="#cb115-764" aria-hidden="true" tabindex="-1"></a><span class="fu">## Set up</span></span>
<span id="cb115-765"><a href="#cb115-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-766"><a href="#cb115-766" aria-hidden="true" tabindex="-1"></a><span class="fu">### df_prep</span></span>
<span id="cb115-767"><a href="#cb115-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-770"><a href="#cb115-770" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-771"><a href="#cb115-771" aria-hidden="true" tabindex="-1"></a>df_prep <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb115-772"><a href="#cb115-772" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-773"><a href="#cb115-773" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> data<span class="sc">$</span>id)</span>
<span id="cb115-774"><a href="#cb115-774" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-775"><a href="#cb115-775" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline characteristics</span></span>
<span id="cb115-776"><a href="#cb115-776" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>v1 <span class="ot">&lt;-</span> data<span class="sc">$</span>age</span>
<span id="cb115-777"><a href="#cb115-777" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>v2 <span class="ot">&lt;-</span> data<span class="sc">$</span>sex</span>
<span id="cb115-778"><a href="#cb115-778" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>v3 <span class="ot">&lt;-</span> data<span class="sc">$</span>ow</span>
<span id="cb115-779"><a href="#cb115-779" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>v4 <span class="ot">&lt;-</span> data<span class="sc">$</span>risk</span>
<span id="cb115-780"><a href="#cb115-780" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-781"><a href="#cb115-781" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-782"><a href="#cb115-782" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying treatment</span></span>
<span id="cb115-783"><a href="#cb115-783" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>A <span class="ot">&lt;-</span> data<span class="sc">$</span>Ap</span>
<span id="cb115-784"><a href="#cb115-784" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>Al1 <span class="ot">&lt;-</span> data<span class="sc">$</span>A_lag1</span>
<span id="cb115-785"><a href="#cb115-785" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>Al2 <span class="ot">&lt;-</span> data<span class="sc">$</span>A_lag2</span>
<span id="cb115-786"><a href="#cb115-786" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-787"><a href="#cb115-787" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-788"><a href="#cb115-788" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-dependent covariate</span></span>
<span id="cb115-789"><a href="#cb115-789" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T1 <span class="ot">&lt;-</span> data<span class="sc">$</span>L1</span>
<span id="cb115-790"><a href="#cb115-790" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T1l1 <span class="ot">&lt;-</span> data<span class="sc">$</span>L1_lag1</span>
<span id="cb115-791"><a href="#cb115-791" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T1l2 <span class="ot">&lt;-</span> data<span class="sc">$</span>L1_lag2</span>
<span id="cb115-792"><a href="#cb115-792" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-793"><a href="#cb115-793" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T2 <span class="ot">&lt;-</span> data<span class="sc">$</span>L2</span>
<span id="cb115-794"><a href="#cb115-794" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T2l1 <span class="ot">&lt;-</span> data<span class="sc">$</span>L2_lag1</span>
<span id="cb115-795"><a href="#cb115-795" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T2l2 <span class="ot">&lt;-</span> data<span class="sc">$</span>L2_lag2</span>
<span id="cb115-796"><a href="#cb115-796" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-797"><a href="#cb115-797" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T3 <span class="ot">&lt;-</span> data<span class="sc">$</span>L3</span>
<span id="cb115-798"><a href="#cb115-798" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T3l1 <span class="ot">&lt;-</span> data<span class="sc">$</span>L3_lag1</span>
<span id="cb115-799"><a href="#cb115-799" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>T3l2 <span class="ot">&lt;-</span> data<span class="sc">$</span>L3_lag2</span>
<span id="cb115-800"><a href="#cb115-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-801"><a href="#cb115-801" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mediator</span></span>
<span id="cb115-802"><a href="#cb115-802" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>M1 <span class="ot">&lt;-</span> data<span class="sc">$</span>Mp</span>
<span id="cb115-803"><a href="#cb115-803" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>M1l1 <span class="ot">&lt;-</span> data<span class="sc">$</span>M_lag1</span>
<span id="cb115-804"><a href="#cb115-804" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>M1l2 <span class="ot">&lt;-</span> data<span class="sc">$</span>M_lag2</span>
<span id="cb115-805"><a href="#cb115-805" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-806"><a href="#cb115-806" aria-hidden="true" tabindex="-1"></a>  <span class="co"># outcomes</span></span>
<span id="cb115-807"><a href="#cb115-807" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>Y <span class="ot">&lt;-</span> data<span class="sc">$</span>Yp</span>
<span id="cb115-808"><a href="#cb115-808" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-809"><a href="#cb115-809" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time</span></span>
<span id="cb115-810"><a href="#cb115-810" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>j <span class="ot">&lt;-</span> data<span class="sc">$</span>mm</span>
<span id="cb115-811"><a href="#cb115-811" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-812"><a href="#cb115-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb115-813"><a href="#cb115-813" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-814"><a href="#cb115-814" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-815"><a href="#cb115-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-816"><a href="#cb115-816" aria-hidden="true" tabindex="-1"></a><span class="fu">### gform</span></span>
<span id="cb115-817"><a href="#cb115-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-820"><a href="#cb115-820" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-821"><a href="#cb115-821" aria-hidden="true" tabindex="-1"></a>gform <span class="ot">&lt;-</span> <span class="cf">function</span>(ii, pgdat, length, am, ay) {</span>
<span id="cb115-822"><a href="#cb115-822" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-823"><a href="#cb115-823" aria-hidden="true" tabindex="-1"></a>  pFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb115-824"><a href="#cb115-824" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> <span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb115-825"><a href="#cb115-825" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-826"><a href="#cb115-826" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-827"><a href="#cb115-827" aria-hidden="true" tabindex="-1"></a>  rFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb115-828"><a href="#cb115-828" aria-hidden="true" tabindex="-1"></a>    pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb115-829"><a href="#cb115-829" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_prob))</span>
<span id="cb115-830"><a href="#cb115-830" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-831"><a href="#cb115-831" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-832"><a href="#cb115-832" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> pgdat</span>
<span id="cb115-833"><a href="#cb115-833" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d[d<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb115-834"><a href="#cb115-834" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-835"><a href="#cb115-835" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d<span class="sc">$</span>idsim</span>
<span id="cb115-836"><a href="#cb115-836" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d<span class="sc">$</span>id</span>
<span id="cb115-837"><a href="#cb115-837" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-838"><a href="#cb115-838" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb115-839"><a href="#cb115-839" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-840"><a href="#cb115-840" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-841"><a href="#cb115-841" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("...", paste0(ii, "(", id_ori, ")"))</span></span>
<span id="cb115-842"><a href="#cb115-842" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-843"><a href="#cb115-843" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-844"><a href="#cb115-844" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-845"><a href="#cb115-845" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb115-846"><a href="#cb115-846" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d[, <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>, <span class="st">"v3"</span>, <span class="st">"v4"</span>)]</span>
<span id="cb115-847"><a href="#cb115-847" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-848"><a href="#cb115-848" aria-hidden="true" tabindex="-1"></a>  T1p <span class="ot">&lt;-</span> T2p <span class="ot">&lt;-</span> T3p  <span class="ot">&lt;-</span> M1p <span class="ot">&lt;-</span> Yp <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-849"><a href="#cb115-849" aria-hidden="true" tabindex="-1"></a>  T1mp <span class="ot">&lt;-</span> T2mp <span class="ot">&lt;-</span> T3mp <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-850"><a href="#cb115-850" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-851"><a href="#cb115-851" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-852"><a href="#cb115-852" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-853"><a href="#cb115-853" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-854"><a href="#cb115-854" aria-hidden="true" tabindex="-1"></a>  M1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-855"><a href="#cb115-855" aria-hidden="true" tabindex="-1"></a>  Yp[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-856"><a href="#cb115-856" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-857"><a href="#cb115-857" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to outcome model</span></span>
<span id="cb115-858"><a href="#cb115-858" aria-hidden="true" tabindex="-1"></a>  T1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb115-859"><a href="#cb115-859" aria-hidden="true" tabindex="-1"></a>  T2p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb115-860"><a href="#cb115-860" aria-hidden="true" tabindex="-1"></a>  T3p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb115-861"><a href="#cb115-861" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-862"><a href="#cb115-862" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to mediator model</span></span>
<span id="cb115-863"><a href="#cb115-863" aria-hidden="true" tabindex="-1"></a>  T1mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb115-864"><a href="#cb115-864" aria-hidden="true" tabindex="-1"></a>  T2mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb115-865"><a href="#cb115-865" aria-hidden="true" tabindex="-1"></a>  T3mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb115-866"><a href="#cb115-866" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-867"><a href="#cb115-867" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-868"><a href="#cb115-868" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>length) {</span>
<span id="cb115-869"><a href="#cb115-869" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-870"><a href="#cb115-870" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb115-871"><a href="#cb115-871" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-872"><a href="#cb115-872" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb115-873"><a href="#cb115-873" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb115-874"><a href="#cb115-874" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb115-875"><a href="#cb115-875" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb115-876"><a href="#cb115-876" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-877"><a href="#cb115-877" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb115-878"><a href="#cb115-878" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb115-879"><a href="#cb115-879" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb115-880"><a href="#cb115-880" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb115-881"><a href="#cb115-881" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-882"><a href="#cb115-882" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-883"><a href="#cb115-883" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-884"><a href="#cb115-884" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb115-885"><a href="#cb115-885" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb115-886"><a href="#cb115-886" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb115-887"><a href="#cb115-887" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb115-888"><a href="#cb115-888" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb115-889"><a href="#cb115-889" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb115-890"><a href="#cb115-890" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb115-891"><a href="#cb115-891" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-892"><a href="#cb115-892" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-893"><a href="#cb115-893" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-894"><a href="#cb115-894" aria-hidden="true" tabindex="-1"></a>      T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb115-895"><a href="#cb115-895" aria-hidden="true" tabindex="-1"></a>      T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb115-896"><a href="#cb115-896" aria-hidden="true" tabindex="-1"></a>      T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb115-897"><a href="#cb115-897" aria-hidden="true" tabindex="-1"></a>      T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb115-898"><a href="#cb115-898" aria-hidden="true" tabindex="-1"></a>      T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb115-899"><a href="#cb115-899" aria-hidden="true" tabindex="-1"></a>      T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb115-900"><a href="#cb115-900" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-901"><a href="#cb115-901" aria-hidden="true" tabindex="-1"></a>      M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb115-902"><a href="#cb115-902" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-903"><a href="#cb115-903" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-904"><a href="#cb115-904" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-905"><a href="#cb115-905" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb115-906"><a href="#cb115-906" aria-hidden="true" tabindex="-1"></a>      dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-907"><a href="#cb115-907" aria-hidden="true" tabindex="-1"></a>                         <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-908"><a href="#cb115-908" aria-hidden="true" tabindex="-1"></a>                         <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-909"><a href="#cb115-909" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-910"><a href="#cb115-910" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb115-911"><a href="#cb115-911" aria-hidden="true" tabindex="-1"></a>        <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb115-912"><a href="#cb115-912" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb115-913"><a href="#cb115-913" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-914"><a href="#cb115-914" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-915"><a href="#cb115-915" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-916"><a href="#cb115-916" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-917"><a href="#cb115-917" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-918"><a href="#cb115-918" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-919"><a href="#cb115-919" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-920"><a href="#cb115-920" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T1</span></span>
<span id="cb115-921"><a href="#cb115-921" aria-hidden="true" tabindex="-1"></a>      dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-922"><a href="#cb115-922" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-923"><a href="#cb115-923" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-924"><a href="#cb115-924" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-925"><a href="#cb115-925" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-926"><a href="#cb115-926" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-927"><a href="#cb115-927" aria-hidden="true" tabindex="-1"></a>      T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb115-928"><a href="#cb115-928" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-929"><a href="#cb115-929" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T2</span></span>
<span id="cb115-930"><a href="#cb115-930" aria-hidden="true" tabindex="-1"></a>      dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-931"><a href="#cb115-931" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-932"><a href="#cb115-932" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-933"><a href="#cb115-933" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-934"><a href="#cb115-934" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-935"><a href="#cb115-935" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-936"><a href="#cb115-936" aria-hidden="true" tabindex="-1"></a>      T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb115-937"><a href="#cb115-937" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-938"><a href="#cb115-938" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T3</span></span>
<span id="cb115-939"><a href="#cb115-939" aria-hidden="true" tabindex="-1"></a>      dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-940"><a href="#cb115-940" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb115-941"><a href="#cb115-941" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-942"><a href="#cb115-942" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-943"><a href="#cb115-943" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-944"><a href="#cb115-944" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-945"><a href="#cb115-945" aria-hidden="true" tabindex="-1"></a>      T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb115-946"><a href="#cb115-946" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-947"><a href="#cb115-947" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-948"><a href="#cb115-948" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-949"><a href="#cb115-949" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb115-950"><a href="#cb115-950" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-951"><a href="#cb115-951" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-952"><a href="#cb115-952" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb115-953"><a href="#cb115-953" aria-hidden="true" tabindex="-1"></a>        dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-954"><a href="#cb115-954" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-955"><a href="#cb115-955" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-956"><a href="#cb115-956" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-957"><a href="#cb115-957" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-958"><a href="#cb115-958" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-959"><a href="#cb115-959" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb115-960"><a href="#cb115-960" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-961"><a href="#cb115-961" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb115-962"><a href="#cb115-962" aria-hidden="true" tabindex="-1"></a>        dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-963"><a href="#cb115-963" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-964"><a href="#cb115-964" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-965"><a href="#cb115-965" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-966"><a href="#cb115-966" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-967"><a href="#cb115-967" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-968"><a href="#cb115-968" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb115-969"><a href="#cb115-969" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-970"><a href="#cb115-970" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb115-971"><a href="#cb115-971" aria-hidden="true" tabindex="-1"></a>        dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-972"><a href="#cb115-972" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-973"><a href="#cb115-973" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-974"><a href="#cb115-974" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-975"><a href="#cb115-975" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-976"><a href="#cb115-976" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-977"><a href="#cb115-977" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb115-978"><a href="#cb115-978" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-979"><a href="#cb115-979" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-980"><a href="#cb115-980" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-981"><a href="#cb115-981" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-982"><a href="#cb115-982" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb115-983"><a href="#cb115-983" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb115-984"><a href="#cb115-984" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb115-985"><a href="#cb115-985" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-986"><a href="#cb115-986" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-987"><a href="#cb115-987" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb115-988"><a href="#cb115-988" aria-hidden="true" tabindex="-1"></a>      dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-989"><a href="#cb115-989" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb115-990"><a href="#cb115-990" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb115-991"><a href="#cb115-991" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb115-992"><a href="#cb115-992" aria-hidden="true" tabindex="-1"></a>                        <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-993"><a href="#cb115-993" aria-hidden="true" tabindex="-1"></a>      Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb115-994"><a href="#cb115-994" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-995"><a href="#cb115-995" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb115-996"><a href="#cb115-996" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb115-997"><a href="#cb115-997" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-998"><a href="#cb115-998" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-999"><a href="#cb115-999" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-1000"><a href="#cb115-1000" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-1001"><a href="#cb115-1001" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-1002"><a href="#cb115-1002" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1003"><a href="#cb115-1003" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1004"><a href="#cb115-1004" aria-hidden="true" tabindex="-1"></a>  boot_num <span class="ot">&lt;-</span> seed</span>
<span id="cb115-1005"><a href="#cb115-1005" aria-hidden="true" tabindex="-1"></a>  gdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(boot_num, id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, M1p, Yp,</span>
<span id="cb115-1006"><a href="#cb115-1006" aria-hidden="true" tabindex="-1"></a>                     T1mp, T1p, T2mp, T2p, T3mp, T3p, Vp)</span>
<span id="cb115-1007"><a href="#cb115-1007" aria-hidden="true" tabindex="-1"></a>  gdat<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat<span class="sc">$</span>id, <span class="at">fromLast =</span> T))</span>
<span id="cb115-1008"><a href="#cb115-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gdat)</span>
<span id="cb115-1009"><a href="#cb115-1009" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1010"><a href="#cb115-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1011"><a href="#cb115-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1012"><a href="#cb115-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1013"><a href="#cb115-1013" aria-hidden="true" tabindex="-1"></a><span class="fu">## Process data function</span></span>
<span id="cb115-1014"><a href="#cb115-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1015"><a href="#cb115-1015" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-1016"><a href="#cb115-1016" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1019"><a href="#cb115-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1020"><a href="#cb115-1020" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat0 <span class="sc">|&gt;</span> </span>
<span id="cb115-1021"><a href="#cb115-1021" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb115-1022"><a href="#cb115-1022" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb115-1023"><a href="#cb115-1023" aria-hidden="true" tabindex="-1"></a>      <span class="at">A_lag1 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1024"><a href="#cb115-1024" aria-hidden="true" tabindex="-1"></a>      <span class="at">A_lag2 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1025"><a href="#cb115-1025" aria-hidden="true" tabindex="-1"></a>      <span class="at">M_lag1 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1026"><a href="#cb115-1026" aria-hidden="true" tabindex="-1"></a>      <span class="at">M_lag2 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1027"><a href="#cb115-1027" aria-hidden="true" tabindex="-1"></a>      <span class="at">L1_lag1 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1028"><a href="#cb115-1028" aria-hidden="true" tabindex="-1"></a>      <span class="at">L1_lag2 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1029"><a href="#cb115-1029" aria-hidden="true" tabindex="-1"></a>      <span class="at">L2_lag1 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb115-1030"><a href="#cb115-1030" aria-hidden="true" tabindex="-1"></a>      <span class="at">L2_lag2 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb115-1031"><a href="#cb115-1031" aria-hidden="true" tabindex="-1"></a>      <span class="at">L3_lag1 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">80</span>),</span>
<span id="cb115-1032"><a href="#cb115-1032" aria-hidden="true" tabindex="-1"></a>      <span class="at">L3_lag2 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">80</span>)</span>
<span id="cb115-1033"><a href="#cb115-1033" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">df_prep</span>()</span>
<span id="cb115-1034"><a href="#cb115-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1035"><a href="#cb115-1035" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb115-1036"><a href="#cb115-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1037"><a href="#cb115-1037" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1038"><a href="#cb115-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1039"><a href="#cb115-1039" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1042"><a href="#cb115-1042" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1043"><a href="#cb115-1043" aria-hidden="true" tabindex="-1"></a>data_pro <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-1044"><a href="#cb115-1044" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-1045"><a href="#cb115-1045" aria-hidden="true" tabindex="-1"></a>    <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-1046"><a href="#cb115-1046" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-1047"><a href="#cb115-1047" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-1048"><a href="#cb115-1048" aria-hidden="true" tabindex="-1"></a>    <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-1049"><a href="#cb115-1049" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-1050"><a href="#cb115-1050" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-1051"><a href="#cb115-1051" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat0</span>
<span id="cb115-1052"><a href="#cb115-1052" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb115-1053"><a href="#cb115-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1054"><a href="#cb115-1054" aria-hidden="true" tabindex="-1"></a>data_pro<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span>
<span id="cb115-1055"><a href="#cb115-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1056"><a href="#cb115-1056" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1057"><a href="#cb115-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1058"><a href="#cb115-1058" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1059"><a href="#cb115-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1062"><a href="#cb115-1062" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1063"><a href="#cb115-1063" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"process_data function"</span>, {</span>
<span id="cb115-1064"><a href="#cb115-1064" aria-hidden="true" tabindex="-1"></a>  <span class="do">## id, v1 - v4</span></span>
<span id="cb115-1065"><a href="#cb115-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)])</span>
<span id="cb115-1066"><a href="#cb115-1066" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1067"><a href="#cb115-1067" aria-hidden="true" tabindex="-1"></a>  <span class="do">## exposure variables</span></span>
<span id="cb115-1068"><a href="#cb115-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"A"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"A1"</span>)])</span>
<span id="cb115-1069"><a href="#cb115-1069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"Al1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"A1l1"</span>)])</span>
<span id="cb115-1070"><a href="#cb115-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"Al2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"A1l2"</span>)])</span>
<span id="cb115-1071"><a href="#cb115-1071" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1072"><a href="#cb115-1072" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate</span></span>
<span id="cb115-1073"><a href="#cb115-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L1"</span>)])</span>
<span id="cb115-1074"><a href="#cb115-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L2"</span>)])</span>
<span id="cb115-1075"><a href="#cb115-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T3"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L3"</span>)])</span>
<span id="cb115-1076"><a href="#cb115-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1077"><a href="#cb115-1077" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate + lag</span></span>
<span id="cb115-1078"><a href="#cb115-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T1l1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L1l1"</span>)])</span>
<span id="cb115-1079"><a href="#cb115-1079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T2l1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L2l1"</span>)])</span>
<span id="cb115-1080"><a href="#cb115-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T3l1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L3l1"</span>)])</span>
<span id="cb115-1081"><a href="#cb115-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1082"><a href="#cb115-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T1l2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L1l2"</span>)])</span>
<span id="cb115-1083"><a href="#cb115-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T2l2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L2l2"</span>)])</span>
<span id="cb115-1084"><a href="#cb115-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"T3l2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"L3l2"</span>)])</span>
<span id="cb115-1085"><a href="#cb115-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1086"><a href="#cb115-1086" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mediator</span></span>
<span id="cb115-1087"><a href="#cb115-1087" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"M1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb115-1088"><a href="#cb115-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)])</span>
<span id="cb115-1089"><a href="#cb115-1089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)])</span>
<span id="cb115-1090"><a href="#cb115-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1091"><a href="#cb115-1091" aria-hidden="true" tabindex="-1"></a>  <span class="do">## outcome and time</span></span>
<span id="cb115-1092"><a href="#cb115-1092" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dat[,<span class="fu">c</span>(<span class="st">"Y"</span>,<span class="st">"j"</span>)],data_pro<span class="sc">$</span>df[,<span class="fu">c</span>(<span class="st">"Y"</span>,<span class="st">"j"</span>)])</span>
<span id="cb115-1093"><a href="#cb115-1093" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1094"><a href="#cb115-1094" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb115-1095"><a href="#cb115-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1096"><a href="#cb115-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1097"><a href="#cb115-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">## fitg function</span></span>
<span id="cb115-1098"><a href="#cb115-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1099"><a href="#cb115-1099" aria-hidden="true" tabindex="-1"></a><span class="fu">### seed = 0, no bootstrap</span></span>
<span id="cb115-1100"><a href="#cb115-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1101"><a href="#cb115-1101" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-1102"><a href="#cb115-1102" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1105"><a href="#cb115-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1106"><a href="#cb115-1106" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> dat0 <span class="sc">|&gt;</span> </span>
<span id="cb115-1107"><a href="#cb115-1107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb115-1108"><a href="#cb115-1108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb115-1109"><a href="#cb115-1109" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag1 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1110"><a href="#cb115-1110" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag2 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1111"><a href="#cb115-1111" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag1 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1112"><a href="#cb115-1112" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag2 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1113"><a href="#cb115-1113" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag1 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1114"><a href="#cb115-1114" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag2 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1115"><a href="#cb115-1115" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag1 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb115-1116"><a href="#cb115-1116" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag2 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb115-1117"><a href="#cb115-1117" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag1 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">80</span>),</span>
<span id="cb115-1118"><a href="#cb115-1118" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag2 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">80</span>)</span>
<span id="cb115-1119"><a href="#cb115-1119" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">df_prep</span>()</span>
<span id="cb115-1120"><a href="#cb115-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1121"><a href="#cb115-1121" aria-hidden="true" tabindex="-1"></a>boot <span class="ot">&lt;-</span> df</span>
<span id="cb115-1122"><a href="#cb115-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1123"><a href="#cb115-1123" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">scale</span>(boot<span class="sc">$</span>j)</span>
<span id="cb115-1124"><a href="#cb115-1124" aria-hidden="true" tabindex="-1"></a>mean_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb115-1125"><a href="#cb115-1125" aria-hidden="true" tabindex="-1"></a>sd_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb115-1126"><a href="#cb115-1126" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(boot<span class="sc">$</span>jj)</span>
<span id="cb115-1127"><a href="#cb115-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1128"><a href="#cb115-1128" aria-hidden="true" tabindex="-1"></a><span class="co">#----- fit parametric models for</span></span>
<span id="cb115-1129"><a href="#cb115-1129" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Mediator models</span></span>
<span id="cb115-1130"><a href="#cb115-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1131"><a href="#cb115-1131" aria-hidden="true" tabindex="-1"></a>mM1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-1132"><a href="#cb115-1132" aria-hidden="true" tabindex="-1"></a>  fitM1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(M1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-1133"><a href="#cb115-1133" aria-hidden="true" tabindex="-1"></a>                 v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb115-1134"><a href="#cb115-1134" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb115-1135"><a href="#cb115-1135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitM1)</span>
<span id="cb115-1136"><a href="#cb115-1136" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1137"><a href="#cb115-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1138"><a href="#cb115-1138" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitM1)</span></span>
<span id="cb115-1139"><a href="#cb115-1139" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Covariate models</span></span>
<span id="cb115-1140"><a href="#cb115-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1141"><a href="#cb115-1141" aria-hidden="true" tabindex="-1"></a>mT1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-1142"><a href="#cb115-1142" aria-hidden="true" tabindex="-1"></a>  fitT1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(T1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-1143"><a href="#cb115-1143" aria-hidden="true" tabindex="-1"></a>                 v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb115-1144"><a href="#cb115-1144" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb115-1145"><a href="#cb115-1145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT1)</span>
<span id="cb115-1146"><a href="#cb115-1146" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1147"><a href="#cb115-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1148"><a href="#cb115-1148" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitT1)</span></span>
<span id="cb115-1149"><a href="#cb115-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1150"><a href="#cb115-1150" aria-hidden="true" tabindex="-1"></a>mT2 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-1151"><a href="#cb115-1151" aria-hidden="true" tabindex="-1"></a>  fitT2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T2 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-1152"><a href="#cb115-1152" aria-hidden="true" tabindex="-1"></a>                v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb115-1153"><a href="#cb115-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT2)</span>
<span id="cb115-1154"><a href="#cb115-1154" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1155"><a href="#cb115-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1156"><a href="#cb115-1156" aria-hidden="true" tabindex="-1"></a>mT3 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-1157"><a href="#cb115-1157" aria-hidden="true" tabindex="-1"></a>  fitT3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T3 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-1158"><a href="#cb115-1158" aria-hidden="true" tabindex="-1"></a>                v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb115-1159"><a href="#cb115-1159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT3)</span>
<span id="cb115-1160"><a href="#cb115-1160" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1161"><a href="#cb115-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1162"><a href="#cb115-1162" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome model: E(Y|a, m, l, v)</span></span>
<span id="cb115-1163"><a href="#cb115-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1164"><a href="#cb115-1164" aria-hidden="true" tabindex="-1"></a>mY <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb115-1165"><a href="#cb115-1165" aria-hidden="true" tabindex="-1"></a>  fitY <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> </span>
<span id="cb115-1166"><a href="#cb115-1166" aria-hidden="true" tabindex="-1"></a>                T3 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span>  v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb115-1167"><a href="#cb115-1167" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb115-1168"><a href="#cb115-1168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitY)</span>
<span id="cb115-1169"><a href="#cb115-1169" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1170"><a href="#cb115-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1171"><a href="#cb115-1171" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitY)</span></span>
<span id="cb115-1172"><a href="#cb115-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1173"><a href="#cb115-1173" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit all models and save in a list</span></span>
<span id="cb115-1174"><a href="#cb115-1174" aria-hidden="true" tabindex="-1"></a>mR <span class="ot">&lt;-</span> <span class="fu">c</span>(mM1, mY, mT1, mT2, mT3)</span>
<span id="cb115-1175"><a href="#cb115-1175" aria-hidden="true" tabindex="-1"></a>fitR <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="cf">function</span>(x) mR[[x]](k))</span>
<span id="cb115-1176"><a href="#cb115-1176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1177"><a href="#cb115-1177" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1178"><a href="#cb115-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1179"><a href="#cb115-1179" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1182"><a href="#cb115-1182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1183"><a href="#cb115-1183" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-1184"><a href="#cb115-1184" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-1185"><a href="#cb115-1185" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-1186"><a href="#cb115-1186" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-1187"><a href="#cb115-1187" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-1188"><a href="#cb115-1188" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-1189"><a href="#cb115-1189" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-1190"><a href="#cb115-1190" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-1191"><a href="#cb115-1191" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-1192"><a href="#cb115-1192" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>F,</span>
<span id="cb115-1193"><a href="#cb115-1193" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-1194"><a href="#cb115-1194" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-1195"><a href="#cb115-1195" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) </span>
<span id="cb115-1196"><a href="#cb115-1196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1197"><a href="#cb115-1197" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1198"><a href="#cb115-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1199"><a href="#cb115-1199" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1200"><a href="#cb115-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1203"><a href="#cb115-1203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1204"><a href="#cb115-1204" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"fitg function"</span>, {</span>
<span id="cb115-1205"><a href="#cb115-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1206"><a href="#cb115-1206" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model M(t)</span></span>
<span id="cb115-1207"><a href="#cb115-1207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1208"><a href="#cb115-1208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1209"><a href="#cb115-1209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1210"><a href="#cb115-1210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1211"><a href="#cb115-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1212"><a href="#cb115-1212" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model Y</span></span>
<span id="cb115-1213"><a href="#cb115-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1214"><a href="#cb115-1214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1215"><a href="#cb115-1215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1216"><a href="#cb115-1216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1217"><a href="#cb115-1217" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1218"><a href="#cb115-1218" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L1</span></span>
<span id="cb115-1219"><a href="#cb115-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1220"><a href="#cb115-1220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1221"><a href="#cb115-1221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1222"><a href="#cb115-1222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1223"><a href="#cb115-1223" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1224"><a href="#cb115-1224" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L2</span></span>
<span id="cb115-1225"><a href="#cb115-1225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1226"><a href="#cb115-1226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1227"><a href="#cb115-1227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1228"><a href="#cb115-1228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1229"><a href="#cb115-1229" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1230"><a href="#cb115-1230" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L3</span></span>
<span id="cb115-1231"><a href="#cb115-1231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1232"><a href="#cb115-1232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1233"><a href="#cb115-1233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1234"><a href="#cb115-1234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1235"><a href="#cb115-1235" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb115-1236"><a href="#cb115-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1237"><a href="#cb115-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1238"><a href="#cb115-1238" aria-hidden="true" tabindex="-1"></a><span class="fu">### seed != 0, bootstrap</span></span>
<span id="cb115-1239"><a href="#cb115-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1240"><a href="#cb115-1240" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-1241"><a href="#cb115-1241" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1244"><a href="#cb115-1244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1245"><a href="#cb115-1245" aria-hidden="true" tabindex="-1"></a><span class="do">## seed = 123</span></span>
<span id="cb115-1246"><a href="#cb115-1246" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> dat0 <span class="sc">|&gt;</span> </span>
<span id="cb115-1247"><a href="#cb115-1247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb115-1248"><a href="#cb115-1248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb115-1249"><a href="#cb115-1249" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag1 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1250"><a href="#cb115-1250" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag2 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1251"><a href="#cb115-1251" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag1 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1252"><a href="#cb115-1252" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag2 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1253"><a href="#cb115-1253" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag1 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1254"><a href="#cb115-1254" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag2 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1255"><a href="#cb115-1255" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag1 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb115-1256"><a href="#cb115-1256" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag2 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb115-1257"><a href="#cb115-1257" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag1 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">80</span>),</span>
<span id="cb115-1258"><a href="#cb115-1258" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag2 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">80</span>)</span>
<span id="cb115-1259"><a href="#cb115-1259" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">df_prep</span>()</span>
<span id="cb115-1260"><a href="#cb115-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1261"><a href="#cb115-1261" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-1262"><a href="#cb115-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1263"><a href="#cb115-1263" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(df<span class="sc">$</span>id))</span>
<span id="cb115-1264"><a href="#cb115-1264" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters), <span class="fu">length</span>(clusters), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-1265"><a href="#cb115-1265" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters[index])</span>
<span id="cb115-1266"><a href="#cb115-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1267"><a href="#cb115-1267" aria-hidden="true" tabindex="-1"></a>boot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb115-1268"><a href="#cb115-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1269"><a href="#cb115-1269" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb115-1270"><a href="#cb115-1270" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loop over repeated id</span></span>
<span id="cb115-1271"><a href="#cb115-1271" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb115-1272"><a href="#cb115-1272" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>id, zzz)</span>
<span id="cb115-1273"><a href="#cb115-1273" aria-hidden="true" tabindex="-1"></a>      boot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(boot, cc)</span>
<span id="cb115-1274"><a href="#cb115-1274" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-1275"><a href="#cb115-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1276"><a href="#cb115-1276" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">scale</span>(boot<span class="sc">$</span>j)</span>
<span id="cb115-1277"><a href="#cb115-1277" aria-hidden="true" tabindex="-1"></a>mean_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb115-1278"><a href="#cb115-1278" aria-hidden="true" tabindex="-1"></a>sd_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb115-1279"><a href="#cb115-1279" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(boot<span class="sc">$</span>jj)</span>
<span id="cb115-1280"><a href="#cb115-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1281"><a href="#cb115-1281" aria-hidden="true" tabindex="-1"></a><span class="co">#----- fit parametric models for</span></span>
<span id="cb115-1282"><a href="#cb115-1282" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Mediator models</span></span>
<span id="cb115-1283"><a href="#cb115-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1284"><a href="#cb115-1284" aria-hidden="true" tabindex="-1"></a>mM1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-1285"><a href="#cb115-1285" aria-hidden="true" tabindex="-1"></a>  fitM1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(M1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-1286"><a href="#cb115-1286" aria-hidden="true" tabindex="-1"></a>                 v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb115-1287"><a href="#cb115-1287" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb115-1288"><a href="#cb115-1288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitM1)</span>
<span id="cb115-1289"><a href="#cb115-1289" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1290"><a href="#cb115-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1291"><a href="#cb115-1291" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitM1)</span></span>
<span id="cb115-1292"><a href="#cb115-1292" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Covariate models</span></span>
<span id="cb115-1293"><a href="#cb115-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1294"><a href="#cb115-1294" aria-hidden="true" tabindex="-1"></a>mT1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-1295"><a href="#cb115-1295" aria-hidden="true" tabindex="-1"></a>  fitT1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(T1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-1296"><a href="#cb115-1296" aria-hidden="true" tabindex="-1"></a>                 v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb115-1297"><a href="#cb115-1297" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb115-1298"><a href="#cb115-1298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT1)</span>
<span id="cb115-1299"><a href="#cb115-1299" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1300"><a href="#cb115-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1301"><a href="#cb115-1301" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitT1)</span></span>
<span id="cb115-1302"><a href="#cb115-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1303"><a href="#cb115-1303" aria-hidden="true" tabindex="-1"></a>mT2 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-1304"><a href="#cb115-1304" aria-hidden="true" tabindex="-1"></a>  fitT2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T2 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-1305"><a href="#cb115-1305" aria-hidden="true" tabindex="-1"></a>                v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb115-1306"><a href="#cb115-1306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT2)</span>
<span id="cb115-1307"><a href="#cb115-1307" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1308"><a href="#cb115-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1309"><a href="#cb115-1309" aria-hidden="true" tabindex="-1"></a>mT3 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-1310"><a href="#cb115-1310" aria-hidden="true" tabindex="-1"></a>  fitT3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T3 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-1311"><a href="#cb115-1311" aria-hidden="true" tabindex="-1"></a>                v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb115-1312"><a href="#cb115-1312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitT3)</span>
<span id="cb115-1313"><a href="#cb115-1313" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1314"><a href="#cb115-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1315"><a href="#cb115-1315" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome model: E(Y|a, m, l, v)</span></span>
<span id="cb115-1316"><a href="#cb115-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1317"><a href="#cb115-1317" aria-hidden="true" tabindex="-1"></a>mY <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb115-1318"><a href="#cb115-1318" aria-hidden="true" tabindex="-1"></a>  fitY <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> </span>
<span id="cb115-1319"><a href="#cb115-1319" aria-hidden="true" tabindex="-1"></a>                T3 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span>  v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb115-1320"><a href="#cb115-1320" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb115-1321"><a href="#cb115-1321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fitY)</span>
<span id="cb115-1322"><a href="#cb115-1322" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-1323"><a href="#cb115-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1324"><a href="#cb115-1324" aria-hidden="true" tabindex="-1"></a><span class="co"># PseudoR2(fitY)</span></span>
<span id="cb115-1325"><a href="#cb115-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1326"><a href="#cb115-1326" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit all models and save in a list</span></span>
<span id="cb115-1327"><a href="#cb115-1327" aria-hidden="true" tabindex="-1"></a>mR <span class="ot">&lt;-</span> <span class="fu">c</span>(mM1, mY, mT1, mT2, mT3)</span>
<span id="cb115-1328"><a href="#cb115-1328" aria-hidden="true" tabindex="-1"></a>fitR <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="cf">function</span>(x) mR[[x]](k))</span>
<span id="cb115-1329"><a href="#cb115-1329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1330"><a href="#cb115-1330" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1331"><a href="#cb115-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1332"><a href="#cb115-1332" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1335"><a href="#cb115-1335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1336"><a href="#cb115-1336" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-1337"><a href="#cb115-1337" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-1338"><a href="#cb115-1338" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-1339"><a href="#cb115-1339" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-1340"><a href="#cb115-1340" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-1341"><a href="#cb115-1341" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-1342"><a href="#cb115-1342" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-1343"><a href="#cb115-1343" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-1344"><a href="#cb115-1344" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-1345"><a href="#cb115-1345" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-1346"><a href="#cb115-1346" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb115-1347"><a href="#cb115-1347" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-1348"><a href="#cb115-1348" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-1349"><a href="#cb115-1349" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) </span>
<span id="cb115-1350"><a href="#cb115-1350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1351"><a href="#cb115-1351" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1352"><a href="#cb115-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1353"><a href="#cb115-1353" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1354"><a href="#cb115-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1357"><a href="#cb115-1357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1358"><a href="#cb115-1358" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"fitg function"</span>, {</span>
<span id="cb115-1359"><a href="#cb115-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1360"><a href="#cb115-1360" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model M(t)</span></span>
<span id="cb115-1361"><a href="#cb115-1361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1362"><a href="#cb115-1362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1363"><a href="#cb115-1363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1364"><a href="#cb115-1364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1365"><a href="#cb115-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1366"><a href="#cb115-1366" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model Y</span></span>
<span id="cb115-1367"><a href="#cb115-1367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1368"><a href="#cb115-1368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1369"><a href="#cb115-1369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1370"><a href="#cb115-1370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>Y<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1371"><a href="#cb115-1371" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1372"><a href="#cb115-1372" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L1</span></span>
<span id="cb115-1373"><a href="#cb115-1373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1374"><a href="#cb115-1374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1375"><a href="#cb115-1375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1376"><a href="#cb115-1376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1377"><a href="#cb115-1377" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1378"><a href="#cb115-1378" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L2</span></span>
<span id="cb115-1379"><a href="#cb115-1379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1380"><a href="#cb115-1380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1381"><a href="#cb115-1381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1382"><a href="#cb115-1382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">4</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">2</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1383"><a href="#cb115-1383" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1384"><a href="#cb115-1384" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model L3</span></span>
<span id="cb115-1385"><a href="#cb115-1385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">min</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1386"><a href="#cb115-1386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">max</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1387"><a href="#cb115-1387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">mean</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">mean</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1388"><a href="#cb115-1388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">sd</span>(fitR[[<span class="dv">5</span>]]<span class="sc">$</span>fitted.values),<span class="fu">sd</span>(fitR2<span class="sc">$</span>L[[<span class="dv">3</span>]]<span class="sc">$</span>fitted.values))</span>
<span id="cb115-1389"><a href="#cb115-1389" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb115-1390"><a href="#cb115-1390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1391"><a href="#cb115-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1392"><a href="#cb115-1392" aria-hidden="true" tabindex="-1"></a><span class="fu">## baseline_mc function</span></span>
<span id="cb115-1393"><a href="#cb115-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1394"><a href="#cb115-1394" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-1395"><a href="#cb115-1395" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1396"><a href="#cb115-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1399"><a href="#cb115-1399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1400"><a href="#cb115-1400" aria-hidden="true" tabindex="-1"></a><span class="do">## seed = 123</span></span>
<span id="cb115-1401"><a href="#cb115-1401" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> dat0 <span class="sc">|&gt;</span> </span>
<span id="cb115-1402"><a href="#cb115-1402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb115-1403"><a href="#cb115-1403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb115-1404"><a href="#cb115-1404" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag1 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1405"><a href="#cb115-1405" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag2 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1406"><a href="#cb115-1406" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag1 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1407"><a href="#cb115-1407" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag2 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1408"><a href="#cb115-1408" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag1 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1409"><a href="#cb115-1409" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag2 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-1410"><a href="#cb115-1410" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag1 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb115-1411"><a href="#cb115-1411" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag2 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb115-1412"><a href="#cb115-1412" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag1 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">80</span>),</span>
<span id="cb115-1413"><a href="#cb115-1413" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag2 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">80</span>)</span>
<span id="cb115-1414"><a href="#cb115-1414" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">df_prep</span>()</span>
<span id="cb115-1415"><a href="#cb115-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1416"><a href="#cb115-1416" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-1417"><a href="#cb115-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1418"><a href="#cb115-1418" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(df<span class="sc">$</span>id))</span>
<span id="cb115-1419"><a href="#cb115-1419" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters), <span class="fu">length</span>(clusters), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-1420"><a href="#cb115-1420" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters[index])</span>
<span id="cb115-1421"><a href="#cb115-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1422"><a href="#cb115-1422" aria-hidden="true" tabindex="-1"></a>boot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb115-1423"><a href="#cb115-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1424"><a href="#cb115-1424" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb115-1425"><a href="#cb115-1425" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loop over repeated id</span></span>
<span id="cb115-1426"><a href="#cb115-1426" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb115-1427"><a href="#cb115-1427" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>id, zzz)</span>
<span id="cb115-1428"><a href="#cb115-1428" aria-hidden="true" tabindex="-1"></a>      boot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(boot, cc)</span>
<span id="cb115-1429"><a href="#cb115-1429" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-1430"><a href="#cb115-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1431"><a href="#cb115-1431" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">scale</span>(boot<span class="sc">$</span>j)</span>
<span id="cb115-1432"><a href="#cb115-1432" aria-hidden="true" tabindex="-1"></a>mean_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb115-1433"><a href="#cb115-1433" aria-hidden="true" tabindex="-1"></a>sd_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb115-1434"><a href="#cb115-1434" aria-hidden="true" tabindex="-1"></a>boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(boot<span class="sc">$</span>jj)</span>
<span id="cb115-1435"><a href="#cb115-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1436"><a href="#cb115-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1437"><a href="#cb115-1437" aria-hidden="true" tabindex="-1"></a>montecarlo <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb115-1438"><a href="#cb115-1438" aria-hidden="true" tabindex="-1"></a><span class="co"># Select baseline visit</span></span>
<span id="cb115-1439"><a href="#cb115-1439" aria-hidden="true" tabindex="-1"></a>  df0 <span class="ot">&lt;-</span> boot[boot<span class="sc">$</span>j<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb115-1440"><a href="#cb115-1440" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1441"><a href="#cb115-1441" aria-hidden="true" tabindex="-1"></a>  df0<span class="sc">$</span>idn <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df0)</span>
<span id="cb115-1442"><a href="#cb115-1442" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1443"><a href="#cb115-1443" aria-hidden="true" tabindex="-1"></a>  MC <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb115-1444"><a href="#cb115-1444" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1445"><a href="#cb115-1445" aria-hidden="true" tabindex="-1"></a>    samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(df0<span class="sc">$</span>idn, <span class="at">size =</span> montecarlo, <span class="at">replace =</span> T)</span>
<span id="cb115-1446"><a href="#cb115-1446" aria-hidden="true" tabindex="-1"></a>    bb <span class="ot">&lt;-</span> <span class="fu">table</span>(samples)</span>
<span id="cb115-1447"><a href="#cb115-1447" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-1448"><a href="#cb115-1448" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb115-1449"><a href="#cb115-1449" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df0[df0<span class="sc">$</span>idn <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb115-1450"><a href="#cb115-1450" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>idn, zzz)</span>
<span id="cb115-1451"><a href="#cb115-1451" aria-hidden="true" tabindex="-1"></a>      MC <span class="ot">&lt;-</span> <span class="fu">rbind</span>(MC, cc)</span>
<span id="cb115-1452"><a href="#cb115-1452" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-1453"><a href="#cb115-1453" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-1454"><a href="#cb115-1454" aria-hidden="true" tabindex="-1"></a>    MC<span class="sc">$</span>idsim <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>montecarlo</span>
<span id="cb115-1455"><a href="#cb115-1455" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-1456"><a href="#cb115-1456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1457"><a href="#cb115-1457" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1458"><a href="#cb115-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1459"><a href="#cb115-1459" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1462"><a href="#cb115-1462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1463"><a href="#cb115-1463" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-1464"><a href="#cb115-1464" aria-hidden="true" tabindex="-1"></a>fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-1465"><a href="#cb115-1465" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-1466"><a href="#cb115-1466" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-1467"><a href="#cb115-1467" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-1468"><a href="#cb115-1468" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-1469"><a href="#cb115-1469" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-1470"><a href="#cb115-1470" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-1471"><a href="#cb115-1471" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-1472"><a href="#cb115-1472" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-1473"><a href="#cb115-1473" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb115-1474"><a href="#cb115-1474" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-1475"><a href="#cb115-1475" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-1476"><a href="#cb115-1476" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1477"><a href="#cb115-1477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>)</span>
<span id="cb115-1478"><a href="#cb115-1478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1479"><a href="#cb115-1479" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1480"><a href="#cb115-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1481"><a href="#cb115-1481" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1482"><a href="#cb115-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1485"><a href="#cb115-1485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1486"><a href="#cb115-1486" aria-hidden="true" tabindex="-1"></a>along_redf <span class="ot">&lt;-</span> MC <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb115-1487"><a href="#cb115-1487" aria-hidden="true" tabindex="-1"></a>test_redf <span class="ot">&lt;-</span> fitR2<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb115-1488"><a href="#cb115-1488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1489"><a href="#cb115-1489" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"baseline_mc function"</span>, {</span>
<span id="cb115-1490"><a href="#cb115-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1491"><a href="#cb115-1491" aria-hidden="true" tabindex="-1"></a>  <span class="co"># id, v1 - v4</span></span>
<span id="cb115-1492"><a href="#cb115-1492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">1</span>],test_redf[,<span class="dv">1</span>])</span>
<span id="cb115-1493"><a href="#cb115-1493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">2</span>],test_redf[,<span class="dv">2</span>])</span>
<span id="cb115-1494"><a href="#cb115-1494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">3</span>],test_redf[,<span class="dv">3</span>])</span>
<span id="cb115-1495"><a href="#cb115-1495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">4</span>],test_redf[,<span class="dv">4</span>])</span>
<span id="cb115-1496"><a href="#cb115-1496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">5</span>],test_redf[,<span class="dv">5</span>])</span>
<span id="cb115-1497"><a href="#cb115-1497" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1498"><a href="#cb115-1498" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exposure variables</span></span>
<span id="cb115-1499"><a href="#cb115-1499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"A"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1"</span>)])</span>
<span id="cb115-1500"><a href="#cb115-1500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Al1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1l1"</span>)])</span>
<span id="cb115-1501"><a href="#cb115-1501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Al2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1l2"</span>)])</span>
<span id="cb115-1502"><a href="#cb115-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1503"><a href="#cb115-1503" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate</span></span>
<span id="cb115-1504"><a href="#cb115-1504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1"</span>)])</span>
<span id="cb115-1505"><a href="#cb115-1505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2"</span>)])</span>
<span id="cb115-1506"><a href="#cb115-1506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3"</span>)])</span>
<span id="cb115-1507"><a href="#cb115-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1508"><a href="#cb115-1508" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate + lag</span></span>
<span id="cb115-1509"><a href="#cb115-1509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1l1"</span>)])</span>
<span id="cb115-1510"><a href="#cb115-1510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2l1"</span>)])</span>
<span id="cb115-1511"><a href="#cb115-1511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3l1"</span>)])</span>
<span id="cb115-1512"><a href="#cb115-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1513"><a href="#cb115-1513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1l2"</span>)])</span>
<span id="cb115-1514"><a href="#cb115-1514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2l2"</span>)])</span>
<span id="cb115-1515"><a href="#cb115-1515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3l2"</span>)])</span>
<span id="cb115-1516"><a href="#cb115-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1517"><a href="#cb115-1517" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mediator</span></span>
<span id="cb115-1518"><a href="#cb115-1518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb115-1519"><a href="#cb115-1519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)])</span>
<span id="cb115-1520"><a href="#cb115-1520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)])</span>
<span id="cb115-1521"><a href="#cb115-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1522"><a href="#cb115-1522" aria-hidden="true" tabindex="-1"></a>  <span class="do">## outcome and time</span></span>
<span id="cb115-1523"><a href="#cb115-1523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Y"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Y"</span>)])</span>
<span id="cb115-1524"><a href="#cb115-1524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"j"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"j"</span>)])</span>
<span id="cb115-1525"><a href="#cb115-1525" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb115-1526"><a href="#cb115-1526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1527"><a href="#cb115-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1528"><a href="#cb115-1528" aria-hidden="true" tabindex="-1"></a><span class="fu">## g_form function</span></span>
<span id="cb115-1529"><a href="#cb115-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1530"><a href="#cb115-1530" aria-hidden="true" tabindex="-1"></a><span class="fu">### ay = 1, am = 1</span></span>
<span id="cb115-1531"><a href="#cb115-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1532"><a href="#cb115-1532" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-1533"><a href="#cb115-1533" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1534"><a href="#cb115-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1537"><a href="#cb115-1537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1538"><a href="#cb115-1538" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">=</span> <span class="dv">123</span></span>
<span id="cb115-1539"><a href="#cb115-1539" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(seed)</span>
<span id="cb115-1540"><a href="#cb115-1540" aria-hidden="true" tabindex="-1"></a>along_redf <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">1</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1541"><a href="#cb115-1541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb115-1542"><a href="#cb115-1542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1543"><a href="#cb115-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1544"><a href="#cb115-1544" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1545"><a href="#cb115-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1546"><a href="#cb115-1546" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1549"><a href="#cb115-1549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1550"><a href="#cb115-1550" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-1551"><a href="#cb115-1551" aria-hidden="true" tabindex="-1"></a>test_redf <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-1552"><a href="#cb115-1552" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-1553"><a href="#cb115-1553" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-1554"><a href="#cb115-1554" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-1555"><a href="#cb115-1555" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-1556"><a href="#cb115-1556" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-1557"><a href="#cb115-1557" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-1558"><a href="#cb115-1558" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-1559"><a href="#cb115-1559" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-1560"><a href="#cb115-1560" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-1561"><a href="#cb115-1561" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb115-1562"><a href="#cb115-1562" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-1563"><a href="#cb115-1563" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-1564"><a href="#cb115-1564" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1565"><a href="#cb115-1565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1566"><a href="#cb115-1566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-1567"><a href="#cb115-1567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1568"><a href="#cb115-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1569"><a href="#cb115-1569" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1570"><a href="#cb115-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1571"><a href="#cb115-1571" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1572"><a href="#cb115-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1573"><a href="#cb115-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1576"><a href="#cb115-1576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1577"><a href="#cb115-1577" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"gform function"</span>, {</span>
<span id="cb115-1578"><a href="#cb115-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1579"><a href="#cb115-1579" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num - Am</span></span>
<span id="cb115-1580"><a href="#cb115-1580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)],test_redf[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)])</span>
<span id="cb115-1581"><a href="#cb115-1581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"v1"</span>,<span class="st">"v2"</span>,<span class="st">"v3"</span>,<span class="st">"v4"</span>,<span class="st">"lastid"</span>)],</span>
<span id="cb115-1582"><a href="#cb115-1582" aria-hidden="true" tabindex="-1"></a>               test_redf[,<span class="fu">c</span>(<span class="st">"v1"</span>,<span class="st">"v2"</span>,<span class="st">"v3"</span>,<span class="st">"v4"</span>,<span class="st">"lastid"</span>)])</span>
<span id="cb115-1583"><a href="#cb115-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1584"><a href="#cb115-1584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb115-1585"><a href="#cb115-1585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp1"</span>)])</span>
<span id="cb115-1586"><a href="#cb115-1586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lp1"</span>)])</span>
<span id="cb115-1587"><a href="#cb115-1587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp2"</span>)])</span>
<span id="cb115-1588"><a href="#cb115-1588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lp2"</span>)])</span>
<span id="cb115-1589"><a href="#cb115-1589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp3"</span>)])</span>
<span id="cb115-1590"><a href="#cb115-1590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3p"</span>)], test_redf[,<span class="fu">c</span>(<span class="st">"Lp3"</span>)])</span>
<span id="cb115-1591"><a href="#cb115-1591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Yp"</span>)], test_redf[,<span class="fu">c</span>(<span class="st">"Yp2"</span>)])</span>
<span id="cb115-1592"><a href="#cb115-1592" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb115-1593"><a href="#cb115-1593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1594"><a href="#cb115-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1595"><a href="#cb115-1595" aria-hidden="true" tabindex="-1"></a><span class="fu">### ay = 0, am = 0</span></span>
<span id="cb115-1596"><a href="#cb115-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1597"><a href="#cb115-1597" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-1598"><a href="#cb115-1598" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1599"><a href="#cb115-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1602"><a href="#cb115-1602" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1603"><a href="#cb115-1603" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">=</span> <span class="dv">123</span></span>
<span id="cb115-1604"><a href="#cb115-1604" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(seed)</span>
<span id="cb115-1605"><a href="#cb115-1605" aria-hidden="true" tabindex="-1"></a>along_redf <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1606"><a href="#cb115-1606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb115-1607"><a href="#cb115-1607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1608"><a href="#cb115-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1609"><a href="#cb115-1609" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1610"><a href="#cb115-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1611"><a href="#cb115-1611" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1614"><a href="#cb115-1614" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1615"><a href="#cb115-1615" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-1616"><a href="#cb115-1616" aria-hidden="true" tabindex="-1"></a>test_redf <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-1617"><a href="#cb115-1617" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-1618"><a href="#cb115-1618" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-1619"><a href="#cb115-1619" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-1620"><a href="#cb115-1620" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-1621"><a href="#cb115-1621" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-1622"><a href="#cb115-1622" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-1623"><a href="#cb115-1623" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-1624"><a href="#cb115-1624" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-1625"><a href="#cb115-1625" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-1626"><a href="#cb115-1626" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb115-1627"><a href="#cb115-1627" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-1628"><a href="#cb115-1628" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-1629"><a href="#cb115-1629" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1630"><a href="#cb115-1630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1631"><a href="#cb115-1631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-1632"><a href="#cb115-1632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1633"><a href="#cb115-1633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1634"><a href="#cb115-1634" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1635"><a href="#cb115-1635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1636"><a href="#cb115-1636" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1637"><a href="#cb115-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1638"><a href="#cb115-1638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1641"><a href="#cb115-1641" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1642"><a href="#cb115-1642" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"gform function"</span>, {</span>
<span id="cb115-1643"><a href="#cb115-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1644"><a href="#cb115-1644" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num - Am</span></span>
<span id="cb115-1645"><a href="#cb115-1645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)],test_redf[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)])</span>
<span id="cb115-1646"><a href="#cb115-1646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"v1"</span>,<span class="st">"v2"</span>,<span class="st">"v3"</span>,<span class="st">"v4"</span>,<span class="st">"lastid"</span>)],</span>
<span id="cb115-1647"><a href="#cb115-1647" aria-hidden="true" tabindex="-1"></a>               test_redf[,<span class="fu">c</span>(<span class="st">"v1"</span>,<span class="st">"v2"</span>,<span class="st">"v3"</span>,<span class="st">"v4"</span>,<span class="st">"lastid"</span>)])</span>
<span id="cb115-1648"><a href="#cb115-1648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1649"><a href="#cb115-1649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb115-1650"><a href="#cb115-1650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp1"</span>)])</span>
<span id="cb115-1651"><a href="#cb115-1651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lp1"</span>)])</span>
<span id="cb115-1652"><a href="#cb115-1652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp2"</span>)])</span>
<span id="cb115-1653"><a href="#cb115-1653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2p"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lp2"</span>)])</span>
<span id="cb115-1654"><a href="#cb115-1654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3mp"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Lmp3"</span>)])</span>
<span id="cb115-1655"><a href="#cb115-1655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3p"</span>)], test_redf[,<span class="fu">c</span>(<span class="st">"Lp3"</span>)])</span>
<span id="cb115-1656"><a href="#cb115-1656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Yp"</span>)], test_redf[,<span class="fu">c</span>(<span class="st">"Yp2"</span>)])</span>
<span id="cb115-1657"><a href="#cb115-1657" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb115-1658"><a href="#cb115-1658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1659"><a href="#cb115-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1660"><a href="#cb115-1660" aria-hidden="true" tabindex="-1"></a><span class="fu">### ay = 0, am = 1</span></span>
<span id="cb115-1661"><a href="#cb115-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1662"><a href="#cb115-1662" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-1663"><a href="#cb115-1663" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1664"><a href="#cb115-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1667"><a href="#cb115-1667" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1668"><a href="#cb115-1668" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">=</span> <span class="dv">123</span></span>
<span id="cb115-1669"><a href="#cb115-1669" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-1670"><a href="#cb115-1670" aria-hidden="true" tabindex="-1"></a>along_redf <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1671"><a href="#cb115-1671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb115-1672"><a href="#cb115-1672" aria-hidden="true" tabindex="-1"></a>along_redf</span>
<span id="cb115-1673"><a href="#cb115-1673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1674"><a href="#cb115-1674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1675"><a href="#cb115-1675" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1676"><a href="#cb115-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1677"><a href="#cb115-1677" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1680"><a href="#cb115-1680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1681"><a href="#cb115-1681" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-1682"><a href="#cb115-1682" aria-hidden="true" tabindex="-1"></a>test_redf <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-1683"><a href="#cb115-1683" aria-hidden="true" tabindex="-1"></a>  <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-1684"><a href="#cb115-1684" aria-hidden="true" tabindex="-1"></a>  <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-1685"><a href="#cb115-1685" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-1686"><a href="#cb115-1686" aria-hidden="true" tabindex="-1"></a>  <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-1687"><a href="#cb115-1687" aria-hidden="true" tabindex="-1"></a>  <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-1688"><a href="#cb115-1688" aria-hidden="true" tabindex="-1"></a>  <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-1689"><a href="#cb115-1689" aria-hidden="true" tabindex="-1"></a>  <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-1690"><a href="#cb115-1690" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-1691"><a href="#cb115-1691" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat0</span>
<span id="cb115-1692"><a href="#cb115-1692" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">fitg</span>(<span class="at">bootstr=</span>T,</span>
<span id="cb115-1693"><a href="#cb115-1693" aria-hidden="true" tabindex="-1"></a>           <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-1694"><a href="#cb115-1694" aria-hidden="true" tabindex="-1"></a>           <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-1695"><a href="#cb115-1695" aria-hidden="true" tabindex="-1"></a>           <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1696"><a href="#cb115-1696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> <span class="dv">10000</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb115-1697"><a href="#cb115-1697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-1698"><a href="#cb115-1698" aria-hidden="true" tabindex="-1"></a>test_redf</span>
<span id="cb115-1699"><a href="#cb115-1699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1700"><a href="#cb115-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1701"><a href="#cb115-1701" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1702"><a href="#cb115-1702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1703"><a href="#cb115-1703" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-1704"><a href="#cb115-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1705"><a href="#cb115-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1708"><a href="#cb115-1708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1709"><a href="#cb115-1709" aria-hidden="true" tabindex="-1"></a><span class="co"># test_that("gform function", {</span></span>
<span id="cb115-1710"><a href="#cb115-1710" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb115-1711"><a href="#cb115-1711" aria-hidden="true" tabindex="-1"></a><span class="co">#   # boot_num - Am</span></span>
<span id="cb115-1712"><a href="#cb115-1712" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c(2:6)],test_redf[,c(1:5)])</span></span>
<span id="cb115-1713"><a href="#cb115-1713" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("v1","v2","v3","v4","lastid","Yp")],</span></span>
<span id="cb115-1714"><a href="#cb115-1714" aria-hidden="true" tabindex="-1"></a><span class="co">#                test_redf[,c("v1","v2","v3","v4","lastid","Yp")])</span></span>
<span id="cb115-1715"><a href="#cb115-1715" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb115-1716"><a href="#cb115-1716" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("M1p")],test_redf[,c("M1")])</span></span>
<span id="cb115-1717"><a href="#cb115-1717" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T1mp")],test_redf[,c("Lmp1")])</span></span>
<span id="cb115-1718"><a href="#cb115-1718" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T1p")],test_redf[,c("Lp1")])</span></span>
<span id="cb115-1719"><a href="#cb115-1719" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T2mp")],test_redf[,c("Lmp2")])</span></span>
<span id="cb115-1720"><a href="#cb115-1720" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T2p")],test_redf[,c("Lp2")])</span></span>
<span id="cb115-1721"><a href="#cb115-1721" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T3mp")],test_redf[,c("Lmp3")])</span></span>
<span id="cb115-1722"><a href="#cb115-1722" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(along_redf[,c("T3p")], test_redf[,c("Lp3")])</span></span>
<span id="cb115-1723"><a href="#cb115-1723" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span>
<span id="cb115-1724"><a href="#cb115-1724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1725"><a href="#cb115-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1726"><a href="#cb115-1726" aria-hidden="true" tabindex="-1"></a><span class="fu"># ay != am bị lỗi </span></span>
<span id="cb115-1727"><a href="#cb115-1727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1728"><a href="#cb115-1728" aria-hidden="true" tabindex="-1"></a>Như trường hợp tính khi am = 1, ay = 0 giữa 2 code k giống nhau nên em làm section để chạy lẻ các code xem lỗi ở đâu. Ở function của a Long thì chạy hết length nhưng Y vẫn = 0, còn function của em thì chạy tới 10 là Y = 1. Em nghĩ sự khác nhau giữa 2 outcome do cơ chế set.seed của R.</span>
<span id="cb115-1729"><a href="#cb115-1729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1730"><a href="#cb115-1730" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2 data bỏ vô g formula giống nhau</span></span>
<span id="cb115-1731"><a href="#cb115-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1734"><a href="#cb115-1734" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1735"><a href="#cb115-1735" aria-hidden="true" tabindex="-1"></a>along_redf <span class="ot">&lt;-</span> MC <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb115-1736"><a href="#cb115-1736" aria-hidden="true" tabindex="-1"></a>test_redf <span class="ot">&lt;-</span> fitR2<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb115-1737"><a href="#cb115-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1738"><a href="#cb115-1738" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"baseline_mc function"</span>, {</span>
<span id="cb115-1739"><a href="#cb115-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1740"><a href="#cb115-1740" aria-hidden="true" tabindex="-1"></a>  <span class="co"># id, v1 - v4</span></span>
<span id="cb115-1741"><a href="#cb115-1741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">1</span>],test_redf[,<span class="dv">1</span>])</span>
<span id="cb115-1742"><a href="#cb115-1742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">2</span>],test_redf[,<span class="dv">2</span>])</span>
<span id="cb115-1743"><a href="#cb115-1743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">3</span>],test_redf[,<span class="dv">3</span>])</span>
<span id="cb115-1744"><a href="#cb115-1744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">4</span>],test_redf[,<span class="dv">4</span>])</span>
<span id="cb115-1745"><a href="#cb115-1745" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="dv">5</span>],test_redf[,<span class="dv">5</span>])</span>
<span id="cb115-1746"><a href="#cb115-1746" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1747"><a href="#cb115-1747" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exposure variables</span></span>
<span id="cb115-1748"><a href="#cb115-1748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"A"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1"</span>)])</span>
<span id="cb115-1749"><a href="#cb115-1749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Al1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1l1"</span>)])</span>
<span id="cb115-1750"><a href="#cb115-1750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Al2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"A1l2"</span>)])</span>
<span id="cb115-1751"><a href="#cb115-1751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1752"><a href="#cb115-1752" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate</span></span>
<span id="cb115-1753"><a href="#cb115-1753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1"</span>)])</span>
<span id="cb115-1754"><a href="#cb115-1754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2"</span>)])</span>
<span id="cb115-1755"><a href="#cb115-1755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3"</span>)])</span>
<span id="cb115-1756"><a href="#cb115-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1757"><a href="#cb115-1757" aria-hidden="true" tabindex="-1"></a>  <span class="do">## time-dependent covariate + lag</span></span>
<span id="cb115-1758"><a href="#cb115-1758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1l1"</span>)])</span>
<span id="cb115-1759"><a href="#cb115-1759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2l1"</span>)])</span>
<span id="cb115-1760"><a href="#cb115-1760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3l1"</span>)])</span>
<span id="cb115-1761"><a href="#cb115-1761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1762"><a href="#cb115-1762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T1l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L1l2"</span>)])</span>
<span id="cb115-1763"><a href="#cb115-1763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T2l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L2l2"</span>)])</span>
<span id="cb115-1764"><a href="#cb115-1764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"T3l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"L3l2"</span>)])</span>
<span id="cb115-1765"><a href="#cb115-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1766"><a href="#cb115-1766" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mediator</span></span>
<span id="cb115-1767"><a href="#cb115-1767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb115-1768"><a href="#cb115-1768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)])</span>
<span id="cb115-1769"><a href="#cb115-1769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)])</span>
<span id="cb115-1770"><a href="#cb115-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1771"><a href="#cb115-1771" aria-hidden="true" tabindex="-1"></a>  <span class="do">## outcome and time</span></span>
<span id="cb115-1772"><a href="#cb115-1772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"Y"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"Y"</span>)])</span>
<span id="cb115-1773"><a href="#cb115-1773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(along_redf[,<span class="fu">c</span>(<span class="st">"j"</span>)],test_redf[,<span class="fu">c</span>(<span class="st">"j"</span>)])</span>
<span id="cb115-1774"><a href="#cb115-1774" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb115-1775"><a href="#cb115-1775" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1776"><a href="#cb115-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1779"><a href="#cb115-1779" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1780"><a href="#cb115-1780" aria-hidden="true" tabindex="-1"></a>ii <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb115-1781"><a href="#cb115-1781" aria-hidden="true" tabindex="-1"></a>length <span class="ot">=</span> <span class="dv">12</span></span>
<span id="cb115-1782"><a href="#cb115-1782" aria-hidden="true" tabindex="-1"></a>am <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb115-1783"><a href="#cb115-1783" aria-hidden="true" tabindex="-1"></a>ay <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb115-1784"><a href="#cb115-1784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-1785"><a href="#cb115-1785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1786"><a href="#cb115-1786" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-1787"><a href="#cb115-1787" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-1788"><a href="#cb115-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1789"><a href="#cb115-1789" aria-hidden="true" tabindex="-1"></a>package code</span>
<span id="cb115-1790"><a href="#cb115-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1793"><a href="#cb115-1793" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-1794"><a href="#cb115-1794" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-1795"><a href="#cb115-1795" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> fitR2</span>
<span id="cb115-1796"><a href="#cb115-1796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-1797"><a href="#cb115-1797" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb115-1798"><a href="#cb115-1798" aria-hidden="true" tabindex="-1"></a>norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb115-1799"><a href="#cb115-1799" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1800"><a href="#cb115-1800" aria-hidden="true" tabindex="-1"></a>  dddd <span class="ot">&lt;-</span> data<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-1801"><a href="#cb115-1801" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1802"><a href="#cb115-1802" aria-hidden="true" tabindex="-1"></a>  lagg <span class="ot">&lt;-</span> dddd <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"L1l"</span>)) <span class="sc">%&gt;%</span> <span class="fu">ncol</span>() </span>
<span id="cb115-1803"><a href="#cb115-1803" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1804"><a href="#cb115-1804" aria-hidden="true" tabindex="-1"></a>  d2 <span class="ot">&lt;-</span> dddd[dddd<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb115-1805"><a href="#cb115-1805" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1806"><a href="#cb115-1806" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d2<span class="sc">$</span>idsim</span>
<span id="cb115-1807"><a href="#cb115-1807" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d2<span class="sc">$</span>id</span>
<span id="cb115-1808"><a href="#cb115-1808" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1809"><a href="#cb115-1809" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb115-1810"><a href="#cb115-1810" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1811"><a href="#cb115-1811" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb115-1812"><a href="#cb115-1812" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>))</span>
<span id="cb115-1813"><a href="#cb115-1813" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1814"><a href="#cb115-1814" aria-hidden="true" tabindex="-1"></a>  Yp2 <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-1815"><a href="#cb115-1815" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1816"><a href="#cb115-1816" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-1817"><a href="#cb115-1817" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1818"><a href="#cb115-1818" aria-hidden="true" tabindex="-1"></a>  Yp2[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-1819"><a href="#cb115-1819" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1820"><a href="#cb115-1820" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(data<span class="sc">$</span>df<span class="sc">$</span>j)</span>
<span id="cb115-1821"><a href="#cb115-1821" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1822"><a href="#cb115-1822" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mediator</span></span>
<span id="cb115-1823"><a href="#cb115-1823" aria-hidden="true" tabindex="-1"></a>  Mp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>M)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-1824"><a href="#cb115-1824" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Mp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M))</span>
<span id="cb115-1825"><a href="#cb115-1825" aria-hidden="true" tabindex="-1"></a>  Mp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Mp)) </span>
<span id="cb115-1826"><a href="#cb115-1826" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1827"><a href="#cb115-1827" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1828"><a href="#cb115-1828" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-1829"><a href="#cb115-1829" aria-hidden="true" tabindex="-1"></a>  Lmp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>L)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-1830"><a href="#cb115-1830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb115-1831"><a href="#cb115-1831" aria-hidden="true" tabindex="-1"></a>  Lmp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Lmp)) </span>
<span id="cb115-1832"><a href="#cb115-1832" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to outcome models)</span></span>
<span id="cb115-1833"><a href="#cb115-1833" aria-hidden="true" tabindex="-1"></a>  Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb115-1834"><a href="#cb115-1834" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1835"><a href="#cb115-1835" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> lagg<span class="sc">:</span>length) {</span>
<span id="cb115-1836"><a href="#cb115-1836" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-1837"><a href="#cb115-1837" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb115-1838"><a href="#cb115-1838" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb115-1839"><a href="#cb115-1839" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb115-1840"><a href="#cb115-1840" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1841"><a href="#cb115-1841" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb115-1842"><a href="#cb115-1842" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-1843"><a href="#cb115-1843" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb115-1844"><a href="#cb115-1844" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1845"><a href="#cb115-1845" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1846"><a href="#cb115-1846" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-1847"><a href="#cb115-1847" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1848"><a href="#cb115-1848" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb115-1849"><a href="#cb115-1849" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1850"><a href="#cb115-1850" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1851"><a href="#cb115-1851" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-1852"><a href="#cb115-1852" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1853"><a href="#cb115-1853" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb115-1854"><a href="#cb115-1854" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-1855"><a href="#cb115-1855" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-1856"><a href="#cb115-1856" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-1857"><a href="#cb115-1857" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-1858"><a href="#cb115-1858" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-1859"><a href="#cb115-1859" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-1860"><a href="#cb115-1860" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1861"><a href="#cb115-1861" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-1862"><a href="#cb115-1862" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1863"><a href="#cb115-1863" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1864"><a href="#cb115-1864" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb115-1865"><a href="#cb115-1865" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1866"><a href="#cb115-1866" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-1867"><a href="#cb115-1867" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1868"><a href="#cb115-1868" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-1869"><a href="#cb115-1869" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1870"><a href="#cb115-1870" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb115-1871"><a href="#cb115-1871" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-1872"><a href="#cb115-1872" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-1873"><a href="#cb115-1873" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-1874"><a href="#cb115-1874" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb115-1875"><a href="#cb115-1875" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb115-1876"><a href="#cb115-1876" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-1877"><a href="#cb115-1877" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-1878"><a href="#cb115-1878" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1879"><a href="#cb115-1879" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb115-1880"><a href="#cb115-1880" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1881"><a href="#cb115-1881" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-1882"><a href="#cb115-1882" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb115-1883"><a href="#cb115-1883" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb115-1884"><a href="#cb115-1884" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb115-1885"><a href="#cb115-1885" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1886"><a href="#cb115-1886" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-1887"><a href="#cb115-1887" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1888"><a href="#cb115-1888" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-1889"><a href="#cb115-1889" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1890"><a href="#cb115-1890" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-1891"><a href="#cb115-1891" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb115-1892"><a href="#cb115-1892" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-1893"><a href="#cb115-1893" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb115-1894"><a href="#cb115-1894" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1895"><a href="#cb115-1895" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-1896"><a href="#cb115-1896" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb115-1897"><a href="#cb115-1897" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-1898"><a href="#cb115-1898" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1899"><a href="#cb115-1899" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1900"><a href="#cb115-1900" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-1901"><a href="#cb115-1901" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1902"><a href="#cb115-1902" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-1903"><a href="#cb115-1903" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-1904"><a href="#cb115-1904" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-1905"><a href="#cb115-1905" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-1906"><a href="#cb115-1906" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-1907"><a href="#cb115-1907" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-1908"><a href="#cb115-1908" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-1909"><a href="#cb115-1909" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1910"><a href="#cb115-1910" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-1911"><a href="#cb115-1911" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1912"><a href="#cb115-1912" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb115-1913"><a href="#cb115-1913" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1914"><a href="#cb115-1914" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-1915"><a href="#cb115-1915" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1916"><a href="#cb115-1916" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-1917"><a href="#cb115-1917" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb115-1918"><a href="#cb115-1918" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-1919"><a href="#cb115-1919" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-1920"><a href="#cb115-1920" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-1921"><a href="#cb115-1921" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-1922"><a href="#cb115-1922" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-1923"><a href="#cb115-1923" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-1924"><a href="#cb115-1924" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb115-1925"><a href="#cb115-1925" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb115-1926"><a href="#cb115-1926" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-1927"><a href="#cb115-1927" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-1928"><a href="#cb115-1928" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-1929"><a href="#cb115-1929" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1930"><a href="#cb115-1930" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb115-1931"><a href="#cb115-1931" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1932"><a href="#cb115-1932" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-1933"><a href="#cb115-1933" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb115-1934"><a href="#cb115-1934" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb115-1935"><a href="#cb115-1935" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb115-1936"><a href="#cb115-1936" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1937"><a href="#cb115-1937" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-1938"><a href="#cb115-1938" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1939"><a href="#cb115-1939" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-1940"><a href="#cb115-1940" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1941"><a href="#cb115-1941" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-1942"><a href="#cb115-1942" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-1943"><a href="#cb115-1943" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1944"><a href="#cb115-1944" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-1945"><a href="#cb115-1945" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb115-1946"><a href="#cb115-1946" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-1947"><a href="#cb115-1947" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1948"><a href="#cb115-1948" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-1949"><a href="#cb115-1949" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1950"><a href="#cb115-1950" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-1951"><a href="#cb115-1951" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-1952"><a href="#cb115-1952" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb115-1953"><a href="#cb115-1953" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-1954"><a href="#cb115-1954" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb115-1955"><a href="#cb115-1955" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-1956"><a href="#cb115-1956" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-1957"><a href="#cb115-1957" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1958"><a href="#cb115-1958" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-1959"><a href="#cb115-1959" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1960"><a href="#cb115-1960" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb115-1961"><a href="#cb115-1961" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1962"><a href="#cb115-1962" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-1963"><a href="#cb115-1963" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1964"><a href="#cb115-1964" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-1965"><a href="#cb115-1965" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb115-1966"><a href="#cb115-1966" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-1967"><a href="#cb115-1967" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-1968"><a href="#cb115-1968" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-1969"><a href="#cb115-1969" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb115-1970"><a href="#cb115-1970" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-1971"><a href="#cb115-1971" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-1972"><a href="#cb115-1972" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb115-1973"><a href="#cb115-1973" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb115-1974"><a href="#cb115-1974" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb115-1975"><a href="#cb115-1975" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-1976"><a href="#cb115-1976" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb115-1977"><a href="#cb115-1977" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-1978"><a href="#cb115-1978" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-1979"><a href="#cb115-1979" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-1980"><a href="#cb115-1980" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-1981"><a href="#cb115-1981" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb115-1982"><a href="#cb115-1982" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb115-1983"><a href="#cb115-1983" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-1984"><a href="#cb115-1984" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-1985"><a href="#cb115-1985" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-1986"><a href="#cb115-1986" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-1987"><a href="#cb115-1987" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-1988"><a href="#cb115-1988" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-1989"><a href="#cb115-1989" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb115-1990"><a href="#cb115-1990" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb115-1991"><a href="#cb115-1991" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-1992"><a href="#cb115-1992" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-1993"><a href="#cb115-1993" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb115-1994"><a href="#cb115-1994" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-1995"><a href="#cb115-1995" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb115-1996"><a href="#cb115-1996" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-1997"><a href="#cb115-1997" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-1998"><a href="#cb115-1998" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb115-1999"><a href="#cb115-1999" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-2000"><a href="#cb115-2000" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb115-2001"><a href="#cb115-2001" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2002"><a href="#cb115-2002" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-2003"><a href="#cb115-2003" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2004"><a href="#cb115-2004" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-2005"><a href="#cb115-2005" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-2006"><a href="#cb115-2006" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-2007"><a href="#cb115-2007" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2008"><a href="#cb115-2008" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-2009"><a href="#cb115-2009" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2010"><a href="#cb115-2010" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2011"><a href="#cb115-2011" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2012"><a href="#cb115-2012" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2013"><a href="#cb115-2013" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2014"><a href="#cb115-2014" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb115-2015"><a href="#cb115-2015" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2016"><a href="#cb115-2016" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-2017"><a href="#cb115-2017" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-2018"><a href="#cb115-2018" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-2019"><a href="#cb115-2019" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-2020"><a href="#cb115-2020" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2021"><a href="#cb115-2021" aria-hidden="true" tabindex="-1"></a>  Yp2</span>
<span id="cb115-2022"><a href="#cb115-2022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-2023"><a href="#cb115-2023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2024"><a href="#cb115-2024" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-2025"><a href="#cb115-2025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2026"><a href="#cb115-2026" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-2027"><a href="#cb115-2027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2028"><a href="#cb115-2028" aria-hidden="true" tabindex="-1"></a>a Long code</span>
<span id="cb115-2029"><a href="#cb115-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2032"><a href="#cb115-2032" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-2033"><a href="#cb115-2033" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-2034"><a href="#cb115-2034" aria-hidden="true" tabindex="-1"></a>pgdat <span class="ot">=</span> MC</span>
<span id="cb115-2035"><a href="#cb115-2035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2036"><a href="#cb115-2036" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> pgdat</span>
<span id="cb115-2037"><a href="#cb115-2037" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d[d<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb115-2038"><a href="#cb115-2038" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2039"><a href="#cb115-2039" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d<span class="sc">$</span>idsim</span>
<span id="cb115-2040"><a href="#cb115-2040" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d<span class="sc">$</span>id</span>
<span id="cb115-2041"><a href="#cb115-2041" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2042"><a href="#cb115-2042" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb115-2043"><a href="#cb115-2043" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2044"><a href="#cb115-2044" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2045"><a href="#cb115-2045" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("...", paste0(ii, "(", id_ori, ")"))</span></span>
<span id="cb115-2046"><a href="#cb115-2046" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2047"><a href="#cb115-2047" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2048"><a href="#cb115-2048" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2049"><a href="#cb115-2049" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb115-2050"><a href="#cb115-2050" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d[, <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>, <span class="st">"v3"</span>, <span class="st">"v4"</span>)]</span>
<span id="cb115-2051"><a href="#cb115-2051" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2052"><a href="#cb115-2052" aria-hidden="true" tabindex="-1"></a>  T1p <span class="ot">&lt;-</span> T2p <span class="ot">&lt;-</span> T3p  <span class="ot">&lt;-</span> M1p <span class="ot">&lt;-</span> Yp <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-2053"><a href="#cb115-2053" aria-hidden="true" tabindex="-1"></a>  T1mp <span class="ot">&lt;-</span> T2mp <span class="ot">&lt;-</span> T3mp <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-2054"><a href="#cb115-2054" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2055"><a href="#cb115-2055" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2056"><a href="#cb115-2056" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2057"><a href="#cb115-2057" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2058"><a href="#cb115-2058" aria-hidden="true" tabindex="-1"></a>  M1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-2059"><a href="#cb115-2059" aria-hidden="true" tabindex="-1"></a>  Yp[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-2060"><a href="#cb115-2060" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2061"><a href="#cb115-2061" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to outcome model</span></span>
<span id="cb115-2062"><a href="#cb115-2062" aria-hidden="true" tabindex="-1"></a>  T1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb115-2063"><a href="#cb115-2063" aria-hidden="true" tabindex="-1"></a>  T2p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb115-2064"><a href="#cb115-2064" aria-hidden="true" tabindex="-1"></a>  T3p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb115-2065"><a href="#cb115-2065" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2066"><a href="#cb115-2066" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to mediator model</span></span>
<span id="cb115-2067"><a href="#cb115-2067" aria-hidden="true" tabindex="-1"></a>  T1mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb115-2068"><a href="#cb115-2068" aria-hidden="true" tabindex="-1"></a>  T2mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb115-2069"><a href="#cb115-2069" aria-hidden="true" tabindex="-1"></a>  T3mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb115-2070"><a href="#cb115-2070" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2071"><a href="#cb115-2071" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2072"><a href="#cb115-2072" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>length) {</span>
<span id="cb115-2073"><a href="#cb115-2073" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-2074"><a href="#cb115-2074" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb115-2075"><a href="#cb115-2075" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2076"><a href="#cb115-2076" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb115-2077"><a href="#cb115-2077" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb115-2078"><a href="#cb115-2078" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb115-2079"><a href="#cb115-2079" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb115-2080"><a href="#cb115-2080" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2081"><a href="#cb115-2081" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb115-2082"><a href="#cb115-2082" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb115-2083"><a href="#cb115-2083" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb115-2084"><a href="#cb115-2084" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb115-2085"><a href="#cb115-2085" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2086"><a href="#cb115-2086" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-2087"><a href="#cb115-2087" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2088"><a href="#cb115-2088" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb115-2089"><a href="#cb115-2089" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb115-2090"><a href="#cb115-2090" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb115-2091"><a href="#cb115-2091" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb115-2092"><a href="#cb115-2092" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb115-2093"><a href="#cb115-2093" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb115-2094"><a href="#cb115-2094" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb115-2095"><a href="#cb115-2095" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2096"><a href="#cb115-2096" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2097"><a href="#cb115-2097" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2098"><a href="#cb115-2098" aria-hidden="true" tabindex="-1"></a>      T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb115-2099"><a href="#cb115-2099" aria-hidden="true" tabindex="-1"></a>      T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb115-2100"><a href="#cb115-2100" aria-hidden="true" tabindex="-1"></a>      T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb115-2101"><a href="#cb115-2101" aria-hidden="true" tabindex="-1"></a>      T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb115-2102"><a href="#cb115-2102" aria-hidden="true" tabindex="-1"></a>      T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb115-2103"><a href="#cb115-2103" aria-hidden="true" tabindex="-1"></a>      T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb115-2104"><a href="#cb115-2104" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2105"><a href="#cb115-2105" aria-hidden="true" tabindex="-1"></a>      M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb115-2106"><a href="#cb115-2106" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2107"><a href="#cb115-2107" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2108"><a href="#cb115-2108" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2109"><a href="#cb115-2109" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb115-2110"><a href="#cb115-2110" aria-hidden="true" tabindex="-1"></a>      dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2111"><a href="#cb115-2111" aria-hidden="true" tabindex="-1"></a>                         <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2112"><a href="#cb115-2112" aria-hidden="true" tabindex="-1"></a>                         <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2113"><a href="#cb115-2113" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2114"><a href="#cb115-2114" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb115-2115"><a href="#cb115-2115" aria-hidden="true" tabindex="-1"></a>        <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb115-2116"><a href="#cb115-2116" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb115-2117"><a href="#cb115-2117" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-2118"><a href="#cb115-2118" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2119"><a href="#cb115-2119" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2120"><a href="#cb115-2120" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2121"><a href="#cb115-2121" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2122"><a href="#cb115-2122" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2123"><a href="#cb115-2123" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-2124"><a href="#cb115-2124" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T1</span></span>
<span id="cb115-2125"><a href="#cb115-2125" aria-hidden="true" tabindex="-1"></a>      dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-2126"><a href="#cb115-2126" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2127"><a href="#cb115-2127" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2128"><a href="#cb115-2128" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-2129"><a href="#cb115-2129" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2130"><a href="#cb115-2130" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2131"><a href="#cb115-2131" aria-hidden="true" tabindex="-1"></a>      T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb115-2132"><a href="#cb115-2132" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2133"><a href="#cb115-2133" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T2</span></span>
<span id="cb115-2134"><a href="#cb115-2134" aria-hidden="true" tabindex="-1"></a>      dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-2135"><a href="#cb115-2135" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2136"><a href="#cb115-2136" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2137"><a href="#cb115-2137" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-2138"><a href="#cb115-2138" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2139"><a href="#cb115-2139" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2140"><a href="#cb115-2140" aria-hidden="true" tabindex="-1"></a>      T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb115-2141"><a href="#cb115-2141" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2142"><a href="#cb115-2142" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T3</span></span>
<span id="cb115-2143"><a href="#cb115-2143" aria-hidden="true" tabindex="-1"></a>      dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-2144"><a href="#cb115-2144" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb115-2145"><a href="#cb115-2145" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2146"><a href="#cb115-2146" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-2147"><a href="#cb115-2147" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2148"><a href="#cb115-2148" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2149"><a href="#cb115-2149" aria-hidden="true" tabindex="-1"></a>      T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb115-2150"><a href="#cb115-2150" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2151"><a href="#cb115-2151" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2152"><a href="#cb115-2152" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-2153"><a href="#cb115-2153" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb115-2154"><a href="#cb115-2154" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2155"><a href="#cb115-2155" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-2156"><a href="#cb115-2156" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb115-2157"><a href="#cb115-2157" aria-hidden="true" tabindex="-1"></a>        dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-2158"><a href="#cb115-2158" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2159"><a href="#cb115-2159" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-2160"><a href="#cb115-2160" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-2161"><a href="#cb115-2161" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-2162"><a href="#cb115-2162" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2163"><a href="#cb115-2163" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb115-2164"><a href="#cb115-2164" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2165"><a href="#cb115-2165" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb115-2166"><a href="#cb115-2166" aria-hidden="true" tabindex="-1"></a>        dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-2167"><a href="#cb115-2167" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2168"><a href="#cb115-2168" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-2169"><a href="#cb115-2169" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-2170"><a href="#cb115-2170" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-2171"><a href="#cb115-2171" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2172"><a href="#cb115-2172" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb115-2173"><a href="#cb115-2173" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2174"><a href="#cb115-2174" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb115-2175"><a href="#cb115-2175" aria-hidden="true" tabindex="-1"></a>        dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-2176"><a href="#cb115-2176" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2177"><a href="#cb115-2177" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-2178"><a href="#cb115-2178" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-2179"><a href="#cb115-2179" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-2180"><a href="#cb115-2180" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2181"><a href="#cb115-2181" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb115-2182"><a href="#cb115-2182" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2183"><a href="#cb115-2183" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2184"><a href="#cb115-2184" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2185"><a href="#cb115-2185" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-2186"><a href="#cb115-2186" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb115-2187"><a href="#cb115-2187" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb115-2188"><a href="#cb115-2188" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb115-2189"><a href="#cb115-2189" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2190"><a href="#cb115-2190" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2191"><a href="#cb115-2191" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb115-2192"><a href="#cb115-2192" aria-hidden="true" tabindex="-1"></a>      dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2193"><a href="#cb115-2193" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb115-2194"><a href="#cb115-2194" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb115-2195"><a href="#cb115-2195" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb115-2196"><a href="#cb115-2196" aria-hidden="true" tabindex="-1"></a>                        <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2197"><a href="#cb115-2197" aria-hidden="true" tabindex="-1"></a>      Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb115-2198"><a href="#cb115-2198" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2199"><a href="#cb115-2199" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb115-2200"><a href="#cb115-2200" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb115-2201"><a href="#cb115-2201" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-2202"><a href="#cb115-2202" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-2203"><a href="#cb115-2203" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-2204"><a href="#cb115-2204" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-2205"><a href="#cb115-2205" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-2206"><a href="#cb115-2206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2207"><a href="#cb115-2207" aria-hidden="true" tabindex="-1"></a>Yp  </span>
<span id="cb115-2208"><a href="#cb115-2208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2209"><a href="#cb115-2209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-2210"><a href="#cb115-2210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2211"><a href="#cb115-2211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2212"><a href="#cb115-2212" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-2213"><a href="#cb115-2213" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-2214"><a href="#cb115-2214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2215"><a href="#cb115-2215" aria-hidden="true" tabindex="-1"></a><span class="fu">## tách data time = 5</span></span>
<span id="cb115-2216"><a href="#cb115-2216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2217"><a href="#cb115-2217" aria-hidden="true" tabindex="-1"></a>theo như code của package thì ở time thứ 5 fit predict Y ở time thứ 6 = 1</span>
<span id="cb115-2218"><a href="#cb115-2218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2219"><a href="#cb115-2219" aria-hidden="true" tabindex="-1"></a>nên em tách lúc time = 5 để xem data dùng để predict Y và sau đó l = 6 để predict</span>
<span id="cb115-2220"><a href="#cb115-2220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2221"><a href="#cb115-2221" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-2222"><a href="#cb115-2222" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-2223"><a href="#cb115-2223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2224"><a href="#cb115-2224" aria-hidden="true" tabindex="-1"></a>package code</span>
<span id="cb115-2225"><a href="#cb115-2225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2228"><a href="#cb115-2228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-2229"><a href="#cb115-2229" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-2230"><a href="#cb115-2230" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> fitR2</span>
<span id="cb115-2231"><a href="#cb115-2231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2232"><a href="#cb115-2232" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb115-2233"><a href="#cb115-2233" aria-hidden="true" tabindex="-1"></a>norev_var <span class="ot">&lt;-</span> data<span class="sc">$</span>norev_var</span>
<span id="cb115-2234"><a href="#cb115-2234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2235"><a href="#cb115-2235" aria-hidden="true" tabindex="-1"></a>  dddd <span class="ot">&lt;-</span> data<span class="sc">$</span>res_df <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-2236"><a href="#cb115-2236" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2237"><a href="#cb115-2237" aria-hidden="true" tabindex="-1"></a>  lagg <span class="ot">&lt;-</span> dddd <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"L1l"</span>)) <span class="sc">%&gt;%</span> <span class="fu">ncol</span>() </span>
<span id="cb115-2238"><a href="#cb115-2238" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2239"><a href="#cb115-2239" aria-hidden="true" tabindex="-1"></a>  d2 <span class="ot">&lt;-</span> dddd[dddd<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb115-2240"><a href="#cb115-2240" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2241"><a href="#cb115-2241" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d2<span class="sc">$</span>idsim</span>
<span id="cb115-2242"><a href="#cb115-2242" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d2<span class="sc">$</span>id</span>
<span id="cb115-2243"><a href="#cb115-2243" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2244"><a href="#cb115-2244" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb115-2245"><a href="#cb115-2245" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2246"><a href="#cb115-2246" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb115-2247"><a href="#cb115-2247" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"v"</span>))</span>
<span id="cb115-2248"><a href="#cb115-2248" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2249"><a href="#cb115-2249" aria-hidden="true" tabindex="-1"></a>  Yp2 <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-2250"><a href="#cb115-2250" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2251"><a href="#cb115-2251" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2252"><a href="#cb115-2252" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2253"><a href="#cb115-2253" aria-hidden="true" tabindex="-1"></a>  Yp2[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-2254"><a href="#cb115-2254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2255"><a href="#cb115-2255" aria-hidden="true" tabindex="-1"></a>  timee <span class="ot">&lt;-</span> <span class="fu">cen_and_scale</span>(data<span class="sc">$</span>df<span class="sc">$</span>j)</span>
<span id="cb115-2256"><a href="#cb115-2256" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2257"><a href="#cb115-2257" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mediator</span></span>
<span id="cb115-2258"><a href="#cb115-2258" aria-hidden="true" tabindex="-1"></a>  Mp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>M)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-2259"><a href="#cb115-2259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Mp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M))</span>
<span id="cb115-2260"><a href="#cb115-2260" aria-hidden="true" tabindex="-1"></a>  Mp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Mp)) </span>
<span id="cb115-2261"><a href="#cb115-2261" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2262"><a href="#cb115-2262" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2263"><a href="#cb115-2263" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-2264"><a href="#cb115-2264" aria-hidden="true" tabindex="-1"></a>  Lmp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>L)) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-2265"><a href="#cb115-2265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"L"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb115-2266"><a href="#cb115-2266" aria-hidden="true" tabindex="-1"></a>  Lmp[<span class="dv">1</span><span class="sc">:</span>lagg<span class="dv">-1</span>,] <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">names</span>(Lmp)) </span>
<span id="cb115-2267"><a href="#cb115-2267" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time-varying covariates (contribute to outcome models)</span></span>
<span id="cb115-2268"><a href="#cb115-2268" aria-hidden="true" tabindex="-1"></a>  Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb115-2269"><a href="#cb115-2269" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb115-2270"><a href="#cb115-2270" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> lagg<span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb115-2271"><a href="#cb115-2271" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2272"><a href="#cb115-2272" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb115-2273"><a href="#cb115-2273" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb115-2274"><a href="#cb115-2274" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb115-2275"><a href="#cb115-2275" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2276"><a href="#cb115-2276" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb115-2277"><a href="#cb115-2277" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-2278"><a href="#cb115-2278" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb115-2279"><a href="#cb115-2279" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2280"><a href="#cb115-2280" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2281"><a href="#cb115-2281" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-2282"><a href="#cb115-2282" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2283"><a href="#cb115-2283" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb115-2284"><a href="#cb115-2284" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2285"><a href="#cb115-2285" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2286"><a href="#cb115-2286" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-2287"><a href="#cb115-2287" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2288"><a href="#cb115-2288" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb115-2289"><a href="#cb115-2289" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-2290"><a href="#cb115-2290" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-2291"><a href="#cb115-2291" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2292"><a href="#cb115-2292" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-2293"><a href="#cb115-2293" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2294"><a href="#cb115-2294" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2295"><a href="#cb115-2295" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2296"><a href="#cb115-2296" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2297"><a href="#cb115-2297" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2298"><a href="#cb115-2298" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2299"><a href="#cb115-2299" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb115-2300"><a href="#cb115-2300" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2301"><a href="#cb115-2301" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-2302"><a href="#cb115-2302" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2303"><a href="#cb115-2303" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-2304"><a href="#cb115-2304" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2305"><a href="#cb115-2305" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb115-2306"><a href="#cb115-2306" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2307"><a href="#cb115-2307" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-2308"><a href="#cb115-2308" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2309"><a href="#cb115-2309" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb115-2310"><a href="#cb115-2310" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb115-2311"><a href="#cb115-2311" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-2312"><a href="#cb115-2312" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-2313"><a href="#cb115-2313" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2314"><a href="#cb115-2314" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb115-2315"><a href="#cb115-2315" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2316"><a href="#cb115-2316" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2317"><a href="#cb115-2317" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb115-2318"><a href="#cb115-2318" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb115-2319"><a href="#cb115-2319" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb115-2320"><a href="#cb115-2320" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2321"><a href="#cb115-2321" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2322"><a href="#cb115-2322" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2323"><a href="#cb115-2323" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2324"><a href="#cb115-2324" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2325"><a href="#cb115-2325" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-2326"><a href="#cb115-2326" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb115-2327"><a href="#cb115-2327" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-2328"><a href="#cb115-2328" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb115-2329"><a href="#cb115-2329" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2330"><a href="#cb115-2330" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-2331"><a href="#cb115-2331" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb115-2332"><a href="#cb115-2332" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-2333"><a href="#cb115-2333" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2334"><a href="#cb115-2334" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2335"><a href="#cb115-2335" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-2336"><a href="#cb115-2336" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2337"><a href="#cb115-2337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-2338"><a href="#cb115-2338" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-2339"><a href="#cb115-2339" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-2340"><a href="#cb115-2340" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2341"><a href="#cb115-2341" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-2342"><a href="#cb115-2342" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2343"><a href="#cb115-2343" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2344"><a href="#cb115-2344" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2345"><a href="#cb115-2345" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2346"><a href="#cb115-2346" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2347"><a href="#cb115-2347" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb115-2348"><a href="#cb115-2348" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2349"><a href="#cb115-2349" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-2350"><a href="#cb115-2350" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2351"><a href="#cb115-2351" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-2352"><a href="#cb115-2352" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb115-2353"><a href="#cb115-2353" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2354"><a href="#cb115-2354" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2355"><a href="#cb115-2355" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2356"><a href="#cb115-2356" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-2357"><a href="#cb115-2357" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2358"><a href="#cb115-2358" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2359"><a href="#cb115-2359" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb115-2360"><a href="#cb115-2360" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb115-2361"><a href="#cb115-2361" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-2362"><a href="#cb115-2362" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2363"><a href="#cb115-2363" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-2364"><a href="#cb115-2364" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2365"><a href="#cb115-2365" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb115-2366"><a href="#cb115-2366" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2367"><a href="#cb115-2367" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2368"><a href="#cb115-2368" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb115-2369"><a href="#cb115-2369" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb115-2370"><a href="#cb115-2370" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb115-2371"><a href="#cb115-2371" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2372"><a href="#cb115-2372" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2373"><a href="#cb115-2373" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2374"><a href="#cb115-2374" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2375"><a href="#cb115-2375" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2376"><a href="#cb115-2376" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-2377"><a href="#cb115-2377" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-2378"><a href="#cb115-2378" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2379"><a href="#cb115-2379" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-2380"><a href="#cb115-2380" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb115-2381"><a href="#cb115-2381" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-2382"><a href="#cb115-2382" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2383"><a href="#cb115-2383" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-2384"><a href="#cb115-2384" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2385"><a href="#cb115-2385" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-2386"><a href="#cb115-2386" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-2387"><a href="#cb115-2387" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb115-2388"><a href="#cb115-2388" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2389"><a href="#cb115-2389" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb115-2390"><a href="#cb115-2390" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2391"><a href="#cb115-2391" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-2392"><a href="#cb115-2392" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2393"><a href="#cb115-2393" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2394"><a href="#cb115-2394" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2395"><a href="#cb115-2395" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb115-2396"><a href="#cb115-2396" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2397"><a href="#cb115-2397" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-2398"><a href="#cb115-2398" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2399"><a href="#cb115-2399" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-2400"><a href="#cb115-2400" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb115-2401"><a href="#cb115-2401" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-2402"><a href="#cb115-2402" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2403"><a href="#cb115-2403" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-2404"><a href="#cb115-2404" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb115-2405"><a href="#cb115-2405" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-2406"><a href="#cb115-2406" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2407"><a href="#cb115-2407" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb115-2408"><a href="#cb115-2408" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb115-2409"><a href="#cb115-2409" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb115-2410"><a href="#cb115-2410" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-2411"><a href="#cb115-2411" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb115-2412"><a href="#cb115-2412" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2413"><a href="#cb115-2413" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-2414"><a href="#cb115-2414" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2415"><a href="#cb115-2415" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2416"><a href="#cb115-2416" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb115-2417"><a href="#cb115-2417" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb115-2418"><a href="#cb115-2418" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-2419"><a href="#cb115-2419" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2420"><a href="#cb115-2420" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-2421"><a href="#cb115-2421" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2422"><a href="#cb115-2422" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2423"><a href="#cb115-2423" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2424"><a href="#cb115-2424" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb115-2425"><a href="#cb115-2425" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb115-2426"><a href="#cb115-2426" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2427"><a href="#cb115-2427" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2428"><a href="#cb115-2428" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb115-2429"><a href="#cb115-2429" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-2430"><a href="#cb115-2430" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb115-2431"><a href="#cb115-2431" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2432"><a href="#cb115-2432" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-2433"><a href="#cb115-2433" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb115-2434"><a href="#cb115-2434" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-2435"><a href="#cb115-2435" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb115-2436"><a href="#cb115-2436" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2437"><a href="#cb115-2437" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-2438"><a href="#cb115-2438" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2439"><a href="#cb115-2439" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-2440"><a href="#cb115-2440" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-2441"><a href="#cb115-2441" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-2442"><a href="#cb115-2442" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2443"><a href="#cb115-2443" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-2444"><a href="#cb115-2444" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2445"><a href="#cb115-2445" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2446"><a href="#cb115-2446" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2447"><a href="#cb115-2447" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2448"><a href="#cb115-2448" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2449"><a href="#cb115-2449" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb115-2450"><a href="#cb115-2450" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2451"><a href="#cb115-2451" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-2452"><a href="#cb115-2452" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-2453"><a href="#cb115-2453" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-2454"><a href="#cb115-2454" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-2455"><a href="#cb115-2455" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2456"><a href="#cb115-2456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-2457"><a href="#cb115-2457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2458"><a href="#cb115-2458" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-2459"><a href="#cb115-2459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2460"><a href="#cb115-2460" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-2461"><a href="#cb115-2461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2462"><a href="#cb115-2462" aria-hidden="true" tabindex="-1"></a>a Long code</span>
<span id="cb115-2463"><a href="#cb115-2463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2466"><a href="#cb115-2466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-2467"><a href="#cb115-2467" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-2468"><a href="#cb115-2468" aria-hidden="true" tabindex="-1"></a>pgdat <span class="ot">=</span> MC</span>
<span id="cb115-2469"><a href="#cb115-2469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2470"><a href="#cb115-2470" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> pgdat</span>
<span id="cb115-2471"><a href="#cb115-2471" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d[d<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb115-2472"><a href="#cb115-2472" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2473"><a href="#cb115-2473" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> d<span class="sc">$</span>idsim</span>
<span id="cb115-2474"><a href="#cb115-2474" aria-hidden="true" tabindex="-1"></a>  id_ori <span class="ot">&lt;-</span> d<span class="sc">$</span>id</span>
<span id="cb115-2475"><a href="#cb115-2475" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2476"><a href="#cb115-2476" aria-hidden="true" tabindex="-1"></a>  length <span class="ot">&lt;-</span> length</span>
<span id="cb115-2477"><a href="#cb115-2477" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2478"><a href="#cb115-2478" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2479"><a href="#cb115-2479" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("...", paste0(ii, "(", id_ori, ")"))</span></span>
<span id="cb115-2480"><a href="#cb115-2480" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2481"><a href="#cb115-2481" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2482"><a href="#cb115-2482" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2483"><a href="#cb115-2483" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Baseline covariates</span></span>
<span id="cb115-2484"><a href="#cb115-2484" aria-hidden="true" tabindex="-1"></a>  Vp <span class="ot">&lt;-</span> d[, <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>, <span class="st">"v3"</span>, <span class="st">"v4"</span>)]</span>
<span id="cb115-2485"><a href="#cb115-2485" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2486"><a href="#cb115-2486" aria-hidden="true" tabindex="-1"></a>  T1p <span class="ot">&lt;-</span> T2p <span class="ot">&lt;-</span> T3p  <span class="ot">&lt;-</span> M1p <span class="ot">&lt;-</span> Yp <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-2487"><a href="#cb115-2487" aria-hidden="true" tabindex="-1"></a>  T1mp <span class="ot">&lt;-</span> T2mp <span class="ot">&lt;-</span> T3mp <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-2488"><a href="#cb115-2488" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2489"><a href="#cb115-2489" aria-hidden="true" tabindex="-1"></a>  mm[<span class="dv">1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2490"><a href="#cb115-2490" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2491"><a href="#cb115-2491" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2492"><a href="#cb115-2492" aria-hidden="true" tabindex="-1"></a>  M1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-2493"><a href="#cb115-2493" aria-hidden="true" tabindex="-1"></a>  Yp[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-2494"><a href="#cb115-2494" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2495"><a href="#cb115-2495" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to outcome model</span></span>
<span id="cb115-2496"><a href="#cb115-2496" aria-hidden="true" tabindex="-1"></a>  T1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb115-2497"><a href="#cb115-2497" aria-hidden="true" tabindex="-1"></a>  T2p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb115-2498"><a href="#cb115-2498" aria-hidden="true" tabindex="-1"></a>  T3p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb115-2499"><a href="#cb115-2499" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2500"><a href="#cb115-2500" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time-varying covariates contribute to mediator model</span></span>
<span id="cb115-2501"><a href="#cb115-2501" aria-hidden="true" tabindex="-1"></a>  T1mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb115-2502"><a href="#cb115-2502" aria-hidden="true" tabindex="-1"></a>  T2mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb115-2503"><a href="#cb115-2503" aria-hidden="true" tabindex="-1"></a>  T3mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb115-2504"><a href="#cb115-2504" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2505"><a href="#cb115-2505" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2506"><a href="#cb115-2506" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb115-2507"><a href="#cb115-2507" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-2508"><a href="#cb115-2508" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb115-2509"><a href="#cb115-2509" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2510"><a href="#cb115-2510" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb115-2511"><a href="#cb115-2511" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb115-2512"><a href="#cb115-2512" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb115-2513"><a href="#cb115-2513" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb115-2514"><a href="#cb115-2514" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2515"><a href="#cb115-2515" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb115-2516"><a href="#cb115-2516" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb115-2517"><a href="#cb115-2517" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb115-2518"><a href="#cb115-2518" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb115-2519"><a href="#cb115-2519" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2520"><a href="#cb115-2520" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-2521"><a href="#cb115-2521" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2522"><a href="#cb115-2522" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb115-2523"><a href="#cb115-2523" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb115-2524"><a href="#cb115-2524" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb115-2525"><a href="#cb115-2525" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb115-2526"><a href="#cb115-2526" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb115-2527"><a href="#cb115-2527" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb115-2528"><a href="#cb115-2528" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb115-2529"><a href="#cb115-2529" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2530"><a href="#cb115-2530" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2531"><a href="#cb115-2531" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2532"><a href="#cb115-2532" aria-hidden="true" tabindex="-1"></a>      T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb115-2533"><a href="#cb115-2533" aria-hidden="true" tabindex="-1"></a>      T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb115-2534"><a href="#cb115-2534" aria-hidden="true" tabindex="-1"></a>      T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb115-2535"><a href="#cb115-2535" aria-hidden="true" tabindex="-1"></a>      T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb115-2536"><a href="#cb115-2536" aria-hidden="true" tabindex="-1"></a>      T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb115-2537"><a href="#cb115-2537" aria-hidden="true" tabindex="-1"></a>      T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb115-2538"><a href="#cb115-2538" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2539"><a href="#cb115-2539" aria-hidden="true" tabindex="-1"></a>      M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb115-2540"><a href="#cb115-2540" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2541"><a href="#cb115-2541" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2542"><a href="#cb115-2542" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2543"><a href="#cb115-2543" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb115-2544"><a href="#cb115-2544" aria-hidden="true" tabindex="-1"></a>      dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2545"><a href="#cb115-2545" aria-hidden="true" tabindex="-1"></a>                         <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2546"><a href="#cb115-2546" aria-hidden="true" tabindex="-1"></a>                         <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2547"><a href="#cb115-2547" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2548"><a href="#cb115-2548" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb115-2549"><a href="#cb115-2549" aria-hidden="true" tabindex="-1"></a>        <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb115-2550"><a href="#cb115-2550" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb115-2551"><a href="#cb115-2551" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-2552"><a href="#cb115-2552" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2553"><a href="#cb115-2553" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2554"><a href="#cb115-2554" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2555"><a href="#cb115-2555" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2556"><a href="#cb115-2556" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2557"><a href="#cb115-2557" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-2558"><a href="#cb115-2558" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T1</span></span>
<span id="cb115-2559"><a href="#cb115-2559" aria-hidden="true" tabindex="-1"></a>      dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-2560"><a href="#cb115-2560" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2561"><a href="#cb115-2561" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2562"><a href="#cb115-2562" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-2563"><a href="#cb115-2563" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2564"><a href="#cb115-2564" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2565"><a href="#cb115-2565" aria-hidden="true" tabindex="-1"></a>      T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb115-2566"><a href="#cb115-2566" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2567"><a href="#cb115-2567" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T2</span></span>
<span id="cb115-2568"><a href="#cb115-2568" aria-hidden="true" tabindex="-1"></a>      dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-2569"><a href="#cb115-2569" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2570"><a href="#cb115-2570" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2571"><a href="#cb115-2571" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-2572"><a href="#cb115-2572" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2573"><a href="#cb115-2573" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2574"><a href="#cb115-2574" aria-hidden="true" tabindex="-1"></a>      T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb115-2575"><a href="#cb115-2575" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2576"><a href="#cb115-2576" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T3</span></span>
<span id="cb115-2577"><a href="#cb115-2577" aria-hidden="true" tabindex="-1"></a>      dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-2578"><a href="#cb115-2578" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb115-2579"><a href="#cb115-2579" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2580"><a href="#cb115-2580" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-2581"><a href="#cb115-2581" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2582"><a href="#cb115-2582" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2583"><a href="#cb115-2583" aria-hidden="true" tabindex="-1"></a>      T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb115-2584"><a href="#cb115-2584" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2585"><a href="#cb115-2585" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2586"><a href="#cb115-2586" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-2587"><a href="#cb115-2587" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb115-2588"><a href="#cb115-2588" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2589"><a href="#cb115-2589" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-2590"><a href="#cb115-2590" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb115-2591"><a href="#cb115-2591" aria-hidden="true" tabindex="-1"></a>        dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-2592"><a href="#cb115-2592" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2593"><a href="#cb115-2593" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-2594"><a href="#cb115-2594" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-2595"><a href="#cb115-2595" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-2596"><a href="#cb115-2596" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2597"><a href="#cb115-2597" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb115-2598"><a href="#cb115-2598" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2599"><a href="#cb115-2599" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb115-2600"><a href="#cb115-2600" aria-hidden="true" tabindex="-1"></a>        dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-2601"><a href="#cb115-2601" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2602"><a href="#cb115-2602" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-2603"><a href="#cb115-2603" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-2604"><a href="#cb115-2604" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-2605"><a href="#cb115-2605" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2606"><a href="#cb115-2606" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb115-2607"><a href="#cb115-2607" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2608"><a href="#cb115-2608" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb115-2609"><a href="#cb115-2609" aria-hidden="true" tabindex="-1"></a>        dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-2610"><a href="#cb115-2610" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2611"><a href="#cb115-2611" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-2612"><a href="#cb115-2612" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-2613"><a href="#cb115-2613" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-2614"><a href="#cb115-2614" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2615"><a href="#cb115-2615" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb115-2616"><a href="#cb115-2616" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2617"><a href="#cb115-2617" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2618"><a href="#cb115-2618" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2619"><a href="#cb115-2619" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-2620"><a href="#cb115-2620" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb115-2621"><a href="#cb115-2621" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb115-2622"><a href="#cb115-2622" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb115-2623"><a href="#cb115-2623" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2624"><a href="#cb115-2624" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2625"><a href="#cb115-2625" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb115-2626"><a href="#cb115-2626" aria-hidden="true" tabindex="-1"></a>      dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2627"><a href="#cb115-2627" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb115-2628"><a href="#cb115-2628" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb115-2629"><a href="#cb115-2629" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb115-2630"><a href="#cb115-2630" aria-hidden="true" tabindex="-1"></a>                        <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2631"><a href="#cb115-2631" aria-hidden="true" tabindex="-1"></a>      Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb115-2632"><a href="#cb115-2632" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2633"><a href="#cb115-2633" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb115-2634"><a href="#cb115-2634" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb115-2635"><a href="#cb115-2635" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-2636"><a href="#cb115-2636" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-2637"><a href="#cb115-2637" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-2638"><a href="#cb115-2638" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-2639"><a href="#cb115-2639" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-2640"><a href="#cb115-2640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2641"><a href="#cb115-2641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2642"><a href="#cb115-2642" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2643"><a href="#cb115-2643" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-2644"><a href="#cb115-2644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2645"><a href="#cb115-2645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2646"><a href="#cb115-2646" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-2647"><a href="#cb115-2647" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-2648"><a href="#cb115-2648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2651"><a href="#cb115-2651" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-2652"><a href="#cb115-2652" aria-hidden="true" tabindex="-1"></a><span class="do">## package</span></span>
<span id="cb115-2653"><a href="#cb115-2653" aria-hidden="true" tabindex="-1"></a>dfYp</span>
<span id="cb115-2654"><a href="#cb115-2654" aria-hidden="true" tabindex="-1"></a><span class="do">## a Long code</span></span>
<span id="cb115-2655"><a href="#cb115-2655" aria-hidden="true" tabindex="-1"></a>dYp </span>
<span id="cb115-2656"><a href="#cb115-2656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-2657"><a href="#cb115-2657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2660"><a href="#cb115-2660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-2661"><a href="#cb115-2661" aria-hidden="true" tabindex="-1"></a><span class="do">### test</span></span>
<span id="cb115-2662"><a href="#cb115-2662" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"dataY function"</span>, {</span>
<span id="cb115-2663"><a href="#cb115-2663" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-2664"><a href="#cb115-2664" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num - Am</span></span>
<span id="cb115-2665"><a href="#cb115-2665" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expect_equal(dfYp[,c(2:6)],dYp[,c(1:5)])</span></span>
<span id="cb115-2666"><a href="#cb115-2666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"v1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"v1"</span>)])</span>
<span id="cb115-2667"><a href="#cb115-2667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"v2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"v2"</span>)])</span>
<span id="cb115-2668"><a href="#cb115-2668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"v3"</span>],dYp[,<span class="fu">c</span>(<span class="st">"v3"</span>)])</span>
<span id="cb115-2669"><a href="#cb115-2669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"v4"</span>],dYp[,<span class="fu">c</span>(<span class="st">"v4"</span>)])</span>
<span id="cb115-2670"><a href="#cb115-2670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"A1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"A"</span>)])</span>
<span id="cb115-2671"><a href="#cb115-2671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"A1l1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"Al1"</span>)])</span>
<span id="cb115-2672"><a href="#cb115-2672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"A1l2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"Al2"</span>)])</span>
<span id="cb115-2673"><a href="#cb115-2673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"M1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"M1"</span>)])</span>
<span id="cb115-2674"><a href="#cb115-2674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"M1l1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"M1l1"</span>)])</span>
<span id="cb115-2675"><a href="#cb115-2675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"M1l2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"M1l2"</span>)])</span>
<span id="cb115-2676"><a href="#cb115-2676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T1"</span>)])</span>
<span id="cb115-2677"><a href="#cb115-2677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L1l1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T1l1"</span>)])</span>
<span id="cb115-2678"><a href="#cb115-2678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L1l2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T1l2"</span>)])</span>
<span id="cb115-2679"><a href="#cb115-2679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T2"</span>)])</span>
<span id="cb115-2680"><a href="#cb115-2680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L2l1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T2l1"</span>)])</span>
<span id="cb115-2681"><a href="#cb115-2681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L2l2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T2l2"</span>)])</span>
<span id="cb115-2682"><a href="#cb115-2682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L3"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T3"</span>)])</span>
<span id="cb115-2683"><a href="#cb115-2683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L3l1"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T3l1"</span>)])</span>
<span id="cb115-2684"><a href="#cb115-2684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dfYp[,<span class="st">"L3l2"</span>],dYp[,<span class="fu">c</span>(<span class="st">"T3l2"</span>)])</span>
<span id="cb115-2685"><a href="#cb115-2685" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb115-2686"><a href="#cb115-2686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-2687"><a href="#cb115-2687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2688"><a href="#cb115-2688" aria-hidden="true" tabindex="-1"></a>và model dùng để fit thì giống nhau</span>
<span id="cb115-2689"><a href="#cb115-2689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2690"><a href="#cb115-2690" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-2691"><a href="#cb115-2691" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-2692"><a href="#cb115-2692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2695"><a href="#cb115-2695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-2696"><a href="#cb115-2696" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Y</span>
<span id="cb115-2697"><a href="#cb115-2697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-2698"><a href="#cb115-2698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2699"><a href="#cb115-2699" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-2700"><a href="#cb115-2700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2701"><a href="#cb115-2701" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-2702"><a href="#cb115-2702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2705"><a href="#cb115-2705" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-2706"><a href="#cb115-2706" aria-hidden="true" tabindex="-1"></a>fitR[[<span class="dv">2</span>]]</span>
<span id="cb115-2707"><a href="#cb115-2707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-2708"><a href="#cb115-2708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2709"><a href="#cb115-2709" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-2710"><a href="#cb115-2710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2711"><a href="#cb115-2711" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-2712"><a href="#cb115-2712" aria-hidden="true" tabindex="-1"></a><span class="fu">## predict time = 6</span></span>
<span id="cb115-2713"><a href="#cb115-2713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2714"><a href="#cb115-2714" aria-hidden="true" tabindex="-1"></a>lúc này ở trên data đang có đến time = 5, nên em chỉ cần l = 6 để predict Y, thì lúc này predict lại ra là 0</span>
<span id="cb115-2715"><a href="#cb115-2715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2716"><a href="#cb115-2716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2717"><a href="#cb115-2717" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-2718"><a href="#cb115-2718" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-2719"><a href="#cb115-2719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2720"><a href="#cb115-2720" aria-hidden="true" tabindex="-1"></a>package code</span>
<span id="cb115-2721"><a href="#cb115-2721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2724"><a href="#cb115-2724" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-2725"><a href="#cb115-2725" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for (l in lagg:5) {</span></span>
<span id="cb115-2726"><a href="#cb115-2726" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb115-2727"><a href="#cb115-2727" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb115-2728"><a href="#cb115-2728" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb115-2729"><a href="#cb115-2729" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb115-2730"><a href="#cb115-2730" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2731"><a href="#cb115-2731" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb115-2732"><a href="#cb115-2732" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-2733"><a href="#cb115-2733" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb115-2734"><a href="#cb115-2734" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2735"><a href="#cb115-2735" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2736"><a href="#cb115-2736" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-2737"><a href="#cb115-2737" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2738"><a href="#cb115-2738" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb115-2739"><a href="#cb115-2739" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2740"><a href="#cb115-2740" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2741"><a href="#cb115-2741" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-2742"><a href="#cb115-2742" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2743"><a href="#cb115-2743" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb115-2744"><a href="#cb115-2744" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-2745"><a href="#cb115-2745" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-2746"><a href="#cb115-2746" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2747"><a href="#cb115-2747" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-2748"><a href="#cb115-2748" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2749"><a href="#cb115-2749" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2750"><a href="#cb115-2750" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2751"><a href="#cb115-2751" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2752"><a href="#cb115-2752" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2753"><a href="#cb115-2753" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2754"><a href="#cb115-2754" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb115-2755"><a href="#cb115-2755" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2756"><a href="#cb115-2756" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-2757"><a href="#cb115-2757" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2758"><a href="#cb115-2758" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-2759"><a href="#cb115-2759" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2760"><a href="#cb115-2760" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb115-2761"><a href="#cb115-2761" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2762"><a href="#cb115-2762" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-2763"><a href="#cb115-2763" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2764"><a href="#cb115-2764" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb115-2765"><a href="#cb115-2765" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb115-2766"><a href="#cb115-2766" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-2767"><a href="#cb115-2767" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-2768"><a href="#cb115-2768" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2769"><a href="#cb115-2769" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb115-2770"><a href="#cb115-2770" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2771"><a href="#cb115-2771" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2772"><a href="#cb115-2772" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb115-2773"><a href="#cb115-2773" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb115-2774"><a href="#cb115-2774" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb115-2775"><a href="#cb115-2775" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2776"><a href="#cb115-2776" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2777"><a href="#cb115-2777" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2778"><a href="#cb115-2778" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2779"><a href="#cb115-2779" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2780"><a href="#cb115-2780" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-2781"><a href="#cb115-2781" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb115-2782"><a href="#cb115-2782" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-2783"><a href="#cb115-2783" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb115-2784"><a href="#cb115-2784" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2785"><a href="#cb115-2785" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-2786"><a href="#cb115-2786" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb115-2787"><a href="#cb115-2787" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-2788"><a href="#cb115-2788" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2789"><a href="#cb115-2789" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2790"><a href="#cb115-2790" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-2791"><a href="#cb115-2791" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2792"><a href="#cb115-2792" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-2793"><a href="#cb115-2793" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-2794"><a href="#cb115-2794" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-2795"><a href="#cb115-2795" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2796"><a href="#cb115-2796" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-2797"><a href="#cb115-2797" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2798"><a href="#cb115-2798" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2799"><a href="#cb115-2799" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2800"><a href="#cb115-2800" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2801"><a href="#cb115-2801" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2802"><a href="#cb115-2802" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb115-2803"><a href="#cb115-2803" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2804"><a href="#cb115-2804" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-2805"><a href="#cb115-2805" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2806"><a href="#cb115-2806" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-2807"><a href="#cb115-2807" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb115-2808"><a href="#cb115-2808" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2809"><a href="#cb115-2809" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2810"><a href="#cb115-2810" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2811"><a href="#cb115-2811" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-2812"><a href="#cb115-2812" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2813"><a href="#cb115-2813" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2814"><a href="#cb115-2814" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb115-2815"><a href="#cb115-2815" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb115-2816"><a href="#cb115-2816" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-2817"><a href="#cb115-2817" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2818"><a href="#cb115-2818" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-2819"><a href="#cb115-2819" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2820"><a href="#cb115-2820" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb115-2821"><a href="#cb115-2821" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2822"><a href="#cb115-2822" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2823"><a href="#cb115-2823" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb115-2824"><a href="#cb115-2824" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb115-2825"><a href="#cb115-2825" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb115-2826"><a href="#cb115-2826" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2827"><a href="#cb115-2827" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2828"><a href="#cb115-2828" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2829"><a href="#cb115-2829" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2830"><a href="#cb115-2830" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2831"><a href="#cb115-2831" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-2832"><a href="#cb115-2832" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-2833"><a href="#cb115-2833" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2834"><a href="#cb115-2834" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-2835"><a href="#cb115-2835" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb115-2836"><a href="#cb115-2836" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-2837"><a href="#cb115-2837" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2838"><a href="#cb115-2838" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-2839"><a href="#cb115-2839" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2840"><a href="#cb115-2840" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-2841"><a href="#cb115-2841" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-2842"><a href="#cb115-2842" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb115-2843"><a href="#cb115-2843" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2844"><a href="#cb115-2844" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb115-2845"><a href="#cb115-2845" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2846"><a href="#cb115-2846" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-2847"><a href="#cb115-2847" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2848"><a href="#cb115-2848" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2849"><a href="#cb115-2849" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2850"><a href="#cb115-2850" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb115-2851"><a href="#cb115-2851" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2852"><a href="#cb115-2852" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-2853"><a href="#cb115-2853" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2854"><a href="#cb115-2854" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-2855"><a href="#cb115-2855" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb115-2856"><a href="#cb115-2856" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-2857"><a href="#cb115-2857" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2858"><a href="#cb115-2858" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-2859"><a href="#cb115-2859" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb115-2860"><a href="#cb115-2860" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-2861"><a href="#cb115-2861" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2862"><a href="#cb115-2862" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb115-2863"><a href="#cb115-2863" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb115-2864"><a href="#cb115-2864" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb115-2865"><a href="#cb115-2865" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-2866"><a href="#cb115-2866" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb115-2867"><a href="#cb115-2867" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2868"><a href="#cb115-2868" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-2869"><a href="#cb115-2869" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2870"><a href="#cb115-2870" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-2871"><a href="#cb115-2871" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb115-2872"><a href="#cb115-2872" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb115-2873"><a href="#cb115-2873" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-2874"><a href="#cb115-2874" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-2875"><a href="#cb115-2875" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-2876"><a href="#cb115-2876" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-2877"><a href="#cb115-2877" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2878"><a href="#cb115-2878" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2879"><a href="#cb115-2879" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb115-2880"><a href="#cb115-2880" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb115-2881"><a href="#cb115-2881" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2882"><a href="#cb115-2882" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2883"><a href="#cb115-2883" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb115-2884"><a href="#cb115-2884" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-2885"><a href="#cb115-2885" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb115-2886"><a href="#cb115-2886" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-2887"><a href="#cb115-2887" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-2888"><a href="#cb115-2888" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb115-2889"><a href="#cb115-2889" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-2890"><a href="#cb115-2890" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb115-2891"><a href="#cb115-2891" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2892"><a href="#cb115-2892" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-2893"><a href="#cb115-2893" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2894"><a href="#cb115-2894" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-2895"><a href="#cb115-2895" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-2896"><a href="#cb115-2896" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-2897"><a href="#cb115-2897" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2898"><a href="#cb115-2898" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-2899"><a href="#cb115-2899" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-2900"><a href="#cb115-2900" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-2901"><a href="#cb115-2901" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2902"><a href="#cb115-2902" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2903"><a href="#cb115-2903" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2904"><a href="#cb115-2904" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb115-2905"><a href="#cb115-2905" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2906"><a href="#cb115-2906" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-2907"><a href="#cb115-2907" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-2908"><a href="#cb115-2908" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-2909"><a href="#cb115-2909" aria-hidden="true" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb115-2910"><a href="#cb115-2910" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-2911"><a href="#cb115-2911" aria-hidden="true" tabindex="-1"></a> Yp2 </span>
<span id="cb115-2912"><a href="#cb115-2912" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-2913"><a href="#cb115-2913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2914"><a href="#cb115-2914" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-2915"><a href="#cb115-2915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2916"><a href="#cb115-2916" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-2917"><a href="#cb115-2917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-2920"><a href="#cb115-2920" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-2921"><a href="#cb115-2921" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for (l in 2:5) {</span></span>
<span id="cb115-2922"><a href="#cb115-2922" aria-hidden="true" tabindex="-1"></a>    l <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb115-2923"><a href="#cb115-2923" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb115-2924"><a href="#cb115-2924" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2925"><a href="#cb115-2925" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb115-2926"><a href="#cb115-2926" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb115-2927"><a href="#cb115-2927" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb115-2928"><a href="#cb115-2928" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb115-2929"><a href="#cb115-2929" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2930"><a href="#cb115-2930" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb115-2931"><a href="#cb115-2931" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb115-2932"><a href="#cb115-2932" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb115-2933"><a href="#cb115-2933" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb115-2934"><a href="#cb115-2934" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2935"><a href="#cb115-2935" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-2936"><a href="#cb115-2936" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2937"><a href="#cb115-2937" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb115-2938"><a href="#cb115-2938" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb115-2939"><a href="#cb115-2939" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb115-2940"><a href="#cb115-2940" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb115-2941"><a href="#cb115-2941" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb115-2942"><a href="#cb115-2942" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb115-2943"><a href="#cb115-2943" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb115-2944"><a href="#cb115-2944" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-2945"><a href="#cb115-2945" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2946"><a href="#cb115-2946" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2947"><a href="#cb115-2947" aria-hidden="true" tabindex="-1"></a>      T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb115-2948"><a href="#cb115-2948" aria-hidden="true" tabindex="-1"></a>      T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb115-2949"><a href="#cb115-2949" aria-hidden="true" tabindex="-1"></a>      T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb115-2950"><a href="#cb115-2950" aria-hidden="true" tabindex="-1"></a>      T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb115-2951"><a href="#cb115-2951" aria-hidden="true" tabindex="-1"></a>      T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb115-2952"><a href="#cb115-2952" aria-hidden="true" tabindex="-1"></a>      T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb115-2953"><a href="#cb115-2953" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2954"><a href="#cb115-2954" aria-hidden="true" tabindex="-1"></a>      M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb115-2955"><a href="#cb115-2955" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2956"><a href="#cb115-2956" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2957"><a href="#cb115-2957" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2958"><a href="#cb115-2958" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb115-2959"><a href="#cb115-2959" aria-hidden="true" tabindex="-1"></a>      dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2960"><a href="#cb115-2960" aria-hidden="true" tabindex="-1"></a>                         <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2961"><a href="#cb115-2961" aria-hidden="true" tabindex="-1"></a>                         <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2962"><a href="#cb115-2962" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2963"><a href="#cb115-2963" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb115-2964"><a href="#cb115-2964" aria-hidden="true" tabindex="-1"></a>        <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb115-2965"><a href="#cb115-2965" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb115-2966"><a href="#cb115-2966" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-2967"><a href="#cb115-2967" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-2968"><a href="#cb115-2968" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-2969"><a href="#cb115-2969" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2970"><a href="#cb115-2970" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2971"><a href="#cb115-2971" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2972"><a href="#cb115-2972" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-2973"><a href="#cb115-2973" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T1</span></span>
<span id="cb115-2974"><a href="#cb115-2974" aria-hidden="true" tabindex="-1"></a>      dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-2975"><a href="#cb115-2975" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2976"><a href="#cb115-2976" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2977"><a href="#cb115-2977" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-2978"><a href="#cb115-2978" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2979"><a href="#cb115-2979" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2980"><a href="#cb115-2980" aria-hidden="true" tabindex="-1"></a>      T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb115-2981"><a href="#cb115-2981" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2982"><a href="#cb115-2982" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T2</span></span>
<span id="cb115-2983"><a href="#cb115-2983" aria-hidden="true" tabindex="-1"></a>      dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-2984"><a href="#cb115-2984" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-2985"><a href="#cb115-2985" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2986"><a href="#cb115-2986" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-2987"><a href="#cb115-2987" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2988"><a href="#cb115-2988" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2989"><a href="#cb115-2989" aria-hidden="true" tabindex="-1"></a>      T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb115-2990"><a href="#cb115-2990" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-2991"><a href="#cb115-2991" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T3</span></span>
<span id="cb115-2992"><a href="#cb115-2992" aria-hidden="true" tabindex="-1"></a>      dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-2993"><a href="#cb115-2993" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb115-2994"><a href="#cb115-2994" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-2995"><a href="#cb115-2995" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-2996"><a href="#cb115-2996" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-2997"><a href="#cb115-2997" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-2998"><a href="#cb115-2998" aria-hidden="true" tabindex="-1"></a>      T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb115-2999"><a href="#cb115-2999" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3000"><a href="#cb115-3000" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3001"><a href="#cb115-3001" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-3002"><a href="#cb115-3002" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb115-3003"><a href="#cb115-3003" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3004"><a href="#cb115-3004" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-3005"><a href="#cb115-3005" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb115-3006"><a href="#cb115-3006" aria-hidden="true" tabindex="-1"></a>        dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-3007"><a href="#cb115-3007" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3008"><a href="#cb115-3008" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-3009"><a href="#cb115-3009" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-3010"><a href="#cb115-3010" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-3011"><a href="#cb115-3011" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3012"><a href="#cb115-3012" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb115-3013"><a href="#cb115-3013" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3014"><a href="#cb115-3014" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb115-3015"><a href="#cb115-3015" aria-hidden="true" tabindex="-1"></a>        dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-3016"><a href="#cb115-3016" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3017"><a href="#cb115-3017" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-3018"><a href="#cb115-3018" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-3019"><a href="#cb115-3019" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-3020"><a href="#cb115-3020" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3021"><a href="#cb115-3021" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb115-3022"><a href="#cb115-3022" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3023"><a href="#cb115-3023" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb115-3024"><a href="#cb115-3024" aria-hidden="true" tabindex="-1"></a>        dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-3025"><a href="#cb115-3025" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3026"><a href="#cb115-3026" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-3027"><a href="#cb115-3027" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-3028"><a href="#cb115-3028" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-3029"><a href="#cb115-3029" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3030"><a href="#cb115-3030" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb115-3031"><a href="#cb115-3031" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3032"><a href="#cb115-3032" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3033"><a href="#cb115-3033" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3034"><a href="#cb115-3034" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-3035"><a href="#cb115-3035" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb115-3036"><a href="#cb115-3036" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb115-3037"><a href="#cb115-3037" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb115-3038"><a href="#cb115-3038" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3039"><a href="#cb115-3039" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3040"><a href="#cb115-3040" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb115-3041"><a href="#cb115-3041" aria-hidden="true" tabindex="-1"></a>      dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3042"><a href="#cb115-3042" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb115-3043"><a href="#cb115-3043" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb115-3044"><a href="#cb115-3044" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb115-3045"><a href="#cb115-3045" aria-hidden="true" tabindex="-1"></a>                        <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3046"><a href="#cb115-3046" aria-hidden="true" tabindex="-1"></a>      Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb115-3047"><a href="#cb115-3047" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3048"><a href="#cb115-3048" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb115-3049"><a href="#cb115-3049" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb115-3050"><a href="#cb115-3050" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-3051"><a href="#cb115-3051" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3052"><a href="#cb115-3052" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-3053"><a href="#cb115-3053" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3054"><a href="#cb115-3054" aria-hidden="true" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb115-3055"><a href="#cb115-3055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3056"><a href="#cb115-3056" aria-hidden="true" tabindex="-1"></a>Yp</span>
<span id="cb115-3057"><a href="#cb115-3057" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3058"><a href="#cb115-3058" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3059"><a href="#cb115-3059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3060"><a href="#cb115-3060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3061"><a href="#cb115-3061" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3062"><a href="#cb115-3062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3063"><a href="#cb115-3063" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3064"><a href="#cb115-3064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3065"><a href="#cb115-3065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3066"><a href="#cb115-3066" aria-hidden="true" tabindex="-1"></a><span class="fu">## predict đến length</span></span>
<span id="cb115-3067"><a href="#cb115-3067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3068"><a href="#cb115-3068" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-3069"><a href="#cb115-3069" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-3070"><a href="#cb115-3070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3071"><a href="#cb115-3071" aria-hidden="true" tabindex="-1"></a>package code</span>
<span id="cb115-3072"><a href="#cb115-3072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3075"><a href="#cb115-3075" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3076"><a href="#cb115-3076" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>) {</span>
<span id="cb115-3077"><a href="#cb115-3077" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3078"><a href="#cb115-3078" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp2[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb115-3079"><a href="#cb115-3079" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb115-3080"><a href="#cb115-3080" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb115-3081"><a href="#cb115-3081" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3082"><a href="#cb115-3082" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb115-3083"><a href="#cb115-3083" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>M[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-3084"><a href="#cb115-3084" aria-hidden="true" tabindex="-1"></a>      var_fm <span class="ot">&lt;-</span> var_fm[<span class="sc">-</span><span class="fu">length</span>(var_fm)] </span>
<span id="cb115-3085"><a href="#cb115-3085" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3086"><a href="#cb115-3086" aria-hidden="true" tabindex="-1"></a>      dfMp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fm)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-3087"><a href="#cb115-3087" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-3088"><a href="#cb115-3088" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3089"><a href="#cb115-3089" aria-hidden="true" tabindex="-1"></a>      dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb115-3090"><a href="#cb115-3090" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3091"><a href="#cb115-3091" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3092"><a href="#cb115-3092" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-3093"><a href="#cb115-3093" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3094"><a href="#cb115-3094" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(lagg)){</span>
<span id="cb115-3095"><a href="#cb115-3095" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-3096"><a href="#cb115-3096" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-3097"><a href="#cb115-3097" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-3098"><a href="#cb115-3098" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-3099"><a href="#cb115-3099" aria-hidden="true" tabindex="-1"></a>          dfMp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfMp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfMp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-3100"><a href="#cb115-3100" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-3101"><a href="#cb115-3101" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3102"><a href="#cb115-3102" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3103"><a href="#cb115-3103" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3104"><a href="#cb115-3104" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3105"><a href="#cb115-3105" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>M)){</span>
<span id="cb115-3106"><a href="#cb115-3106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3107"><a href="#cb115-3107" aria-hidden="true" tabindex="-1"></a>        M_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>M[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-3108"><a href="#cb115-3108" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3109"><a href="#cb115-3109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Mp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-3110"><a href="#cb115-3110" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3111"><a href="#cb115-3111" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (M_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Mp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb115-3112"><a href="#cb115-3112" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-3113"><a href="#cb115-3113" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-3114"><a href="#cb115-3114" aria-hidden="true" tabindex="-1"></a>            Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-3115"><a href="#cb115-3115" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb115-3116"><a href="#cb115-3116" aria-hidden="true" tabindex="-1"></a>              M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb115-3117"><a href="#cb115-3117" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-3118"><a href="#cb115-3118" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-3119"><a href="#cb115-3119" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3120"><a href="#cb115-3120" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb115-3121"><a href="#cb115-3121" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3122"><a href="#cb115-3122" aria-hidden="true" tabindex="-1"></a>          Mp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-3123"><a href="#cb115-3123" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">rFunc</span>(data<span class="sc">$</span>M[[x]], dfMp),</span>
<span id="cb115-3124"><a href="#cb115-3124" aria-hidden="true" tabindex="-1"></a>            M_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>M[[x]], dfMp)</span>
<span id="cb115-3125"><a href="#cb115-3125" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb115-3126"><a href="#cb115-3126" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3127"><a href="#cb115-3127" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-3128"><a href="#cb115-3128" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3129"><a href="#cb115-3129" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3130"><a href="#cb115-3130" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3131"><a href="#cb115-3131" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-3132"><a href="#cb115-3132" aria-hidden="true" tabindex="-1"></a>      <span class="co"># L</span></span>
<span id="cb115-3133"><a href="#cb115-3133" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>L[[<span class="dv">1</span>]]<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-3134"><a href="#cb115-3134" aria-hidden="true" tabindex="-1"></a>      var_fl <span class="ot">&lt;-</span> var_fl[<span class="sc">-</span><span class="fu">length</span>(var_fl)] </span>
<span id="cb115-3135"><a href="#cb115-3135" aria-hidden="true" tabindex="-1"></a>      dfLmp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-3136"><a href="#cb115-3136" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-3137"><a href="#cb115-3137" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> am</span>
<span id="cb115-3138"><a href="#cb115-3138" aria-hidden="true" tabindex="-1"></a>      dfLmp[<span class="fu">colnames</span>(dfLmp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-3139"><a href="#cb115-3139" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3140"><a href="#cb115-3140" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3141"><a href="#cb115-3141" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-3142"><a href="#cb115-3142" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3143"><a href="#cb115-3143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-3144"><a href="#cb115-3144" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-3145"><a href="#cb115-3145" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-3146"><a href="#cb115-3146" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Lmp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-3147"><a href="#cb115-3147" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-3148"><a href="#cb115-3148" aria-hidden="true" tabindex="-1"></a>          dfLmp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLmp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLmp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-3149"><a href="#cb115-3149" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-3150"><a href="#cb115-3150" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3151"><a href="#cb115-3151" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3152"><a href="#cb115-3152" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3153"><a href="#cb115-3153" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb115-3154"><a href="#cb115-3154" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3155"><a href="#cb115-3155" aria-hidden="true" tabindex="-1"></a>        L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-3156"><a href="#cb115-3156" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3157"><a href="#cb115-3157" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">names</span>(Lmp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-3158"><a href="#cb115-3158" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lmp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb115-3159"><a href="#cb115-3159" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-3160"><a href="#cb115-3160" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-3161"><a href="#cb115-3161" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-3162"><a href="#cb115-3162" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-3163"><a href="#cb115-3163" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-3164"><a href="#cb115-3164" aria-hidden="true" tabindex="-1"></a>            Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-3165"><a href="#cb115-3165" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb115-3166"><a href="#cb115-3166" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb115-3167"><a href="#cb115-3167" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-3168"><a href="#cb115-3168" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-3169"><a href="#cb115-3169" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-3170"><a href="#cb115-3170" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3171"><a href="#cb115-3171" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb115-3172"><a href="#cb115-3172" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3173"><a href="#cb115-3173" aria-hidden="true" tabindex="-1"></a>          Lmp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-3174"><a href="#cb115-3174" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLmp),</span>
<span id="cb115-3175"><a href="#cb115-3175" aria-hidden="true" tabindex="-1"></a>            L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLmp)</span>
<span id="cb115-3176"><a href="#cb115-3176" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb115-3177"><a href="#cb115-3177" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3178"><a href="#cb115-3178" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-3179"><a href="#cb115-3179" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3180"><a href="#cb115-3180" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3181"><a href="#cb115-3181" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3182"><a href="#cb115-3182" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-3183"><a href="#cb115-3183" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-3184"><a href="#cb115-3184" aria-hidden="true" tabindex="-1"></a>        dfLp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_fl)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-3185"><a href="#cb115-3185" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-3186"><a href="#cb115-3186" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb115-3187"><a href="#cb115-3187" aria-hidden="true" tabindex="-1"></a>        dfLp[<span class="fu">colnames</span>(dfLp) <span class="sc">==</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-3188"><a href="#cb115-3188" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3189"><a href="#cb115-3189" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-3190"><a href="#cb115-3190" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3191"><a href="#cb115-3191" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-3192"><a href="#cb115-3192" aria-hidden="true" tabindex="-1"></a>            term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-3193"><a href="#cb115-3193" aria-hidden="true" tabindex="-1"></a>            <span class="co"># L lag</span></span>
<span id="cb115-3194"><a href="#cb115-3194" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-3195"><a href="#cb115-3195" aria-hidden="true" tabindex="-1"></a>            <span class="co"># M lag</span></span>
<span id="cb115-3196"><a href="#cb115-3196" aria-hidden="true" tabindex="-1"></a>            dfLp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfLp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfLp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-3197"><a href="#cb115-3197" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-3198"><a href="#cb115-3198" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3199"><a href="#cb115-3199" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-3200"><a href="#cb115-3200" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3201"><a href="#cb115-3201" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L)){</span>
<span id="cb115-3202"><a href="#cb115-3202" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3203"><a href="#cb115-3203" aria-hidden="true" tabindex="-1"></a>          L_reg <span class="ot">&lt;-</span> data<span class="sc">$</span>L[[x]]<span class="sc">$</span>family<span class="sc">$</span>family</span>
<span id="cb115-3204"><a href="#cb115-3204" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3205"><a href="#cb115-3205" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">names</span>(Lp[x]) <span class="sc">%in%</span> norev_var){</span>
<span id="cb115-3206"><a href="#cb115-3206" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (L_reg <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">&amp;</span> Lp[l<span class="dv">-1</span>,x] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb115-3207"><a href="#cb115-3207" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-3208"><a href="#cb115-3208" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-3209"><a href="#cb115-3209" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-3210"><a href="#cb115-3210" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb115-3211"><a href="#cb115-3211" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-3212"><a href="#cb115-3212" aria-hidden="true" tabindex="-1"></a>              Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-3213"><a href="#cb115-3213" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb115-3214"><a href="#cb115-3214" aria-hidden="true" tabindex="-1"></a>                L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb115-3215"><a href="#cb115-3215" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb115-3216"><a href="#cb115-3216" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb115-3217"><a href="#cb115-3217" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb115-3218"><a href="#cb115-3218" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-3219"><a href="#cb115-3219" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb115-3220"><a href="#cb115-3220" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-3221"><a href="#cb115-3221" aria-hidden="true" tabindex="-1"></a>            Lp[l,x] <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb115-3222"><a href="#cb115-3222" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"binomial"</span> <span class="sc">~</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>L[[x]], dfLp),</span>
<span id="cb115-3223"><a href="#cb115-3223" aria-hidden="true" tabindex="-1"></a>              L_reg  <span class="sc">==</span> <span class="st">"gaussian"</span> <span class="sc">~</span> <span class="fu">predict</span>(data<span class="sc">$</span>L[[x]], dfLp)</span>
<span id="cb115-3224"><a href="#cb115-3224" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb115-3225"><a href="#cb115-3225" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb115-3226"><a href="#cb115-3226" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb115-3227"><a href="#cb115-3227" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3228"><a href="#cb115-3228" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-3229"><a href="#cb115-3229" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3230"><a href="#cb115-3230" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb115-3231"><a href="#cb115-3231" aria-hidden="true" tabindex="-1"></a>        Lp <span class="ot">&lt;-</span> Lmp</span>
<span id="cb115-3232"><a href="#cb115-3232" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3233"><a href="#cb115-3233" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3234"><a href="#cb115-3234" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb115-3235"><a href="#cb115-3235" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> <span class="fu">attr</span>(data<span class="sc">$</span>Y<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb115-3236"><a href="#cb115-3236" aria-hidden="true" tabindex="-1"></a>      var_y <span class="ot">&lt;-</span> var_y[<span class="sc">-</span><span class="fu">length</span>(var_y)] </span>
<span id="cb115-3237"><a href="#cb115-3237" aria-hidden="true" tabindex="-1"></a>      dfYp <span class="ot">&lt;-</span> d2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(var_y)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-3238"><a href="#cb115-3238" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">jj =</span> (l<span class="sc">-</span>timee<span class="sc">$</span>mean_j)<span class="sc">/</span>timee<span class="sc">$</span>sd_j)</span>
<span id="cb115-3239"><a href="#cb115-3239" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"A"</span>)] <span class="ot">&lt;-</span> ay</span>
<span id="cb115-3240"><a href="#cb115-3240" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Mp)] <span class="ot">&lt;-</span> Mp[l,]</span>
<span id="cb115-3241"><a href="#cb115-3241" aria-hidden="true" tabindex="-1"></a>      dfYp[<span class="fu">colnames</span>(dfYp) <span class="sc">%in%</span> <span class="fu">colnames</span>(Lp)] <span class="ot">&lt;-</span> Lp[l,] </span>
<span id="cb115-3242"><a href="#cb115-3242" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3243"><a href="#cb115-3243" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">&gt;</span> lagg){</span>
<span id="cb115-3244"><a href="#cb115-3244" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3245"><a href="#cb115-3245" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (zz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>lagg){</span>
<span id="cb115-3246"><a href="#cb115-3246" aria-hidden="true" tabindex="-1"></a>          term <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"l"</span>,zz)</span>
<span id="cb115-3247"><a href="#cb115-3247" aria-hidden="true" tabindex="-1"></a>          <span class="co"># L lag</span></span>
<span id="cb115-3248"><a href="#cb115-3248" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"L"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Lp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-3249"><a href="#cb115-3249" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M lag</span></span>
<span id="cb115-3250"><a href="#cb115-3250" aria-hidden="true" tabindex="-1"></a>          dfYp[<span class="fu">startsWith</span>(<span class="fu">colnames</span>(dfYp), <span class="st">"M"</span>) <span class="sc">&amp;</span> <span class="fu">endsWith</span>(<span class="fu">colnames</span>(dfYp), term)] <span class="ot">&lt;-</span> Mp[l<span class="sc">-</span>zz,]</span>
<span id="cb115-3251"><a href="#cb115-3251" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-3252"><a href="#cb115-3252" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3253"><a href="#cb115-3253" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3254"><a href="#cb115-3254" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3255"><a href="#cb115-3255" aria-hidden="true" tabindex="-1"></a>      Yp2[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(data<span class="sc">$</span>Y, dfYp)</span>
<span id="cb115-3256"><a href="#cb115-3256" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3257"><a href="#cb115-3257" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-3258"><a href="#cb115-3258" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3259"><a href="#cb115-3259" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-3260"><a href="#cb115-3260" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-3261"><a href="#cb115-3261" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3262"><a href="#cb115-3262" aria-hidden="true" tabindex="-1"></a> Yp2</span>
<span id="cb115-3263"><a href="#cb115-3263" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb115-3264"><a href="#cb115-3264" aria-hidden="true" tabindex="-1"></a> <span class="fu">colnames</span>(Lmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lmp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb115-3265"><a href="#cb115-3265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(Lp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Lp"</span>,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data<span class="sc">$</span>L))</span>
<span id="cb115-3266"><a href="#cb115-3266" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3267"><a href="#cb115-3267" aria-hidden="true" tabindex="-1"></a>  <span class="co"># boot_num &lt;- seed</span></span>
<span id="cb115-3268"><a href="#cb115-3268" aria-hidden="true" tabindex="-1"></a>  gdat2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, Mp, Yp2,</span>
<span id="cb115-3269"><a href="#cb115-3269" aria-hidden="true" tabindex="-1"></a>                     Lmp, Lp, Vp)</span>
<span id="cb115-3270"><a href="#cb115-3270" aria-hidden="true" tabindex="-1"></a>  gdat2<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat2<span class="sc">$</span>id, <span class="at">fromLast =</span> T))</span>
<span id="cb115-3271"><a href="#cb115-3271" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3272"><a href="#cb115-3272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3273"><a href="#cb115-3273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3274"><a href="#cb115-3274" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3275"><a href="#cb115-3275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3276"><a href="#cb115-3276" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-3277"><a href="#cb115-3277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3278"><a href="#cb115-3278" aria-hidden="true" tabindex="-1"></a>a Long code</span>
<span id="cb115-3279"><a href="#cb115-3279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3282"><a href="#cb115-3282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3283"><a href="#cb115-3283" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>) {</span>
<span id="cb115-3284"><a href="#cb115-3284" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3285"><a href="#cb115-3285" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb115-3286"><a href="#cb115-3286" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3287"><a href="#cb115-3287" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb115-3288"><a href="#cb115-3288" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb115-3289"><a href="#cb115-3289" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb115-3290"><a href="#cb115-3290" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb115-3291"><a href="#cb115-3291" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3292"><a href="#cb115-3292" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb115-3293"><a href="#cb115-3293" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb115-3294"><a href="#cb115-3294" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb115-3295"><a href="#cb115-3295" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb115-3296"><a href="#cb115-3296" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3297"><a href="#cb115-3297" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-3298"><a href="#cb115-3298" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3299"><a href="#cb115-3299" aria-hidden="true" tabindex="-1"></a>        T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb115-3300"><a href="#cb115-3300" aria-hidden="true" tabindex="-1"></a>        T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb115-3301"><a href="#cb115-3301" aria-hidden="true" tabindex="-1"></a>        T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb115-3302"><a href="#cb115-3302" aria-hidden="true" tabindex="-1"></a>        T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb115-3303"><a href="#cb115-3303" aria-hidden="true" tabindex="-1"></a>        T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb115-3304"><a href="#cb115-3304" aria-hidden="true" tabindex="-1"></a>        T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb115-3305"><a href="#cb115-3305" aria-hidden="true" tabindex="-1"></a>        M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb115-3306"><a href="#cb115-3306" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3307"><a href="#cb115-3307" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3308"><a href="#cb115-3308" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3309"><a href="#cb115-3309" aria-hidden="true" tabindex="-1"></a>      T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb115-3310"><a href="#cb115-3310" aria-hidden="true" tabindex="-1"></a>      T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb115-3311"><a href="#cb115-3311" aria-hidden="true" tabindex="-1"></a>      T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb115-3312"><a href="#cb115-3312" aria-hidden="true" tabindex="-1"></a>      T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb115-3313"><a href="#cb115-3313" aria-hidden="true" tabindex="-1"></a>      T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb115-3314"><a href="#cb115-3314" aria-hidden="true" tabindex="-1"></a>      T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb115-3315"><a href="#cb115-3315" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3316"><a href="#cb115-3316" aria-hidden="true" tabindex="-1"></a>      M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb115-3317"><a href="#cb115-3317" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3318"><a href="#cb115-3318" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3319"><a href="#cb115-3319" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3320"><a href="#cb115-3320" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict mediator</span></span>
<span id="cb115-3321"><a href="#cb115-3321" aria-hidden="true" tabindex="-1"></a>      dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-3322"><a href="#cb115-3322" aria-hidden="true" tabindex="-1"></a>                         <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-3323"><a href="#cb115-3323" aria-hidden="true" tabindex="-1"></a>                         <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3324"><a href="#cb115-3324" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3325"><a href="#cb115-3325" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb115-3326"><a href="#cb115-3326" aria-hidden="true" tabindex="-1"></a>        <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb115-3327"><a href="#cb115-3327" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb115-3328"><a href="#cb115-3328" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-3329"><a href="#cb115-3329" aria-hidden="true" tabindex="-1"></a>        M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-3330"><a href="#cb115-3330" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3331"><a href="#cb115-3331" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3332"><a href="#cb115-3332" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3333"><a href="#cb115-3333" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3334"><a href="#cb115-3334" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-3335"><a href="#cb115-3335" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T1</span></span>
<span id="cb115-3336"><a href="#cb115-3336" aria-hidden="true" tabindex="-1"></a>      dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-3337"><a href="#cb115-3337" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3338"><a href="#cb115-3338" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-3339"><a href="#cb115-3339" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-3340"><a href="#cb115-3340" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-3341"><a href="#cb115-3341" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3342"><a href="#cb115-3342" aria-hidden="true" tabindex="-1"></a>      T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb115-3343"><a href="#cb115-3343" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3344"><a href="#cb115-3344" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T2</span></span>
<span id="cb115-3345"><a href="#cb115-3345" aria-hidden="true" tabindex="-1"></a>      dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-3346"><a href="#cb115-3346" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3347"><a href="#cb115-3347" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-3348"><a href="#cb115-3348" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-3349"><a href="#cb115-3349" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-3350"><a href="#cb115-3350" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3351"><a href="#cb115-3351" aria-hidden="true" tabindex="-1"></a>      T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb115-3352"><a href="#cb115-3352" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3353"><a href="#cb115-3353" aria-hidden="true" tabindex="-1"></a>      <span class="co"># T3</span></span>
<span id="cb115-3354"><a href="#cb115-3354" aria-hidden="true" tabindex="-1"></a>      dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-3355"><a href="#cb115-3355" aria-hidden="true" tabindex="-1"></a>                          <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb115-3356"><a href="#cb115-3356" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-3357"><a href="#cb115-3357" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-3358"><a href="#cb115-3358" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-3359"><a href="#cb115-3359" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3360"><a href="#cb115-3360" aria-hidden="true" tabindex="-1"></a>      T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb115-3361"><a href="#cb115-3361" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3362"><a href="#cb115-3362" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3363"><a href="#cb115-3363" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-3364"><a href="#cb115-3364" aria-hidden="true" tabindex="-1"></a>      <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb115-3365"><a href="#cb115-3365" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3366"><a href="#cb115-3366" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-3367"><a href="#cb115-3367" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb115-3368"><a href="#cb115-3368" aria-hidden="true" tabindex="-1"></a>        dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-3369"><a href="#cb115-3369" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3370"><a href="#cb115-3370" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-3371"><a href="#cb115-3371" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-3372"><a href="#cb115-3372" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-3373"><a href="#cb115-3373" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3374"><a href="#cb115-3374" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb115-3375"><a href="#cb115-3375" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3376"><a href="#cb115-3376" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb115-3377"><a href="#cb115-3377" aria-hidden="true" tabindex="-1"></a>        dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-3378"><a href="#cb115-3378" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3379"><a href="#cb115-3379" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-3380"><a href="#cb115-3380" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-3381"><a href="#cb115-3381" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-3382"><a href="#cb115-3382" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3383"><a href="#cb115-3383" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb115-3384"><a href="#cb115-3384" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3385"><a href="#cb115-3385" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb115-3386"><a href="#cb115-3386" aria-hidden="true" tabindex="-1"></a>        dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-3387"><a href="#cb115-3387" aria-hidden="true" tabindex="-1"></a>                           <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3388"><a href="#cb115-3388" aria-hidden="true" tabindex="-1"></a>                           T1l1, T1l2, </span>
<span id="cb115-3389"><a href="#cb115-3389" aria-hidden="true" tabindex="-1"></a>                           T2l1, T2l2,  </span>
<span id="cb115-3390"><a href="#cb115-3390" aria-hidden="true" tabindex="-1"></a>                           T3l1, T3l2, </span>
<span id="cb115-3391"><a href="#cb115-3391" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3392"><a href="#cb115-3392" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb115-3393"><a href="#cb115-3393" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3394"><a href="#cb115-3394" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3395"><a href="#cb115-3395" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3396"><a href="#cb115-3396" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-3397"><a href="#cb115-3397" aria-hidden="true" tabindex="-1"></a>        T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb115-3398"><a href="#cb115-3398" aria-hidden="true" tabindex="-1"></a>        T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb115-3399"><a href="#cb115-3399" aria-hidden="true" tabindex="-1"></a>        T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb115-3400"><a href="#cb115-3400" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3401"><a href="#cb115-3401" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3402"><a href="#cb115-3402" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Y</span></span>
<span id="cb115-3403"><a href="#cb115-3403" aria-hidden="true" tabindex="-1"></a>      dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3404"><a href="#cb115-3404" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb115-3405"><a href="#cb115-3405" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb115-3406"><a href="#cb115-3406" aria-hidden="true" tabindex="-1"></a>                        <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb115-3407"><a href="#cb115-3407" aria-hidden="true" tabindex="-1"></a>                        <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3408"><a href="#cb115-3408" aria-hidden="true" tabindex="-1"></a>      Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb115-3409"><a href="#cb115-3409" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3410"><a href="#cb115-3410" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb115-3411"><a href="#cb115-3411" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb115-3412"><a href="#cb115-3412" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-3413"><a href="#cb115-3413" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3414"><a href="#cb115-3414" aria-hidden="true" tabindex="-1"></a>    mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-3415"><a href="#cb115-3415" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3416"><a href="#cb115-3416" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-3417"><a href="#cb115-3417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3418"><a href="#cb115-3418" aria-hidden="true" tabindex="-1"></a>Yp</span>
<span id="cb115-3419"><a href="#cb115-3419" aria-hidden="true" tabindex="-1"></a><span class="co"># boot_num &lt;- seed</span></span>
<span id="cb115-3420"><a href="#cb115-3420" aria-hidden="true" tabindex="-1"></a> gdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, M1p, Yp,</span>
<span id="cb115-3421"><a href="#cb115-3421" aria-hidden="true" tabindex="-1"></a>                     T1mp, T1p, T2mp, T2p, T3mp, T3p, Vp)</span>
<span id="cb115-3422"><a href="#cb115-3422" aria-hidden="true" tabindex="-1"></a>  gdat<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat<span class="sc">$</span>id, <span class="at">fromLast =</span> T)) </span>
<span id="cb115-3423"><a href="#cb115-3423" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3424"><a href="#cb115-3424" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb115-3425"><a href="#cb115-3425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3426"><a href="#cb115-3426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3427"><a href="#cb115-3427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3428"><a href="#cb115-3428" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3429"><a href="#cb115-3429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3430"><a href="#cb115-3430" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3431"><a href="#cb115-3431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3432"><a href="#cb115-3432" aria-hidden="true" tabindex="-1"></a><span class="fu">## output</span></span>
<span id="cb115-3433"><a href="#cb115-3433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3434"><a href="#cb115-3434" aria-hidden="true" tabindex="-1"></a>Theo output này thì các biến dùng để fit model Y ở time thứ 7 ở 2 code đều giống nhau. Nhưng predict lại ra khác nhau. Em nghĩ vì pFunc có runif() nên xác xuất ra khác nhau. Và thêm 1 phần là khi mình set am != ay thì các biến Lp của mình khác với các biến Lmp nên predict dễ gây sự khác nhau trong việc predict &gt; runif(1) hơn so với khi am == ay thì Lp &lt;- Lmp.</span>
<span id="cb115-3435"><a href="#cb115-3435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3436"><a href="#cb115-3436" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-3437"><a href="#cb115-3437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3438"><a href="#cb115-3438" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-3439"><a href="#cb115-3439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3442"><a href="#cb115-3442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3443"><a href="#cb115-3443" aria-hidden="true" tabindex="-1"></a>gdat2</span>
<span id="cb115-3444"><a href="#cb115-3444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3445"><a href="#cb115-3445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3446"><a href="#cb115-3446" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3447"><a href="#cb115-3447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3448"><a href="#cb115-3448" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-3449"><a href="#cb115-3449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3452"><a href="#cb115-3452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3453"><a href="#cb115-3453" aria-hidden="true" tabindex="-1"></a>gdat</span>
<span id="cb115-3454"><a href="#cb115-3454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3455"><a href="#cb115-3455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3456"><a href="#cb115-3456" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3457"><a href="#cb115-3457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3458"><a href="#cb115-3458" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3459"><a href="#cb115-3459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3460"><a href="#cb115-3460" aria-hidden="true" tabindex="-1"></a><span class="fu"># Function bự (tvmedg)</span></span>
<span id="cb115-3461"><a href="#cb115-3461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3462"><a href="#cb115-3462" aria-hidden="true" tabindex="-1"></a><span class="fu">## tvmedg</span></span>
<span id="cb115-3463"><a href="#cb115-3463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3464"><a href="#cb115-3464" aria-hidden="true" tabindex="-1"></a>bước đầu em setup ở ii = 2 để chạy so với g_boot của anh Long</span>
<span id="cb115-3465"><a href="#cb115-3465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3468"><a href="#cb115-3468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3469"><a href="#cb115-3469" aria-hidden="true" tabindex="-1"></a>tvmedg <span class="ot">&lt;-</span> <span class="cf">function</span>(data,</span>
<span id="cb115-3470"><a href="#cb115-3470" aria-hidden="true" tabindex="-1"></a>                   fix,expo,med,tvar,lag,outc,time,<span class="at">norev =</span> <span class="cn">NULL</span>,<span class="at">LM =</span> <span class="cn">FALSE</span>,</span>
<span id="cb115-3471"><a href="#cb115-3471" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bootstr =</span> <span class="cn">FALSE</span>, <span class="at">seed =</span> <span class="dv">0</span>,</span>
<span id="cb115-3472"><a href="#cb115-3472" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-3473"><a href="#cb115-3473" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-3474"><a href="#cb115-3474" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>,</span>
<span id="cb115-3475"><a href="#cb115-3475" aria-hidden="true" tabindex="-1"></a>                   <span class="at">montecarlo =</span> <span class="dv">10000</span>,<span class="at">length =</span> <span class="dv">12</span>,<span class="at">parallel=</span><span class="cn">TRUE</span>){</span>
<span id="cb115-3476"><a href="#cb115-3476" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3477"><a href="#cb115-3477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb115-3478"><a href="#cb115-3478" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3479"><a href="#cb115-3479" aria-hidden="true" tabindex="-1"></a>  fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-3480"><a href="#cb115-3480" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix =</span> fix,</span>
<span id="cb115-3481"><a href="#cb115-3481" aria-hidden="true" tabindex="-1"></a>    <span class="at">expo =</span> expo,</span>
<span id="cb115-3482"><a href="#cb115-3482" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> med,</span>
<span id="cb115-3483"><a href="#cb115-3483" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvar =</span> tvar,</span>
<span id="cb115-3484"><a href="#cb115-3484" aria-hidden="true" tabindex="-1"></a>    <span class="at">outc =</span> outc,</span>
<span id="cb115-3485"><a href="#cb115-3485" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag =</span> lag,</span>
<span id="cb115-3486"><a href="#cb115-3486" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> time,</span>
<span id="cb115-3487"><a href="#cb115-3487" aria-hidden="true" tabindex="-1"></a>    <span class="at">norev =</span> norev,</span>
<span id="cb115-3488"><a href="#cb115-3488" aria-hidden="true" tabindex="-1"></a>    <span class="at">LM =</span> LM,</span>
<span id="cb115-3489"><a href="#cb115-3489" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data</span>
<span id="cb115-3490"><a href="#cb115-3490" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb115-3491"><a href="#cb115-3491" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fitg</span>(<span class="at">bootstr=</span>bootstr,</span>
<span id="cb115-3492"><a href="#cb115-3492" aria-hidden="true" tabindex="-1"></a>         <span class="at">mreg =</span> mreg,</span>
<span id="cb115-3493"><a href="#cb115-3493" aria-hidden="true" tabindex="-1"></a>         <span class="at">lreg =</span> lreg,</span>
<span id="cb115-3494"><a href="#cb115-3494" aria-hidden="true" tabindex="-1"></a>         <span class="at">yreg =</span> yreg,<span class="at">dof =</span> dof) <span class="sc">%&gt;%</span> </span>
<span id="cb115-3495"><a href="#cb115-3495" aria-hidden="true" tabindex="-1"></a>    <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> montecarlo)</span>
<span id="cb115-3496"><a href="#cb115-3496" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3497"><a href="#cb115-3497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3498"><a href="#cb115-3498" aria-hidden="true" tabindex="-1"></a>    outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>,<span class="at">data=</span>fitR2, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>)</span>
<span id="cb115-3499"><a href="#cb115-3499" aria-hidden="true" tabindex="-1"></a>    outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>,<span class="at">data=</span>fitR2, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb115-3500"><a href="#cb115-3500" aria-hidden="true" tabindex="-1"></a>    outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> <span class="dv">2</span>,<span class="at">data=</span>fitR2, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb115-3501"><a href="#cb115-3501" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3502"><a href="#cb115-3502" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(outdat11, outdat10, outdat00)</span>
<span id="cb115-3503"><a href="#cb115-3503" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3504"><a href="#cb115-3504" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-3505"><a href="#cb115-3505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3506"><a href="#cb115-3506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3507"><a href="#cb115-3507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3508"><a href="#cb115-3508" aria-hidden="true" tabindex="-1"></a><span class="fu">## g_boot</span></span>
<span id="cb115-3509"><a href="#cb115-3509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3512"><a href="#cb115-3512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3513"><a href="#cb115-3513" aria-hidden="true" tabindex="-1"></a>g_boot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">length =</span> <span class="dv">12</span>, <span class="at">montecarlo =</span> <span class="dv">0</span>, <span class="at">seed =</span> <span class="dv">0</span>,<span class="at">boostr =</span> F) { </span>
<span id="cb115-3514"><a href="#cb115-3514" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3515"><a href="#cb115-3515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"g-formula for single mediator"</span>,<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb115-3516"><a href="#cb115-3516" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3517"><a href="#cb115-3517" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">df_prep</span>(<span class="at">data =</span> data)</span>
<span id="cb115-3518"><a href="#cb115-3518" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3519"><a href="#cb115-3519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb115-3520"><a href="#cb115-3520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Running SEED"</span>, seed, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb115-3521"><a href="#cb115-3521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb115-3522"><a href="#cb115-3522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Resampling Data"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb115-3523"><a href="#cb115-3523" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3524"><a href="#cb115-3524" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Resampling based on id and store in `boot` dataset</span></span>
<span id="cb115-3525"><a href="#cb115-3525" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">table</span>(df<span class="sc">$</span>id))</span>
<span id="cb115-3526"><a href="#cb115-3526" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters), <span class="fu">length</span>(clusters), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-3527"><a href="#cb115-3527" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters[index])</span>
<span id="cb115-3528"><a href="#cb115-3528" aria-hidden="true" tabindex="-1"></a>  boot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb115-3529"><a href="#cb115-3529" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3530"><a href="#cb115-3530" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(boostr <span class="sc">==</span> F) {</span>
<span id="cb115-3531"><a href="#cb115-3531" aria-hidden="true" tabindex="-1"></a>    <span class="co"># not doing bootstrap</span></span>
<span id="cb115-3532"><a href="#cb115-3532" aria-hidden="true" tabindex="-1"></a>    boot <span class="ot">&lt;-</span> df </span>
<span id="cb115-3533"><a href="#cb115-3533" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb115-3534"><a href="#cb115-3534" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb115-3535"><a href="#cb115-3535" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loop over repeated id</span></span>
<span id="cb115-3536"><a href="#cb115-3536" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>id <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb115-3537"><a href="#cb115-3537" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>id, zzz)</span>
<span id="cb115-3538"><a href="#cb115-3538" aria-hidden="true" tabindex="-1"></a>      boot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(boot, cc)</span>
<span id="cb115-3539"><a href="#cb115-3539" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-3540"><a href="#cb115-3540" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-3541"><a href="#cb115-3541" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3542"><a href="#cb115-3542" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3543"><a href="#cb115-3543" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check boot data</span></span>
<span id="cb115-3544"><a href="#cb115-3544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Resampled data identical to original for seed ="</span>, seed, <span class="st">"?:"</span>, <span class="fu">identical</span>(boot, df),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb115-3545"><a href="#cb115-3545" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3546"><a href="#cb115-3546" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3547"><a href="#cb115-3547" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3548"><a href="#cb115-3548" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Centering and scaling the time-scale variable</span></span>
<span id="cb115-3549"><a href="#cb115-3549" aria-hidden="true" tabindex="-1"></a>  boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">scale</span>(boot<span class="sc">$</span>j)</span>
<span id="cb115-3550"><a href="#cb115-3550" aria-hidden="true" tabindex="-1"></a>  mean_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span></span>
<span id="cb115-3551"><a href="#cb115-3551" aria-hidden="true" tabindex="-1"></a>  sd_j <span class="ot">&lt;-</span> <span class="fu">attributes</span>(boot<span class="sc">$</span>jj)<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb115-3552"><a href="#cb115-3552" aria-hidden="true" tabindex="-1"></a>  boot<span class="sc">$</span>jj <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(boot<span class="sc">$</span>jj)</span>
<span id="cb115-3553"><a href="#cb115-3553" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3554"><a href="#cb115-3554" aria-hidden="true" tabindex="-1"></a>  <span class="co">#----- fit parametric models for</span></span>
<span id="cb115-3555"><a href="#cb115-3555" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Mediator models</span></span>
<span id="cb115-3556"><a href="#cb115-3556" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3557"><a href="#cb115-3557" aria-hidden="true" tabindex="-1"></a>  mM1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-3558"><a href="#cb115-3558" aria-hidden="true" tabindex="-1"></a>    fitM1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(M1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-3559"><a href="#cb115-3559" aria-hidden="true" tabindex="-1"></a>                   v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb115-3560"><a href="#cb115-3560" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb115-3561"><a href="#cb115-3561" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fitM1)</span>
<span id="cb115-3562"><a href="#cb115-3562" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-3563"><a href="#cb115-3563" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3564"><a href="#cb115-3564" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PseudoR2(fitM1)</span></span>
<span id="cb115-3565"><a href="#cb115-3565" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Covariate models</span></span>
<span id="cb115-3566"><a href="#cb115-3566" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3567"><a href="#cb115-3567" aria-hidden="true" tabindex="-1"></a>  mT1 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-3568"><a href="#cb115-3568" aria-hidden="true" tabindex="-1"></a>    fitT1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(T1 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-3569"><a href="#cb115-3569" aria-hidden="true" tabindex="-1"></a>                   v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb115-3570"><a href="#cb115-3570" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb115-3571"><a href="#cb115-3571" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fitT1)</span>
<span id="cb115-3572"><a href="#cb115-3572" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-3573"><a href="#cb115-3573" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3574"><a href="#cb115-3574" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PseudoR2(fitT1)</span></span>
<span id="cb115-3575"><a href="#cb115-3575" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3576"><a href="#cb115-3576" aria-hidden="true" tabindex="-1"></a>  mT2 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-3577"><a href="#cb115-3577" aria-hidden="true" tabindex="-1"></a>    fitT2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T2 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-3578"><a href="#cb115-3578" aria-hidden="true" tabindex="-1"></a>                  v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb115-3579"><a href="#cb115-3579" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fitT2)</span>
<span id="cb115-3580"><a href="#cb115-3580" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-3581"><a href="#cb115-3581" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3582"><a href="#cb115-3582" aria-hidden="true" tabindex="-1"></a>  mT3 <span class="ot">&lt;-</span> <span class="cf">function</span>(k){</span>
<span id="cb115-3583"><a href="#cb115-3583" aria-hidden="true" tabindex="-1"></a>    fitT3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(T3 <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span> </span>
<span id="cb115-3584"><a href="#cb115-3584" aria-hidden="true" tabindex="-1"></a>                  v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">data =</span> boot)</span>
<span id="cb115-3585"><a href="#cb115-3585" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fitT3)</span>
<span id="cb115-3586"><a href="#cb115-3586" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-3587"><a href="#cb115-3587" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3588"><a href="#cb115-3588" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Outcome model: E(Y|a, m, l, v)</span></span>
<span id="cb115-3589"><a href="#cb115-3589" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3590"><a href="#cb115-3590" aria-hidden="true" tabindex="-1"></a>  mY <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb115-3591"><a href="#cb115-3591" aria-hidden="true" tabindex="-1"></a>    fitY <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> A <span class="sc">+</span> Al1 <span class="sc">+</span> Al2 <span class="sc">+</span> M1 <span class="sc">+</span> M1l1 <span class="sc">+</span> M1l2 <span class="sc">+</span> T1 <span class="sc">+</span> T1l1 <span class="sc">+</span> T1l2 <span class="sc">+</span> T2 <span class="sc">+</span> T2l1 <span class="sc">+</span> T2l2 <span class="sc">+</span> </span>
<span id="cb115-3592"><a href="#cb115-3592" aria-hidden="true" tabindex="-1"></a>                  T3 <span class="sc">+</span> T3l1 <span class="sc">+</span> T3l2 <span class="sc">+</span>  v1 <span class="sc">+</span> v2 <span class="sc">+</span> v3 <span class="sc">+</span> v4 <span class="sc">+</span> splines<span class="sc">::</span><span class="fu">bs</span>(jj, <span class="at">df =</span> <span class="dv">3</span>), </span>
<span id="cb115-3593"><a href="#cb115-3593" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> binomial, <span class="at">data =</span> boot)</span>
<span id="cb115-3594"><a href="#cb115-3594" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fitY)</span>
<span id="cb115-3595"><a href="#cb115-3595" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-3596"><a href="#cb115-3596" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3597"><a href="#cb115-3597" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PseudoR2(fitY)</span></span>
<span id="cb115-3598"><a href="#cb115-3598" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3599"><a href="#cb115-3599" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit all models and save in a list</span></span>
<span id="cb115-3600"><a href="#cb115-3600" aria-hidden="true" tabindex="-1"></a>  mR <span class="ot">&lt;-</span> <span class="fu">c</span>(mM1, mY, mT1, mT2, mT3)</span>
<span id="cb115-3601"><a href="#cb115-3601" aria-hidden="true" tabindex="-1"></a>  fitR <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="cf">function</span>(x) mR[[x]](k))</span>
<span id="cb115-3602"><a href="#cb115-3602" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3603"><a href="#cb115-3603" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3604"><a href="#cb115-3604" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3605"><a href="#cb115-3605" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select baseline visit</span></span>
<span id="cb115-3606"><a href="#cb115-3606" aria-hidden="true" tabindex="-1"></a>  df0 <span class="ot">&lt;-</span> boot[boot<span class="sc">$</span>j<span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb115-3607"><a href="#cb115-3607" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3608"><a href="#cb115-3608" aria-hidden="true" tabindex="-1"></a>  df0<span class="sc">$</span>idn <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df0)</span>
<span id="cb115-3609"><a href="#cb115-3609" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3610"><a href="#cb115-3610" aria-hidden="true" tabindex="-1"></a>  MC <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb115-3611"><a href="#cb115-3611" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3612"><a href="#cb115-3612" aria-hidden="true" tabindex="-1"></a>    samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(df0<span class="sc">$</span>idn, <span class="at">size =</span> montecarlo, <span class="at">replace =</span> T)</span>
<span id="cb115-3613"><a href="#cb115-3613" aria-hidden="true" tabindex="-1"></a>    bb <span class="ot">&lt;-</span> <span class="fu">table</span>(samples)</span>
<span id="cb115-3614"><a href="#cb115-3614" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3615"><a href="#cb115-3615" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(zzz <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(bb)) {</span>
<span id="cb115-3616"><a href="#cb115-3616" aria-hidden="true" tabindex="-1"></a>      cc <span class="ot">&lt;-</span> df0[df0<span class="sc">$</span>idn <span class="sc">%in%</span> <span class="fu">names</span>(bb[bb <span class="sc">%in%</span> <span class="fu">c</span>(zzz<span class="sc">:</span><span class="fu">max</span>(bb))]), ]</span>
<span id="cb115-3617"><a href="#cb115-3617" aria-hidden="true" tabindex="-1"></a>      cc<span class="sc">$</span>bid <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cc<span class="sc">$</span>idn, zzz)</span>
<span id="cb115-3618"><a href="#cb115-3618" aria-hidden="true" tabindex="-1"></a>      MC <span class="ot">&lt;-</span> <span class="fu">rbind</span>(MC, cc)</span>
<span id="cb115-3619"><a href="#cb115-3619" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-3620"><a href="#cb115-3620" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3621"><a href="#cb115-3621" aria-hidden="true" tabindex="-1"></a>    MC<span class="sc">$</span>idsim <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>montecarlo</span>
<span id="cb115-3622"><a href="#cb115-3622" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3623"><a href="#cb115-3623" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3624"><a href="#cb115-3624" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pgf function for predicting follow-up</span></span>
<span id="cb115-3625"><a href="#cb115-3625" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-----------------------------------------------------------------------------</span></span>
<span id="cb115-3626"><a href="#cb115-3626" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3627"><a href="#cb115-3627" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3628"><a href="#cb115-3628" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pgf function</span></span>
<span id="cb115-3629"><a href="#cb115-3629" aria-hidden="true" tabindex="-1"></a>  gform <span class="ot">&lt;-</span> <span class="cf">function</span>(ii, pgdat, length, am, ay) {</span>
<span id="cb115-3630"><a href="#cb115-3630" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3631"><a href="#cb115-3631" aria-hidden="true" tabindex="-1"></a>    pFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb115-3632"><a href="#cb115-3632" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">&gt;</span> <span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb115-3633"><a href="#cb115-3633" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-3634"><a href="#cb115-3634" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3635"><a href="#cb115-3635" aria-hidden="true" tabindex="-1"></a>    rFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ndat) {</span>
<span id="cb115-3636"><a href="#cb115-3636" aria-hidden="true" tabindex="-1"></a>      pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> ndat, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb115-3637"><a href="#cb115-3637" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_prob))</span>
<span id="cb115-3638"><a href="#cb115-3638" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-3639"><a href="#cb115-3639" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3640"><a href="#cb115-3640" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> pgdat</span>
<span id="cb115-3641"><a href="#cb115-3641" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> d[d<span class="sc">$</span>idsim<span class="sc">==</span>ii, ]</span>
<span id="cb115-3642"><a href="#cb115-3642" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3643"><a href="#cb115-3643" aria-hidden="true" tabindex="-1"></a>    id <span class="ot">&lt;-</span> d<span class="sc">$</span>idsim</span>
<span id="cb115-3644"><a href="#cb115-3644" aria-hidden="true" tabindex="-1"></a>    id_ori <span class="ot">&lt;-</span> d<span class="sc">$</span>id</span>
<span id="cb115-3645"><a href="#cb115-3645" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3646"><a href="#cb115-3646" aria-hidden="true" tabindex="-1"></a>    length <span class="ot">&lt;-</span> length</span>
<span id="cb115-3647"><a href="#cb115-3647" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3648"><a href="#cb115-3648" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3649"><a href="#cb115-3649" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cat("...", paste0(ii, "(", id_ori, ")"))</span></span>
<span id="cb115-3650"><a href="#cb115-3650" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3651"><a href="#cb115-3651" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3652"><a href="#cb115-3652" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3653"><a href="#cb115-3653" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Baseline covariates</span></span>
<span id="cb115-3654"><a href="#cb115-3654" aria-hidden="true" tabindex="-1"></a>    Vp <span class="ot">&lt;-</span> d[, <span class="fu">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>, <span class="st">"v3"</span>, <span class="st">"v4"</span>)]</span>
<span id="cb115-3655"><a href="#cb115-3655" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3656"><a href="#cb115-3656" aria-hidden="true" tabindex="-1"></a>    T1p <span class="ot">&lt;-</span> T2p <span class="ot">&lt;-</span> T3p  <span class="ot">&lt;-</span> M1p <span class="ot">&lt;-</span> Yp <span class="ot">&lt;-</span> mm <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-3657"><a href="#cb115-3657" aria-hidden="true" tabindex="-1"></a>    T1mp <span class="ot">&lt;-</span> T2mp <span class="ot">&lt;-</span> T3mp <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb115-3658"><a href="#cb115-3658" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3659"><a href="#cb115-3659" aria-hidden="true" tabindex="-1"></a>    mm[<span class="dv">1</span>] <span class="ot">&lt;-</span> j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-3660"><a href="#cb115-3660" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3661"><a href="#cb115-3661" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3662"><a href="#cb115-3662" aria-hidden="true" tabindex="-1"></a>    M1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-3663"><a href="#cb115-3663" aria-hidden="true" tabindex="-1"></a>    Yp[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb115-3664"><a href="#cb115-3664" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3665"><a href="#cb115-3665" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time-varying covariates contribute to outcome model</span></span>
<span id="cb115-3666"><a href="#cb115-3666" aria-hidden="true" tabindex="-1"></a>    T1p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb115-3667"><a href="#cb115-3667" aria-hidden="true" tabindex="-1"></a>    T2p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb115-3668"><a href="#cb115-3668" aria-hidden="true" tabindex="-1"></a>    T3p[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb115-3669"><a href="#cb115-3669" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3670"><a href="#cb115-3670" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time-varying covariates contribute to mediator model</span></span>
<span id="cb115-3671"><a href="#cb115-3671" aria-hidden="true" tabindex="-1"></a>    T1mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T1</span>
<span id="cb115-3672"><a href="#cb115-3672" aria-hidden="true" tabindex="-1"></a>    T2mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T2</span>
<span id="cb115-3673"><a href="#cb115-3673" aria-hidden="true" tabindex="-1"></a>    T3mp[<span class="dv">1</span>] <span class="ot">&lt;-</span> d<span class="sc">$</span>T3</span>
<span id="cb115-3674"><a href="#cb115-3674" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3675"><a href="#cb115-3675" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3676"><a href="#cb115-3676" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>length) {</span>
<span id="cb115-3677"><a href="#cb115-3677" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3678"><a href="#cb115-3678" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Yp[l<span class="dv">-1</span>]<span class="sc">==</span><span class="dv">0</span>) {</span>
<span id="cb115-3679"><a href="#cb115-3679" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3680"><a href="#cb115-3680" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (l <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb115-3681"><a href="#cb115-3681" aria-hidden="true" tabindex="-1"></a>          T1l2 <span class="ot">&lt;-</span> T1p[<span class="dv">1</span>]</span>
<span id="cb115-3682"><a href="#cb115-3682" aria-hidden="true" tabindex="-1"></a>          T2l2 <span class="ot">&lt;-</span> T2p[<span class="dv">1</span>]</span>
<span id="cb115-3683"><a href="#cb115-3683" aria-hidden="true" tabindex="-1"></a>          T3l2 <span class="ot">&lt;-</span> T3p[<span class="dv">1</span>]</span>
<span id="cb115-3684"><a href="#cb115-3684" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3685"><a href="#cb115-3685" aria-hidden="true" tabindex="-1"></a>          T1ml2 <span class="ot">&lt;-</span> T1mp[<span class="dv">1</span>]</span>
<span id="cb115-3686"><a href="#cb115-3686" aria-hidden="true" tabindex="-1"></a>          T2ml2 <span class="ot">&lt;-</span> T2mp[<span class="dv">1</span>]</span>
<span id="cb115-3687"><a href="#cb115-3687" aria-hidden="true" tabindex="-1"></a>          T3ml2 <span class="ot">&lt;-</span> T3mp[<span class="dv">1</span>]</span>
<span id="cb115-3688"><a href="#cb115-3688" aria-hidden="true" tabindex="-1"></a>          M1l2 <span class="ot">&lt;-</span> M1p[<span class="dv">1</span>]</span>
<span id="cb115-3689"><a href="#cb115-3689" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3690"><a href="#cb115-3690" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb115-3691"><a href="#cb115-3691" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3692"><a href="#cb115-3692" aria-hidden="true" tabindex="-1"></a>          T1l2 <span class="ot">&lt;-</span> T1p[l<span class="dv">-2</span>]</span>
<span id="cb115-3693"><a href="#cb115-3693" aria-hidden="true" tabindex="-1"></a>          T2l2 <span class="ot">&lt;-</span> T2p[l<span class="dv">-2</span>]</span>
<span id="cb115-3694"><a href="#cb115-3694" aria-hidden="true" tabindex="-1"></a>          T3l2 <span class="ot">&lt;-</span> T3p[l<span class="dv">-2</span>]</span>
<span id="cb115-3695"><a href="#cb115-3695" aria-hidden="true" tabindex="-1"></a>          T1ml2 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-2</span>]</span>
<span id="cb115-3696"><a href="#cb115-3696" aria-hidden="true" tabindex="-1"></a>          T2ml2 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-2</span>]</span>
<span id="cb115-3697"><a href="#cb115-3697" aria-hidden="true" tabindex="-1"></a>          T3ml2 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-2</span>]</span>
<span id="cb115-3698"><a href="#cb115-3698" aria-hidden="true" tabindex="-1"></a>          M1l2 <span class="ot">&lt;-</span> M1p[l<span class="dv">-2</span>]</span>
<span id="cb115-3699"><a href="#cb115-3699" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3700"><a href="#cb115-3700" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-3701"><a href="#cb115-3701" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3702"><a href="#cb115-3702" aria-hidden="true" tabindex="-1"></a>        T1l1 <span class="ot">&lt;-</span> T1p[l<span class="dv">-1</span>]</span>
<span id="cb115-3703"><a href="#cb115-3703" aria-hidden="true" tabindex="-1"></a>        T2l1 <span class="ot">&lt;-</span> T2p[l<span class="dv">-1</span>]</span>
<span id="cb115-3704"><a href="#cb115-3704" aria-hidden="true" tabindex="-1"></a>        T3l1 <span class="ot">&lt;-</span> T3p[l<span class="dv">-1</span>]</span>
<span id="cb115-3705"><a href="#cb115-3705" aria-hidden="true" tabindex="-1"></a>        T1ml1 <span class="ot">&lt;-</span> T1mp[l<span class="dv">-1</span>]</span>
<span id="cb115-3706"><a href="#cb115-3706" aria-hidden="true" tabindex="-1"></a>        T2ml1 <span class="ot">&lt;-</span> T2mp[l<span class="dv">-1</span>]</span>
<span id="cb115-3707"><a href="#cb115-3707" aria-hidden="true" tabindex="-1"></a>        T3ml1 <span class="ot">&lt;-</span> T3mp[l<span class="dv">-1</span>]</span>
<span id="cb115-3708"><a href="#cb115-3708" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3709"><a href="#cb115-3709" aria-hidden="true" tabindex="-1"></a>        M1l1 <span class="ot">&lt;-</span> M1p[l<span class="dv">-1</span>]</span>
<span id="cb115-3710"><a href="#cb115-3710" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3711"><a href="#cb115-3711" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3712"><a href="#cb115-3712" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3713"><a href="#cb115-3713" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict mediator</span></span>
<span id="cb115-3714"><a href="#cb115-3714" aria-hidden="true" tabindex="-1"></a>        dM1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, M1l1, M1l2, <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-3715"><a href="#cb115-3715" aria-hidden="true" tabindex="-1"></a>                           <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-3716"><a href="#cb115-3716" aria-hidden="true" tabindex="-1"></a>                           <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3717"><a href="#cb115-3717" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3718"><a href="#cb115-3718" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (M1p[l <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb115-3719"><a href="#cb115-3719" aria-hidden="true" tabindex="-1"></a>          <span class="co"># M1p[l] &lt;- pFunc(fitR[[1]], dM1p)</span></span>
<span id="cb115-3720"><a href="#cb115-3720" aria-hidden="true" tabindex="-1"></a>          M1p[l] <span class="ot">&lt;-</span> <span class="fu">rFunc</span>(fitR[[<span class="dv">1</span>]], dM1p)</span>
<span id="cb115-3721"><a href="#cb115-3721" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb115-3722"><a href="#cb115-3722" aria-hidden="true" tabindex="-1"></a>          M1p[l] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb115-3723"><a href="#cb115-3723" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-3724"><a href="#cb115-3724" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3725"><a href="#cb115-3725" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3726"><a href="#cb115-3726" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3727"><a href="#cb115-3727" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict time-varying covariates (contribute to mediator models)</span></span>
<span id="cb115-3728"><a href="#cb115-3728" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T1</span></span>
<span id="cb115-3729"><a href="#cb115-3729" aria-hidden="true" tabindex="-1"></a>        dT1mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-3730"><a href="#cb115-3730" aria-hidden="true" tabindex="-1"></a>                            <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3731"><a href="#cb115-3731" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-3732"><a href="#cb115-3732" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-3733"><a href="#cb115-3733" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T3l1 =</span> T3ml1,<span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-3734"><a href="#cb115-3734" aria-hidden="true" tabindex="-1"></a>                            <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3735"><a href="#cb115-3735" aria-hidden="true" tabindex="-1"></a>        T1mp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1mp)</span>
<span id="cb115-3736"><a href="#cb115-3736" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3737"><a href="#cb115-3737" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T2</span></span>
<span id="cb115-3738"><a href="#cb115-3738" aria-hidden="true" tabindex="-1"></a>        dT2mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-3739"><a href="#cb115-3739" aria-hidden="true" tabindex="-1"></a>                            <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3740"><a href="#cb115-3740" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-3741"><a href="#cb115-3741" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-3742"><a href="#cb115-3742" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-3743"><a href="#cb115-3743" aria-hidden="true" tabindex="-1"></a>                            <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3744"><a href="#cb115-3744" aria-hidden="true" tabindex="-1"></a>        T2mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2mp)</span>
<span id="cb115-3745"><a href="#cb115-3745" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3746"><a href="#cb115-3746" aria-hidden="true" tabindex="-1"></a>        <span class="co"># T3</span></span>
<span id="cb115-3747"><a href="#cb115-3747" aria-hidden="true" tabindex="-1"></a>        dT3mp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> am, <span class="at">Al1 =</span> am, <span class="at">Al2 =</span> am, </span>
<span id="cb115-3748"><a href="#cb115-3748" aria-hidden="true" tabindex="-1"></a>                            <span class="at">M1 =</span> M1p[l], M1l1, M1l2,</span>
<span id="cb115-3749"><a href="#cb115-3749" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T1l1 =</span> T1ml1, <span class="at">T1l2 =</span> T1ml2, </span>
<span id="cb115-3750"><a href="#cb115-3750" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T2l1 =</span> T2ml1, <span class="at">T2l2 =</span> T2ml2, </span>
<span id="cb115-3751"><a href="#cb115-3751" aria-hidden="true" tabindex="-1"></a>                            <span class="at">T3l1 =</span> T3ml1, <span class="at">T3l2 =</span> T3ml2,</span>
<span id="cb115-3752"><a href="#cb115-3752" aria-hidden="true" tabindex="-1"></a>                            <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3753"><a href="#cb115-3753" aria-hidden="true" tabindex="-1"></a>        T3mp[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3mp)</span>
<span id="cb115-3754"><a href="#cb115-3754" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3755"><a href="#cb115-3755" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3756"><a href="#cb115-3756" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict time-varying covariates (contribute to outcome models, if ay != am)</span></span>
<span id="cb115-3757"><a href="#cb115-3757" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If ay = am ==&gt; simply covariates take the same values between two models</span></span>
<span id="cb115-3758"><a href="#cb115-3758" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3759"><a href="#cb115-3759" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (ay <span class="sc">!=</span> am) {</span>
<span id="cb115-3760"><a href="#cb115-3760" aria-hidden="true" tabindex="-1"></a>          <span class="co"># T1</span></span>
<span id="cb115-3761"><a href="#cb115-3761" aria-hidden="true" tabindex="-1"></a>          dT1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-3762"><a href="#cb115-3762" aria-hidden="true" tabindex="-1"></a>                             <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3763"><a href="#cb115-3763" aria-hidden="true" tabindex="-1"></a>                             T1l1, T1l2, </span>
<span id="cb115-3764"><a href="#cb115-3764" aria-hidden="true" tabindex="-1"></a>                             T2l1, T2l2,  </span>
<span id="cb115-3765"><a href="#cb115-3765" aria-hidden="true" tabindex="-1"></a>                             T3l1, T3l2, </span>
<span id="cb115-3766"><a href="#cb115-3766" aria-hidden="true" tabindex="-1"></a>                             <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3767"><a href="#cb115-3767" aria-hidden="true" tabindex="-1"></a>          T1p[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">3</span>]], dT1p)</span>
<span id="cb115-3768"><a href="#cb115-3768" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3769"><a href="#cb115-3769" aria-hidden="true" tabindex="-1"></a>          <span class="co"># T2</span></span>
<span id="cb115-3770"><a href="#cb115-3770" aria-hidden="true" tabindex="-1"></a>          dT2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-3771"><a href="#cb115-3771" aria-hidden="true" tabindex="-1"></a>                             <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3772"><a href="#cb115-3772" aria-hidden="true" tabindex="-1"></a>                             T1l1, T1l2, </span>
<span id="cb115-3773"><a href="#cb115-3773" aria-hidden="true" tabindex="-1"></a>                             T2l1, T2l2,  </span>
<span id="cb115-3774"><a href="#cb115-3774" aria-hidden="true" tabindex="-1"></a>                             T3l1, T3l2, </span>
<span id="cb115-3775"><a href="#cb115-3775" aria-hidden="true" tabindex="-1"></a>                             <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3776"><a href="#cb115-3776" aria-hidden="true" tabindex="-1"></a>          T2p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">4</span>]], dT2p)</span>
<span id="cb115-3777"><a href="#cb115-3777" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3778"><a href="#cb115-3778" aria-hidden="true" tabindex="-1"></a>          <span class="co"># T3</span></span>
<span id="cb115-3779"><a href="#cb115-3779" aria-hidden="true" tabindex="-1"></a>          dT3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, </span>
<span id="cb115-3780"><a href="#cb115-3780" aria-hidden="true" tabindex="-1"></a>                             <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3781"><a href="#cb115-3781" aria-hidden="true" tabindex="-1"></a>                             T1l1, T1l2, </span>
<span id="cb115-3782"><a href="#cb115-3782" aria-hidden="true" tabindex="-1"></a>                             T2l1, T2l2,  </span>
<span id="cb115-3783"><a href="#cb115-3783" aria-hidden="true" tabindex="-1"></a>                             T3l1, T3l2, </span>
<span id="cb115-3784"><a href="#cb115-3784" aria-hidden="true" tabindex="-1"></a>                             <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3785"><a href="#cb115-3785" aria-hidden="true" tabindex="-1"></a>          T3p[l] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitR[[<span class="dv">5</span>]], dT3p)</span>
<span id="cb115-3786"><a href="#cb115-3786" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3787"><a href="#cb115-3787" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3788"><a href="#cb115-3788" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb115-3789"><a href="#cb115-3789" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb115-3790"><a href="#cb115-3790" aria-hidden="true" tabindex="-1"></a>          T1p[l] <span class="ot">&lt;-</span> T1mp[l]</span>
<span id="cb115-3791"><a href="#cb115-3791" aria-hidden="true" tabindex="-1"></a>          T2p[l] <span class="ot">&lt;-</span> T2mp[l]</span>
<span id="cb115-3792"><a href="#cb115-3792" aria-hidden="true" tabindex="-1"></a>          T3p[l] <span class="ot">&lt;-</span> T3mp[l]</span>
<span id="cb115-3793"><a href="#cb115-3793" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb115-3794"><a href="#cb115-3794" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3795"><a href="#cb115-3795" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Y</span></span>
<span id="cb115-3796"><a href="#cb115-3796" aria-hidden="true" tabindex="-1"></a>        dYp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Vp, <span class="at">A =</span> ay, <span class="at">Al1 =</span> ay, <span class="at">Al2 =</span> ay, <span class="at">M1 =</span> M1p[l], M1l1, M1l2, </span>
<span id="cb115-3797"><a href="#cb115-3797" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T1 =</span> T1p[l], T1l1, T1l2, </span>
<span id="cb115-3798"><a href="#cb115-3798" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T2 =</span> T2p[l], T2l1, T2l2,</span>
<span id="cb115-3799"><a href="#cb115-3799" aria-hidden="true" tabindex="-1"></a>                          <span class="at">T3 =</span> T3p[l], T3l1, T3l2, </span>
<span id="cb115-3800"><a href="#cb115-3800" aria-hidden="true" tabindex="-1"></a>                          <span class="at">jj =</span> <span class="fu">as.numeric</span>((l<span class="sc">-</span>mean_j)<span class="sc">/</span>sd_j))</span>
<span id="cb115-3801"><a href="#cb115-3801" aria-hidden="true" tabindex="-1"></a>        Yp[l] <span class="ot">&lt;-</span> <span class="fu">pFunc</span>(fitR[[<span class="dv">2</span>]], dYp)</span>
<span id="cb115-3802"><a href="#cb115-3802" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-3803"><a href="#cb115-3803" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb115-3804"><a href="#cb115-3804" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb115-3805"><a href="#cb115-3805" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3806"><a href="#cb115-3806" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3807"><a href="#cb115-3807" aria-hidden="true" tabindex="-1"></a>      mm[l] <span class="ot">&lt;-</span> l</span>
<span id="cb115-3808"><a href="#cb115-3808" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3809"><a href="#cb115-3809" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-3810"><a href="#cb115-3810" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3811"><a href="#cb115-3811" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3812"><a href="#cb115-3812" aria-hidden="true" tabindex="-1"></a>    <span class="co"># boot_num &lt;- seed</span></span>
<span id="cb115-3813"><a href="#cb115-3813" aria-hidden="true" tabindex="-1"></a>    gdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, id_ori, mm, <span class="at">Ay =</span> ay, <span class="at">Am =</span> am, M1p, Yp,</span>
<span id="cb115-3814"><a href="#cb115-3814" aria-hidden="true" tabindex="-1"></a>                       T1mp, T1p, T2mp, T2p, T3mp, T3p, Vp)</span>
<span id="cb115-3815"><a href="#cb115-3815" aria-hidden="true" tabindex="-1"></a>    gdat<span class="sc">$</span>lastid <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">duplicated</span>(gdat<span class="sc">$</span>id, <span class="at">fromLast =</span> T))</span>
<span id="cb115-3816"><a href="#cb115-3816" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(gdat)</span>
<span id="cb115-3817"><a href="#cb115-3817" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb115-3818"><a href="#cb115-3818" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3819"><a href="#cb115-3819" aria-hidden="true" tabindex="-1"></a>    outdat11 <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>)</span>
<span id="cb115-3820"><a href="#cb115-3820" aria-hidden="true" tabindex="-1"></a>    outdat10 <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb115-3821"><a href="#cb115-3821" aria-hidden="true" tabindex="-1"></a>    outdat00 <span class="ot">&lt;-</span> <span class="fu">gform</span>(<span class="at">ii =</span> <span class="dv">2</span>, <span class="at">pgdat =</span> MC, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb115-3822"><a href="#cb115-3822" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3823"><a href="#cb115-3823" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(outdat11, outdat10, outdat00)</span>
<span id="cb115-3824"><a href="#cb115-3824" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3825"><a href="#cb115-3825" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-3826"><a href="#cb115-3826" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3827"><a href="#cb115-3827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3828"><a href="#cb115-3828" aria-hidden="true" tabindex="-1"></a><span class="fu">## Run</span></span>
<span id="cb115-3829"><a href="#cb115-3829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3830"><a href="#cb115-3830" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-3831"><a href="#cb115-3831" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-3832"><a href="#cb115-3832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3835"><a href="#cb115-3835" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3836"><a href="#cb115-3836" aria-hidden="true" tabindex="-1"></a>aaa2 <span class="ot">&lt;-</span> <span class="fu">tvmedg</span>(<span class="at">data =</span> dat0,</span>
<span id="cb115-3837"><a href="#cb115-3837" aria-hidden="true" tabindex="-1"></a>       <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-3838"><a href="#cb115-3838" aria-hidden="true" tabindex="-1"></a>       <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-3839"><a href="#cb115-3839" aria-hidden="true" tabindex="-1"></a>       <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-3840"><a href="#cb115-3840" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-3841"><a href="#cb115-3841" aria-hidden="true" tabindex="-1"></a>       <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-3842"><a href="#cb115-3842" aria-hidden="true" tabindex="-1"></a>       <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-3843"><a href="#cb115-3843" aria-hidden="true" tabindex="-1"></a>       <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-3844"><a href="#cb115-3844" aria-hidden="true" tabindex="-1"></a>       <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-3845"><a href="#cb115-3845" aria-hidden="true" tabindex="-1"></a>       <span class="at">LM =</span> F,</span>
<span id="cb115-3846"><a href="#cb115-3846" aria-hidden="true" tabindex="-1"></a>       <span class="at">bootstr =</span> T,</span>
<span id="cb115-3847"><a href="#cb115-3847" aria-hidden="true" tabindex="-1"></a>       <span class="at">seed =</span> <span class="dv">444</span>,</span>
<span id="cb115-3848"><a href="#cb115-3848" aria-hidden="true" tabindex="-1"></a>       <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-3849"><a href="#cb115-3849" aria-hidden="true" tabindex="-1"></a>       <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-3850"><a href="#cb115-3850" aria-hidden="true" tabindex="-1"></a>       <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>,</span>
<span id="cb115-3851"><a href="#cb115-3851" aria-hidden="true" tabindex="-1"></a>       <span class="at">montecarlo =</span> <span class="dv">10000</span>,<span class="at">length =</span> <span class="dv">12</span>)</span>
<span id="cb115-3852"><a href="#cb115-3852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3853"><a href="#cb115-3853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3854"><a href="#cb115-3854" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3855"><a href="#cb115-3855" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-3856"><a href="#cb115-3856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3859"><a href="#cb115-3859" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3860"><a href="#cb115-3860" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/tvmed_dat100.RDS"</span>)</span>
<span id="cb115-3861"><a href="#cb115-3861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3862"><a href="#cb115-3862" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb115-3863"><a href="#cb115-3863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb115-3864"><a href="#cb115-3864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb115-3865"><a href="#cb115-3865" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag1 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-3866"><a href="#cb115-3866" aria-hidden="true" tabindex="-1"></a>    <span class="at">A_lag2 =</span> <span class="fu">lag</span>(Ap, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-3867"><a href="#cb115-3867" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag1 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-3868"><a href="#cb115-3868" aria-hidden="true" tabindex="-1"></a>    <span class="at">M_lag2 =</span> <span class="fu">lag</span>(Mp, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-3869"><a href="#cb115-3869" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag1 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-3870"><a href="#cb115-3870" aria-hidden="true" tabindex="-1"></a>    <span class="at">L1_lag2 =</span> <span class="fu">lag</span>(L1, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb115-3871"><a href="#cb115-3871" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag1 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb115-3872"><a href="#cb115-3872" aria-hidden="true" tabindex="-1"></a>    <span class="at">L2_lag2 =</span> <span class="fu">lag</span>(L2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">100</span>),</span>
<span id="cb115-3873"><a href="#cb115-3873" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag1 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="dv">80</span>),</span>
<span id="cb115-3874"><a href="#cb115-3874" aria-hidden="true" tabindex="-1"></a>    <span class="at">L3_lag2 =</span> <span class="fu">lag</span>(L3, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">default =</span> <span class="dv">80</span>)</span>
<span id="cb115-3875"><a href="#cb115-3875" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb115-3876"><a href="#cb115-3876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3877"><a href="#cb115-3877" aria-hidden="true" tabindex="-1"></a>aaa <span class="ot">&lt;-</span>  <span class="fu">g_boot</span>(<span class="at">data =</span> dat, <span class="at">length =</span> <span class="dv">12</span>, </span>
<span id="cb115-3878"><a href="#cb115-3878" aria-hidden="true" tabindex="-1"></a>               <span class="at">montecarlo =</span> <span class="dv">10000</span>, <span class="at">seed =</span> <span class="dv">444</span>,</span>
<span id="cb115-3879"><a href="#cb115-3879" aria-hidden="true" tabindex="-1"></a>               <span class="at">boostr =</span> T) </span>
<span id="cb115-3880"><a href="#cb115-3880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3881"><a href="#cb115-3881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3882"><a href="#cb115-3882" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3883"><a href="#cb115-3883" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3884"><a href="#cb115-3884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3885"><a href="#cb115-3885" aria-hidden="true" tabindex="-1"></a><span class="fu">## Output</span></span>
<span id="cb115-3886"><a href="#cb115-3886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3887"><a href="#cb115-3887" aria-hidden="true" tabindex="-1"></a>Em có extract những output cần so giữa 2 function với nhau ở dưới</span>
<span id="cb115-3888"><a href="#cb115-3888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3889"><a href="#cb115-3889" aria-hidden="true" tabindex="-1"></a>::: columns</span>
<span id="cb115-3890"><a href="#cb115-3890" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-3891"><a href="#cb115-3891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3892"><a href="#cb115-3892" aria-hidden="true" tabindex="-1"></a>tvmedg</span>
<span id="cb115-3893"><a href="#cb115-3893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3896"><a href="#cb115-3896" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3897"><a href="#cb115-3897" aria-hidden="true" tabindex="-1"></a>aaa2</span>
<span id="cb115-3898"><a href="#cb115-3898" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3899"><a href="#cb115-3899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3900"><a href="#cb115-3900" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3901"><a href="#cb115-3901" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb115-3902"><a href="#cb115-3902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3903"><a href="#cb115-3903" aria-hidden="true" tabindex="-1"></a>g_boot</span>
<span id="cb115-3904"><a href="#cb115-3904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3907"><a href="#cb115-3907" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3908"><a href="#cb115-3908" aria-hidden="true" tabindex="-1"></a>aaa</span>
<span id="cb115-3909"><a href="#cb115-3909" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3910"><a href="#cb115-3910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3911"><a href="#cb115-3911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3912"><a href="#cb115-3912" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3913"><a href="#cb115-3913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3914"><a href="#cb115-3914" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb115-3915"><a href="#cb115-3915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3916"><a href="#cb115-3916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3919"><a href="#cb115-3919" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3920"><a href="#cb115-3920" aria-hidden="true" tabindex="-1"></a><span class="co"># test_that("process_data function", {</span></span>
<span id="cb115-3921"><a href="#cb115-3921" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb115-3922"><a href="#cb115-3922" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,2:6],aaa2[,1:5])</span></span>
<span id="cb115-3923"><a href="#cb115-3923" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T1mp"],aaa2[,"Lmp1"])</span></span>
<span id="cb115-3924"><a href="#cb115-3924" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T2mp"],aaa2[,"Lmp2"])</span></span>
<span id="cb115-3925"><a href="#cb115-3925" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T3mp"],aaa2[,"Lmp3"])</span></span>
<span id="cb115-3926"><a href="#cb115-3926" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T1p"],aaa2[,"Lp1"])</span></span>
<span id="cb115-3927"><a href="#cb115-3927" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T2p"],aaa2[,"Lp2"])</span></span>
<span id="cb115-3928"><a href="#cb115-3928" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,"T3p"],aaa2[,"Lp3"])</span></span>
<span id="cb115-3929"><a href="#cb115-3929" aria-hidden="true" tabindex="-1"></a><span class="co">#   expect_equal(aaa[,c("v1","v2","v3","v4","lastid")],aaa2[,c("v1","v2","v3","v4","lastid")])</span></span>
<span id="cb115-3930"><a href="#cb115-3930" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span>
<span id="cb115-3931"><a href="#cb115-3931" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3932"><a href="#cb115-3932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3933"><a href="#cb115-3933" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extract variables</span></span>
<span id="cb115-3934"><a href="#cb115-3934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3935"><a href="#cb115-3935" aria-hidden="true" tabindex="-1"></a>Ở time 11, am = ap = 1 thì code a Long tính ra Tmp1 = Tp1 = 1 =&gt; dẫn đến các variables Lmp2, Lmp3 khác nhau ở time 12 và cũng có xác suất T1mp có thể ra 1. Ở time 2 am != ap, Tp1 = 1. Em nghĩ vấn đề khác nhau này thì mình chạy nhiều lấy mean thì k sao, nhưng mình k có test coverage cho package mình được.</span>
<span id="cb115-3936"><a href="#cb115-3936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3939"><a href="#cb115-3939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3940"><a href="#cb115-3940" aria-hidden="true" tabindex="-1"></a>cp <span class="ot">&lt;-</span> <span class="fu">cbind</span>(aaa2[,<span class="fu">c</span>(<span class="st">"Ay"</span>,<span class="st">"Am"</span>,<span class="st">"mm"</span>,<span class="st">"M1"</span>,<span class="st">"Lmp1"</span>,<span class="st">"Lmp2"</span>,<span class="st">"Lmp3"</span>,<span class="st">"Lp1"</span>,<span class="st">"Lp2"</span>,<span class="st">"Lp3"</span>,<span class="st">"Yp2"</span>)],aaa[,<span class="fu">c</span>(<span class="st">"M1p"</span>,<span class="st">"T1mp"</span>,<span class="st">"T2mp"</span>,<span class="st">"T3mp"</span>,<span class="st">"T1p"</span>,<span class="st">"T2p"</span>,<span class="st">"T3p"</span>,<span class="st">"Yp"</span>)])</span>
<span id="cb115-3941"><a href="#cb115-3941" aria-hidden="true" tabindex="-1"></a>cp[,<span class="fu">c</span>(<span class="st">"Ay"</span>,<span class="st">"Am"</span>,<span class="st">"mm"</span>,<span class="st">"M1"</span>,<span class="st">"M1p"</span>,<span class="st">"Lmp1"</span>,<span class="st">"T1mp"</span>,<span class="st">"Lmp2"</span>,<span class="st">"T2mp"</span>,<span class="st">"Lmp3"</span>,<span class="st">"T3mp"</span>,<span class="st">"Lp1"</span>,<span class="st">"T1p"</span>,<span class="st">"Lp2"</span>,<span class="st">"T2p"</span>,<span class="st">"Lp3"</span>,<span class="st">"T3p"</span>,<span class="st">"Yp2"</span>,<span class="st">"Yp"</span>)]</span>
<span id="cb115-3942"><a href="#cb115-3942" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-3943"><a href="#cb115-3943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3944"><a href="#cb115-3944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3945"><a href="#cb115-3945" aria-hidden="true" tabindex="-1"></a><span class="fu"># Final tvmedg function</span></span>
<span id="cb115-3946"><a href="#cb115-3946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3949"><a href="#cb115-3949" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-3950"><a href="#cb115-3950" aria-hidden="true" tabindex="-1"></a>tvmedg <span class="ot">&lt;-</span> <span class="cf">function</span>(data,</span>
<span id="cb115-3951"><a href="#cb115-3951" aria-hidden="true" tabindex="-1"></a>                   fix,expo,med,tvar,lag,outc,time,<span class="at">norev =</span> <span class="cn">NULL</span>,<span class="at">LM =</span> <span class="cn">FALSE</span>,</span>
<span id="cb115-3952"><a href="#cb115-3952" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bootstr =</span> <span class="cn">FALSE</span>, <span class="at">seed =</span> <span class="dv">0</span>,</span>
<span id="cb115-3953"><a href="#cb115-3953" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-3954"><a href="#cb115-3954" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-3955"><a href="#cb115-3955" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>,</span>
<span id="cb115-3956"><a href="#cb115-3956" aria-hidden="true" tabindex="-1"></a>                   <span class="at">montecarlo =</span> <span class="dv">10000</span>,<span class="at">length =</span> <span class="dv">12</span>,<span class="at">parallel=</span><span class="cn">TRUE</span>){</span>
<span id="cb115-3957"><a href="#cb115-3957" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3958"><a href="#cb115-3958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb115-3959"><a href="#cb115-3959" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3960"><a href="#cb115-3960" aria-hidden="true" tabindex="-1"></a>  fitR2 <span class="ot">&lt;-</span> <span class="fu">process_data</span>(</span>
<span id="cb115-3961"><a href="#cb115-3961" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix =</span> fix,</span>
<span id="cb115-3962"><a href="#cb115-3962" aria-hidden="true" tabindex="-1"></a>    <span class="at">expo =</span> expo,</span>
<span id="cb115-3963"><a href="#cb115-3963" aria-hidden="true" tabindex="-1"></a>    <span class="at">med =</span> med,</span>
<span id="cb115-3964"><a href="#cb115-3964" aria-hidden="true" tabindex="-1"></a>    <span class="at">tvar =</span> tvar,</span>
<span id="cb115-3965"><a href="#cb115-3965" aria-hidden="true" tabindex="-1"></a>    <span class="at">outc =</span> outc,</span>
<span id="cb115-3966"><a href="#cb115-3966" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag =</span> lag,</span>
<span id="cb115-3967"><a href="#cb115-3967" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> time,</span>
<span id="cb115-3968"><a href="#cb115-3968" aria-hidden="true" tabindex="-1"></a>    <span class="at">norev =</span> norev,</span>
<span id="cb115-3969"><a href="#cb115-3969" aria-hidden="true" tabindex="-1"></a>    <span class="at">LM =</span> LM,</span>
<span id="cb115-3970"><a href="#cb115-3970" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data</span>
<span id="cb115-3971"><a href="#cb115-3971" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb115-3972"><a href="#cb115-3972" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fitg</span>(<span class="at">bootstr=</span>bootstr,</span>
<span id="cb115-3973"><a href="#cb115-3973" aria-hidden="true" tabindex="-1"></a>         <span class="at">mreg =</span> mreg,</span>
<span id="cb115-3974"><a href="#cb115-3974" aria-hidden="true" tabindex="-1"></a>         <span class="at">lreg =</span> lreg,</span>
<span id="cb115-3975"><a href="#cb115-3975" aria-hidden="true" tabindex="-1"></a>         <span class="at">yreg =</span> yreg,<span class="at">dof =</span> dof) <span class="sc">%&gt;%</span> </span>
<span id="cb115-3976"><a href="#cb115-3976" aria-hidden="true" tabindex="-1"></a>    <span class="fu">baseline_mc</span>(<span class="at">montecarlo =</span> montecarlo)</span>
<span id="cb115-3977"><a href="#cb115-3977" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-3978"><a href="#cb115-3978" aria-hidden="true" tabindex="-1"></a>    start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb115-3979"><a href="#cb115-3979" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3980"><a href="#cb115-3980" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (parallel <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb115-3981"><a href="#cb115-3981" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb115-3982"><a href="#cb115-3982" aria-hidden="true" tabindex="-1"></a>      gform_wrapper2 <span class="ot">&lt;-</span> <span class="cf">function</span>(iii, data, length) {</span>
<span id="cb115-3983"><a href="#cb115-3983" aria-hidden="true" tabindex="-1"></a>        outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>)</span>
<span id="cb115-3984"><a href="#cb115-3984" aria-hidden="true" tabindex="-1"></a>        outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb115-3985"><a href="#cb115-3985" aria-hidden="true" tabindex="-1"></a>        outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb115-3986"><a href="#cb115-3986" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bind_rows</span>(outdat11, outdat10, outdat00)</span>
<span id="cb115-3987"><a href="#cb115-3987" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-3988"><a href="#cb115-3988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3989"><a href="#cb115-3989" aria-hidden="true" tabindex="-1"></a>      resultDatM <span class="ot">&lt;-</span> <span class="fu">future_map_dfr</span>(<span class="dv">1</span><span class="sc">:</span>montecarlo,  </span>
<span id="cb115-3990"><a href="#cb115-3990" aria-hidden="true" tabindex="-1"></a>                                   <span class="sc">~</span> <span class="fu">gform_wrapper2</span>(<span class="at">ii =</span> .x, <span class="at">data =</span> fitR2, <span class="at">length =</span> length))</span>
<span id="cb115-3991"><a href="#cb115-3991" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb115-3992"><a href="#cb115-3992" aria-hidden="true" tabindex="-1"></a>      resultDatM <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb115-3993"><a href="#cb115-3993" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (iii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>montecarlo){</span>
<span id="cb115-3994"><a href="#cb115-3994" aria-hidden="true" tabindex="-1"></a>        outdat11 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">1</span>)</span>
<span id="cb115-3995"><a href="#cb115-3995" aria-hidden="true" tabindex="-1"></a>        outdat10 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">1</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb115-3996"><a href="#cb115-3996" aria-hidden="true" tabindex="-1"></a>        outdat00 <span class="ot">&lt;-</span> <span class="fu">g_form</span>(<span class="at">ii =</span> iii,<span class="at">data=</span>data, <span class="at">length =</span> length, <span class="at">ay =</span> <span class="dv">0</span>, <span class="at">am =</span> <span class="dv">0</span>)</span>
<span id="cb115-3997"><a href="#cb115-3997" aria-hidden="true" tabindex="-1"></a>        resultDatM2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(outdat11, outdat10, outdat00)</span>
<span id="cb115-3998"><a href="#cb115-3998" aria-hidden="true" tabindex="-1"></a>        resultDatM <span class="ot">&lt;-</span> <span class="fu">rbind</span>(resultDatM,resultDatM2)</span>
<span id="cb115-3999"><a href="#cb115-3999" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb115-4000"><a href="#cb115-4000" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb115-4001"><a href="#cb115-4001" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-4002"><a href="#cb115-4002" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-4003"><a href="#cb115-4003" aria-hidden="true" tabindex="-1"></a>  end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb115-4004"><a href="#cb115-4004" aria-hidden="true" tabindex="-1"></a>  elapsed_time <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span>
<span id="cb115-4005"><a href="#cb115-4005" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-4006"><a href="#cb115-4006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(elapsed_time)</span>
<span id="cb115-4007"><a href="#cb115-4007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultDatM)</span>
<span id="cb115-4008"><a href="#cb115-4008" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-4009"><a href="#cb115-4009" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-4010"><a href="#cb115-4010" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-4011"><a href="#cb115-4011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4012"><a href="#cb115-4012" aria-hidden="true" tabindex="-1"></a>Em chạy trước montecarlo = 100 tại chạy 10000 nó lâu quá :)))</span>
<span id="cb115-4013"><a href="#cb115-4013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4016"><a href="#cb115-4016" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-4017"><a href="#cb115-4017" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb115-4018"><a href="#cb115-4018" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb115-4019"><a href="#cb115-4019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4020"><a href="#cb115-4020" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">8</span>)</span>
<span id="cb115-4021"><a href="#cb115-4021" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb115-4022"><a href="#cb115-4022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4023"><a href="#cb115-4023" aria-hidden="true" tabindex="-1"></a>datMC <span class="ot">&lt;-</span> <span class="fu">tvmedg</span>(<span class="at">data =</span> dat0,</span>
<span id="cb115-4024"><a href="#cb115-4024" aria-hidden="true" tabindex="-1"></a>       <span class="at">fix =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"ow"</span>,<span class="st">"risk"</span>),</span>
<span id="cb115-4025"><a href="#cb115-4025" aria-hidden="true" tabindex="-1"></a>       <span class="at">expo =</span> <span class="fu">c</span>(<span class="st">"Ap"</span>),</span>
<span id="cb115-4026"><a href="#cb115-4026" aria-hidden="true" tabindex="-1"></a>       <span class="at">med =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-4027"><a href="#cb115-4027" aria-hidden="true" tabindex="-1"></a>       <span class="at">tvar =</span> <span class="fu">c</span>(<span class="st">"L1"</span>,<span class="st">"L2"</span>,<span class="st">"L3"</span>),</span>
<span id="cb115-4028"><a href="#cb115-4028" aria-hidden="true" tabindex="-1"></a>       <span class="at">outc =</span> <span class="fu">c</span>(<span class="st">"Yp"</span>),</span>
<span id="cb115-4029"><a href="#cb115-4029" aria-hidden="true" tabindex="-1"></a>       <span class="at">lag =</span> <span class="dv">2</span>,</span>
<span id="cb115-4030"><a href="#cb115-4030" aria-hidden="true" tabindex="-1"></a>       <span class="at">norev =</span> <span class="fu">c</span>(<span class="st">"Mp"</span>),</span>
<span id="cb115-4031"><a href="#cb115-4031" aria-hidden="true" tabindex="-1"></a>       <span class="at">time =</span> <span class="fu">c</span>(<span class="st">"mm"</span>),</span>
<span id="cb115-4032"><a href="#cb115-4032" aria-hidden="true" tabindex="-1"></a>       <span class="at">LM =</span> F,</span>
<span id="cb115-4033"><a href="#cb115-4033" aria-hidden="true" tabindex="-1"></a>       <span class="at">bootstr =</span> T,</span>
<span id="cb115-4034"><a href="#cb115-4034" aria-hidden="true" tabindex="-1"></a>       <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb115-4035"><a href="#cb115-4035" aria-hidden="true" tabindex="-1"></a>       <span class="at">mreg =</span> <span class="st">"binomial"</span>,</span>
<span id="cb115-4036"><a href="#cb115-4036" aria-hidden="true" tabindex="-1"></a>       <span class="at">lreg =</span> <span class="fu">c</span>(<span class="st">"binomial"</span>,<span class="st">"gaussian"</span>,<span class="st">"gaussian"</span>),</span>
<span id="cb115-4037"><a href="#cb115-4037" aria-hidden="true" tabindex="-1"></a>       <span class="at">yreg =</span> <span class="st">"binomial"</span>,<span class="at">dof =</span> <span class="dv">3</span>,</span>
<span id="cb115-4038"><a href="#cb115-4038" aria-hidden="true" tabindex="-1"></a>       <span class="at">montecarlo =</span> <span class="dv">100</span>,<span class="at">length =</span> <span class="dv">12</span>,</span>
<span id="cb115-4039"><a href="#cb115-4039" aria-hidden="true" tabindex="-1"></a>       <span class="at">parallel=</span><span class="cn">TRUE</span>)</span>
<span id="cb115-4040"><a href="#cb115-4040" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-4041"><a href="#cb115-4041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4044"><a href="#cb115-4044" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-4045"><a href="#cb115-4045" aria-hidden="true" tabindex="-1"></a>ExtResult <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb115-4046"><a href="#cb115-4046" aria-hidden="true" tabindex="-1"></a>  Q11 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Am <span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb115-4047"><a href="#cb115-4047" aria-hidden="true" tabindex="-1"></a>  Q10 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Am <span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb115-4048"><a href="#cb115-4048" aria-hidden="true" tabindex="-1"></a>  Q00 <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(lastid <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Ay <span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> Am <span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb115-4049"><a href="#cb115-4049" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-4050"><a href="#cb115-4050" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(1,1):"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q11<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb115-4051"><a href="#cb115-4051" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(1,0):"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q10<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb115-4052"><a href="#cb115-4052" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Q(0,0):"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q00<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb115-4053"><a href="#cb115-4053" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-4054"><a href="#cb115-4054" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Indirect:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q11<span class="sc">$</span>Yp) <span class="sc">-</span> <span class="fu">mean</span>(Q10<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb115-4055"><a href="#cb115-4055" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Direct:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q10<span class="sc">$</span>Yp) <span class="sc">-</span> <span class="fu">mean</span>(Q00<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb115-4056"><a href="#cb115-4056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Total:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(Q11<span class="sc">$</span>Yp) <span class="sc">-</span> <span class="fu">mean</span>(Q00<span class="sc">$</span>Yp), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb115-4057"><a href="#cb115-4057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Proportional explain:"</span>, </span>
<span id="cb115-4058"><a href="#cb115-4058" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>((<span class="fu">mean</span>(Q11<span class="sc">$</span>Yp) <span class="sc">-</span> <span class="fu">mean</span>(Q10<span class="sc">$</span>Yp))<span class="sc">/</span>(<span class="fu">mean</span>(Q11<span class="sc">$</span>Yp) <span class="sc">-</span> <span class="fu">mean</span>(Q00<span class="sc">$</span>Yp)), <span class="dv">3</span>),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb115-4059"><a href="#cb115-4059" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb115-4060"><a href="#cb115-4060" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-4061"><a href="#cb115-4061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4064"><a href="#cb115-4064" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb115-4065"><a href="#cb115-4065" aria-hidden="true" tabindex="-1"></a><span class="fu">ExtResult</span>(datMC)</span>
<span id="cb115-4066"><a href="#cb115-4066" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb115-4067"><a href="#cb115-4067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4068"><a href="#cb115-4068" aria-hidden="true" tabindex="-1"></a><span class="fu"># Note</span></span>
<span id="cb115-4069"><a href="#cb115-4069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4070"><a href="#cb115-4070" aria-hidden="true" tabindex="-1"></a>Note những vấn đề e còn thắc mắc:</span>
<span id="cb115-4071"><a href="#cb115-4071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4072"><a href="#cb115-4072" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Em chưa hiểu intergration của montecarlo sẽ làm như thế nào.</span>
<span id="cb115-4073"><a href="#cb115-4073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4074"><a href="#cb115-4074" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Việc 2 function cho ra kết quả khác nhau khi ay != am. Em vẫn đang lăn tăn là do em code có sai k. Em đã check việc dùng data và formula để fit và em vẫn nghĩ do tính random của rFunc() và Pfunc() nên ra kết quả khác nhau.</span>
<span id="cb115-4075"><a href="#cb115-4075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4076"><a href="#cb115-4076" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Em chưa làm function để tính 95% CI.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>